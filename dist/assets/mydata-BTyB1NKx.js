import{r,j as t}from"./index--N4c26ck.js";import{T,a as D,b as L,c as j,C as v,d as k,e as y,f as O}from"./table-DKhPwKfP.js";function R(){const[c,M]=r.useState([]),[N,S]=r.useState(!1),[A,b]=r.useState(null);r.useEffect(()=>{const e=new AbortController;async function a(){try{S(!0),b(null);const s=await fetch("/api/mydata",{signal:e.signal});if(!s.ok)throw new Error(`Failed to fetch data: ${s.status}`);const n=await s.json();M(n)}catch(s){s.name!=="AbortError"&&b(s.message??String(s))}finally{S(!1)}}return a(),()=>e.abort()},[]);const[l,m]=r.useState({tag:"",name:"",value:""}),[u,w]=r.useState(null),[x,C]=r.useState("asc"),[f,o]=r.useState(null),g=r.useMemo(()=>{const e=Array.from(new Set(c.map(n=>n.tag))).sort(),a=Array.from(new Set(c.map(n=>n.name))).sort(),s=Array.from(new Set(c.map(n=>n.value))).sort();return{tag:e,name:a,value:s}},[c]),h=e=>()=>{w(e),C("asc"),o(null)},p=e=>()=>{w(e),C("desc"),o(null)},E=r.useMemo(()=>{function e(s,n){if(Array.isArray(s))return s.length===0?!0:s.map(d=>d.toLowerCase()).includes(String(n).toLowerCase());const i=String(s).trim().toLowerCase();return i?String(n).toLowerCase().includes(i):!0}let a=c.filter(s=>e(l.tag,s.tag)&&e(l.name,s.name)&&e(l.value,s.value));return u&&(a=[...a].sort((s,n)=>{const i=String(s[u]).toLowerCase(),d=String(n[u]).toLowerCase();return i<d?x==="asc"?-1:1:i>d?x==="asc"?1:-1:0})),a},[c,l,u,x]);return r.useEffect(()=>{const e=a=>{a.target.closest("[data-col-menu-root]")||o(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),t.jsxs("div",{className:"h-full w-full flex flex-col min-h-0",children:[t.jsx("div",{className:"flex items-center gap-3 mb-3 text-sm text-muted-foreground"}),t.jsxs("div",{className:"flex-1 min-h-0 rounded-md border","data-col-menu-root":!0,children:[N?t.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"Loading dataâ€¦"}):A?t.jsxs("div",{className:"p-3 text-sm text-destructive",children:["Error: ",A]}):null,t.jsxs(T,{children:[t.jsx(D,{children:t.jsxs(L,{children:[t.jsx(j,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:"Tag"}),t.jsx(v,{col:"tag",openMenu:f,setOpenMenu:e=>o(e),values:g.tag,selectedValues:Array.isArray(l.tag)?l.tag:[],onApplySelection:e=>{m(a=>({...a,tag:e})),o(null)},sortAsc:h,sortDesc:p})]})}),t.jsx(j,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:"Name"}),t.jsx(v,{col:"name",openMenu:f,setOpenMenu:e=>o(e),values:g.name,selectedValues:Array.isArray(l.name)?l.name:[],onApplySelection:e=>{m(a=>({...a,name:e})),o(null)},sortAsc:h,sortDesc:p})]})}),t.jsx(j,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:"Value"}),t.jsx(v,{col:"value",openMenu:f,setOpenMenu:e=>o(e),values:g.value,selectedValues:Array.isArray(l.value)?l.value:[],onApplySelection:e=>{m(a=>({...a,value:e})),o(null)},sortAsc:h,sortDesc:p})]})})]})}),t.jsx(k,{children:E.map((e,a)=>t.jsxs(L,{children:[t.jsx(y,{children:e.tag}),t.jsx(y,{children:e.name}),t.jsx(y,{children:e.value})]},`${e.tag}-${e.name}-${a}`))}),t.jsxs(O,{children:[E.length," rows"]})]})]})]})}export{R as default};
