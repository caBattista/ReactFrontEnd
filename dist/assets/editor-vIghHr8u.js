import{r as Wr,j as Jl}from"./index--N4c26ck.js";let pt=class SM{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),Lf.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Lf.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new $h(this),r=new $h(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new $h(this,t)}iterRange(t,e=this.length){return new vM(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new kM(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?SM.empty:t.length<=32?new Zi(t):Lf.from(Zi.split(t,[]))}},Zi=class Rn extends pt{constructor(t,e=EI(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new PI(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new Rn(Dx(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=Vf(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Rn(l,o.length+r.length));else{let h=l.length>>1;i.push(new Rn(l.slice(0,h)),new Rn(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof Rn))return super.replace(t,e,i);let n=Vf(this.text,Vf(i.text,Dx(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new Rn(n,r):Lf.from(Rn.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new Rn(i,n)),i=[],n=-1);return n>-1&&e.push(new Rn(i,n)),e}},Lf=class Jr extends pt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new Jr(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Jr))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new Zi(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof Jr)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof Zi&&h&&(g=c[c.length-1])instanceof Zi&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new Zi(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:Jr.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new Jr(l,e)}};pt.empty=new Zi([""],0);function EI(s){let t=-1;for(let e of s)t+=e.length+1;return t}function Vf(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function Dx(s,t,e){return Vf(s,[""],t,e)}let $h=class{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof Zi?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof Zi?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof Zi){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof Zi?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}},vM=class{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new $h(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},kM=class{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(pt.prototype[Symbol.iterator]=function(){return this.iter()},$h.prototype[Symbol.iterator]=vM.prototype[Symbol.iterator]=kM.prototype[Symbol.iterator]=function(){return this});let PI=class{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}},Ao="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<Ao.length;s++)Ao[s]+=Ao[s-1];function LI(s){for(let t=1;t<Ao.length;t+=2)if(Ao[t]>s)return Ao[t-1]<=s;return!1}function Ox(s){return s>=127462&&s<=127487}const Tx=8205;function ps(s,t,e=!0,i=!0){return(e?AM:VI)(s,t,i)}function AM(s,t,e){if(t==s.length)return t;t&&CM(s.charCodeAt(t))&&MM(s.charCodeAt(t-1))&&t--;let i=If(s,t);for(t+=$x(i);t<s.length;){let n=If(s,t);if(i==Tx||n==Tx||e&&LI(n))t+=$x(n),i=n;else if(Ox(n)){let r=0,o=t-2;for(;o>=0&&Ox(If(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function VI(s,t,e){for(;t>0;){let i=AM(s,t-2,e);if(i<t)return i;t--}return 0}function CM(s){return s>=56320&&s<57344}function MM(s){return s>=55296&&s<56320}function If(s,t){let e=s.charCodeAt(t);if(!MM(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return CM(i)?(e-55296<<10)+(i-56320)+65536:e}function $x(s){return s<65536?1:2}const Up=/\r\n?|\n/;var mi=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(mi||(mi={}));let Rh=class Nf{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){Jp(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new Nf(t)}composeDesc(t){return this.empty?t:t.empty?this:DM(this,t)}mapDesc(t,e=!1){return t.empty?this:Yp(this,t,e)}mapPos(t,e=-1,i=mi.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=mi.Simple&&a>=t&&(i==mi.TrackDel&&n<t&&a>t||i==mi.TrackBefore&&n<t||i==mi.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Nf(t)}static create(t){return new Nf(t)}},ss=class $s extends Rh{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Jp(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return Yp(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(pt.empty);i.push(o?t.slice(r,r+o):pt.empty)}r+=o}return new $s(e,i)}compose(t){return this.empty?t:t.empty?this:DM(this,t,!0)}map(t,e=!1){return t.empty?this:Yp(this,t,e,!0)}iterChanges(t,e=!1){Jp(this,t,e)}get desc(){return Rh.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new oa(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Ee(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Ee(e,c,f),f>0&&fr(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Ee(e,c,-1),Ee(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new $s(e,i),filtered:Rh.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Ee(n,e-o,-1);let f=new $s(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof $s){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?pt.of(d.split(i||Up)):d:pt.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Ee(n,f-o,-1),Ee(n,u-f,m),fr(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new $s(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(pt.empty);i[n]=pt.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new $s(e,i)}static createSet(t,e){return new $s(t,e)}};function Ee(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function fr(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(pt.empty);s.push(e)}}function Jp(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=pt.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function Yp(s,t,e,i=!1){let n=[],r=i?[]:null,o=new oa(s),l=new oa(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let c=Math.min(l.len,h-a);l.forward(c),Ee(n,c,-1),a+=c}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(Ee(n,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let c=0,f=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<f)c+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<f){let u=Math.min(l.len,f-a);c+=u,l.forward(u),a+=u}else break;Ee(n,c,o.ins),r&&fr(r,n,o.text),h=f,o.next()}else{if(o.done&&l.done)return r?ss.createSet(n,r):Rh.create(n);throw new Error("Mismatched change set lengths")}}function DM(s,t,e=!1){let i=[],n=e?[]:null,r=new oa(s),o=new oa(t);for(let l=!1;;){if(r.done&&o.done)return n?ss.createSet(i,n):Rh.create(i);if(r.ins==0)Ee(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Ee(i,0,o.ins,l),n&&fr(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Ee(i,h,c,l),n&&c&&fr(n,i,o.text)}else o.ins==-1?(Ee(i,r.off?0:r.len,h,l),n&&fr(n,i,r.textBit(h))):(Ee(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&fr(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}let oa=class{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?pt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?pt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}},Mc=class Xp{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new Xp(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return N.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return N.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return N.range(t.anchor,t.head)}static create(t,e,i){return new Xp(t,e,i)}},N=class ai{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:ai.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ai([this.main],0)}addRange(t,e=!0){return ai.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,ai.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ai(t.ranges.map(e=>Mc.fromJSON(e)),t.main)}static single(t,e=t){return new ai([ai.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return ai.normalized(t.slice(),e);i=r.to}return new ai(t,e)}static cursor(t,e=0,i,n){return Mc.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n??33554431)<<5)}static range(t,e,i){let n=(i??33554431)<<5;return e<t?Mc.create(e,t,16|n|8):Mc.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?ai.range(h,l):ai.range(l,h))}}return new ai(t,e)}};function OM(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let nb=0,K=class TM{constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=r,this.id=nb++,this.default=t([])}static define(t={}){return new TM(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:sb),!!t.static,t.enables)}of(t){return new Hf([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Hf(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Hf(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}};function sb(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}let Hf=class{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=nb++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||Zp(f,c)){let d=i(f);if(l?!Rx(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d=i(f),g=u.config.address[r];if(g!=null){let m=Uu(u,g);if(this.dependencies.every(p=>p instanceof K?u.facet(p)===f.facet(p):p instanceof nc?u.field(p,!1)==f.field(p,!1):!0)||(l?Rx(d,m,n):n(d,m)))return f.values[o]=m,0}return f.values[o]=d,1}}}};function Rx(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function Zp(s,t){let e=!1;for(let i of t)Bh(s,i)&1&&(e=!0);return e}function II(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=Uu(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)Bh(h,a);return h.values[o]=l(h),1},update(h,a){if(!Zp(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=Zp(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&sb(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const Bx=K.define({static:!0});let nc=class $M{constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new $M(nb++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Bx).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,Bx.of({field:this,create:t})]}get extension(){return this}};const Yr={lowest:4,low:3,default:2,high:1,highest:0};function Rl(s){return t=>new BM(t,s)}const RM={highest:Rl(Yr.highest),high:Rl(Yr.high),default:Rl(Yr.default),low:Rl(Yr.low),lowest:Rl(Yr.lowest)};let BM=class{constructor(t,e){this.inner=t,this.prec=e}},EM=class PM{of(t){return new Qp(this,t)}reconfigure(t){return PM.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}},Qp=class{constructor(t,e){this.compartment=t,this.inner=e}},Ex=class LM{constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of NI(t,e,o))u instanceof nc?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,sb(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>II(p,g,d))}}let f=a.map(u=>u(l));return new LM(t,o,f,l,h,r)}};function NI(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof Qp&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof Qp){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof BM)r(o.inner,o.prec);else if(o instanceof nc)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof Hf)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,Yr.default),i.reduce((o,l)=>o.concat(l))}function Bh(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function Uu(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const VM=K.define(),IM=K.define({combine:s=>s.some(t=>t),static:!0}),NM=K.define({combine:s=>s.length?s[0]:void 0,static:!0}),HM=K.define(),FM=K.define(),WM=K.define(),zM=K.define({combine:s=>s.length?s[0]:!1});let sc=class{constructor(t,e){this.type=t,this.value=e}static define(){return new HI}},HI=class{of(t){return new sc(this,t)}},FI=class{constructor(t){this.map=t}of(t){return new Ae(this,t)}},Ae=class qM{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new qM(this.type,e)}is(t){return this.type==t}static define(t={}){return new FI(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}};Ae.reconfigure=Ae.define();Ae.appendConfig=Ae.define();let fn=class Yl{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&OM(i,e.newLength),r.some(l=>l.type==Yl.time)||(this.annotations=r.concat(Yl.time.of(Date.now())))}static create(t,e,i,n,r,o){return new Yl(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(Yl.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}};fn.time=sc.define();fn.userEvent=sc.define();fn.addToHistory=sc.define();fn.remote=sc.define();function WI(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function KM(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=ss.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:Ae.mapEffects(s.effects,n).concat(Ae.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function _p(s,t,e){let i=t.selection,n=Co(t.annotations);return t.userEvent&&(n=n.concat(fn.userEvent.of(t.userEvent))),{changes:t.changes instanceof ss?t.changes:ss.of(t.changes||[],e,s.facet(NM)),selection:i&&(i instanceof N?i:N.single(i.anchor,i.head)),effects:Co(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function GM(s,t,e){let i=_p(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=KM(i,_p(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=fn.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return qI(e?zI(n):n)}function zI(s){let t=s.startState,e=!0;for(let n of t.facet(HM)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:WI(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=ss.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.invertedDesc}s=fn.create(t,n,s.selection&&s.selection.map(r),Ae.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(FM);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof fn?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof fn?s=r[0]:s=GM(t,Co(r),!1)}return s}function qI(s){let t=s.startState,e=t.facet(WM),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=KM(s,_p(t,r,s.changes.newLength),!0))}return i==s?s:fn.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const KI=[];function Co(s){return s==null?KI:Array.isArray(s)?s:[s]}var ms=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(ms||(ms={}));const GI=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let tm;try{tm=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function jI(s){if(tm)return tm.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||GI.test(e)))return!0}return!1}function UI(s){return t=>{if(!/\S/.test(t))return ms.Space;if(jI(t))return ms.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return ms.Word;return ms.Other}}let We=class Ni{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Bh(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return Bh(this,i),Uu(this,i)}update(...t){return GM(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(EM.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(Ae.reconfigure)?(e=null,i=o.value):o.is(Ae.appendConfig)&&(e=null,i=Co(i).concat(o.value));let r;e?r=t.startState.values.slice():(e=Ex.resolve(i,n,this),r=new Ni(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new Ni(e,t.newDoc,t.newSelection,r,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:N.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=Co(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=Ae.mapEffects(o,c).concat(Ae.mapEffects(Co(h.effects),f))}return{changes:n,selection:N.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof ss?t:ss.of(t,this.doc.length,this.facet(Ni.lineSeparator))}toText(t){return pt.of(t.split(this.facet(Ni.lineSeparator)||Up))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Bh(this,e),Uu(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof nc&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}return Ni.create({doc:t.doc,selection:N.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=Ex.resolve(t.extensions||[],new Map),i=t.doc instanceof pt?t.doc:pt.of((t.doc||"").split(e.staticFacet(Ni.lineSeparator)||Up)),n=t.selection?t.selection instanceof N?t.selection:N.single(t.selection.anchor,t.selection.head):N.single(0);return OM(n,i.length),e.staticFacet(IM)||(n=n.asSingle()),new Ni(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(Ni.tabSize)}get lineBreak(){return this.facet(Ni.lineSeparator)||`
`}get readOnly(){return this.facet(zM)}phrase(t,...e){for(let i of this.facet(Ni.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(VM))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return UI(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=ps(e,o,!1);if(r(e.slice(h,o))!=ms.Word)break;o=h}for(;l<n;){let h=ps(e,l);if(r(e.slice(l,h))!=ms.Word)break;l=h}return o==l?null:N.range(o+i,l+i)}};We.allowMultipleSelections=IM;We.tabSize=K.define({combine:s=>s.length?s[0]:4});We.lineSeparator=NM;We.readOnly=zM;We.phrases=K.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});We.languageData=VM;We.changeFilter=HM;We.transactionFilter=FM;We.transactionExtender=WM;EM.reconfigure=Ae.define();function rb(s,t,e={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}let _o=class{eq(t){return this==t}range(t,e=t){return em.create(t,e,this)}};_o.prototype.startSide=_o.prototype.endSide=0;_o.prototype.point=!1;_o.prototype.mapMode=mi.TrackDel;let em=class jM{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new jM(t,e,i)}};function im(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}let JI=class UM{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new UM(n,r,i,l):null,pos:o}}},se=class Xr{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new Xr(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(im)),this.isEmpty)return e.length?Xr.of(e):this;let l=new YM(this,null,-1).goto(0),h=0,a=[],c=new nm;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(em.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?Xr.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new Xr(i,e,r||Xr.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return sm.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return sm.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=Px(o,l,i),a=new Bl(o,h,r),c=new Bl(l,h,r);i.iterGaps((f,u,d)=>Lx(a,f,c,u,d,n)),i.empty&&i.length==0&&Lx(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=Px(r,o),h=new Bl(r,l,0).goto(i),a=new Bl(o,l,0).goto(i);for(;;){if(h.to!=a.to||!rm(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new Bl(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new nm;for(let n of t instanceof em?[t]:e?YI(t):t)i.add(n.from,n.to,n.value);return i.finish()}};se.empty=new se([],[],null,-1);function YI(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(im(t,i)>0)return s.slice().sort(im);t=i}return s}se.empty.nextLayer=se.empty;let nm=class JM{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new JI(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new JM)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(se.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=se.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}};function Px(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}let YM=class{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}},sm=class XM{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new YM(o,e,i,r));return n.length==1?n[0]:new XM(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)Ag(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)Ag(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Ag(this.heap,0)}}};function Ag(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}let Bl=class{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=sm.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Dc(this.active,t),Dc(this.activeTo,t),Dc(this.activeRank,t),this.minActive=Vx(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;Oc(this.active,e,i),Oc(this.activeTo,e,n),Oc(this.activeRank,e,r),t&&Oc(t,e,this.cursor.from),this.minActive=Vx(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&Dc(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}};function Lx(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to||s.endSide-e.endSide,c=a<0?s.to+h:e.to,f=Math.min(c,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&rm(s.activeForPoint(s.to+h),e.activeForPoint(e.to))||r.comparePoint(l,f,s.point,e.point):f>l&&!rm(s.active,e.active)&&r.compareRange(l,f,s.active,e.active),c>o)break;l=c,a<=0&&s.next(),a>=0&&e.next()}}function rm(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function Dc(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function Oc(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function Vx(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function ZM(s,t,e=s.length){let i=0;for(let n=0;n<e;)s.charCodeAt(n)==9?(i+=t-i%t,n++):(i++,n=ps(s,n));return i}function om(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=ps(s,n)}return i===!0?-1:s.length}const lm="ͼ",Ix=typeof Symbol>"u"?"__"+lm:Symbol.for(lm),hm=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Nx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class I{constructor(t,e){this.rules=[];let{finish:i}=e||{};function n(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function r(o,l,h,a){let c=[],f=/^@(\w+)\b/.exec(o[0]),u=f&&f[1]=="keyframes";if(f&&l==null)return h.push(o[0]+";");for(let d in l){let g=l[d];if(/&/.test(d))r(d.split(/,\s*/).map(m=>o.map(p=>m.replace(/&/,p))).reduce((m,p)=>m.concat(p)),g,h);else if(g&&typeof g=="object"){if(!f)throw new RangeError("The value of a property ("+d+") should be a primitive value.");r(n(d),g,c,u)}else g!=null&&c.push(d.replace(/_.*/,"").replace(/[A-Z]/g,m=>"-"+m.toLowerCase())+": "+g+";")}(c.length||u)&&h.push((i&&!f&&!a?o.map(i):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in t)r(n(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=Nx[Ix]||1;return Nx[Ix]=t+1,lm+t.toString(36)}static mount(t,e,i){let n=t[hm],r=i&&i.nonce;n?r&&n.setNonce(r):n=new XI(t,r),n.mount(Array.isArray(e)?e:[e],t)}}let Hx=new Map;class XI{constructor(t,e){let i=t.ownerDocument||t,n=i.defaultView;if(!t.head&&t.adoptedStyleSheets&&n.CSSStyleSheet){let r=Hx.get(i);if(r)return t[hm]=r;this.sheet=new n.CSSStyleSheet,Hx.set(i,this)}else this.styleTag=i.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);this.modules=[],t[hm]=this}mount(t,e){let i=this.sheet,n=0,r=0;for(let o=0;o<t.length;o++){let l=t[o],h=this.modules.indexOf(l);if(h<r&&h>-1&&(this.modules.splice(h,1),r--,h=-1),h==-1){if(this.modules.splice(r++,0,l),i)for(let a=0;a<l.rules.length;a++)i.insertRule(l.rules[a],n++)}else{for(;r<h;)n+=this.modules[r++].rules.length;n+=l.rules.length,r++}}if(i)e.adoptedStyleSheets.indexOf(this.sheet)<0&&(e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets]);else{let o="";for(let h=0;h<this.modules.length;h++)o+=this.modules[h].getRules()+`
`;this.styleTag.textContent=o;let l=e.head||e;this.styleTag.parentNode!=l&&l.insertBefore(this.styleTag,l.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}var rs={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ju={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},ZI=typeof navigator<"u"&&/Mac/.test(navigator.platform),QI=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var pe=0;pe<10;pe++)rs[48+pe]=rs[96+pe]=String(pe);for(var pe=1;pe<=24;pe++)rs[pe+111]="F"+pe;for(var pe=65;pe<=90;pe++)rs[pe]=String.fromCharCode(pe+32),Ju[pe]=String.fromCharCode(pe);for(var Cg in rs)Ju.hasOwnProperty(Cg)||(Ju[Cg]=rs[Cg]);function ob(s){var t=ZI&&s.metaKey&&s.shiftKey&&!s.ctrlKey&&!s.altKey||QI&&s.shiftKey&&s.key&&s.key.length==1||s.key=="Unidentified",e=!t&&s.key||(s.shiftKey?Ju:rs)[s.keyCode]||s.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}function Yu(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function tl(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function _I(){let s=document.activeElement;for(;s&&s.shadowRoot;)s=s.shadowRoot.activeElement;return s}function am(s,t){if(!t.anchorNode)return!1;try{return tl(s,t.anchorNode)}catch{return!1}}function la(s){return s.nodeType==3?ha(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function Xu(s,t,e,i){return e?Fx(s,t,e,i,-1)||Fx(s,t,e,i,1):!1}function cm(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function Fx(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:Zu(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=cm(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?Zu(s):0}else return!1}}function Zu(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}const QM={left:0,right:0,top:0,bottom:0};function jd(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function t8(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function e8(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView;for(let c=s;c;)if(c.nodeType==1){let f,u=c==h.body;if(u)f=t8(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let m=c.getBoundingClientRect();f={left:m.left,right:m.left+c.clientWidth,top:m.top,bottom:m.top+c.clientHeight}}let d=0,g=0;if(n=="nearest")t.top<f.top?(g=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+g&&(g=t.bottom-f.bottom+g+o)):t.bottom>f.bottom&&(g=t.bottom-f.bottom+o,e<0&&t.top-g<f.top&&(g=-(f.top+g-t.top+o)));else{let m=t.bottom-t.top,p=f.bottom-f.top;g=(n=="center"&&m<=p?t.top+m/2-p/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-p+o)-f.top}if(i=="nearest"?t.left<f.left?(d=-(f.left-t.left+r),e>0&&t.right>f.right+d&&(d=t.right-f.right+d+r)):t.right>f.right&&(d=t.right-f.right+r,e<0&&t.left<f.left+d&&(d=-(f.left+d-t.left+r))):d=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,d||g)if(u)a.scrollBy(d,g);else{if(g){let m=c.scrollTop;c.scrollTop+=g,g=c.scrollTop-m}if(d){let m=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-m}t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(u)break;c=c.assignedSlot||c.parentNode,i=n="nearest"}else if(c.nodeType==11)c=c.host;else break}let i8=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}},zr=null;function _M(s){if(s.setActive)return s.setActive();if(zr)return s.focus(zr);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(zr==null?{get preventScroll(){return zr={preventScroll:!0},!0}}:void 0),!zr){zr=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let Wx;function ha(s,t,e=t){let i=Wx||(Wx=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function Eh(s,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function n8(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function tD(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}let Ue=class fm{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new fm(t.parentNode,cm(t),e)}static after(t,e){return new fm(t.parentNode,cm(t)+1,e)}};const lb=[];let Zt=class um{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let r of this.children){if(r.dirty){if(!r.dom&&(n=i?i.nextSibling:e.firstChild)){let o=um.get(n);(!o||!o.parent&&o.constructor==r.constructor)&&r.reuseDOM(n)}r.sync(t),r.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=r.dom&&(t.written=!0),r.dom.parentNode==e)for(;n&&n!=r.dom;)n=zx(n);else e.insertBefore(r.dom,n);i=r.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=zx(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=Zu(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!um.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=lb){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new eD(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}};Zt.prototype.breakAfter=0;function zx(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}let eD=class{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function iD(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function nD(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,iD(s,a,c,l,h,i,0,n,r)}let yi=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},dm=typeof document<"u"?document:{documentElement:{style:{}}};const gm=/Edge\/(\d+)/.exec(yi.userAgent),sD=/MSIE \d/.test(yi.userAgent),pm=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(yi.userAgent),Ud=!!(sD||pm||gm),qx=!Ud&&/gecko\/(\d+)/i.test(yi.userAgent),Mg=!Ud&&/Chrome\/(\d+)/.exec(yi.userAgent),s8="webkitFontSmoothing"in dm.documentElement.style,rD=!Ud&&/Apple Computer/.test(yi.vendor),Kx=rD&&(/Mobile\/\w+/.test(yi.userAgent)||yi.maxTouchPoints>2);var T={mac:Kx||/Mac/.test(yi.platform),windows:/Win/.test(yi.platform),linux:/Linux|X11/.test(yi.platform),ie:Ud,ie_version:sD?dm.documentMode||6:pm?+pm[1]:gm?+gm[1]:0,gecko:qx,gecko_version:qx?+(/Firefox\/(\d+)/.exec(yi.userAgent)||[0,0])[1]:0,chrome:!!Mg,chrome_version:Mg?+Mg[1]:0,ios:Kx,android:/Android\b/.test(yi.userAgent),safari:rD,webkit_version:s8?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:dm.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const r8=256;let aa=class mm extends Zt{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof mm)||this.length-(e-t)+i.length>r8)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new mm(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Ue(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return wm(this.dom,t,e)}},Ar=class ym extends Zt{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(tD(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,r,o){return i&&(!(i instanceof ym&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(nD(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new ym(this.mark,e,o)}domAtPos(t){return hD(this.dom,this.children,t)}coordsAt(t,e){return cD(this,t,e)}};function wm(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?T.chrome||T.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=ha(s,n,r).getClientRects();if(!l.length)return QM;let h=l[(o?o<0:e>=0)?0:l.length-1];return T.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?jd(h,o<0):h||null}let hb=class Xl extends Zt{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||Xl)(t,e,i)}split(t){let e=Xl.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof Xl)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof Xl&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return pt.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):pt.empty}domAtPos(t){return t==0?Ue.before(this.dom):Ue.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return QM;for(let r=t>0?i.length-1:0;n=i[r],!(t>0?r==0:r==i.length-1||n.top<n.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:jd(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},oD=class extends hb{domAtPos(t){let{topView:e,text:i}=this.widget;return e?bm(t,0,e,i,(n,r)=>n.domAtPos(r),n=>new Ue(i,Math.min(n,i.nodeValue.length))):new Ue(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?lD(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?bm(t,e,i,n,(r,o,l)=>r.coordsAt(o,l),(r,o)=>wm(n,r,o)):wm(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}};function bm(s,t,e,i,n,r){if(e instanceof Ar){for(let o of e.children){let l=tl(o.dom,i),h=l?i.nodeValue.length:o.length;if(s<h||s==h&&o.getSide()<=0)return l?bm(s,t,o,i,n,r):n(o,s,t);s-=h}return n(e,e.length,-1)}else return e.dom==i?r(s,t):n(e,s,t)}function lD(s,t,e,i){if(e instanceof Ar)for(let n of e.children){let r=0,o=tl(n.dom,i);if(tl(n.dom,s))return r+(o?lD(s,t,n,i):n.localPosFromDOM(s,t));r+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(s,t)}let xm=class Sm extends Zt{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Sm&&t.side==this.side}split(){return new Sm(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Ue.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=o8(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return pt.empty}};aa.prototype.children=hb.prototype.children=xm.prototype.children=lb;function o8(s,t){let e=s.parent,i=e?e.children.indexOf(s):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof aa){let r=n.coordsAt(t<0?n.length:0,t);if(r)return r}i+=t}else if(e instanceof Ar&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function hD(s,t,e){let i=0;for(let n=0;i<t.length;i++){let r=t[i],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(e>n&&e<o&&r.dom.parentNode==s)return r.domAtPos(e-n);if(e<=n)break;n=o}}for(;i>0;i--){let n=t[i-1].dom;if(n.parentNode==s)return Ue.after(n)}return new Ue(s,0)}function aD(s,t,e){let i,{children:n}=s;e>0&&t instanceof Ar&&n.length&&(i=n[n.length-1])instanceof Ar&&i.mark.eq(t.mark)?aD(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function cD(s,t,e){for(let r=0,o=0;o<s.children.length;o++){let l=s.children[o],h=r+l.length,a;if((e<=0||h==s.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==s.children.length||(a=s.children[o+1]).length||a.getSide()>0)){let c=0;if(h==r){if(l.getSide()<=0)continue;c=e=-l.getSide()}let f=l.coordsAt(Math.max(0,t-r),e);return c&&f?jd(f,e<0):f}r=h}let i=s.dom.lastChild;if(!i)return s.dom.getBoundingClientRect();let n=la(i);return n[n.length-1]||null}function vm(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}function ab(s,t){if(s==t)return!0;if(!s||!t)return!1;let e=Object.keys(s),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||s[n]!==t[n])return!1;return!0}function km(s,t,e){let i=null;if(t)for(let n in t)e&&n in e||s.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||s.setAttribute(i=n,e[n]);return!!i}let Al=class{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}};var rt=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(rt||(rt={}));let $t=class extends _o{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new fD(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new ca(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=pD(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new ca(t,i,n,e,t.widget||null,!0)}static line(t){return new cb(t)}static set(t,e=!1){return se.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};$t.none=se.empty;let fD=class uD extends $t{constructor(t){let{start:e,end:i}=pD(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof uD&&this.tagName==t.tagName&&this.class==t.class&&ab(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}};fD.prototype.point=!1;let cb=class dD extends $t{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof dD&&ab(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}};cb.prototype.mapMode=mi.TrackBefore;cb.prototype.point=!0;let ca=class gD extends $t{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?mi.TrackBefore:mi.TrackAfter:mi.TrackDel}get type(){return this.startSide<this.endSide?rt.WidgetRange:this.startSide<=0?rt.WidgetBefore:rt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof gD&&l8(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}};ca.prototype.point=!0;function pD(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function l8(s,t){return s==t||!!(s&&t&&s.compare(t))}function Am(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}let Qi=class Ff extends Zt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof Ff))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),nD(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new Ff;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){ab(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){aD(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=vm(e,this.attrs||{})),i&&(this.attrs=vm({class:i},this.attrs||{}))}domAtPos(t){return hD(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(tD(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(km(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&Zt.get(i)instanceof Ar;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=Zt.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!T.ios||!this.children.some(n=>n instanceof aa))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof aa))return null;let i=la(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return cD(this,t,e)}become(t){return!1}get type(){return rt.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof Ff)return r;if(o>e)break}n=o+r.breakAfter}return null}},Cm=class Wf extends Zt{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof Wf)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?Ue.before(this.dom):Ue.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Wf(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return lb}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):pt.empty}domBoundsAround(){return null}become(t){return t instanceof Wf&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},h8=class mD{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof Cm&&t.type==rt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Qi),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Tc(new xm(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Tc(new aa(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof ca){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof ca)if(i.block){let{type:h}=i;h==rt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Cm(i.widget||new Gx("div"),l,h))}else{let h=hb.create(i.widget||new Gx("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(Tc(new xm(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(Tc(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new mD(t,e,i,r);return o.openEnd=se.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function Tc(s,t){for(let e of t)s=new Ar(e,[s],s.length);return s}let Gx=class extends Al{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}};const yD=K.define(),wD=K.define(),bD=K.define(),xD=K.define(),Mm=K.define(),SD=K.define(),vD=K.define({combine:s=>s.some(t=>t)});let jx=class kD{constructor(t,e="nearest",i="nearest",n=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r}map(t){return t.empty?this:new kD(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}};const Ux=Ae.define({map:(s,t)=>s.map(t)});function xr(s,t,e){let i=s.facet(xD);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const rc=K.define({combine:s=>s.length?s[0]:!0});let a8=0;const Zl=K.define();let Vr=class Dm{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:r}=e||{};return new Dm(a8++,t,i,o=>{let l=[Zl.of(o)];return r&&l.push(fa.of(h=>{let a=h.plugin(o);return a?r(a):$t.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return Dm.define(i=>new t(i),e)}},Dg=class{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(xr(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){xr(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){xr(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const AD=K.define(),CD=K.define(),fa=K.define(),MD=K.define(),DD=K.define(),Ql=K.define();let ua=class zf{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new zf(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new zf(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new zf(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}},Jx=class OD{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=ss.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new ua(o,l,h,a))),this.changedRanges=n;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}static create(t,e,i){return new OD(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}};var Gt=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(Gt||(Gt={}));const Om=Gt.LTR,c8=Gt.RTL;function TD(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const f8=TD("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),u8=TD("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Tm=Object.create(null),vn=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);Tm[t]=e,Tm[e]=-t}function d8(s){return s<=247?f8[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?u8[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||s==8204?256:1}const g8=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;let Mo=class{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?c8:Om}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};const At=[];function p8(s,t){let e=s.length,i=t==Om?1:2,n=t==Om?2:1;if(!s||i==1&&!g8.test(s))return $D(e);for(let o=0,l=i,h=i;o<e;o++){let a=d8(s.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),At[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=At[o];if(a==128)o<e-1&&l==At[o+1]&&l&24?a=At[o]=l:At[o]=256;else if(a==64){let c=o+1;for(;c<e&&At[c]==64;)c++;let f=o&&l==8||c<e&&At[c]==8?h==1?1:8:256;for(let u=o;u<c;u++)At[u]=f;o=c-1}else a==8&&h==1&&(At[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,c,f;o<e;o++)if(c=Tm[a=s.charCodeAt(o)])if(c<0){for(let u=l-3;u>=0;u-=3)if(vn[u+1]==-c){let d=vn[u+2],g=d&2?i:d&4?d&1?n:i:0;g&&(At[o]=At[vn[u]]=g),l=u;break}}else{if(vn.length==189)break;vn[l++]=o,vn[l++]=a,vn[l++]=h}else if((f=At[o])==2||f==1){let u=f==i;h=u?0:1;for(let d=l-3;d>=0;d-=3){let g=vn[d+2];if(g&2)break;if(u)vn[d+2]|=2;else{if(g&4)break;vn[d+2]|=4}}}for(let o=0;o<e;o++)if(At[o]==256){let l=o+1;for(;l<e&&At[l]==256;)l++;let h=(o?At[o-1]:i)==1,a=(l<e?At[l]:i)==1,c=h==a?h?1:2:i;for(let f=o;f<l;f++)At[f]=c;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=At[o++]!=1;for(;o<e&&h==(At[o]!=1);)o++;if(h)for(let a=o;a>l;){let c=a,f=At[--a]!=2;for(;a>l&&f==(At[a-1]!=2);)a--;r.push(new Mo(a,c,f?2:1))}else r.push(new Mo(l,o,0))}else for(let o=0;o<e;){let l=o,h=At[o++]==2;for(;o<e&&h==(At[o]==2);)o++;r.push(new Mo(l,o,h?1:2))}return r}function $D(s){return[new Mo(0,s,0)]}let RD="";function m8(s,t,e,i,n){var r;let o=i.head-s.from,l=-1;if(o==0){if(!n||!s.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==s.length){if(n)return null;let u=t[t.length-1];u.level!=e&&(o=u.side(!0,e),l=t.length-1)}l<0&&(l=Mo.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),c=ps(s.text,o,a);if(RD=s.text.slice(Math.min(o,c),Math.max(o,c)),c!=h.side(n,e))return N.cursor(c+s.from,a?-1:1,h.level);let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!f&&h.level!=e?N.cursor(n?s.to:s.from,n?-1:1,e):f&&f.level<h.level?N.cursor(f.side(!n,e)+s.from,n?1:-1,f.level):N.cursor(c+s.from,n?-1:1,h.level)}const Ws="￿";let BD=class{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(We.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Ws}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let r=n.nextSibling;if(r==e)break;let o=Zt.get(n),l=Zt.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:Yx(n))||Yx(r)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=r}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=Zt.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}};function Yx(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}let Xx=class{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}},Zx=class extends Zt{constructor(t){super(),this.view=t,this.compositionDeco=$t.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Qi],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ua(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=$t.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=w8(this.view,t.changes)),(T.ie||T.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),r=v8(i,n,t.changes);return e=ua.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let r=T.chrome||T.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof Cm&&r.widget instanceof Qx&&n.push(r.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let r=n>=0?t[n]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:c,breakAtStart:f,openStart:u,openEnd:d}=h8.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:g,off:m}=i.findPos(l,1),{i:p,off:y}=i.findPos(o,-1);iD(this,p,y,g,m,c,f,u,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||T.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),o=n.empty?r:this.domAtPos(n.head);if(T.gecko&&n.empty&&y8(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new Ue(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!Xu(r.node,r.offset,l.anchorNode,l.anchorOffset)||!Xu(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{T.android&&T.chrome&&this.dom.contains(l.focusNode)&&k8(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Yu(this.root);if(n.empty){if(T.gecko){let a=x8(r.node,r.offset);if(a&&a!=3){let c=PD(r.node,r.offset,a==1?1:-1);c&&(r=new Ue(c,a==1?0:c.nodeValue.length))}}h.collapse(r.node,r.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new Ue(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new Ue(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Yu(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=Qi.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(rc)?this.root.activeElement==this.dom:am(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=Zt.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof Qi)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=rt.WidgetBefore&&r.type!=rt.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==rt.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==Gt.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?la(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?Gt.RTL:Gt.LTR}measureTextSize(){for(let n of this.children)if(n instanceof Qi){let r=n.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=la(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new eD(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push($t.replace({widget:new Qx(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return $t.set(t)}updateDeco(){let t=this.view.state.facet(fa).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=0,o=0,l=0,h=0;for(let c of this.view.state.facet(DD).map(f=>f(this.view)))if(c){let{left:f,right:u,top:d,bottom:g}=c;f!=null&&(r=Math.max(r,f)),u!=null&&(o=Math.max(o,u)),d!=null&&(l=Math.max(l,d)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};e8(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Gt.LTR)}};function y8(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}let Qx=class extends Al{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function ED(s){let t=s.observer.selectionRange,e=t.focusNode&&PD(t.focusNode,t.focusOffset,0);if(!e)return null;let i=s.docView.nearest(e);if(!i)return null;if(i instanceof Qi){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let r=n.previousSibling;for(;r&&!Zt.get(r);)r=r.previousSibling;let o=r?Zt.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof Qi)break;i=r}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function w8(s,t){let e=ED(s);if(!e)return $t.none;let{from:i,to:n,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=s,c=r.nodeType==3?r.nodeValue:new BD([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),Ws)==c)h=l+c.length;else if(a.doc.sliceString(Math.max(0,h-c.length),h,Ws)==c)l=h-c.length;else return $t.none;else if(a.doc.sliceString(l,h,Ws)!=c)return $t.none;let f=Zt.get(r);return f instanceof oD?f=f.widget.topView:f&&(f.parent=null),$t.set($t.replace({widget:new b8(r,o,f),inclusive:!0}).range(l,h))}let b8=class extends Al{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return oD}};function PD(s,t,e){for(;;){if(s.nodeType==3)return s;if(s.nodeType==1&&t>0&&e<=0)s=s.childNodes[t-1],t=Zu(s);else if(s.nodeType==1&&t<s.childNodes.length&&e>=0)s=s.childNodes[t],t=0;else return null}}function x8(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let S8=class{constructor(){this.changes=[]}compareRange(t,e){Am(t,e,this.changes)}comparePoint(t,e){Am(t,e,this.changes)}};function v8(s,t,e){let i=new S8;return se.compare(s,t,e,i),i.changes}function k8(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function A8(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return N.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=ps(n.text,r,!1):l=ps(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=ps(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=ps(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return N.range(o+n.from,l+n.from)}function C8(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function M8(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function Og(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function _x(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function tS(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function $m(s,t,e){let i,n,r,o,l,h,a,c;for(let d=s.firstChild;d;d=d.nextSibling){let g=la(d);for(let m=0;m<g.length;m++){let p=g[m];n&&Og(n,p)&&(p=_x(tS(p,n.bottom),n.top));let y=C8(t,p),w=M8(e,p);if(y==0&&w==0)return d.nodeType==3?eS(d,t,e):$m(d,t,e);(!i||o>w||o==w&&r>y)&&(i=d,n=p,r=y,o=w),y==0?e>p.bottom&&(!a||a.bottom<p.bottom)?(l=d,a=p):e<p.top&&(!c||c.top>p.top)&&(h=d,c=p):a&&Og(a,p)?a=tS(a,p.bottom):c&&Og(c,p)&&(c=_x(c,p.top))}}if(a&&a.bottom>=e?(i=l,n=a):c&&c.top<=e&&(i=h,n=c),!i)return{node:s,offset:0};let f=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return eS(i,f,e);if(!r&&i.contentEditable=="true")return $m(i,f,e);let u=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:u}}function eS(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=ha(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if((T.chrome||T.gecko)&&ha(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function LD(s,{x:t,y:e},i,n=-1){var r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,c=e-l;if(c<0)return 0;if(c>a)return s.state.doc.length;for(let y=s.defaultLineHeight/2,w=!1;h=s.elementAtHeight(c),h.type!=rt.Text;)for(;c=n>0?h.bottom+y:h.top-y,!(c>=0&&c<=a);){if(w)return i?null:0;w=!0,n=-n}e=l+c;let f=h.from;if(f<s.viewport.from)return s.viewport.from==0?0:i?null:iS(s,o,h,t,e);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:i?null:iS(s,o,h,t,e);let u=s.dom.ownerDocument,d=s.root.elementFromPoint?s.root:u,g=d.elementFromPoint(t,e);g&&!s.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=d.elementFromPoint(t,e),g&&!s.contentDOM.contains(g)&&(g=null));let m,p=-1;if(g&&((r=s.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(u.caretPositionFromPoint){let y=u.caretPositionFromPoint(t,e);y&&({offsetNode:m,offset:p}=y)}else if(u.caretRangeFromPoint){let y=u.caretRangeFromPoint(t,e);y&&({startContainer:m,startOffset:p}=y,T.safari&&D8(m,p,t)&&(m=void 0))}}if(!m||!s.docView.dom.contains(m)){let y=Qi.find(s.docView,f);if(!y)return c>h.top+h.height/2?h.to:h.from;({node:m,offset:p}=$m(y.dom,t,e))}return s.docView.posFromDOM(m,p)}function iS(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=Math.floor((n-e.top)/s.defaultLineHeight);r+=l*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+om(o,r,s.state.tabSize)}function D8(s,t,e){let i;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return ha(s,i-1,i).getBoundingClientRect().left>e}function O8(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=!i||!s.lineWrapping?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let h=s.dom.getBoundingClientRect(),a=s.textDirectionAt(n.from),c=s.posAtCoords({x:e==(a==Gt.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(c!=null)return N.cursor(c,e?-1:1)}let o=Qi.find(s.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return N.cursor(l,e?-1:1)}function nS(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=m8(n,r,o,l,e),c=RD;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=N.cursor(e?n.from:n.to)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function T8(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==ms.Space&&(n=o),n==o}}function $8(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return N.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.defaultLineHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=LD(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n))return N.cursor(m,t.assoc,void 0,o)}}function Tg(s,t,e){let i=s.state.facet(MD).map(n=>n(s));for(;;){let n=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?N.cursor(o,1):N.cursor(l,-1),n=!0)});if(!n)return e}}let R8=class{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in le){let i=le[e];t.contentDOM.addEventListener(e,n=>{!sS(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))}),this.registeredEvents.push(e)}T.chrome&&T.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,T.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let r of e)if(n=(i=r.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{sS(t,l)&&this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let r=n.handlers[t];if(r)try{if(r.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){xr(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(r){xr(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(T.android&&T.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return T.ios&&(i=VD.find(n=>n.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Eh(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:T.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!T.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};const VD=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],ID=[16,17,18,20,91,92,224,225];let B8=class{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(We.allowMultipleSelections)&&E8(t,e),this.dragMove=P8(t,e),this.dragging=L8(t,e)&&fb(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}};function E8(s,t){let e=s.state.facet(yD);return e.length?e[0](t):T.mac?t.metaKey:t.ctrlKey}function P8(s,t){let e=s.state.facet(wD);return e.length?e[0](t):T.mac?!t.altKey:!t.ctrlKey}function L8(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=Yu(s.root);if(i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function sS(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=Zt.get(e))&&i.ignoreEvent(t))return!1;return!0}const le=Object.create(null),ND=T.ie&&T.ie_version<15||T.ios&&T.webkit_version<604;function V8(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),HD(s,e.value)},50)}function HD(s,t){let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(Rm!=null&&e.selection.ranges.every(h=>h.empty)&&Rm==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:N.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:N.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}le.keydown=(s,t)=>{s.inputState.setSelectionOrigin("select"),t.keyCode==27?s.inputState.lastEscPress=Date.now():ID.indexOf(t.keyCode)<0&&(s.inputState.lastEscPress=0)};let FD=0;le.touchstart=(s,t)=>{FD=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};le.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};le.mousedown=(s,t)=>{if(s.observer.flush(),FD>Date.now()-2e3&&fb(t)==1)return;let e=null;for(let i of s.state.facet(bD))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=H8(s,t)),e){let i=s.root.activeElement!=s.contentDOM;i&&s.observer.ignore(()=>_M(s.contentDOM)),s.inputState.startMouseSelection(new B8(s,t,e,i))}};function rS(s,t,e,i){if(i==1)return N.cursor(t,e);if(i==2)return A8(s.state,t,e);{let n=Qi.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,N.range(o,l)}}let WD=(s,t)=>s>=t.top&&s<=t.bottom,oS=(s,t,e)=>WD(t,e)&&s>=e.left&&s<=e.right;function I8(s,t,e,i){let n=Qi.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&oS(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&oS(e,i,l)?1:o&&WD(i,o)?-1:1}function lS(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:I8(s,e,t.clientX,t.clientY)}}const N8=T.ie&&T.ie_version<=11;let hS=null,aS=0,cS=0;function fb(s){if(!N8)return s.detail;let t=hS,e=cS;return hS=s,cS=Date.now(),aS=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(aS+1)%3:1}function H8(s,t){let e=lS(s,t),i=fb(t),n=s.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),n=n.map(l.changes),o=null)},get(l,h,a){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=r:(c=r=lS(s,l),o=l),!c||!e)return n;let f=rS(s,c.pos,c.bias,i);if(e.pos!=c.pos&&!h){let u=rS(s,e.pos,e.bias,i),d=Math.min(u.from,f.from),g=Math.max(u.to,f.to);f=d<f.from?N.range(d,g):N.range(g,d)}return h?n.replaceRange(n.main.extend(f.from,f.to)):a?n.addRange(f):N.create([f])}}}le.dragstart=(s,t)=>{let{selection:{main:e}}=s.state,{mouseSelection:i}=s.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",s.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function fS(s,t,e,i){if(!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=s.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}le.drop=(s,t)=>{if(!t.dataTransfer)return;if(s.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,r=()=>{++n==e.length&&fS(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else fS(s,t,t.dataTransfer.getData("Text"),!0)};le.paste=(s,t)=>{if(s.state.readOnly)return t.preventDefault();s.observer.flush();let e=ND?null:t.clipboardData;e?(HD(s,e.getData("text/plain")),t.preventDefault()):V8(s)};function F8(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function W8(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(s.lineBreak),ranges:e,linewise:i}}let Rm=null;le.copy=le.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=W8(s.state);if(!e&&!n)return;Rm=n?e:null;let r=ND?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):F8(s,e),t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function zD(s){setTimeout(()=>{s.hasFocus!=s.inputState.notifiedFocused&&s.update([])},10)}le.focus=zD;le.blur=s=>{s.observer.clearSelectionRange(),zD(s)};function qD(s,t){if(s.docView.compositionDeco.size){s.inputState.rapidCompositionStart=t;try{s.update([])}finally{s.inputState.rapidCompositionStart=!1}}}le.compositionstart=le.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0,s.docView.compositionDeco.size&&(s.observer.flush(),qD(s,!0)))};le.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionFirstChange=null,setTimeout(()=>{s.inputState.composing<0&&qD(s,!1)},50)};le.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};le.beforeinput=(s,t)=>{var e;let i;if(T.chrome&&T.android&&(i=VD.find(n=>n.inputType==t.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}};const uS=["pre-wrap","normal","pre-line","break-spaces"];let z8=class{constructor(){this.doc=pt.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return uS.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r){let o=uS.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<r.length;h++){let a=r[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}},q8=class{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}},po=class KD{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new KD(this.from,this.length+t.length,this.top,this.height+t.height,e)}};var ot=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(ot||(ot={}));const qf=.001;let Xn=class Kf{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>qf&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Kf.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:c}=n[o],f=r.lineAt(l,ot.ByPosNoHeight,e,0,0),u=f.to>=h?f:r.lineAt(h,ot.ByPosNoHeight,e,0,0);for(c+=u.to-h,h=u.to;o>0&&f.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<f.from&&(f=r.lineAt(l,ot.ByPosNoHeight,e,0,0));a+=f.from-l,l=f.from;let d=j8.build(i,t,a,c);r=r.replace(l,h,d)}return r.updateHeight(i,0)}static empty(){return new Nn(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new K8(Kf.of(t.slice(0,e)),o,Kf.of(t.slice(i)))}};Xn.prototype.size=1;let GD=class extends Xn{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new po(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Nn=class Bm extends GD{constructor(t,e){super(t,e,rt.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof Bm||n instanceof Do&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Do?n=new Bm(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Xn.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},Do=class Hi extends Xn{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:c}=e.line(r+h);return new po(a,c,i+l*h,l,rt.Text)}lineAt(t,e,i,n,r){if(e==ot.ByHeight)return this.blockAt(t,i,n,r);if(e==ot.ByPosNoHeight){let{from:f,to:u}=i.lineAt(t);return new po(f,u-f,0,0,rt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:c}=i.lineAt(t);return new po(h,a,n+l*(c-o),l,rt.Text)}forEachLine(t,e,i,n,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),c=Math.min(r+this.length,e);a<=c;){let f=i.lineAt(a);a==t&&(n+=h*(f.number-l)),o(new po(f.from,f.length,n,h,rt.Text)),n+=h,a=f.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof Hi?i[i.length-1]=new Hi(r.length+n):i.push(null,new Hi(n-1))}if(t>0){let r=i[0];r instanceof Hi?i[0]=new Hi(t+r.length):i.unshift(new Hi(t-1),null)}return Xn.of(i)}decomposeLeft(t,e){e.push(new Hi(t-1),null)}decomposeRight(t,e){e.push(null,new Hi(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new Hi(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let f=t.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];h==-1?h=u:Math.abs(u-h)>=qf&&(h=-2);let d=new Nn(f,u);d.outdated=!1,o.push(d),l+=f+1}l<=r&&o.push(null,new Hi(r-l).updateHeight(t,l));let c=Xn.of(o);return t.heightChanged=a||h<0||Math.abs(c.height-this.height)>=qf||Math.abs(h-this.lines(t.doc,e).lineHeight)>=qf,c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},K8=class extends Xn{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==ot.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==ot.ByPosNoHeight?ot.ByPosNoHeight:ot.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,ot.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&dS(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),dS(r,l)}return Xn.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Xn.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function dS(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof Do&&(i=s[t+1])instanceof Do&&s.splice(t-1,3,new Do(e.length+1+i.length))}const G8=5;let j8=class jD{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Nn?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Nn(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new GD(r,n,i.type)):(r||n>=G8)&&this.addLineDeco(n,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Nn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Do(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Nn)return t;let e=new Nn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==rt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=rt.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Nn)&&!this.isCovered?this.nodes.push(new Nn(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof Nn&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new jD(i,t);return se.spans(e,i,n,r,0),r.finish(i)}};function U8(s,t,e){let i=new J8;return se.compare(s,t,e,i,0),i.changes}let J8=class{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&Am(t,e,this.changes,5)}};function Y8(s,t){let e=s.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=s.ownerDocument.body;for(let h=s.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,c=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&c.overflow!="visible"){let f=a.getBoundingClientRect();i=Math.max(i,f.left),n=Math.min(n,f.right),r=Math.max(r,f.top),o=Math.min(o,f.bottom)}h=c.position=="absolute"||c.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}function X8(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}let $g=class{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t){return $t.replace({widget:new Z8(this.size,t)}).range(this.from,this.to)}},Z8=class extends Al{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}},gS=class{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new z8,this.scaler=yS,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Gt.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(fa).filter(e=>typeof e!="function"),this.heightMap=Xn.empty().applyChanges(this.stateDeco,pt.empty,this.heightOracle.setDoc(t.doc),[new ua(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=$t.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new $c(r,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?yS:new t4(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:_l(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(fa).filter(a=>typeof a!="function");let n=t.changedRanges,r=ua.extendWithRanges(n,U8(i,this.stateDeco,t?t.changes:ss.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?Gt.RTL:Gt.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,c=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let u=(this.printing?X8:Y8)(e,this.paddingTop),d=u.top-this.pixelViewport.top,g=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let w=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(w)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:x,charWidth:b}=t.docView.measureTextSize();o=n.refresh(r,x,b,p/b,w),o&&(t.docView.minWidth=0,h|=8)}d>0&&g>0?a=Math.max(d,g):d<0&&g<0&&(a=Math.min(d,g)),n.heightChanged=!1;for(let x of this.viewports){let b=x.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(x);this.heightMap=this.heightMap.updateHeight(n,0,o,new q8(x.from,b))}n.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new $c(n.lineAt(o-i*1e3,ot.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,ot.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,ot.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new $c(n.lineAt(u-1e3/2,ot.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,ot.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new $c(this.heightMap.lineAt(i,ot.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,ot.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,ot.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,ot.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new $g(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=Gt.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=Q8(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=Rc(n,(this.visibleTop-i.top-a)/i.height),o=Rc(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;r=Rc(n,(this.pixelViewport.left-c)/a),o=Rc(n,(this.pixelViewport.right+c)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&mS(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&mS(l,h.to-10,h.to+10);for(let{from:a,to:c}of l)c-a>1e3&&e.push(_8(t,f=>f.from>=i.from&&f.to<=i.to&&Math.abs(f.from-a)<1e3&&Math.abs(f.to-c)<1e3)||new $g(a,c,this.gapSize(i,a,c,n)))}return e}gapSize(t,e,i,n){let r=pS(n,i)-pS(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){$g.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=$t.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];se.spans(t,this.viewport.from,this.viewport.to,{span(n,r){e.push({from:n,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=e[r].from||n.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||_l(this.heightMap.lineAt(t,ot.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return _l(this.heightMap.lineAt(this.scaler.fromDOM(t),ot.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return _l(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},$c=class{constructor(t,e){this.from=t,this.to=e}};function Q8(s,t,e){let i=[],n=s,r=0;return se.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function Rc({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function pS(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function mS(s,t,e){for(let i=0;i<s.length;i++){let n=s[i];if(n.from<e&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>e&&r.push({from:e,to:n.to}),s.splice(i,1,...r),i+=r.length-1}}}function _8(s,t){for(let e of s)if(t(e))return e}const yS={toDOM(s){return s},fromDOM(s){return s},scale:1};let t4=class{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,ot.ByPos,t,0,0).top,c=e.lineAt(h,ot.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}};function _l(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new po(s.from,s.length,e,i-e,Array.isArray(s.type)?s.type.map(n=>_l(n,t)):s.type)}const Bc=K.define({combine:s=>s.join(" ")}),Em=K.define({combine:s=>s.indexOf(!0)>-1}),Pm=I.newName(),UD=I.newName(),JD=I.newName(),YD={"&light":"."+UD,"&dark":"."+JD};function Lm(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const e4=Lm("."+Pm,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},YD),i4={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Rg=T.ie&&T.ie_version<=11;let n4=class{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new i8,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(T.ie&&T.ie_version<=11||T.ios&&t.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),Rg&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(rc)?e.root.activeElement!=this.dom:!am(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((T.ie&&T.ie_version<=11||T.android&&T.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Xu(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Yu(t),i=T.safari&&t.nodeType==11&&_I()==this.view.contentDOM&&s4(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,i4),Rg&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Rg&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Eh(this.view.contentDOM,i.key,i.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&am(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=wS(e,t.previousSibling||t.target.previousSibling,-1),n=wS(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function wS(s,t,e){for(;t;){let i=Zt.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function s4(s){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return Xu(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}function r4(s,t,e,i){let n,r,o=s.state.selection.main;if(t>-1){let l=s.docView.domBoundsAround(t,e,0);if(!l||s.state.readOnly)return!1;let{from:h,to:a}=l,c=s.docView.impreciseHead||s.docView.impreciseAnchor?[]:l4(s),f=new BD(c,s.state);f.readRange(l.startDOM,l.endDOM);let u=o.from,d=null;(s.inputState.lastKeyCode===8&&s.inputState.lastKeyTime>Date.now()-100||T.android&&f.text.length<a-h)&&(u=o.to,d="end");let g=o4(s.state.doc.sliceString(h,a,Ws),f.text,u-h,d);g&&(T.chrome&&s.inputState.lastKeyCode==13&&g.toB==g.from+2&&f.text.slice(g.from,g.toB)==Ws+Ws&&g.toB--,n={from:h+g.from,to:h+g.toA,insert:pt.of(f.text.slice(g.from,g.toB).split(Ws))}),r=h4(c,h)}else if(s.hasFocus||!s.state.facet(rc)){let l=s.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=s.docView,c=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!tl(s.contentDOM,l.focusNode)?s.state.selection.main.head:s.docView.posFromDOM(l.focusNode,l.focusOffset),f=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!tl(s.contentDOM,l.anchorNode)?s.state.selection.main.anchor:s.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||f!=o.anchor)&&(r=N.single(f,c))}if(!n&&!r)return!1;if(!n&&i&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,n.from).append(n.insert).append(s.state.doc.slice(n.to,o.to))}:(T.mac||T.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:pt.of([" "])}),n){let l=s.state;if(T.ios&&s.inputState.flushIOSKey(s)||T.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&Eh(s.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&Eh(s.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&Eh(s.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(s.state.facet(SD).some(f=>f(s,n.from,n.to,h)))return!0;s.inputState.composing>=0&&s.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&s.inputState.composing<0){let f=o.from<n.from?l.sliceDoc(o.from,n.from):"",u=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(s.state.toText(f+n.insert.sliceString(0,void 0,s.state.lineBreak)+u))}else{let f=l.changes(n),u=r&&!l.selection.main.eq(r.main)&&r.main.to<=f.newLength?r.main:void 0;if(l.selection.ranges.length>1&&s.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=s.state.sliceDoc(n.from,n.to),g=ED(s)||s.state.doc.lineAt(o.head),m=o.to-n.to,p=o.to-o.from;a=l.changeByRange(y=>{if(y.from==o.from&&y.to==o.to)return{changes:f,range:u||y.map(f)};let w=y.to-m,x=w-d.length;if(y.to-y.from!=p||s.state.sliceDoc(x,w)!=d||g&&y.to>=g.from&&y.from<=g.to)return{range:y};let b=l.changes({from:x,to:w,insert:n.insert}),S=y.to-o.to;return{changes:b,range:u?N.range(Math.max(0,u.anchor+S),Math.max(0,u.head+S)):y.map(b)}})}else a={changes:f,selection:u&&l.selection.replaceRange(u)}}let c="input.type";return s.composing&&(c+=".compose",s.inputState.compositionFirstChange&&(c+=".start",s.inputState.compositionFirstChange=!1)),s.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(o)){let l=!1,h="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(l=!0),h=s.inputState.lastSelectionOrigin),s.dispatch({selection:r,scrollIntoView:l,userEvent:h}),!0}else return!1}function o4(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function l4(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new Xx(e,i)),(n!=e||r!=i)&&t.push(new Xx(n,r))),t}function h4(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?N.single(e+t,i+t):null}let Rt=class XD{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||n8(t.parent)||document,this.viewState=new gS(t.state||We.create()),this.plugins=this.state.facet(Zl).map(e=>new Dg(e));for(let e of this.plugins)e.update(this);this.observer=new n4(this,(e,i,n)=>r4(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new R8(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new Zx(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof fn?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let l of t){if(l.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=l.state}if(this.destroyed){this.viewState.state=r;return}if(this.observer.clear(),r.facet(We.phrases)!=this.state.facet(We.phrases))return this.setState(r);n=Jx.create(this,r,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new jx(h.empty?h:N.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(Ux)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=xS.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(Ql)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Bc)!=n.state.facet(Bc)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(Mm))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new gS(t),this.plugins=t.facet(Zl).map(i=>new Dg(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new Zx(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Zl),i=t.state.facet(Zl);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new Dg(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let n=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(f=>{try{return f.read(this)}catch(u){return xr(this.state,u),bS}}),h=Jx.create(this,this.state,[]),a=!1,c=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let f=0;f<o.length;f++)if(l[f]!=bS)try{let u=o[f];u.write&&u.write(l[f],this)}catch(u){xr(this.state,u)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),a&&this.docView.updateSelection(!0),this.viewport.from==n.from&&this.viewport.to==n.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(Mm))i(e)}get themeClasses(){return Pm+" "+(this.state.facet(Em)?JD:UD)+" "+this.state.facet(Bc)}updateAttrs(){let t=SS(this,AD,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(rc)?"true":"false",class:"cm-content",style:`${T.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),SS(this,CD,e);let i=this.observer.ignore(()=>{let n=km(this.contentDOM,this.contentAttrs,e),r=km(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(XD.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(Ql),I.mount(this.root,this.styleModules.concat(e4).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Tg(this,t,nS(this,t,e,i))}moveByGroup(t,e){return Tg(this,t,nS(this,t,e,i=>T8(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return O8(this,t,e,i)}moveVertically(t,e,i){return Tg(this,t,$8(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),LD(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[Mo.find(r,t-n.from,-1,e)];return jd(i,o.dir==Gt.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(vD)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>a4)return $D(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=p8(t.text,e);return this.bidiCache.push(new xS(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||T.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{_M(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Ux.of(new jx(typeof t=="number"?N.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Vr.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=I.newName(),n=[Bc.of(i),Ql.of(Lm(`.${i}`,t))];return e&&e.dark&&n.push(Em.of(!0)),n}static baseTheme(t){return RM.lowest(Ql.of(Lm("."+Pm,t,YD)))}};Rt.styleModule=Ql;Rt.inputHandler=SD;Rt.perLineTextDirection=vD;Rt.exceptionSink=xD;Rt.updateListener=Mm;Rt.editable=rc;Rt.mouseSelectionStyle=bD;Rt.dragMovesSelection=wD;Rt.clickAddsSelectionRange=yD;Rt.decorations=fa;Rt.atomicRanges=MD;Rt.scrollMargins=DD;Rt.darkTheme=Em;Rt.contentAttributes=CD;Rt.editorAttributes=AD;Rt.lineWrapping=Rt.contentAttributes.of({class:"cm-lineWrapping"});Rt.announce=Ae.define();const a4=4096,bS={};let xS=class ZD{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:Gt.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new ZD(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}};function SS(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&vm(o,e)}return e}const c4=T.mac?"mac":T.windows?"win":T.linux?"linux":"key";function f4(s,t){const e=s.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let n,r,o,l;for(let h=0;h<e.length-1;++h){const a=e[h];if(/^(cmd|meta|m)$/i.test(a))l=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))t=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Bg(s,t,e){return t.altKey&&(s="Alt-"+s),t.ctrlKey&&(s="Ctrl-"+s),t.metaKey&&(s="Meta-"+s),e!==!1&&t.shiftKey&&(s="Shift-"+s),s}const u4=Rt.domEventHandlers({keydown(s,t){return m4(d4(t.state),s,t,"editor")}}),QD=K.define({enables:u4}),vS=new WeakMap;function d4(s){let t=s.facet(QD),e=vS.get(t);return e||vS.set(t,e=p4(t.reduce((i,n)=>i.concat(n),[]))),e}let Ns=null;const g4=4e3;function p4(s,t=c4){let e=Object.create(null),i=Object.create(null),n=(o,l)=>{let h=i[o];if(h==null)i[o]=l;else if(h!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,h,a)=>{let c=e[o]||(e[o]=Object.create(null)),f=l.split(/ (?!$)/).map(g=>f4(g,t));for(let g=1;g<f.length;g++){let m=f.slice(0,g).join(" ");n(m,!0),c[m]||(c[m]={preventDefault:!0,commands:[p=>{let y=Ns={view:p,prefix:m,scope:o};return setTimeout(()=>{Ns==y&&(Ns=null)},g4),!0}]})}let u=f.join(" ");n(u,!1);let d=c[u]||(c[u]={preventDefault:!1,commands:[]});d.commands.push(h),a&&(d.preventDefault=!0)};for(let o of s){let l=o[t]||o.key;if(l)for(let h of o.scope?o.scope.split(" "):["editor"])r(h,l,o.run,o.preventDefault),o.shift&&r(h,"Shift-"+l,o.shift,o.preventDefault)}return e}function m4(s,t,e,i){let n=ob(t),r=n.length==1&&n!=" ",o="",l=!1;Ns&&Ns.view==e&&Ns.scope==i&&(o=Ns.prefix+" ",(l=ID.indexOf(t.keyCode)<0)&&(Ns=null));let h=f=>{if(f){for(let u of f.commands)if(u(e))return!0;f.preventDefault&&(l=!0)}return!1},a=s[i],c;if(a){if(h(a[o+Bg(n,t,!r)]))return!0;if(r&&(t.shiftKey||t.altKey||t.metaKey)&&(c=rs[t.keyCode])&&c!=n){if(h(a[o+Bg(c,t,!0)]))return!0}else if(r&&t.shiftKey&&h(a[o+Bg(n,t,!0)]))return!0}return l}const _D=!T.ios,th=K.define({combine(s){return rb(s,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})}});function y4(s={}){return[th.of(s),w4,b4]}class tO{constructor(t,e,i,n,r){this.left=t,this.top=e,this.width=i,this.height=n,this.className=r}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width>=0&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}}const w4=Vr.fromClass(class{constructor(s){this.view=s,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=s.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=s.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),s.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(th).cursorBlinkRate+"ms"}update(s){let t=s.startState.facet(th)!=s.state.facet(th);(t||s.selectionSet||s.geometryChanged||s.viewportChanged)&&this.view.requestMeasure(this.measureReq),s.transactions.some(e=>e.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),t&&this.setBlinkRate()}readPos(){let{state:s}=this.view,t=s.facet(th),e=s.selection.ranges.map(n=>n.empty?[]:x4(this.view,n)).reduce((n,r)=>n.concat(r)),i=[];for(let n of s.selection.ranges){let r=n==s.selection.main;if(n.empty?!r||_D:t.drawRangeCursor){let o=S4(this.view,n,r);o&&i.push(o)}}return{rangePieces:e,cursors:i}}drawSel({rangePieces:s,cursors:t}){if(s.length!=this.rangePieces.length||s.some((e,i)=>!e.eq(this.rangePieces[i]))){this.selectionLayer.textContent="";for(let e of s)this.selectionLayer.appendChild(e.draw());this.rangePieces=s}if(t.length!=this.cursors.length||t.some((e,i)=>!e.eq(this.cursors[i]))){let e=this.cursorLayer.children;if(e.length!==t.length){this.cursorLayer.textContent="";for(const i of t)this.cursorLayer.appendChild(i.draw())}else t.forEach((i,n)=>i.adjust(e[n]));this.cursors=t}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),eO={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};_D&&(eO[".cm-line"].caretColor="transparent !important");const b4=RM.highest(Rt.theme(eO));function iO(s){let t=s.scrollDOM.getBoundingClientRect();return{left:(s.textDirection==Gt.LTR?t.left:t.right-s.scrollDOM.clientWidth)-s.scrollDOM.scrollLeft,top:t.top-s.scrollDOM.scrollTop}}function kS(s,t,e){let i=N.cursor(t);return{from:Math.max(e.from,s.moveToLineBoundary(i,!1,!0).from),to:Math.min(e.to,s.moveToLineBoundary(i,!0,!0).from),type:rt.Text}}function AS(s,t){let e=s.lineBlockAt(t);if(Array.isArray(e.type)){for(let i of e.type)if(i.to>t||i.to==t&&(i.to==e.to||i.type==rt.Text))return i}return e}function x4(s,t){if(t.to<=s.viewport.from||t.from>=s.viewport.to)return[];let e=Math.max(t.from,s.viewport.from),i=Math.min(t.to,s.viewport.to),n=s.textDirection==Gt.LTR,r=s.contentDOM,o=r.getBoundingClientRect(),l=iO(s),h=window.getComputedStyle(r.firstChild),a=o.left+parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)),c=o.right-parseInt(h.paddingRight),f=AS(s,e),u=AS(s,i),d=f.type==rt.Text?f:null,g=u.type==rt.Text?u:null;if(s.lineWrapping&&(d&&(d=kS(s,e,d)),g&&(g=kS(s,i,g))),d&&g&&d.from==g.from)return p(y(t.from,t.to,d));{let x=d?y(t.from,null,d):w(f,!1),b=g?y(null,t.to,g):w(u,!0),S=[];return(d||f).to<(g||u).from-1?S.push(m(a,x.bottom,c,b.top)):x.bottom<b.top&&s.elementAtHeight((x.bottom+b.top)/2).type==rt.Text&&(x.bottom=b.top=(x.bottom+b.top)/2),p(x).concat(S).concat(p(b))}function m(x,b,S,v){return new tO(x-l.left,b-l.top-.01,S-x,v-b+.01,"cm-selectionBackground")}function p({top:x,bottom:b,horizontal:S}){let v=[];for(let L=0;L<S.length;L+=2)v.push(m(S[L],x,S[L+1],b));return v}function y(x,b,S){let v=1e9,L=-1e9,Pt=[];function J(Lt,Wt,hi,xe,Be){let Vi=s.coordsAtPos(Lt,Lt==S.to?-2:2),de=s.coordsAtPos(hi,hi==S.from?2:-2);v=Math.min(Vi.top,de.top,v),L=Math.max(Vi.bottom,de.bottom,L),Be==Gt.LTR?Pt.push(n&&Wt?a:Vi.left,n&&xe?c:de.right):Pt.push(!n&&xe?a:de.left,!n&&Wt?c:Vi.right)}let W=x??S.from,et=b??S.to;for(let Lt of s.visibleRanges)if(Lt.to>W&&Lt.from<et)for(let Wt=Math.max(Lt.from,W),hi=Math.min(Lt.to,et);;){let xe=s.state.doc.lineAt(Wt);for(let Be of s.bidiSpans(xe)){let Vi=Be.from+xe.from,de=Be.to+xe.from;if(Vi>=hi)break;de>Wt&&J(Math.max(Vi,Wt),x==null&&Vi<=W,Math.min(de,hi),b==null&&de>=et,Be.dir)}if(Wt=xe.to+1,Wt>=hi)break}return Pt.length==0&&J(W,x==null,et,b==null,s.textDirection),{top:v,bottom:L,horizontal:Pt}}function w(x,b){let S=o.top+(b?x.top:x.bottom);return{top:S,bottom:S,horizontal:[]}}}function S4(s,t,e){let i=s.coordsAtPos(t.head,t.assoc||1);if(!i)return null;let n=iO(s);return new tO(i.left-n.left,i.top-n.top,-1,i.bottom-i.top,e?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const nO=Ae.define({map(s,t){return s==null?null:t.mapPos(s)}}),eh=nc.define({create(){return null},update(s,t){return s!=null&&(s=t.changes.mapPos(s)),t.effects.reduce((e,i)=>i.is(nO)?i.value:e,s)}}),v4=Vr.fromClass(class{constructor(s){this.view=s,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(s){var t;let e=s.state.field(eh);e==null?this.cursor!=null&&((t=this.cursor)===null||t===void 0||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(s.startState.field(eh)!=e||s.docChanged||s.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let s=this.view.state.field(eh),t=s!=null&&this.view.coordsAtPos(s);if(!t)return null;let e=this.view.scrollDOM.getBoundingClientRect();return{left:t.left-e.left+this.view.scrollDOM.scrollLeft,top:t.top-e.top+this.view.scrollDOM.scrollTop,height:t.bottom-t.top}}drawCursor(s){this.cursor&&(s?(this.cursor.style.left=s.left+"px",this.cursor.style.top=s.top+"px",this.cursor.style.height=s.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(s){this.view.state.field(eh)!=s&&this.view.dispatch({effects:nO.of(s)})}},{eventHandlers:{dragover(s){this.setDropPos(this.view.posAtCoords({x:s.clientX,y:s.clientY}))},dragleave(s){(s.target==this.view.contentDOM||!this.view.contentDOM.contains(s.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function k4(){return[eh,v4]}function CS(s,t,e,i,n){t.lastIndex=0;for(let r=s.iterRange(e,i),o=e,l;!r.next().done;o+=r.value.length)if(!r.lineBreak)for(;l=t.exec(r.value);)n(o+l.index,o+l.index+l[0].length,l)}function A4(s,t){let e=s.visibleRanges;if(e.length==1&&e[0].from==s.viewport.from&&e[0].to==s.viewport.to)return e;let i=[];for(let{from:n,to:r}of e)n=Math.max(s.state.doc.lineAt(n).from,n-t),r=Math.min(s.state.doc.lineAt(r).to,r+t),i.length&&i[i.length-1].to>=n?i[i.length-1].to=r:i.push({from:n,to:r});return i}class C4{constructor(t){let{regexp:e,decoration:i,boundary:n,maxLength:r=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=e,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=n,this.maxLength=r}createDeco(t){let e=new nm;for(let{from:i,to:n}of A4(t,this.maxLength))CS(t.state.doc,this.regexp,i,n,(r,o,l)=>e.add(r,o,this.getDeco(l,t,r)));return e.finish()}updateDeco(t,e){let i=1e9,n=-1;return t.docChanged&&t.changes.iterChanges((r,o,l,h)=>{h>t.view.viewport.from&&l<t.view.viewport.to&&(i=Math.min(l,i),n=Math.max(h,n))}),t.viewportChanged||n-i>1e3?this.createDeco(t.view):n>-1?this.updateRange(t.view,e.map(t.changes),i,n):e}updateRange(t,e,i,n){for(let r of t.visibleRanges){let o=Math.max(r.from,i),l=Math.min(r.to,n);if(l>o){let h=t.state.doc.lineAt(o),a=h.to<l?t.state.doc.lineAt(l):h,c=Math.max(r.from,h.from),f=Math.min(r.to,a.to);if(this.boundary){for(;o>h.from;o--)if(this.boundary.test(h.text[o-1-h.from])){c=o;break}for(;l<a.to;l++)if(this.boundary.test(a.text[l-a.from])){f=l;break}}let u=[],d;if(h==a)for(this.regexp.lastIndex=c-h.from;(d=this.regexp.exec(h.text))&&d.index<f-h.from;){let g=d.index+h.from;u.push(this.getDeco(d,t,g).range(g,g+d[0].length))}else CS(t.state.doc,this.regexp,c,f,(g,m,p)=>u.push(this.getDeco(p,t,g).range(g,m)));e=e.update({filterFrom:c,filterTo:f,filter:(g,m)=>g<c||m>f,add:u})}}return e}}const Vm=/x/.unicode!=null?"gu":"g",M4=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮\uFEFF￹-￼]`,Vm),D4={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Eg=null;function O4(){var s;if(Eg==null&&typeof document<"u"&&document.body){let t=document.body.style;Eg=((s=t.tabSize)!==null&&s!==void 0?s:t.MozTabSize)!=null}return Eg||!1}const Gf=K.define({combine(s){let t=rb(s,{render:null,specialChars:M4,addSpecialChars:null});return(t.replaceTabs=!O4())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,Vm)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,Vm)),t}});function T4(s={}){return[Gf.of(s),$4()]}let MS=null;function $4(){return MS||(MS=Vr.fromClass(class{constructor(s){this.view=s,this.decorations=$t.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(s.state.facet(Gf)),this.decorations=this.decorator.createDeco(s)}makeDecorator(s){return new C4({regexp:s.specialChars,decoration:(t,e,i)=>{let{doc:n}=e.state,r=If(t[0],0);if(r==9){let o=n.lineAt(i),l=e.state.tabSize,h=ZM(o.text,l,i-o.from);return $t.replace({widget:new P4((l-h%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[r]||(this.decorationCache[r]=$t.replace({widget:new E4(s,r)}))},boundary:s.replaceTabs?void 0:/[^]/})}update(s){let t=s.state.facet(Gf);s.startState.facet(Gf)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(s.view)):this.decorations=this.decorator.updateDeco(s,this.decorations)}},{decorations:s=>s.decorations}))}const R4="•";function B4(s){return s>=32?R4:s==10?"␤":String.fromCharCode(9216+s)}class E4 extends Al{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=B4(this.code),i=t.state.phrase("Control character")+" "+(D4[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,i,e);if(n)return n;let r=document.createElement("span");return r.textContent=e,r.title=i,r.setAttribute("aria-label",i),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class P4 extends Al{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function L4(){return I4}const V4=$t.line({class:"cm-activeLine"}),I4=Vr.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.docChanged||s.selectionSet)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let t=-1,e=[];for(let i of s.state.selection.ranges){if(!i.empty)return $t.none;let n=s.lineBlockAt(i.head);n.from>t&&(e.push(V4.range(n.from)),t=n.from)}return $t.set(e)}},{decorations:s=>s.decorations}),Im=2e3;function N4(s,t,e){let i=Math.min(t.line,e.line),n=Math.max(t.line,e.line),r=[];if(t.off>Im||e.off>Im||t.col<0||e.col<0){let o=Math.min(t.off,e.off),l=Math.max(t.off,e.off);for(let h=i;h<=n;h++){let a=s.doc.line(h);a.length<=l&&r.push(N.range(a.from+o,a.to+l))}}else{let o=Math.min(t.col,e.col),l=Math.max(t.col,e.col);for(let h=i;h<=n;h++){let a=s.doc.line(h),c=om(a.text,o,s.tabSize,!0);if(c>-1){let f=om(a.text,l,s.tabSize);r.push(N.range(a.from+c,a.from+f))}}}return r}function H4(s,t){let e=s.coordsAtPos(s.viewport.from);return e?Math.round(Math.abs((e.left-t)/s.defaultCharacterWidth)):-1}function DS(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1),i=s.state.doc.lineAt(e),n=e-i.from,r=n>Im?-1:n==i.length?H4(s,t.clientX):ZM(i.text,s.state.tabSize,e-i.from);return{line:i.number,col:r,off:n}}function F4(s,t){let e=DS(s,t),i=s.state.selection;return e?{update(n){if(n.docChanged){let r=n.changes.mapPos(n.startState.doc.line(e.line).from),o=n.state.doc.lineAt(r);e={line:o.number,col:e.col,off:Math.min(e.off,o.length)},i=i.map(n.changes)}},get(n,r,o){let l=DS(s,n);if(!l)return i;let h=N4(s.state,e,l);return h.length?o?N.create(h.concat(i.ranges)):N.create(h):i}}:null}function W4(s){let t=(e=>e.altKey&&e.button==0);return Rt.mouseSelectionStyle.of((e,i)=>t(i)?F4(e,i):null)}const z4={Alt:[18,s=>s.altKey],Control:[17,s=>s.ctrlKey],Shift:[16,s=>s.shiftKey],Meta:[91,s=>s.metaKey]},q4={style:"cursor: crosshair"};function K4(s={}){let[t,e]=z4[s.key||"Alt"],i=Vr.fromClass(class{constructor(n){this.view=n,this.isDown=!1}set(n){this.isDown!=n&&(this.isDown=n,this.view.update([]))}},{eventHandlers:{keydown(n){this.set(n.keyCode==t||e(n))},keyup(n){(n.keyCode==t||!e(n))&&this.set(!1)}}});return[i,Rt.contentAttributes.of(n=>{var r;return!((r=n.plugin(i))===null||r===void 0)&&r.isDown?q4:null})]}let ir=class extends _o{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}};ir.prototype.elementClass="";ir.prototype.toDOM=void 0;ir.prototype.mapMode=mi.TrackBefore;ir.prototype.startSide=ir.prototype.endSide=-1;ir.prototype.point=!0;const jf=K.define(),Uf=K.define(),OS=K.define({combine:s=>s.some(t=>t)});function G4(s){return[j4]}const j4=Vr.fromClass(class{constructor(s){this.view=s,this.prevViewport=s.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=s.state.facet(Uf).map(t=>new $S(s,t));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!s.state.facet(OS),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),s.scrollDOM.insertBefore(this.dom,s.contentDOM)}update(s){if(this.updateGutters(s)){let t=this.prevViewport,e=s.view.viewport,i=Math.min(t.to,e.to)-Math.max(t.from,e.from);this.syncGutters(i<(e.to-e.from)*.8)}s.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(OS)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=s.view.viewport}syncGutters(s){let t=this.dom.nextSibling;s&&this.dom.remove();let e=se.iter(this.view.state.facet(jf),this.view.viewport.from),i=[],n=this.gutters.map(r=>new U4(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks){let o;if(Array.isArray(r.type)){for(let l of r.type)if(l.type==rt.Text){o=l;break}}else o=r.type==rt.Text?r:void 0;if(o){i.length&&(i=[]),sO(e,i,r.from);for(let l of n)l.line(this.view,o,i)}}for(let r of n)r.finish();s&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(s){let t=s.startState.facet(Uf),e=s.state.facet(Uf),i=s.docChanged||s.heightChanged||s.viewportChanged||!se.eq(s.startState.facet(jf),s.state.facet(jf),s.view.viewport.from,s.view.viewport.to);if(t==e)for(let n of this.gutters)n.update(s)&&(i=!0);else{i=!0;let n=[];for(let r of e){let o=t.indexOf(r);o<0?n.push(new $S(this.view,r)):(this.gutters[o].update(s),n.push(this.gutters[o]))}for(let r of this.gutters)r.dom.remove(),n.indexOf(r)<0&&r.destroy();for(let r of n)this.dom.appendChild(r.dom);this.gutters=n}return i}destroy(){for(let s of this.gutters)s.destroy();this.dom.remove()}},{provide:s=>Rt.scrollMargins.of(t=>{let e=t.plugin(s);return!e||e.gutters.length==0||!e.fixed?null:t.textDirection==Gt.LTR?{left:e.dom.offsetWidth}:{right:e.dom.offsetWidth}})});function TS(s){return Array.isArray(s)?s:[s]}function sO(s,t,e){for(;s.value&&s.from<=e;)s.from==e&&t.push(s.value),s.next()}let U4=class{constructor(t,e,i){this.gutter=t,this.height=i,this.localMarkers=[],this.i=0,this.cursor=se.iter(t.markers,e.from)}line(t,e,i){this.localMarkers.length&&(this.localMarkers=[]),sO(this.cursor,this.localMarkers,e.from);let n=i.length?this.localMarkers.concat(i):this.localMarkers,r=this.gutter.config.lineMarker(t,e,n);r&&n.unshift(r);let o=this.gutter;if(n.length==0&&!o.config.renderEmptyElements)return;let l=e.top-this.height;if(this.i==o.elements.length){let h=new rO(t,e.height,l,n);o.elements.push(h),o.dom.appendChild(h.dom)}else o.elements[this.i].update(t,e.height,l,n);this.height=e.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}},$S=class{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,n=>{let r=t.lineBlockAtHeight(n.clientY-t.documentTop);e.domEventHandlers[i](t,r,n)&&n.preventDefault()});this.markers=TS(e.markers(t)),e.initialSpacer&&(this.spacer=new rO(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=TS(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],t);n!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[n])}let i=t.view.viewport;return!se.eq(this.markers,e,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}},rO=class{constructor(t,e,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,i,n)}update(t,e,i,n){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),J4(this.markers,n)||this.setMarkers(t,n)}setMarkers(t,e){let i="cm-gutterElement",n=this.dom.firstChild;for(let r=0,o=0;;){let l=o,h=r<e.length?e[r++]:null,a=!1;if(h){let c=h.elementClass;c&&(i+=" "+c);for(let f=o;f<this.markers.length;f++)if(this.markers[f].compare(h)){l=f,a=!0;break}}else l=this.markers.length;for(;o<l;){let c=this.markers[o++];if(c.toDOM){c.destroy(n);let f=n.nextSibling;n.remove(),n=f}}if(!h)break;h.toDOM&&(a?n=n.nextSibling:this.dom.insertBefore(h.toDOM(t),n)),a&&o++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}};function J4(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(!s[e].compare(t[e]))return!1;return!0}const Y4=K.define(),mo=K.define({combine(s){return rb(s,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let n in e){let r=i[n],o=e[n];i[n]=r?(l,h,a)=>r(l,h,a)||o(l,h,a):o}return i}})}});class Pg extends ir{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Lg(s,t){return s.state.facet(mo).formatNumber(t,s.state)}const X4=Uf.compute([mo],s=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(Y4)},lineMarker(t,e,i){return i.some(n=>n.toDOM)?null:new Pg(Lg(t,t.state.doc.lineAt(e.from).number))},lineMarkerChange:t=>t.startState.facet(mo)!=t.state.facet(mo),initialSpacer(t){return new Pg(Lg(t,RS(t.state.doc.lines)))},updateSpacer(t,e){let i=Lg(e.view,RS(e.view.state.doc.lines));return i==t.number?t:new Pg(i)},domEventHandlers:s.facet(mo).domEventHandlers}));function Z4(s={}){return[mo.of(s),G4(),X4]}function RS(s){let t=9;for(;t<s;)t=t*10+9;return t}const Q4=new class extends ir{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},_4=jf.compute(["selection"],s=>{let t=[],e=-1;for(let i of s.selection.ranges)if(i.empty){let n=s.doc.lineAt(i.head).from;n>e&&(e=n,t.push(Q4.range(n)))}return se.of(t)});function tN(){return _4}const eN=1024;let iN=0,Vg=class{constructor(t,e){this.from=t,this.to=e}};class j{constructor(t={}){this.id=iN++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=Ei.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}j.closedBy=new j({deserialize:s=>s.split(" ")});j.openedBy=new j({deserialize:s=>s.split(" ")});j.group=new j({deserialize:s=>s.split(" ")});j.contextHash=new j({perNode:!0});j.lookAhead=new j({perNode:!0});j.mounted=new j({perNode:!0});const nN=Object.create(null);class Ei{constructor(t,e,i,n=0){this.name=t,this.props=e,this.id=i,this.flags=n}static define(t){let e=t.props&&t.props.length?Object.create(null):nN,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),n=new Ei(t.name||"",e,t.id,i);if(t.props){for(let r of t.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[r[0].id]=r[1]}}return n}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(j.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let n of i.split(" "))e[n]=t[i];return i=>{for(let n=i.prop(j.group),r=-1;r<(n?n.length:0);r++){let o=e[r<0?i.name:n[r]];if(o)return o}}}}Ei.none=new Ei("",Object.create(null),0,8);const Ec=new WeakMap,BS=new WeakMap;var ve;(function(s){s[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays"})(ve||(ve={}));class Ce{constructor(t,e,i,n,r){if(this.type=t,this.children=e,this.positions=i,this.length=n,this.props=null,r&&r.length){this.props=Object.create(null);for(let[o,l]of r)this.props[typeof o=="number"?o:o.id]=l}}toString(){let t=this.prop(j.mounted);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let n=i.toString();n&&(e&&(e+=","),e+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new td(this.topNode,t)}cursorAt(t,e=0,i=0){let n=Ec.get(this)||this.topNode,r=new td(n);return r.moveTo(t,e),Ec.set(this,r._tree),r}get topNode(){return new As(this,0,0,null)}resolve(t,e=0){let i=el(Ec.get(this)||this.topNode,t,e,!1);return Ec.set(this,i),i}resolveInner(t,e=0){let i=el(BS.get(this)||this.topNode,t,e,!0);return BS.set(this,i),i}iterate(t){let{enter:e,leave:i,from:n=0,to:r=this.length}=t;for(let o=this.cursor((t.mode||0)|ve.IncludeAnonymous);;){let l=!1;if(o.from<=r&&o.to>=n&&(o.type.isAnonymous||e(o)!==!1)){if(o.firstChild())continue;l=!0}for(;l&&i&&!o.type.isAnonymous&&i(o),!o.nextSibling();){if(!o.parent())return;l=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:gb(Ei.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,n)=>new Ce(this.type,e,i,n,this.propValues),t.makeTree||((e,i,n)=>new Ce(Ei.none,e,i,n)))}static build(t){return rN(t)}}Ce.empty=new Ce(Ei.none,[],[],0);class ub{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ub(this.buffer,this.index)}}class Ir{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return Ei.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],n=this.set.types[e],r=n.name;if(/\W/.test(r)&&!n.isError&&(r=JSON.stringify(r)),t+=4,i==t)return r;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return r+"("+o.join(",")+")"}findChild(t,e,i,n,r){let{buffer:o}=this,l=-1;for(let h=t;h!=e&&!(oO(r,n,o[h+1],o[h+2])&&(l=h,i>0));h=o[h+3]);return l}slice(t,e,i,n){let r=this.buffer,o=new Uint16Array(e-t);for(let l=t,h=0;l<e;)o[h++]=r[l++],o[h++]=r[l++]-i,o[h++]=r[l++]-i,o[h++]=r[l++]-t;return new Ir(o,n-i,this.set)}}function oO(s,t,e,i){switch(s){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function lO(s,t){let e=s.childBefore(t);for(;e;){let i=e.lastChild;if(!i||i.to!=e.to)break;i.type.isError&&i.from==i.to?(s=e,e=i.prevSibling):e=i}return s}function el(s,t,e,i){for(var n;s.from==s.to||(e<1?s.from>=t:s.from>t)||(e>-1?s.to<=t:s.to<t);){let o=!i&&s instanceof As&&s.index<0?null:s.parent;if(!o)return s;s=o}let r=i?0:ve.IgnoreOverlays;if(i)for(let o=s,l=o.parent;l;o=l,l=o.parent)o instanceof As&&o.index<0&&((n=l.enter(t,e,r))===null||n===void 0?void 0:n.from)!=o.from&&(s=l);for(;;){let o=s.enter(t,e,r);if(!o)return s;s=o}}class As{constructor(t,e,i,n){this._tree=t,this.from=e,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,n,r=0){for(let o=this;;){for(let{children:l,positions:h}=o._tree,a=e>0?l.length:-1;t!=a;t+=e){let c=l[t],f=h[t]+o.from;if(oO(n,i,f,f+c.length)){if(c instanceof Ir){if(r&ve.ExcludeBuffers)continue;let u=c.findChild(0,c.buffer.length,e,i-f,n);if(u>-1)return new zs(new sN(o,c,t,f),null,u)}else if(r&ve.IncludeAnonymous||!c.type.isAnonymous||db(c)){let u;if(!(r&ve.IgnoreMounts)&&c.props&&(u=c.prop(j.mounted))&&!u.overlay)return new As(u.tree,f,t,o);let d=new As(c,f,t,o);return r&ve.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(e<0?c.children.length-1:0,e,i,n)}}}if(r&ve.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let n;if(!(i&ve.IgnoreOverlays)&&(n=this._tree.prop(j.mounted))&&n.overlay){let r=t-this.from;for(let{from:o,to:l}of n.overlay)if((e>0?o<=r:o<r)&&(e<0?l>=r:l>r))return new As(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new td(this,t)}get tree(){return this._tree}toTree(){return this._tree}resolve(t,e=0){return el(this,t,e,!1)}resolveInner(t,e=0){return el(this,t,e,!0)}enterUnfinishedNodesBefore(t){return lO(this,t)}getChild(t,e=null,i=null){let n=Qu(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Qu(this,t,e,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(t){return _u(this,t)}}function Qu(s,t,e,i){let n=s.cursor(),r=[];if(!n.firstChild())return r;if(e!=null){for(;!n.type.is(e);)if(!n.nextSibling())return r}for(;;){if(i!=null&&n.type.is(i))return r;if(n.type.is(t)&&r.push(n.node),!n.nextSibling())return i==null?r:[]}}function _u(s,t,e=t.length-1){for(let i=s.parent;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class sN{constructor(t,e,i,n){this.parent=t,this.buffer=e,this.index=i,this.start=n}}class zs{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e,i){let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.context.start,i);return r<0?null:new zs(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&ve.ExcludeBuffers)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return r<0?null:new zs(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new zs(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new zs(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new td(this,t)}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,n=this.index+4,r=i.buffer[this.index+3];if(r>n){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];t.push(i.slice(n,r,o,l)),e.push(0)}return new Ce(this.type,t,e,this.to-this.from)}resolve(t,e=0){return el(this,t,e,!1)}resolveInner(t,e=0){return el(this,t,e,!0)}enterUnfinishedNodesBefore(t){return lO(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let n=Qu(this,t,e,i);return n.length?n[0]:null}getChildren(t,e=null,i=null){return Qu(this,t,e,i)}get node(){return this}matchContext(t){return _u(this,t)}}class td{constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof As)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:n}=this.buffer;return this.type=e||n.set.types[n.buffer[t]],this.from=i+n.buffer[t+1],this.to=i+n.buffer[t+2],!0}yield(t){return t?t instanceof As?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:n}=this.buffer,r=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,i);return r<0?!1:(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&ve.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&ve.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&ve.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let n=i<0?0:this.stack[i]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{let n=e.buffer[this.index+3];if(n<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(n)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:n}=this;if(n){if(t>0){if(this.index<n.buffer.buffer.length)return!1}else for(let r=0;r<this.index;r++)if(n.buffer.buffer[r+3]<this.index)return!1;({index:e,parent:i}=n)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let r=e+t,o=t<0?-1:i._tree.children.length;r!=o;r+=t){let l=i._tree.children[r];if(this.mode&ve.IncludeAnonymous||l instanceof Ir||!l.type.isAnonymous||db(l))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let n=this.index,r=this.stack.length;r>=0;){for(let o=t;o;o=o._parent)if(o.index==n){if(n==this.index)return o;e=o,i=r+1;break t}n=this.stack[--r]}for(let n=i;n<this.stack.length;n++)e=new zs(this.buffer,e,this.stack[n]);return this.bufferNode=new zs(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let n=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&e&&e(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(t){if(!this.buffer)return _u(this.node,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let n=t.length-1,r=this.stack.length-1;n>=0;r--){if(r<0)return _u(this.node,t,n);let o=i[e.buffer[this.stack[r]]];if(!o.isAnonymous){if(t[n]&&t[n]!=o.name)return!1;n--}}return!0}}function db(s){return s.children.some(t=>t instanceof Ir||!t.type.isAnonymous||db(t))}function rN(s){var t;let{buffer:e,nodeSet:i,maxBufferLength:n=eN,reused:r=[],minRepeatType:o=i.types.length}=s,l=Array.isArray(e)?new ub(e,e.length):e,h=i.types,a=0,c=0;function f(b,S,v,L,Pt){let{id:J,start:W,end:et,size:Lt}=l,Wt=c;for(;Lt<0;)if(l.next(),Lt==-1){let de=r[J];v.push(de),L.push(W-b);return}else if(Lt==-3){a=J;return}else if(Lt==-4){c=J;return}else throw new RangeError(`Unrecognized record size: ${Lt}`);let hi=h[J],xe,Be,Vi=W-b;if(et-W<=n&&(Be=m(l.pos-S,Pt))){let de=new Uint16Array(Be.size-Be.skip),Ii=l.pos-Be.size,ds=de.length;for(;l.pos>Ii;)ds=p(Be.start,de,ds);xe=new Ir(de,et-Be.start,i),Vi=Be.start-b}else{let de=l.pos-Lt;l.next();let Ii=[],ds=[],or=J>=o?J:-1,Fr=0,Cc=et;for(;l.pos>de;)or>=0&&l.id==or&&l.size>=0?(l.end<=Cc-n&&(d(Ii,ds,W,Fr,l.end,Cc,or,Wt),Fr=Ii.length,Cc=l.end),l.next()):f(W,de,Ii,ds,or);if(or>=0&&Fr>0&&Fr<Ii.length&&d(Ii,ds,W,Fr,W,Cc,or,Wt),Ii.reverse(),ds.reverse(),or>-1&&Fr>0){let Mx=u(hi);xe=gb(hi,Ii,ds,0,Ii.length,0,et-W,Mx,Mx)}else xe=g(hi,Ii,ds,et-W,Wt-et)}v.push(xe),L.push(Vi)}function u(b){return(S,v,L)=>{let Pt=0,J=S.length-1,W,et;if(J>=0&&(W=S[J])instanceof Ce){if(!J&&W.type==b&&W.length==L)return W;(et=W.prop(j.lookAhead))&&(Pt=v[J]+W.length+et)}return g(b,S,v,L,Pt)}}function d(b,S,v,L,Pt,J,W,et){let Lt=[],Wt=[];for(;b.length>L;)Lt.push(b.pop()),Wt.push(S.pop()+v-Pt);b.push(g(i.types[W],Lt,Wt,J-Pt,et-J)),S.push(Pt-v)}function g(b,S,v,L,Pt=0,J){if(a){let W=[j.contextHash,a];J=J?[W].concat(J):[W]}if(Pt>25){let W=[j.lookAhead,Pt];J=J?[W].concat(J):[W]}return new Ce(b,S,v,L,J)}function m(b,S){let v=l.fork(),L=0,Pt=0,J=0,W=v.end-n,et={size:0,start:0,skip:0};t:for(let Lt=v.pos-b;v.pos>Lt;){let Wt=v.size;if(v.id==S&&Wt>=0){et.size=L,et.start=Pt,et.skip=J,J+=4,L+=4,v.next();continue}let hi=v.pos-Wt;if(Wt<0||hi<Lt||v.start<W)break;let xe=v.id>=o?4:0,Be=v.start;for(v.next();v.pos>hi;){if(v.size<0)if(v.size==-3)xe+=4;else break t;else v.id>=o&&(xe+=4);v.next()}Pt=Be,L+=Wt,J+=xe}return(S<0||L==b)&&(et.size=L,et.start=Pt,et.skip=J),et.size>4?et:void 0}function p(b,S,v){let{id:L,start:Pt,end:J,size:W}=l;if(l.next(),W>=0&&L<o){let et=v;if(W>4){let Lt=l.pos-(W-4);for(;l.pos>Lt;)v=p(b,S,v)}S[--v]=et,S[--v]=J-b,S[--v]=Pt-b,S[--v]=L}else W==-3?a=L:W==-4&&(c=L);return v}let y=[],w=[];for(;l.pos>0;)f(s.start||0,s.bufferStart||0,y,w,-1);let x=(t=s.length)!==null&&t!==void 0?t:y.length?w[0]+y[0].length:0;return new Ce(h[s.topID],y.reverse(),w.reverse(),x)}const ES=new WeakMap;function Jf(s,t){if(!s.isAnonymous||t instanceof Ir||t.type!=s)return 1;let e=ES.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=s||!(i instanceof Ce)){e=1;break}e+=Jf(s,i)}ES.set(t,e)}return e}function gb(s,t,e,i,n,r,o,l,h){let a=0;for(let g=i;g<n;g++)a+=Jf(s,t[g]);let c=Math.ceil(a*1.5/8),f=[],u=[];function d(g,m,p,y,w){for(let x=p;x<y;){let b=x,S=m[x],v=Jf(s,g[x]);for(x++;x<y;x++){let L=Jf(s,g[x]);if(v+L>=c)break;v+=L}if(x==b+1){if(v>c){let L=g[b];d(L.children,L.positions,0,L.children.length,m[b]+w);continue}f.push(g[b])}else{let L=m[x-1]+g[x-1].length-S;f.push(gb(s,g,m,b,x,S,L,null,h))}u.push(S+w-r)}}return d(t,e,i,n,0),(l||h)(f,u,o)}class Sr{constructor(t,e,i,n,r=!1,o=!1){this.from=t,this.to=e,this.tree=i,this.offset=n,this.open=(r?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(t,e=[],i=!1){let n=[new Sr(0,t.length,t,0,!1,i)];for(let r of e)r.to>t.length&&n.push(r);return n}static applyChanges(t,e,i=128){if(!e.length)return t;let n=[],r=1,o=t.length?t[0]:null;for(let l=0,h=0,a=0;;l++){let c=l<e.length?e[l]:null,f=c?c.fromA:1e9;if(f-h>=i)for(;o&&o.from<f;){let u=o;if(h>=u.from||f<=u.to||a){let d=Math.max(u.from,h)-a,g=Math.min(u.to,f)-a;u=d>=g?null:new Sr(d,g,u.tree,u.offset+a,l>0,!!c)}if(u&&n.push(u),o.to>f)break;o=r<t.length?t[r++]:null}if(!c)break;h=c.toA,a=c.toA-c.toB}return n}}class oN{startParse(t,e,i){return typeof t=="string"&&(t=new lN(t)),i=i?i.length?i.map(n=>new Vg(n.from,n.to)):[new Vg(0,0)]:[new Vg(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let n=this.startParse(t,e,i);for(;;){let r=n.advance();if(r)return r}}}class lN{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new j({perNode:!0});let mt=class hO{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),Yf.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Yf.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new Ph(this),r=new Ph(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new Ph(this,t)}iterRange(t,e=this.length){return new aO(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new cO(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?hO.empty:t.length<=32?new _i(t):Yf.from(_i.split(t,[]))}},_i=class Bn extends mt{constructor(t,e=hN(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new aN(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new Bn(PS(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=Xf(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Bn(l,o.length+r.length));else{let h=l.length>>1;i.push(new Bn(l.slice(0,h)),new Bn(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof Bn))return super.replace(t,e,i);let n=Xf(this.text,Xf(i.text,PS(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new Bn(n,r):Yf.from(Bn.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new Bn(i,n)),i=[],n=-1);return n>-1&&e.push(new Bn(i,n)),e}},Yf=class Zr extends mt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new Zr(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Zr))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new _i(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof Zr)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof _i&&h&&(g=c[c.length-1])instanceof _i&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new _i(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:Zr.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new Zr(l,e)}};mt.empty=new _i([""],0);function hN(s){let t=-1;for(let e of s)t+=e.length+1;return t}function Xf(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function PS(s,t,e){return Xf(s,[""],t,e)}let Ph=class{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof _i?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof _i?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof _i){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof _i?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}},aO=class{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Ph(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},cO=class{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(mt.prototype[Symbol.iterator]=function(){return this.iter()},Ph.prototype[Symbol.iterator]=aO.prototype[Symbol.iterator]=cO.prototype[Symbol.iterator]=function(){return this});let aN=class{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}},Oo="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<Oo.length;s++)Oo[s]+=Oo[s-1];function cN(s){for(let t=1;t<Oo.length;t+=2)if(Oo[t]>s)return Oo[t-1]<=s;return!1}function LS(s){return s>=127462&&s<=127487}const VS=8205;function ys(s,t,e=!0,i=!0){return(e?fO:fN)(s,t,i)}function fO(s,t,e){if(t==s.length)return t;t&&uO(s.charCodeAt(t))&&dO(s.charCodeAt(t-1))&&t--;let i=Ig(s,t);for(t+=IS(i);t<s.length;){let n=Ig(s,t);if(i==VS||n==VS||e&&cN(n))t+=IS(n),i=n;else if(LS(n)){let r=0,o=t-2;for(;o>=0&&LS(Ig(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function fN(s,t,e){for(;t>0;){let i=fO(s,t-2,e);if(i<t)return i;t--}return 0}function uO(s){return s>=56320&&s<57344}function dO(s){return s>=55296&&s<56320}function Ig(s,t){let e=s.charCodeAt(t);if(!dO(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return uO(i)?(e-55296<<10)+(i-56320)+65536:e}function IS(s){return s<65536?1:2}const Nm=/\r\n?|\n/;var wi=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(wi||(wi={}));let Lh=class Zf{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){Hm(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new Zf(t)}composeDesc(t){return this.empty?t:t.empty?this:gO(this,t)}mapDesc(t,e=!1){return t.empty?this:Fm(this,t,e)}mapPos(t,e=-1,i=wi.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=wi.Simple&&a>=t&&(i==wi.TrackDel&&n<t&&a>t||i==wi.TrackBefore&&n<t||i==wi.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Zf(t)}static create(t){return new Zf(t)}},os=class Rs extends Lh{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Hm(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return Fm(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(mt.empty);i.push(o?t.slice(r,r+o):mt.empty)}r+=o}return new Rs(e,i)}compose(t){return this.empty?t:t.empty?this:gO(this,t,!0)}map(t,e=!1){return t.empty?this:Fm(this,t,e,!0)}iterChanges(t,e=!1){Hm(this,t,e)}get desc(){return Lh.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new da(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Pe(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Pe(e,c,f),f>0&&ur(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Pe(e,c,-1),Pe(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new Rs(e,i),filtered:Lh.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Pe(n,e-o,-1);let f=new Rs(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof Rs){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?mt.of(d.split(i||Nm)):d:mt.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Pe(n,f-o,-1),Pe(n,u-f,m),ur(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new Rs(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(mt.empty);i[n]=mt.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new Rs(e,i)}static createSet(t,e){return new Rs(t,e)}};function Pe(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function ur(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(mt.empty);s.push(e)}}function Hm(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=mt.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function Fm(s,t,e,i=!1){let n=[],r=i?[]:null,o=new da(s),l=new da(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let c=Math.min(l.len,h-a);l.forward(c),Pe(n,c,-1),a+=c}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(Pe(n,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let c=0,f=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<f)c+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<f){let u=Math.min(l.len,f-a);c+=u,l.forward(u),a+=u}else break;Pe(n,c,o.ins),r&&ur(r,n,o.text),h=f,o.next()}else{if(o.done&&l.done)return r?os.createSet(n,r):Lh.create(n);throw new Error("Mismatched change set lengths")}}function gO(s,t,e=!1){let i=[],n=e?[]:null,r=new da(s),o=new da(t);for(let l=!1;;){if(r.done&&o.done)return n?os.createSet(i,n):Lh.create(i);if(r.ins==0)Pe(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Pe(i,0,o.ins,l),n&&ur(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Pe(i,h,c,l),n&&c&&ur(n,i,o.text)}else o.ins==-1?(Pe(i,r.off?0:r.len,h,l),n&&ur(n,i,r.textBit(h))):(Pe(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&ur(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}let da=class{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?mt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?mt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}},Pc=class Wm{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new Wm(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return z.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return z.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return z.range(t.anchor,t.head)}static create(t,e,i){return new Wm(t,e,i)}},z=class ci{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:ci.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ci([this.main],0)}addRange(t,e=!0){return ci.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,ci.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ci(t.ranges.map(e=>Pc.fromJSON(e)),t.main)}static single(t,e=t){return new ci([ci.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return ci.normalized(t.slice(),e);i=r.to}return new ci(t,e)}static cursor(t,e=0,i,n){return Pc.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n??33554431)<<5)}static range(t,e,i){let n=(i??33554431)<<5;return e<t?Pc.create(e,t,16|n|8):Pc.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?ci.range(h,l):ci.range(l,h))}}return new ci(t,e)}};function pO(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let pb=0,H=class mO{constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=r,this.id=pb++,this.default=t([])}static define(t={}){return new mO(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:mb),!!t.static,t.enables)}of(t){return new Qf([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Qf(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Qf(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}};function mb(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}let Qf=class{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=pb++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||zm(f,c)){let d=i(f);if(l?!NS(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d=i(f),g=u.config.address[r];if(g!=null){let m=ed(u,g);if(this.dependencies.every(p=>p instanceof H?u.facet(p)===f.facet(p):p instanceof Nr?u.field(p,!1)==f.field(p,!1):!0)||(l?NS(d,m,n):n(d,m)))return f.values[o]=m,0}return f.values[o]=d,1}}}};function NS(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function zm(s,t){let e=!1;for(let i of t)Vh(s,i)&1&&(e=!0);return e}function uN(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=ed(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)Vh(h,a);return h.values[o]=l(h),1},update(h,a){if(!zm(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=zm(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&mb(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const HS=H.define({static:!0});let Nr=class yO{constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new yO(pb++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(HS).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,HS.of({field:this,create:t})]}get extension(){return this}};const Qr={lowest:4,low:3,default:2,high:1,highest:0};function El(s){return t=>new bO(t,s)}const wO={highest:El(Qr.highest),high:El(Qr.high),default:El(Qr.default),low:El(Qr.low),lowest:El(Qr.lowest)};let bO=class{constructor(t,e){this.inner=t,this.prec=e}},xO=class SO{of(t){return new qm(this,t)}reconfigure(t){return SO.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}},qm=class{constructor(t,e){this.compartment=t,this.inner=e}},FS=class vO{constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of dN(t,e,o))u instanceof Nr?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,mb(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>uN(p,g,d))}}let f=a.map(u=>u(l));return new vO(t,o,f,l,h,r)}};function dN(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof qm&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof qm){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof bO)r(o.inner,o.prec);else if(o instanceof Nr)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof Qf)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,Qr.default),i.reduce((o,l)=>o.concat(l))}function Vh(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function ed(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const kO=H.define(),AO=H.define({combine:s=>s.some(t=>t),static:!0}),CO=H.define({combine:s=>s.length?s[0]:void 0,static:!0}),MO=H.define(),DO=H.define(),OO=H.define(),TO=H.define({combine:s=>s.length?s[0]:!1});let oc=class{constructor(t,e){this.type=t,this.value=e}static define(){return new gN}},gN=class{of(t){return new oc(this,t)}},pN=class{constructor(t){this.map=t}of(t){return new jt(this,t)}},jt=class $O{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new $O(this.type,e)}is(t){return this.type==t}static define(t={}){return new pN(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}};jt.reconfigure=jt.define();jt.appendConfig=jt.define();let un=class ih{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&pO(i,e.newLength),r.some(l=>l.type==ih.time)||(this.annotations=r.concat(ih.time.of(Date.now())))}static create(t,e,i,n,r,o){return new ih(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(ih.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}};un.time=oc.define();un.userEvent=oc.define();un.addToHistory=oc.define();un.remote=oc.define();function mN(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function RO(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=os.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:jt.mapEffects(s.effects,n).concat(jt.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function Km(s,t,e){let i=t.selection,n=To(t.annotations);return t.userEvent&&(n=n.concat(un.userEvent.of(t.userEvent))),{changes:t.changes instanceof os?t.changes:os.of(t.changes||[],e,s.facet(CO)),selection:i&&(i instanceof z?i:z.single(i.anchor,i.head)),effects:To(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function BO(s,t,e){let i=Km(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=RO(i,Km(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=un.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return wN(e?yN(n):n)}function yN(s){let t=s.startState,e=!0;for(let n of t.facet(MO)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:mN(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=os.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.invertedDesc}s=un.create(t,n,s.selection&&s.selection.map(r),jt.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(DO);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof un?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof un?s=r[0]:s=BO(t,To(r),!1)}return s}function wN(s){let t=s.startState,e=t.facet(OO),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=RO(s,Km(t,r,s.changes.newLength),!0))}return i==s?s:un.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const bN=[];function To(s){return s==null?bN:Array.isArray(s)?s:[s]}var ws=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(ws||(ws={}));const xN=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Gm;try{Gm=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function SN(s){if(Gm)return Gm.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||xN.test(e)))return!0}return!1}function vN(s){return t=>{if(!/\S/.test(t))return ws.Space;if(SN(t))return ws.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return ws.Word;return ws.Other}}let Qt=class Fi{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Vh(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return Vh(this,i),ed(this,i)}update(...t){return BO(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(xO.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(jt.reconfigure)?(e=null,i=o.value):o.is(jt.appendConfig)&&(e=null,i=To(i).concat(o.value));let r;e?r=t.startState.values.slice():(e=FS.resolve(i,n,this),r=new Fi(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new Fi(e,t.newDoc,t.newSelection,r,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:z.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=To(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=jt.mapEffects(o,c).concat(jt.mapEffects(To(h.effects),f))}return{changes:n,selection:z.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof os?t:os.of(t,this.doc.length,this.facet(Fi.lineSeparator))}toText(t){return mt.of(t.split(this.facet(Fi.lineSeparator)||Nm))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Vh(this,e),ed(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof Nr&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}return Fi.create({doc:t.doc,selection:z.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=FS.resolve(t.extensions||[],new Map),i=t.doc instanceof mt?t.doc:mt.of((t.doc||"").split(e.staticFacet(Fi.lineSeparator)||Nm)),n=t.selection?t.selection instanceof z?t.selection:z.single(t.selection.anchor,t.selection.head):z.single(0);return pO(n,i.length),e.staticFacet(AO)||(n=n.asSingle()),new Fi(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(Fi.tabSize)}get lineBreak(){return this.facet(Fi.lineSeparator)||`
`}get readOnly(){return this.facet(TO)}phrase(t,...e){for(let i of this.facet(Fi.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(kO))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return vN(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=ys(e,o,!1);if(r(e.slice(h,o))!=ws.Word)break;o=h}for(;l<n;){let h=ys(e,l);if(r(e.slice(l,h))!=ws.Word)break;l=h}return o==l?null:z.range(o+i,l+i)}};Qt.allowMultipleSelections=AO;Qt.tabSize=H.define({combine:s=>s.length?s[0]:4});Qt.lineSeparator=CO;Qt.readOnly=TO;Qt.phrases=H.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});Qt.languageData=kO;Qt.changeFilter=MO;Qt.transactionFilter=DO;Qt.transactionExtender=OO;xO.reconfigure=jt.define();function EO(s,t,e={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}let il=class{eq(t){return this==t}range(t,e=t){return jm.create(t,e,this)}};il.prototype.startSide=il.prototype.endSide=0;il.prototype.point=!1;il.prototype.mapMode=wi.TrackDel;let jm=class PO{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new PO(t,e,i)}};function Um(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}let kN=class LO{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new LO(n,r,i,l):null,pos:o}}},Kt=class _r{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new _r(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(Um)),this.isEmpty)return e.length?_r.of(e):this;let l=new IO(this,null,-1).goto(0),h=0,a=[],c=new id;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(jm.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?_r.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new _r(i,e,r||_r.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return Jm.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return Jm.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=WS(o,l,i),a=new Pl(o,h,r),c=new Pl(l,h,r);i.iterGaps((f,u,d)=>zS(a,f,c,u,d,n)),i.empty&&i.length==0&&zS(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=WS(r,o),h=new Pl(r,l,0).goto(i),a=new Pl(o,l,0).goto(i);for(;;){if(h.to!=a.to||!Ym(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new Pl(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new id;for(let n of t instanceof jm?[t]:e?AN(t):t)i.add(n.from,n.to,n.value);return i.finish()}};Kt.empty=new Kt([],[],null,-1);function AN(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(Um(t,i)>0)return s.slice().sort(Um);t=i}return s}Kt.empty.nextLayer=Kt.empty;let id=class VO{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new kN(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new VO)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(Kt.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=Kt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}};function WS(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}let IO=class{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}},Jm=class NO{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new IO(o,e,i,r));return n.length==1?n[0]:new NO(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)Ng(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)Ng(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Ng(this.heap,0)}}};function Ng(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}let Pl=class{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Jm.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Lc(this.active,t),Lc(this.activeTo,t),Lc(this.activeRank,t),this.minActive=qS(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;Vc(this.active,e,i),Vc(this.activeTo,e,n),Vc(this.activeRank,e,r),t&&Vc(t,e,this.cursor.from),this.minActive=qS(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&Lc(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}};function zS(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to||s.endSide-e.endSide,c=a<0?s.to+h:e.to,f=Math.min(c,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&Ym(s.activeForPoint(s.to+h),e.activeForPoint(e.to))||r.comparePoint(l,f,s.point,e.point):f>l&&!Ym(s.active,e.active)&&r.compareRange(l,f,s.active,e.active),c>o)break;l=c,a<=0&&s.next(),a>=0&&e.next()}}function Ym(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function Lc(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function Vc(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function qS(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function CN(s,t,e=s.length){let i=0;for(let n=0;n<e;)s.charCodeAt(n)==9?(i+=t-i%t,n++):(i++,n=ys(s,n));return i}function MN(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=ys(s,n)}return s.length}function nd(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function nl(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function DN(){let s=document.activeElement;for(;s&&s.shadowRoot;)s=s.shadowRoot.activeElement;return s}function Xm(s,t){if(!t.anchorNode)return!1;try{return nl(s,t.anchorNode)}catch{return!1}}function ga(s){return s.nodeType==3?pa(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function sd(s,t,e,i){return e?KS(s,t,e,i,-1)||KS(s,t,e,i,1):!1}function Zm(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function KS(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:rd(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=Zm(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?rd(s):0}else return!1}}function rd(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}const HO={left:0,right:0,top:0,bottom:0};function Jd(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function ON(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function TN(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView;for(let c=s;c;)if(c.nodeType==1){let f,u=c==h.body;if(u)f=ON(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let m=c.getBoundingClientRect();f={left:m.left,right:m.left+c.clientWidth,top:m.top,bottom:m.top+c.clientHeight}}let d=0,g=0;if(n=="nearest")t.top<f.top?(g=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+g&&(g=t.bottom-f.bottom+g+o)):t.bottom>f.bottom&&(g=t.bottom-f.bottom+o,e<0&&t.top-g<f.top&&(g=-(f.top+g-t.top+o)));else{let m=t.bottom-t.top,p=f.bottom-f.top;g=(n=="center"&&m<=p?t.top+m/2-p/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-p+o)-f.top}if(i=="nearest"?t.left<f.left?(d=-(f.left-t.left+r),e>0&&t.right>f.right+d&&(d=t.right-f.right+d+r)):t.right>f.right&&(d=t.right-f.right+r,e<0&&t.left<f.left+d&&(d=-(f.left+d-t.left+r))):d=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,d||g)if(u)a.scrollBy(d,g);else{if(g){let m=c.scrollTop;c.scrollTop+=g,g=c.scrollTop-m}if(d){let m=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-m}t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(u)break;c=c.assignedSlot||c.parentNode,i=n="nearest"}else if(c.nodeType==11)c=c.host;else break}let $N=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}},qr=null;function FO(s){if(s.setActive)return s.setActive();if(qr)return s.focus(qr);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(qr==null?{get preventScroll(){return qr={preventScroll:!0},!0}}:void 0),!qr){qr=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let GS;function pa(s,t,e=t){let i=GS||(GS=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function Ih(s,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function RN(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function WO(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}let Je=class Qm{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Qm(t.parentNode,Zm(t),e)}static after(t,e){return new Qm(t.parentNode,Zm(t)+1,e)}};const yb=[];let _t=class _m{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let r of this.children){if(r.dirty){if(!r.dom&&(n=i?i.nextSibling:e.firstChild)){let o=_m.get(n);(!o||!o.parent&&o.constructor==r.constructor)&&r.reuseDOM(n)}r.sync(t),r.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=r.dom&&(t.written=!0),r.dom.parentNode==e)for(;n&&n!=r.dom;)n=jS(n);else e.insertBefore(r.dom,n);i=r.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=jS(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=rd(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!_m.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=yb){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new zO(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}};_t.prototype.breakAfter=0;function jS(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}let zO=class{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function qO(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function KO(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,qO(s,a,c,l,h,i,0,n,r)}let dn=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},t0=typeof document<"u"?document:{documentElement:{style:{}}};const e0=/Edge\/(\d+)/.exec(dn.userAgent),GO=/MSIE \d/.test(dn.userAgent),i0=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(dn.userAgent),Yd=!!(GO||i0||e0),US=!Yd&&/gecko\/(\d+)/i.test(dn.userAgent),Hg=!Yd&&/Chrome\/(\d+)/.exec(dn.userAgent),BN="webkitFontSmoothing"in t0.documentElement.style,jO=!Yd&&/Apple Computer/.test(dn.vendor),JS=jO&&(/Mobile\/\w+/.test(dn.userAgent)||dn.maxTouchPoints>2);var B={mac:JS||/Mac/.test(dn.platform),ie:Yd,ie_version:GO?t0.documentMode||6:i0?+i0[1]:e0?+e0[1]:0,gecko:US,gecko_version:US?+(/Firefox\/(\d+)/.exec(dn.userAgent)||[0,0])[1]:0,chrome:!!Hg,chrome_version:Hg?+Hg[1]:0,ios:JS,android:/Android\b/.test(dn.userAgent),safari:jO,webkit_version:BN?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:t0.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const EN=256;let ma=class n0 extends _t{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof n0)||this.length-(e-t)+i.length>EN)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new n0(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Je(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return r0(this.dom,t,e)}},Cr=class s0 extends _t{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(WO(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,r,o){return i&&(!(i instanceof s0&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(KO(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new s0(this.mark,e,o)}domAtPos(t){return YO(this.dom,this.children,t)}coordsAt(t,e){return ZO(this,t,e)}};function r0(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?B.chrome||B.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=pa(s,n,r).getClientRects();if(!l.length)return HO;let h=l[(o?o<0:e>=0)?0:l.length-1];return B.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?Jd(h,o<0):h||null}let wb=class nh extends _t{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||nh)(t,e,i)}split(t){let e=nh.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof nh)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof nh&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return mt.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):mt.empty}domAtPos(t){return t==0?Je.before(this.dom):Je.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return HO;for(let r=t>0?i.length-1:0;n=i[r],!(t>0?r==0:r==i.length-1||n.top<n.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:Jd(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},UO=class extends wb{domAtPos(t){let{topView:e,text:i}=this.widget;return e?o0(t,0,e,i,(n,r)=>n.domAtPos(r),n=>new Je(i,Math.min(n,i.nodeValue.length))):new Je(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?JO(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?o0(t,e,i,n,(r,o,l)=>r.coordsAt(o,l),(r,o)=>r0(n,r,o)):r0(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}};function o0(s,t,e,i,n,r){if(e instanceof Cr){for(let o of e.children){let l=nl(o.dom,i),h=l?i.nodeValue.length:o.length;if(s<h||s==h&&o.getSide()<=0)return l?o0(s,t,o,i,n,r):n(o,s,t);s-=h}return n(e,e.length,-1)}else return e.dom==i?r(s,t):n(e,s,t)}function JO(s,t,e,i){if(e instanceof Cr)for(let n of e.children){let r=0,o=nl(n.dom,i);if(nl(n.dom,s))return r+(o?JO(s,t,n,i):n.localPosFromDOM(s,t));r+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(s,t)}let l0=class h0 extends _t{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof h0&&t.side==this.side}split(){return new h0(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Je.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=PN(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return mt.empty}};ma.prototype.children=wb.prototype.children=l0.prototype.children=yb;function PN(s,t){let e=s.parent,i=e?e.children.indexOf(s):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof ma){let r=n.coordsAt(t<0?n.length:0,t);if(r)return r}i+=t}else if(e instanceof Cr&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function YO(s,t,e){let i=0;for(let n=0;i<t.length;i++){let r=t[i],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(e>n&&e<o&&r.dom.parentNode==s)return r.domAtPos(e-n);if(e<=n)break;n=o}}for(;i>0;i--){let n=t[i-1].dom;if(n.parentNode==s)return Je.after(n)}return new Je(s,0)}function XO(s,t,e){let i,{children:n}=s;e>0&&t instanceof Cr&&n.length&&(i=n[n.length-1])instanceof Cr&&i.mark.eq(t.mark)?XO(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function ZO(s,t,e){for(let r=0,o=0;o<s.children.length;o++){let l=s.children[o],h=r+l.length,a;if((e<=0||h==s.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==s.children.length||(a=s.children[o+1]).length||a.getSide()>0)){let c=0;if(h==r){if(l.getSide()<=0)continue;c=e=-l.getSide()}let f=l.coordsAt(Math.max(0,t-r),e);return c&&f?Jd(f,e<0):f}r=h}let i=s.dom.lastChild;if(!i)return s.dom.getBoundingClientRect();let n=ga(i);return n[n.length-1]||null}function a0(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}function bb(s,t){if(s==t)return!0;if(!s||!t)return!1;let e=Object.keys(s),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||s[n]!==t[n])return!1;return!0}function c0(s,t,e){let i=null;if(t)for(let n in t)e&&n in e||s.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||s.setAttribute(i=n,e[n]);return!!i}let lc=class{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}};var Nt=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(Nt||(Nt={}));let xt=class extends il{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new QO(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new ya(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=iT(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new ya(t,i,n,e,t.widget||null,!0)}static line(t){return new xb(t)}static set(t,e=!1){return Kt.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};xt.none=Kt.empty;let QO=class _O extends xt{constructor(t){let{start:e,end:i}=iT(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof _O&&this.tagName==t.tagName&&this.class==t.class&&bb(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}};QO.prototype.point=!1;let xb=class tT extends xt{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof tT&&bb(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}};xb.prototype.mapMode=wi.TrackBefore;xb.prototype.point=!0;let ya=class eT extends xt{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?wi.TrackBefore:wi.TrackAfter:wi.TrackDel}get type(){return this.startSide<this.endSide?Nt.WidgetRange:this.startSide<=0?Nt.WidgetBefore:Nt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof eT&&LN(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}};ya.prototype.point=!0;function iT(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function LN(s,t){return s==t||!!(s&&t&&s.compare(t))}function f0(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}let tn=class _f extends _t{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof _f))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),KO(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new _f;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){bb(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){XO(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=a0(e,this.attrs||{})),i&&(this.attrs=a0({class:i},this.attrs||{}))}domAtPos(t){return YO(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(WO(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(c0(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&_t.get(i)instanceof Cr;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=_t.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!B.ios||!this.children.some(n=>n instanceof ma))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof ma))return null;let i=ga(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return ZO(this,t,e)}become(t){return!1}get type(){return Nt.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof _f)return r;if(o>e)break}n=o+r.breakAfter}return null}},u0=class tu extends _t{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof tu)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?Je.before(this.dom):Je.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new tu(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return yb}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):mt.empty}domBoundsAround(){return null}become(t){return t instanceof tu&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},VN=class nT{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof u0&&t.type==Nt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new tn),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Ic(new l0(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Ic(new ma(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof ya){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof ya)if(i.block){let{type:h}=i;h==Nt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new u0(i.widget||new YS("div"),l,h))}else{let h=wb.create(i.widget||new YS("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(Ic(new l0(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(Ic(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new nT(t,e,i,r);return o.openEnd=Kt.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function Ic(s,t){for(let e of t)s=new Cr(e,[s],s.length);return s}let YS=class extends lc{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}};const sT=H.define(),rT=H.define(),oT=H.define(),lT=H.define(),d0=H.define(),hT=H.define(),aT=H.define({combine:s=>s.some(t=>t)});let XS=class cT{constructor(t,e="nearest",i="nearest",n=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r}map(t){return t.empty?this:new cT(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}};const ZS=jt.define({map:(s,t)=>s.map(t)});function _s(s,t,e){let i=s.facet(lT);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const hc=H.define({combine:s=>s.length?s[0]:!0});let IN=0;const sh=H.define();let ac=class g0{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:r}=e||{};return new g0(IN++,t,i,o=>{let l=[sh.of(o)];return r&&l.push(wa.of(h=>{let a=h.plugin(o);return a?r(a):xt.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return g0.define(i=>new t(i),e)}},Fg=class{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(_s(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){_s(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){_s(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const fT=H.define(),uT=H.define(),wa=H.define(),dT=H.define(),gT=H.define(),rh=H.define();let ba=class eu{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new eu(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new eu(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new eu(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}},QS=class pT{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=os.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new ba(o,l,h,a))),this.changedRanges=n;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}static create(t,e,i){return new pT(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}};var Me=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(Me||(Me={}));const p0=Me.LTR,NN=Me.RTL;function mT(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const HN=mT("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),FN=mT("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),m0=Object.create(null),kn=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);m0[t]=e,m0[e]=-t}function WN(s){return s<=247?HN[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?FN[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||s==8204?256:1}const zN=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;let $o=class{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?NN:p0}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};const Ct=[];function qN(s,t){let e=s.length,i=t==p0?1:2,n=t==p0?2:1;if(!s||i==1&&!zN.test(s))return yT(e);for(let o=0,l=i,h=i;o<e;o++){let a=WN(s.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),Ct[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=Ct[o];if(a==128)o<e-1&&l==Ct[o+1]&&l&24?a=Ct[o]=l:Ct[o]=256;else if(a==64){let c=o+1;for(;c<e&&Ct[c]==64;)c++;let f=o&&l==8||c<e&&Ct[c]==8?h==1?1:8:256;for(let u=o;u<c;u++)Ct[u]=f;o=c-1}else a==8&&h==1&&(Ct[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,c,f;o<e;o++)if(c=m0[a=s.charCodeAt(o)])if(c<0){for(let u=l-3;u>=0;u-=3)if(kn[u+1]==-c){let d=kn[u+2],g=d&2?i:d&4?d&1?n:i:0;g&&(Ct[o]=Ct[kn[u]]=g),l=u;break}}else{if(kn.length==189)break;kn[l++]=o,kn[l++]=a,kn[l++]=h}else if((f=Ct[o])==2||f==1){let u=f==i;h=u?0:1;for(let d=l-3;d>=0;d-=3){let g=kn[d+2];if(g&2)break;if(u)kn[d+2]|=2;else{if(g&4)break;kn[d+2]|=4}}}for(let o=0;o<e;o++)if(Ct[o]==256){let l=o+1;for(;l<e&&Ct[l]==256;)l++;let h=(o?Ct[o-1]:i)==1,a=(l<e?Ct[l]:i)==1,c=h==a?h?1:2:i;for(let f=o;f<l;f++)Ct[f]=c;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=Ct[o++]!=1;for(;o<e&&h==(Ct[o]!=1);)o++;if(h)for(let a=o;a>l;){let c=a,f=Ct[--a]!=2;for(;a>l&&f==(Ct[a-1]!=2);)a--;r.push(new $o(a,c,f?2:1))}else r.push(new $o(l,o,0))}else for(let o=0;o<e;){let l=o,h=Ct[o++]==2;for(;o<e&&h==(Ct[o]==2);)o++;r.push(new $o(l,o,h?1:2))}return r}function yT(s){return[new $o(0,s,0)]}let wT="";function KN(s,t,e,i,n){var r;let o=i.head-s.from,l=-1;if(o==0){if(!n||!s.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==s.length){if(n)return null;let u=t[t.length-1];u.level!=e&&(o=u.side(!0,e),l=t.length-1)}l<0&&(l=$o.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),c=ys(s.text,o,a);if(wT=s.text.slice(Math.min(o,c),Math.max(o,c)),c!=h.side(n,e))return z.cursor(c+s.from,a?-1:1,h.level);let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!f&&h.level!=e?z.cursor(n?s.to:s.from,n?-1:1,e):f&&f.level<h.level?z.cursor(f.side(!n,e)+s.from,n?1:-1,f.level):z.cursor(c+s.from,n?-1:1,h.level)}const qs="￿";let bT=class{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(Qt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=qs}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let r=n.nextSibling;if(r==e)break;let o=_t.get(n),l=_t.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:_S(n))||_S(r)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=r}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=_t.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}};function _S(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}let tv=class{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}},ev=class extends _t{constructor(t){super(),this.view=t,this.compositionDeco=xt.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new tn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ba(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=xt.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=jN(this.view,t.changes)),(B.ie||B.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),r=XN(i,n,t.changes);return e=ba.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let r=B.chrome||B.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof u0&&r.widget instanceof iv&&n.push(r.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let r=n>=0?t[n]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:c,breakAtStart:f,openStart:u,openEnd:d}=VN.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:g,off:m}=i.findPos(l,1),{i:p,off:y}=i.findPos(o,-1);qO(this,p,y,g,m,c,f,u,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||B.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),o=n.empty?r:this.domAtPos(n.head);if(B.gecko&&n.empty&&GN(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new Je(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!sd(r.node,r.offset,l.anchorNode,l.anchorOffset)||!sd(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{B.android&&B.chrome&&this.dom.contains(l.focusNode)&&ZN(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=nd(this.root);if(n.empty){if(B.gecko){let a=JN(r.node,r.offset);if(a&&a!=3){let c=ST(r.node,r.offset,a==1?1:-1);c&&(r=new Je(c,a==1?0:c.nodeValue.length))}}h.collapse(r.node,r.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new Je(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new Je(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=nd(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=tn.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(hc)?this.root.activeElement==this.dom:Xm(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=_t.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof tn)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=Nt.WidgetBefore&&r.type!=Nt.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==Nt.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==Me.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?ga(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?Me.RTL:Me.LTR}measureTextSize(){for(let n of this.children)if(n instanceof tn){let r=n.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=ga(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new zO(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(xt.replace({widget:new iv(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return xt.set(t)}updateDeco(){let t=this.view.state.facet(wa).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=0,o=0,l=0,h=0;for(let c of this.view.state.facet(gT).map(f=>f(this.view)))if(c){let{left:f,right:u,top:d,bottom:g}=c;f!=null&&(r=Math.max(r,f)),u!=null&&(o=Math.max(o,u)),d!=null&&(l=Math.max(l,d)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};TN(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Me.LTR)}};function GN(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}let iv=class extends lc{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function xT(s){let t=s.observer.selectionRange,e=t.focusNode&&ST(t.focusNode,t.focusOffset,0);if(!e)return null;let i=s.docView.nearest(e);if(!i)return null;if(i instanceof tn){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let r=n.previousSibling;for(;r&&!_t.get(r);)r=r.previousSibling;let o=r?_t.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof tn)break;i=r}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function jN(s,t){let e=xT(s);if(!e)return xt.none;let{from:i,to:n,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=s,c=r.nodeType==3?r.nodeValue:new bT([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),qs)==c)h=l+c.length;else if(a.doc.sliceString(Math.max(0,h-c.length),h,qs)==c)l=h-c.length;else return xt.none;else if(a.doc.sliceString(l,h,qs)!=c)return xt.none;let f=_t.get(r);return f instanceof UO?f=f.widget.topView:f&&(f.parent=null),xt.set(xt.replace({widget:new UN(r,o,f),inclusive:!0}).range(l,h))}let UN=class extends lc{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return UO}};function ST(s,t,e){for(;;){if(s.nodeType==3)return s;if(s.nodeType==1&&t>0&&e<=0)s=s.childNodes[t-1],t=rd(s);else if(s.nodeType==1&&t<s.childNodes.length&&e>=0)s=s.childNodes[t],t=0;else return null}}function JN(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let YN=class{constructor(){this.changes=[]}compareRange(t,e){f0(t,e,this.changes)}comparePoint(t,e){f0(t,e,this.changes)}};function XN(s,t,e){let i=new YN;return Kt.compare(s,t,e,i),i.changes}function ZN(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function QN(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return z.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=ys(n.text,r,!1):l=ys(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=ys(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=ys(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return z.range(o+n.from,l+n.from)}function _N(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function tH(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function Wg(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function nv(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function sv(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function y0(s,t,e){let i,n,r,o,l,h,a,c;for(let d=s.firstChild;d;d=d.nextSibling){let g=ga(d);for(let m=0;m<g.length;m++){let p=g[m];n&&Wg(n,p)&&(p=nv(sv(p,n.bottom),n.top));let y=_N(t,p),w=tH(e,p);if(y==0&&w==0)return d.nodeType==3?rv(d,t,e):y0(d,t,e);(!i||o>w||o==w&&r>y)&&(i=d,n=p,r=y,o=w),y==0?e>p.bottom&&(!a||a.bottom<p.bottom)?(l=d,a=p):e<p.top&&(!c||c.top>p.top)&&(h=d,c=p):a&&Wg(a,p)?a=sv(a,p.bottom):c&&Wg(c,p)&&(c=nv(c,p.top))}}if(a&&a.bottom>=e?(i=l,n=a):c&&c.top<=e&&(i=h,n=c),!i)return{node:s,offset:0};let f=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return rv(i,f,e);if(!r&&i.contentEditable=="true")return y0(i,f,e);let u=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:u}}function rv(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=pa(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if((B.chrome||B.gecko)&&pa(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function vT(s,{x:t,y:e},i,n=-1){var r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,c=e-l;if(c<0)return 0;if(c>a)return s.state.doc.length;for(let y=s.defaultLineHeight/2,w=!1;h=s.elementAtHeight(c),h.type!=Nt.Text;)for(;c=n>0?h.bottom+y:h.top-y,!(c>=0&&c<=a);){if(w)return i?null:0;w=!0,n=-n}e=l+c;let f=h.from;if(f<s.viewport.from)return s.viewport.from==0?0:i?null:ov(s,o,h,t,e);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:i?null:ov(s,o,h,t,e);let u=s.dom.ownerDocument,d=s.root.elementFromPoint?s.root:u,g=d.elementFromPoint(t,e);g&&!s.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=d.elementFromPoint(t,e),g&&!s.contentDOM.contains(g)&&(g=null));let m,p=-1;if(g&&((r=s.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(u.caretPositionFromPoint){let y=u.caretPositionFromPoint(t,e);y&&({offsetNode:m,offset:p}=y)}else if(u.caretRangeFromPoint){let y=u.caretRangeFromPoint(t,e);y&&({startContainer:m,startOffset:p}=y,B.safari&&eH(m,p,t)&&(m=void 0))}}if(!m||!s.docView.dom.contains(m)){let y=tn.find(s.docView,f);if(!y)return c>h.top+h.height/2?h.to:h.from;({node:m,offset:p}=y0(y.dom,t,e))}return s.docView.posFromDOM(m,p)}function ov(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=Math.floor((n-e.top)/s.defaultLineHeight);r+=l*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+MN(o,r,s.state.tabSize)}function eH(s,t,e){let i;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return pa(s,i-1,i).getBoundingClientRect().left>e}function iH(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=!i||!s.lineWrapping?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let h=s.dom.getBoundingClientRect(),a=s.textDirectionAt(n.from),c=s.posAtCoords({x:e==(a==Me.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(c!=null)return z.cursor(c,e?-1:1)}let o=tn.find(s.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return z.cursor(l,e?-1:1)}function lv(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=KN(n,r,o,l,e),c=wT;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=z.cursor(e?n.from:n.to)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function nH(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==ws.Space&&(n=o),n==o}}function sH(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return z.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.defaultLineHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=vT(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n))return z.cursor(m,t.assoc,void 0,o)}}function zg(s,t,e){let i=s.state.facet(dT).map(n=>n(s));for(;;){let n=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?z.cursor(o,1):z.cursor(l,-1),n=!0)});if(!n)return e}}let rH=class{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in he){let i=he[e];t.contentDOM.addEventListener(e,n=>{!hv(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))}),this.registeredEvents.push(e)}B.chrome&&B.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,B.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let r of e)if(n=(i=r.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{hv(t,l)&&this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let r=n.handlers[t];if(r)try{if(r.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){_s(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(r){_s(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(B.android&&B.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return B.ios&&(i=kT.find(n=>n.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Ih(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:B.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!B.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};const kT=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],oH=[16,17,18,20,91,92,224,225];let lH=class{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(Qt.allowMultipleSelections)&&hH(t,e),this.dragMove=aH(t,e),this.dragging=cH(t,e)&&Sb(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}};function hH(s,t){let e=s.state.facet(sT);return e.length?e[0](t):B.mac?t.metaKey:t.ctrlKey}function aH(s,t){let e=s.state.facet(rT);return e.length?e[0](t):B.mac?!t.altKey:!t.ctrlKey}function cH(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=nd(s.root);if(i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function hv(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=_t.get(e))&&i.ignoreEvent(t))return!1;return!0}const he=Object.create(null),AT=B.ie&&B.ie_version<15||B.ios&&B.webkit_version<604;function fH(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),CT(s,e.value)},50)}function CT(s,t){let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(w0!=null&&e.selection.ranges.every(h=>h.empty)&&w0==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:z.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:z.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}he.keydown=(s,t)=>{s.inputState.setSelectionOrigin("select"),t.keyCode==27?s.inputState.lastEscPress=Date.now():oH.indexOf(t.keyCode)<0&&(s.inputState.lastEscPress=0)};let MT=0;he.touchstart=(s,t)=>{MT=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};he.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};he.mousedown=(s,t)=>{if(s.observer.flush(),MT>Date.now()-2e3&&Sb(t)==1)return;let e=null;for(let i of s.state.facet(oT))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=gH(s,t)),e){let i=s.root.activeElement!=s.contentDOM;i&&s.observer.ignore(()=>FO(s.contentDOM)),s.inputState.startMouseSelection(new lH(s,t,e,i))}};function av(s,t,e,i){if(i==1)return z.cursor(t,e);if(i==2)return QN(s.state,t,e);{let n=tn.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,z.range(o,l)}}let DT=(s,t)=>s>=t.top&&s<=t.bottom,cv=(s,t,e)=>DT(t,e)&&s>=e.left&&s<=e.right;function uH(s,t,e,i){let n=tn.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&cv(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&cv(e,i,l)?1:o&&DT(i,o)?-1:1}function fv(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:uH(s,e,t.clientX,t.clientY)}}const dH=B.ie&&B.ie_version<=11;let uv=null,dv=0,gv=0;function Sb(s){if(!dH)return s.detail;let t=uv,e=gv;return uv=s,gv=Date.now(),dv=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(dv+1)%3:1}function gH(s,t){let e=fv(s,t),i=Sb(t),n=s.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),n=n.map(l.changes),o=null)},get(l,h,a){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=r:(c=r=fv(s,l),o=l),!c||!e)return n;let f=av(s,c.pos,c.bias,i);if(e.pos!=c.pos&&!h){let u=av(s,e.pos,e.bias,i),d=Math.min(u.from,f.from),g=Math.max(u.to,f.to);f=d<f.from?z.range(d,g):z.range(g,d)}return h?n.replaceRange(n.main.extend(f.from,f.to)):a?n.addRange(f):z.create([f])}}}he.dragstart=(s,t)=>{let{selection:{main:e}}=s.state,{mouseSelection:i}=s.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",s.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function pv(s,t,e,i){if(!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=s.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}he.drop=(s,t)=>{if(!t.dataTransfer)return;if(s.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,r=()=>{++n==e.length&&pv(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else pv(s,t,t.dataTransfer.getData("Text"),!0)};he.paste=(s,t)=>{if(s.state.readOnly)return t.preventDefault();s.observer.flush();let e=AT?null:t.clipboardData;e?(CT(s,e.getData("text/plain")),t.preventDefault()):fH(s)};function pH(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function mH(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(s.lineBreak),ranges:e,linewise:i}}let w0=null;he.copy=he.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=mH(s.state);if(!e&&!n)return;w0=n?e:null;let r=AT?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):pH(s,e),t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function OT(s){setTimeout(()=>{s.hasFocus!=s.inputState.notifiedFocused&&s.update([])},10)}he.focus=OT;he.blur=s=>{s.observer.clearSelectionRange(),OT(s)};function TT(s,t){if(s.docView.compositionDeco.size){s.inputState.rapidCompositionStart=t;try{s.update([])}finally{s.inputState.rapidCompositionStart=!1}}}he.compositionstart=he.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0,s.docView.compositionDeco.size&&(s.observer.flush(),TT(s,!0)))};he.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionFirstChange=null,setTimeout(()=>{s.inputState.composing<0&&TT(s,!1)},50)};he.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};he.beforeinput=(s,t)=>{var e;let i;if(B.chrome&&B.android&&(i=kT.find(n=>n.inputType==t.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}};const mv=["pre-wrap","normal","pre-line","break-spaces"];let yH=class{constructor(){this.doc=mt.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return mv.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r){let o=mv.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<r.length;h++){let a=r[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}},wH=class{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}},yo=class $T{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new $T(this.from,this.length+t.length,this.top,this.height+t.height,e)}};var lt=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(lt||(lt={}));const iu=.001;let Zn=class nu{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>iu&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return nu.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:c}=n[o],f=r.lineAt(l,lt.ByPosNoHeight,e,0,0),u=f.to>=h?f:r.lineAt(h,lt.ByPosNoHeight,e,0,0);for(c+=u.to-h,h=u.to;o>0&&f.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<f.from&&(f=r.lineAt(l,lt.ByPosNoHeight,e,0,0));a+=f.from-l,l=f.from;let d=SH.build(i,t,a,c);r=r.replace(l,h,d)}return r.updateHeight(i,0)}static empty(){return new Hn(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new bH(nu.of(t.slice(0,e)),o,nu.of(t.slice(i)))}};Zn.prototype.size=1;let RT=class extends Zn{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new yo(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Hn=class b0 extends RT{constructor(t,e){super(t,e,Nt.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof b0||n instanceof Ro&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Ro?n=new b0(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Zn.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},Ro=class Wi extends Zn{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:c}=e.line(r+h);return new yo(a,c,i+l*h,l,Nt.Text)}lineAt(t,e,i,n,r){if(e==lt.ByHeight)return this.blockAt(t,i,n,r);if(e==lt.ByPosNoHeight){let{from:f,to:u}=i.lineAt(t);return new yo(f,u-f,0,0,Nt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:c}=i.lineAt(t);return new yo(h,a,n+l*(c-o),l,Nt.Text)}forEachLine(t,e,i,n,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),c=Math.min(r+this.length,e);a<=c;){let f=i.lineAt(a);a==t&&(n+=h*(f.number-l)),o(new yo(f.from,f.length,n,h,Nt.Text)),n+=h,a=f.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof Wi?i[i.length-1]=new Wi(r.length+n):i.push(null,new Wi(n-1))}if(t>0){let r=i[0];r instanceof Wi?i[0]=new Wi(t+r.length):i.unshift(new Wi(t-1),null)}return Zn.of(i)}decomposeLeft(t,e){e.push(new Wi(t-1),null)}decomposeRight(t,e){e.push(null,new Wi(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new Wi(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let f=t.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];h==-1?h=u:Math.abs(u-h)>=iu&&(h=-2);let d=new Hn(f,u);d.outdated=!1,o.push(d),l+=f+1}l<=r&&o.push(null,new Wi(r-l).updateHeight(t,l));let c=Zn.of(o);return t.heightChanged=a||h<0||Math.abs(c.height-this.height)>=iu||Math.abs(h-this.lines(t.doc,e).lineHeight)>=iu,c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},bH=class extends Zn{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==lt.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==lt.ByPosNoHeight?lt.ByPosNoHeight:lt.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,lt.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&yv(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),yv(r,l)}return Zn.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Zn.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function yv(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof Ro&&(i=s[t+1])instanceof Ro&&s.splice(t-1,3,new Ro(e.length+1+i.length))}const xH=5;let SH=class BT{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Hn?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Hn(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new RT(r,n,i.type)):(r||n>=xH)&&this.addLineDeco(n,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Hn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Ro(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Hn)return t;let e=new Hn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==Nt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Nt.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Hn)&&!this.isCovered?this.nodes.push(new Hn(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof Hn&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new BT(i,t);return Kt.spans(e,i,n,r,0),r.finish(i)}};function vH(s,t,e){let i=new kH;return Kt.compare(s,t,e,i,0),i.changes}let kH=class{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&f0(t,e,this.changes,5)}};function AH(s,t){let e=s.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=s.ownerDocument.body;for(let h=s.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,c=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&c.overflow!="visible"){let f=a.getBoundingClientRect();i=Math.max(i,f.left),n=Math.min(n,f.right),r=Math.max(r,f.top),o=Math.min(o,f.bottom)}h=c.position=="absolute"||c.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}function CH(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}let qg=class{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t){return xt.replace({widget:new MH(this.size,t)}).range(this.from,this.to)}},MH=class extends lc{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}},wv=class{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new yH,this.scaler=Sv,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Me.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(wa).filter(e=>typeof e!="function"),this.heightMap=Zn.empty().applyChanges(this.stateDeco,mt.empty,this.heightOracle.setDoc(t.doc),[new ba(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=xt.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new Nc(r,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?Sv:new TH(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:oh(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(wa).filter(a=>typeof a!="function");let n=t.changedRanges,r=ba.extendWithRanges(n,vH(i,this.stateDeco,t?t.changes:os.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?Me.RTL:Me.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,c=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let u=(this.printing?CH:AH)(e,this.paddingTop),d=u.top-this.pixelViewport.top,g=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let w=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(w)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:x,charWidth:b}=t.docView.measureTextSize();o=n.refresh(r,x,b,p/b,w),o&&(t.docView.minWidth=0,h|=8)}d>0&&g>0?a=Math.max(d,g):d<0&&g<0&&(a=Math.min(d,g)),n.heightChanged=!1;for(let x of this.viewports){let b=x.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(x);this.heightMap=this.heightMap.updateHeight(n,0,o,new wH(x.from,b))}n.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new Nc(n.lineAt(o-i*1e3,lt.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,lt.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,lt.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new Nc(n.lineAt(u-1e3/2,lt.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,lt.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new Nc(this.heightMap.lineAt(i,lt.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,lt.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,lt.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,lt.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new qg(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=Me.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=DH(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=Hc(n,(this.visibleTop-i.top-a)/i.height),o=Hc(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;r=Hc(n,(this.pixelViewport.left-c)/a),o=Hc(n,(this.pixelViewport.right+c)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&xv(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&xv(l,h.to-10,h.to+10);for(let{from:a,to:c}of l)c-a>1e3&&e.push(OH(t,f=>f.from>=i.from&&f.to<=i.to&&Math.abs(f.from-a)<1e3&&Math.abs(f.to-c)<1e3)||new qg(a,c,this.gapSize(i,a,c,n)))}return e}gapSize(t,e,i,n){let r=bv(n,i)-bv(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){qg.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=xt.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Kt.spans(t,this.viewport.from,this.viewport.to,{span(n,r){e.push({from:n,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=e[r].from||n.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||oh(this.heightMap.lineAt(t,lt.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return oh(this.heightMap.lineAt(this.scaler.fromDOM(t),lt.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return oh(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},Nc=class{constructor(t,e){this.from=t,this.to=e}};function DH(s,t,e){let i=[],n=s,r=0;return Kt.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function Hc({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function bv(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function xv(s,t,e){for(let i=0;i<s.length;i++){let n=s[i];if(n.from<e&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>e&&r.push({from:e,to:n.to}),s.splice(i,1,...r),i+=r.length-1}}}function OH(s,t){for(let e of s)if(t(e))return e}const Sv={toDOM(s){return s},fromDOM(s){return s},scale:1};let TH=class{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,lt.ByPos,t,0,0).top,c=e.lineAt(h,lt.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}};function oh(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new yo(s.from,s.length,e,i-e,Array.isArray(s.type)?s.type.map(n=>oh(n,t)):s.type)}const Fc=H.define({combine:s=>s.join(" ")}),x0=H.define({combine:s=>s.indexOf(!0)>-1}),S0=I.newName(),ET=I.newName(),PT=I.newName(),LT={"&light":"."+ET,"&dark":"."+PT};function v0(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const $H=v0("."+S0,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},LT),RH={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Kg=B.ie&&B.ie_version<=11;let BH=class{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new $N,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(B.ie&&B.ie_version<=11||B.ios&&t.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),Kg&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(hc)?e.root.activeElement!=this.dom:!Xm(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((B.ie&&B.ie_version<=11||B.android&&B.chrome)&&!e.state.selection.main.empty&&i.focusNode&&sd(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=nd(t),i=B.safari&&t.nodeType==11&&DN()==this.view.contentDOM&&EH(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,RH),Kg&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Kg&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Ih(this.view.contentDOM,i.key,i.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&Xm(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=vv(e,t.previousSibling||t.target.previousSibling,-1),n=vv(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function vv(s,t,e){for(;t;){let i=_t.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function EH(s){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return sd(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}function PH(s,t,e,i){let n,r,o=s.state.selection.main;if(t>-1){let l=s.docView.domBoundsAround(t,e,0);if(!l||s.state.readOnly)return!1;let{from:h,to:a}=l,c=s.docView.impreciseHead||s.docView.impreciseAnchor?[]:VH(s),f=new bT(c,s.state);f.readRange(l.startDOM,l.endDOM);let u=o.from,d=null;(s.inputState.lastKeyCode===8&&s.inputState.lastKeyTime>Date.now()-100||B.android&&f.text.length<a-h)&&(u=o.to,d="end");let g=LH(s.state.doc.sliceString(h,a,qs),f.text,u-h,d);g&&(B.chrome&&s.inputState.lastKeyCode==13&&g.toB==g.from+2&&f.text.slice(g.from,g.toB)==qs+qs&&g.toB--,n={from:h+g.from,to:h+g.toA,insert:mt.of(f.text.slice(g.from,g.toB).split(qs))}),r=IH(c,h)}else if(s.hasFocus||!s.state.facet(hc)){let l=s.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=s.docView,c=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!nl(s.contentDOM,l.focusNode)?s.state.selection.main.head:s.docView.posFromDOM(l.focusNode,l.focusOffset),f=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!nl(s.contentDOM,l.anchorNode)?s.state.selection.main.anchor:s.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||f!=o.anchor)&&(r=z.single(f,c))}if(!n&&!r)return!1;if(!n&&i&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,n.from).append(n.insert).append(s.state.doc.slice(n.to,o.to))}:(B.mac||B.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:mt.of([" "])}),n){let l=s.state;if(B.ios&&s.inputState.flushIOSKey(s)||B.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&Ih(s.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&Ih(s.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&Ih(s.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(s.state.facet(hT).some(f=>f(s,n.from,n.to,h)))return!0;s.inputState.composing>=0&&s.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&s.inputState.composing<0){let f=o.from<n.from?l.sliceDoc(o.from,n.from):"",u=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(s.state.toText(f+n.insert.sliceString(0,void 0,s.state.lineBreak)+u))}else{let f=l.changes(n),u=r&&!l.selection.main.eq(r.main)&&r.main.to<=f.newLength?r.main:void 0;if(l.selection.ranges.length>1&&s.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=s.state.sliceDoc(n.from,n.to),g=xT(s)||s.state.doc.lineAt(o.head),m=o.to-n.to,p=o.to-o.from;a=l.changeByRange(y=>{if(y.from==o.from&&y.to==o.to)return{changes:f,range:u||y.map(f)};let w=y.to-m,x=w-d.length;if(y.to-y.from!=p||s.state.sliceDoc(x,w)!=d||g&&y.to>=g.from&&y.from<=g.to)return{range:y};let b=l.changes({from:x,to:w,insert:n.insert}),S=y.to-o.to;return{changes:b,range:u?z.range(Math.max(0,u.anchor+S),Math.max(0,u.head+S)):y.map(b)}})}else a={changes:f,selection:u&&l.selection.replaceRange(u)}}let c="input.type";return s.composing&&(c+=".compose",s.inputState.compositionFirstChange&&(c+=".start",s.inputState.compositionFirstChange=!1)),s.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(o)){let l=!1,h="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(l=!0),h=s.inputState.lastSelectionOrigin),s.dispatch({selection:r,scrollIntoView:l,userEvent:h}),!0}else return!1}function LH(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function VH(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new tv(e,i)),(n!=e||r!=i)&&t.push(new tv(n,r))),t}function IH(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?z.single(e+t,i+t):null}let st=class VT{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||RN(t.parent)||document,this.viewState=new wv(t.state||Qt.create()),this.plugins=this.state.facet(sh).map(e=>new Fg(e));for(let e of this.plugins)e.update(this);this.observer=new BH(this,(e,i,n)=>PH(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new rH(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new ev(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof un?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let l of t){if(l.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=l.state}if(this.destroyed){this.viewState.state=r;return}if(this.observer.clear(),r.facet(Qt.phrases)!=this.state.facet(Qt.phrases))return this.setState(r);n=QS.create(this,r,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new XS(h.empty?h:z.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(ZS)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=Av.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(rh)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Fc)!=n.state.facet(Fc)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(d0))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new wv(t),this.plugins=t.facet(sh).map(i=>new Fg(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new ev(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(sh),i=t.state.facet(sh);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new Fg(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let n=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(f=>{try{return f.read(this)}catch(u){return _s(this.state,u),kv}}),h=QS.create(this,this.state,[]),a=!1,c=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let f=0;f<o.length;f++)if(l[f]!=kv)try{let u=o[f];u.write&&u.write(l[f],this)}catch(u){_s(this.state,u)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),a&&this.docView.updateSelection(!0),this.viewport.from==n.from&&this.viewport.to==n.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(d0))i(e)}get themeClasses(){return S0+" "+(this.state.facet(x0)?PT:ET)+" "+this.state.facet(Fc)}updateAttrs(){let t=Cv(this,fT,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(hc)?"true":"false",class:"cm-content",style:`${B.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Cv(this,uT,e);let i=this.observer.ignore(()=>{let n=c0(this.contentDOM,this.contentAttrs,e),r=c0(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(VT.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(rh),I.mount(this.root,this.styleModules.concat($H).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return zg(this,t,lv(this,t,e,i))}moveByGroup(t,e){return zg(this,t,lv(this,t,e,i=>nH(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return iH(this,t,e,i)}moveVertically(t,e,i){return zg(this,t,sH(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),vT(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[$o.find(r,t-n.from,-1,e)];return Jd(i,o.dir==Me.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(aT)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>NH)return yT(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=qN(t.text,e);return this.bidiCache.push(new Av(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||B.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{FO(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return ZS.of(new XS(typeof t=="number"?z.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return ac.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=I.newName(),n=[Fc.of(i),rh.of(v0(`.${i}`,t))];return e&&e.dark&&n.push(x0.of(!0)),n}static baseTheme(t){return wO.lowest(rh.of(v0("."+S0,t,LT)))}};st.styleModule=rh;st.inputHandler=hT;st.perLineTextDirection=aT;st.exceptionSink=lT;st.updateListener=d0;st.editable=hc;st.mouseSelectionStyle=oT;st.dragMovesSelection=rT;st.clickAddsSelectionRange=sT;st.decorations=wa;st.atomicRanges=dT;st.scrollMargins=gT;st.darkTheme=x0;st.contentAttributes=uT;st.editorAttributes=fT;st.lineWrapping=st.contentAttributes.of({class:"cm-lineWrapping"});st.announce=jt.define();const NH=4096,kv={};let Av=class IT{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:Me.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new IT(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}};function Cv(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&a0(o,e)}return e}const HH=!B.ios,FH={".cm-line":{}};HH&&(FH[".cm-line"].caretColor="transparent !important");let Mr=class extends il{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}};Mr.prototype.elementClass="";Mr.prototype.toDOM=void 0;Mr.prototype.mapMode=wi.TrackBefore;Mr.prototype.startSide=Mr.prototype.endSide=-1;Mr.prototype.point=!0;const Gg=H.define(),WH={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Kt.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},su=H.define();function zH(s){return[qH(),su.of(Object.assign(Object.assign({},WH),s))]}const Mv=H.define({combine:s=>s.some(t=>t)});function qH(s){return[KH]}const KH=ac.fromClass(class{constructor(s){this.view=s,this.prevViewport=s.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=s.state.facet(su).map(t=>new Ov(s,t));for(let t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!s.state.facet(Mv),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),s.scrollDOM.insertBefore(this.dom,s.contentDOM)}update(s){if(this.updateGutters(s)){let t=this.prevViewport,e=s.view.viewport,i=Math.min(t.to,e.to)-Math.max(t.from,e.from);this.syncGutters(i<(e.to-e.from)*.8)}s.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Mv)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=s.view.viewport}syncGutters(s){let t=this.dom.nextSibling;s&&this.dom.remove();let e=Kt.iter(this.view.state.facet(Gg),this.view.viewport.from),i=[],n=this.gutters.map(r=>new GH(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks){let o;if(Array.isArray(r.type)){for(let l of r.type)if(l.type==Nt.Text){o=l;break}}else o=r.type==Nt.Text?r:void 0;if(o){i.length&&(i=[]),NT(e,i,r.from);for(let l of n)l.line(this.view,o,i)}}for(let r of n)r.finish();s&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(s){let t=s.startState.facet(su),e=s.state.facet(su),i=s.docChanged||s.heightChanged||s.viewportChanged||!Kt.eq(s.startState.facet(Gg),s.state.facet(Gg),s.view.viewport.from,s.view.viewport.to);if(t==e)for(let n of this.gutters)n.update(s)&&(i=!0);else{i=!0;let n=[];for(let r of e){let o=t.indexOf(r);o<0?n.push(new Ov(this.view,r)):(this.gutters[o].update(s),n.push(this.gutters[o]))}for(let r of this.gutters)r.dom.remove(),n.indexOf(r)<0&&r.destroy();for(let r of n)this.dom.appendChild(r.dom);this.gutters=n}return i}destroy(){for(let s of this.gutters)s.destroy();this.dom.remove()}},{provide:s=>st.scrollMargins.of(t=>{let e=t.plugin(s);return!e||e.gutters.length==0||!e.fixed?null:t.textDirection==Me.LTR?{left:e.dom.offsetWidth}:{right:e.dom.offsetWidth}})});function Dv(s){return Array.isArray(s)?s:[s]}function NT(s,t,e){for(;s.value&&s.from<=e;)s.from==e&&t.push(s.value),s.next()}class GH{constructor(t,e,i){this.gutter=t,this.height=i,this.localMarkers=[],this.i=0,this.cursor=Kt.iter(t.markers,e.from)}line(t,e,i){this.localMarkers.length&&(this.localMarkers=[]),NT(this.cursor,this.localMarkers,e.from);let n=i.length?this.localMarkers.concat(i):this.localMarkers,r=this.gutter.config.lineMarker(t,e,n);r&&n.unshift(r);let o=this.gutter;if(n.length==0&&!o.config.renderEmptyElements)return;let l=e.top-this.height;if(this.i==o.elements.length){let h=new HT(t,e.height,l,n);o.elements.push(h),o.dom.appendChild(h.dom)}else o.elements[this.i].update(t,e.height,l,n);this.height=e.bottom,this.i++}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class Ov{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,n=>{let r=t.lineBlockAtHeight(n.clientY-t.documentTop);e.domEventHandlers[i](t,r,n)&&n.preventDefault()});this.markers=Dv(e.markers(t)),e.initialSpacer&&(this.spacer=new HT(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=Dv(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],t);n!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[n])}let i=t.view.viewport;return!Kt.eq(this.markers,e,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class HT{constructor(t,e,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,i,n)}update(t,e,i,n){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),jH(this.markers,n)||this.setMarkers(t,n)}setMarkers(t,e){let i="cm-gutterElement",n=this.dom.firstChild;for(let r=0,o=0;;){let l=o,h=r<e.length?e[r++]:null,a=!1;if(h){let c=h.elementClass;c&&(i+=" "+c);for(let f=o;f<this.markers.length;f++)if(this.markers[f].compare(h)){l=f,a=!0;break}}else l=this.markers.length;for(;o<l;){let c=this.markers[o++];if(c.toDOM){c.destroy(n);let f=n.nextSibling;n.remove(),n=f}}if(!h)break;h.toDOM&&(a?n=n.nextSibling:this.dom.insertBefore(h.toDOM(t),n)),a&&o++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}function jH(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(!s[e].compare(t[e]))return!1;return!0}let UH=0;class Kn{constructor(t,e,i){this.set=t,this.base=e,this.modified=i,this.id=UH++}static define(t){if(t?.base)throw new Error("Can not derive from a modified tag");let e=new Kn([],null,[]);if(e.set.push(e),t)for(let i of t.set)e.set.push(i);return e}static defineModifier(){let t=new od;return e=>e.modified.indexOf(t)>-1?e:od.get(e.base||e,e.modified.concat(t).sort((i,n)=>i.id-n.id))}}let JH=0;class od{constructor(){this.instances=[],this.id=JH++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find(l=>l.base==t&&YH(e,l.modified));if(i)return i;let n=[],r=new Kn(n,t,e);for(let l of e)l.instances.push(r);let o=FT(e);for(let l of t.set)for(let h of o)n.push(od.get(l,h));return r}}function YH(s,t){return s.length==t.length&&s.every((e,i)=>e==t[i])}function FT(s){let t=[s];for(let e=0;e<s.length;e++)for(let i of FT(s.slice(0,e).concat(s.slice(e+1))))t.push(i);return t}function XH(s){let t=Object.create(null);for(let e in s){let i=s[e];Array.isArray(i)||(i=[i]);for(let n of e.split(" "))if(n){let r=[],o=2,l=n;for(let f=0;;){if(l=="..."&&f>0&&f+3==n.length){o=1;break}let u=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!u)throw new RangeError("Invalid path: "+n);if(r.push(u[0]=="*"?"":u[0][0]=='"'?JSON.parse(u[0]):u[0]),f+=u[0].length,f==n.length)break;let d=n[f++];if(f==n.length&&d=="!"){o=0;break}if(d!="/")throw new RangeError("Invalid path: "+n);l=n.slice(f)}let h=r.length-1,a=r[h];if(!a)throw new RangeError("Invalid path: "+n);let c=new ZH(i,o,h>0?r.slice(0,h):null);t[a]=c.sort(t[a])}}return WT.add(t)}const WT=new j;class ZH{constructor(t,e,i,n){this.tags=t,this.mode=e,this.context=i,this.next=n}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function zT(s,t){let e=Object.create(null);for(let r of s)if(!Array.isArray(r.tag))e[r.tag.id]=r.class;else for(let o of r.tag)e[o.id]=r.class;let{scope:i,all:n=null}=t||{};return{style:r=>{let o=n;for(let l of r)for(let h of l.set){let a=e[h.id];if(a){o=o?o+" "+a:a;break}}return o},scope:i}}function QH(s,t){let e=null;for(let i of s){let n=i.style(t);n&&(e=e?e+" "+n:n)}return e}function _H(s,t,e,i=0,n=s.length){let r=new tF(i,Array.isArray(t)?t:[t],e);r.highlightRange(s.cursor(),i,n,"",r.highlighters),r.flush(n)}class tF{constructor(t,e,i){this.at=t,this.highlighters=e,this.span=i,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,i,n,r){let{type:o,from:l,to:h}=t;if(l>=i||h<=e)return;o.isTop&&(r=this.highlighters.filter(d=>!d.scope||d.scope(o)));let a=n,c=o.prop(WT),f=!1;for(;c;){if(!c.context||t.matchContext(c.context)){let d=QH(r,c.tags);d&&(a&&(a+=" "),a+=d,c.mode==1?n+=(n?" ":"")+d:c.mode==0&&(f=!0));break}c=c.next}if(this.startSpan(t.from,a),f)return;let u=t.tree&&t.tree.prop(j.mounted);if(u&&u.overlay){let d=t.node.enter(u.overlay[0].from+l,1),g=this.highlighters.filter(p=>!p.scope||p.scope(u.tree.type)),m=t.firstChild();for(let p=0,y=l;;p++){let w=p<u.overlay.length?u.overlay[p]:null,x=w?w.from+l:h,b=Math.max(e,y),S=Math.min(i,x);if(b<S&&m)for(;t.from<S&&(this.highlightRange(t,b,S,n,r),this.startSpan(Math.min(i,t.to),a),!(t.to>=x||!t.nextSibling())););if(!w||x>i)break;y=w.to+l,y>e&&(this.highlightRange(d.cursor(),Math.max(e,w.from+l),Math.min(i,y),n,g),this.startSpan(y,a))}m&&t.parent()}else if(t.firstChild()){do if(!(t.to<=e)){if(t.from>=i)break;this.highlightRange(t,e,i,n,r),this.startSpan(Math.min(i,t.to),a)}while(t.nextSibling());t.parent()}}}const k=Kn.define,Wc=k(),Vs=k(),Tv=k(Vs),$v=k(Vs),Is=k(),zc=k(Is),jg=k(Is),En=k(),lr=k(En),An=k(),Cn=k(),k0=k(),Ll=k(k0),qc=k(),A={comment:Wc,lineComment:k(Wc),blockComment:k(Wc),docComment:k(Wc),name:Vs,variableName:k(Vs),typeName:Tv,tagName:k(Tv),propertyName:$v,attributeName:k($v),className:k(Vs),labelName:k(Vs),namespace:k(Vs),macroName:k(Vs),literal:Is,string:zc,docString:k(zc),character:k(zc),attributeValue:k(zc),number:jg,integer:k(jg),float:k(jg),bool:k(Is),regexp:k(Is),escape:k(Is),color:k(Is),url:k(Is),keyword:An,self:k(An),null:k(An),atom:k(An),unit:k(An),modifier:k(An),operatorKeyword:k(An),controlKeyword:k(An),definitionKeyword:k(An),moduleKeyword:k(An),operator:Cn,derefOperator:k(Cn),arithmeticOperator:k(Cn),logicOperator:k(Cn),bitwiseOperator:k(Cn),compareOperator:k(Cn),updateOperator:k(Cn),definitionOperator:k(Cn),typeOperator:k(Cn),controlOperator:k(Cn),punctuation:k0,separator:k(k0),bracket:Ll,angleBracket:k(Ll),squareBracket:k(Ll),paren:k(Ll),brace:k(Ll),content:En,heading:lr,heading1:k(lr),heading2:k(lr),heading3:k(lr),heading4:k(lr),heading5:k(lr),heading6:k(lr),contentSeparator:k(En),list:k(En),quote:k(En),emphasis:k(En),strong:k(En),link:k(En),monospace:k(En),strikethrough:k(En),inserted:k(),deleted:k(),changed:k(),invalid:k(),meta:qc,documentMeta:k(qc),annotation:k(qc),processingInstruction:k(qc),definition:Kn.defineModifier(),constant:Kn.defineModifier(),function:Kn.defineModifier(),standard:Kn.defineModifier(),local:Kn.defineModifier(),special:Kn.defineModifier()};zT([{tag:A.link,class:"tok-link"},{tag:A.heading,class:"tok-heading"},{tag:A.emphasis,class:"tok-emphasis"},{tag:A.strong,class:"tok-strong"},{tag:A.keyword,class:"tok-keyword"},{tag:A.atom,class:"tok-atom"},{tag:A.bool,class:"tok-bool"},{tag:A.url,class:"tok-url"},{tag:A.labelName,class:"tok-labelName"},{tag:A.inserted,class:"tok-inserted"},{tag:A.deleted,class:"tok-deleted"},{tag:A.literal,class:"tok-literal"},{tag:A.string,class:"tok-string"},{tag:A.number,class:"tok-number"},{tag:[A.regexp,A.escape,A.special(A.string)],class:"tok-string2"},{tag:A.variableName,class:"tok-variableName"},{tag:A.local(A.variableName),class:"tok-variableName tok-local"},{tag:A.definition(A.variableName),class:"tok-variableName tok-definition"},{tag:A.special(A.variableName),class:"tok-variableName2"},{tag:A.definition(A.propertyName),class:"tok-propertyName tok-definition"},{tag:A.typeName,class:"tok-typeName"},{tag:A.namespace,class:"tok-namespace"},{tag:A.className,class:"tok-className"},{tag:A.macroName,class:"tok-macroName"},{tag:A.propertyName,class:"tok-propertyName"},{tag:A.operator,class:"tok-operator"},{tag:A.comment,class:"tok-comment"},{tag:A.meta,class:"tok-meta"},{tag:A.invalid,class:"tok-invalid"},{tag:A.punctuation,class:"tok-punctuation"}]);var Ug;const ld=new j;class Un{constructor(t,e,i=[]){this.data=t,Qt.prototype.hasOwnProperty("tree")||Object.defineProperty(Qt.prototype,"tree",{get(){return $e(this)}}),this.parser=e,this.extension=[nr.of(this),Qt.languageData.of((n,r,o)=>n.facet(Rv(n,r,o)))].concat(i)}isActiveAt(t,e,i=-1){return Rv(t,e,i)==this.data}findRegions(t){let e=t.facet(nr);if(e?.data==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],n=(r,o)=>{if(r.prop(ld)==this.data){i.push({from:o,to:o+r.length});return}let l=r.prop(j.mounted);if(l){if(l.tree.prop(ld)==this.data){if(l.overlay)for(let h of l.overlay)i.push({from:h.from+o,to:h.to+o});else i.push({from:o,to:o+r.length});return}else if(l.overlay){let h=i.length;if(n(l.tree,l.overlay[0].from+o),i.length>h)return}}for(let h=0;h<r.children.length;h++){let a=r.children[h];a instanceof Ce&&n(a,r.positions[h]+o)}};return n($e(t),0),i}get allowsNesting(){return!0}}Un.setState=jt.define();function Rv(s,t,e){let i=s.facet(nr);if(!i)return null;let n=i.data;if(i.allowsNesting)for(let r=$e(s).topNode;r;r=r.enter(t,e,ve.ExcludeBuffers))n=r.type.prop(ld)||n;return n}function $e(s){let t=s.field(Un.state,!1);return t?t.tree:Ce.empty}class eF{constructor(t,e=t.length){this.doc=t,this.length=e,this.cursorPos=0,this.string="",this.cursor=t.iter()}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let Vl=null;class hd{constructor(t,e,i=[],n,r,o,l,h){this.parser=t,this.state=e,this.fragments=i,this.tree=n,this.treeLen=r,this.viewport=o,this.skipped=l,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}static create(t,e,i){return new hd(t,e,[],Ce.empty,0,i,[],null)}startParse(){return this.parser.startParse(new eF(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=Ce.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof t=="number"){let n=Date.now()+t;t=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(Sr.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Sr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Vl;Vl=this;try{return t()}finally{Vl=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=Bv(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:n,treeLen:r,viewport:o,skipped:l}=this;if(this.takeTree(),!t.empty){let h=[];if(t.iterChangedRanges((a,c,f,u)=>h.push({fromA:a,toA:c,fromB:f,toB:u})),i=Sr.applyChanges(i,h),n=Ce.empty,r=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){l=[];for(let a of this.skipped){let c=t.mapPos(a.from,1),f=t.mapPos(a.to,-1);c<f&&l.push({from:c,to:f})}}}return new hd(this.parser,e,i,n,r,o,l,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:n,to:r}=this.skipped[i];n<t.to&&r>t.from&&(this.fragments=Bv(this.fragments,n,r),this.skipped.splice(i--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends oN{createParse(e,i,n){let r=n[0].from,o=n[n.length-1].to;return{parsedPos:r,advance(){let h=Vl;if(h){for(let a of n)h.tempSkipped.push(a);t&&(h.scheduleOn=h.scheduleOn?Promise.all([h.scheduleOn,t]):t)}return this.parsedPos=o,new Ce(Ei.none,[],[],o-r)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return Vl}}function Bv(s,t,e){return Sr.applyChanges(s,[{fromA:t,toA:e,fromB:t,toB:e}])}class sl{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new sl(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=hd.create(t.facet(nr).parser,t,{from:0,to:e});return i.work(20,e)||i.takeTree(),new sl(i)}}Un.state=Nr.define({create:sl.init,update(s,t){for(let e of t.effects)if(e.is(Un.setState))return e.value;return t.startState.facet(nr)!=t.state.facet(nr)?sl.init(t.state):s.apply(t)}});let qT=s=>{let t=setTimeout(()=>s(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(qT=s=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(s,{timeout:400})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const Jg=typeof navigator<"u"&&(!((Ug=navigator.scheduling)===null||Ug===void 0)&&Ug.isInputPending)?()=>navigator.scheduling.isInputPending():null,iF=ac.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(Un.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(Un.state);(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))&&(this.working=qT(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,r=i.field(Un.state);if(r.tree==r.context.tree&&r.context.isDone(n+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!Jg?Math.max(25,t.timeRemaining()-5):1e9),l=r.context.treeLen<n&&i.doc.length>n+1e3,h=r.context.work(()=>Jg&&Jg()||Date.now()>o,n+(l?0:1e5));this.chunkBudget-=Date.now()-e,(h||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:Un.setState.of(new sl(r.context))})),this.chunkBudget>0&&!(h&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(e=>_s(this.view.state,e)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),nr=H.define({combine(s){return s.length?s[0]:null},enables:[Un.state,iF]}),nF=H.define(),vb=H.define({combine:s=>{if(!s.length)return"  ";if(!/^(?: +|\t+)$/.test(s[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return s[0]}});function ad(s){let t=s.facet(vb);return t.charCodeAt(0)==9?s.tabSize*t.length:t.length}function xa(s,t){let e="",i=s.tabSize;if(s.facet(vb).charCodeAt(0)==9)for(;t>=i;)e+="	",t-=i;for(let n=0;n<t;n++)e+=" ";return e}function kb(s,t){s instanceof Qt&&(s=new Xd(s));for(let i of s.state.facet(nF)){let n=i(s,t);if(n!=null)return n}let e=$e(s.state);return e?rF(s,e,t):null}class Xd{constructor(t,e={}){this.state=t,this.options=e,this.unit=ad(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:n,simulateDoubleBreak:r}=this.options;return n!=null&&n>=i.from&&n<=i.to?r&&n==t?{text:"",from:t}:(e<0?n<t:n<=t)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(t,e);return i.slice(t-n,Math.min(i.length,t+100-n))}column(t,e=1){let{text:i,from:n}=this.lineAt(t,e),r=this.countColumn(i,t-n),o=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return o>-1&&(r+=o-this.countColumn(i,i.search(/\S|$/))),r}countColumn(t,e=t.length){return CN(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:n}=this.lineAt(t,e),r=this.options.overrideIndentation;if(r){let o=r(n);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const sF=new j;function rF(s,t,e){return KT(t.resolveInner(e).enterUnfinishedNodesBefore(e),e,s)}function oF(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function lF(s){let t=s.type.prop(sF);if(t)return t;let e=s.firstChild,i;if(e&&(i=e.type.prop(j.closedBy))){let n=s.lastChild,r=n&&i.indexOf(n.name)>-1;return o=>fF(o,!0,1,void 0,r&&!oF(o)?n.from:void 0)}return s.parent==null?hF:null}function KT(s,t,e){for(;s;s=s.parent){let i=lF(s);if(i)return i(Ab.create(e,t,s))}return null}function hF(){return 0}class Ab extends Xd{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.node=i}static create(t,e,i){return new Ab(t,e,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let t=this.state.doc.lineAt(this.node.from);for(;;){let e=this.node.resolve(t.from);for(;e.parent&&e.parent.from==e.from;)e=e.parent;if(aF(e,this.node))break;t=this.state.doc.lineAt(e.from)}return this.lineIndent(t.from)}continue(){let t=this.node.parent;return t?KT(t,this.pos,this.base):0}}function aF(s,t){for(let e=t;e;e=e.parent)if(s==e)return!0;return!1}function cF(s){let t=s.node,e=t.childAfter(t.from),i=t.lastChild;if(!e)return null;let n=s.options.simulateBreak,r=s.state.doc.lineAt(e.from),o=n==null||n<=r.from?r.to:Math.min(r.to,n);for(let l=e.to;;){let h=t.childAfter(l);if(!h||h==i)return null;if(!h.type.isSkipped)return h.from<o?e:null;l=h.to}}function fF(s,t,e,i,n){let r=s.textAfter,o=r.match(/^\s*/)[0].length,l=i&&r.slice(o,o+i.length)==i||n==s.pos+o,h=cF(s);return h?l?s.column(h.from):s.column(h.to):s.baseIndent+(l?0:s.unit*e)}const uF=200;function dF(){return Qt.transactionFilter.of(s=>{if(!s.docChanged||!s.isUserEvent("input.type")&&!s.isUserEvent("input.complete"))return s;let t=s.startState.languageDataAt("indentOnInput",s.startState.selection.main.head);if(!t.length)return s;let e=s.newDoc,{head:i}=s.newSelection.main,n=e.lineAt(i);if(i>n.from+uF)return s;let r=e.sliceString(n.from,i);if(!t.some(a=>a.test(r)))return s;let{state:o}=s,l=-1,h=[];for(let{head:a}of o.selection.ranges){let c=o.doc.lineAt(a);if(c.from==l)continue;l=c.from;let f=kb(o,c.from);if(f==null)continue;let u=/^\s*/.exec(c.text)[0],d=xa(o,f);u!=d&&h.push({from:c.from,to:c.from+u.length,insert:d})}return h.length?[s,{changes:h,sequential:!0}]:s})}const gF=H.define(),pF=new j;function mF(s,t,e){let i=$e(s);if(i.length<e)return null;let n=i.resolveInner(e),r=null;for(let o=n;o;o=o.parent){if(o.to<=e||o.from>e)continue;if(r&&o.from<t)break;let l=o.type.prop(pF);if(l&&(o.to<i.length-50||i.length==s.doc.length||!yF(o))){let h=l(o,s);h&&h.from<=e&&h.from>=t&&h.to>e&&(r=h)}}return r}function yF(s){let t=s.lastChild;return t&&t.to==s.to&&t.type.isError}function cd(s,t,e){for(let i of s.facet(gF)){let n=i(s,t,e);if(n)return n}return mF(s,t,e)}function GT(s,t){let e=t.mapPos(s.from,1),i=t.mapPos(s.to,-1);return e>=i?void 0:{from:e,to:i}}const Zd=jt.define({map:GT}),cc=jt.define({map:GT});function jT(s){let t=[];for(let{head:e}of s.state.selection.ranges)t.some(i=>i.from<=e&&i.to>=e)||t.push(s.lineBlockAt(e));return t}const Dr=Nr.define({create(){return xt.none},update(s,t){s=s.map(t.changes);for(let e of t.effects)e.is(Zd)&&!wF(s,e.value.from,e.value.to)?s=s.update({add:[MF.range(e.value.from,e.value.to)]}):e.is(cc)&&(s=s.update({filter:(i,n)=>e.value.from!=i||e.value.to!=n,filterFrom:e.value.from,filterTo:e.value.to}));if(t.selection){let e=!1,{head:i}=t.selection.main;s.between(i,i,(n,r)=>{n<i&&r>i&&(e=!0)}),e&&(s=s.update({filterFrom:i,filterTo:i,filter:(n,r)=>r<=i||n>=i}))}return s},provide:s=>st.decorations.from(s)});function fd(s,t,e){var i;let n=null;return(i=s.field(Dr,!1))===null||i===void 0||i.between(t,e,(r,o)=>{(!n||n.from>r)&&(n={from:r,to:o})}),n}function wF(s,t,e){let i=!1;return s.between(t,t,(n,r)=>{n==t&&r==e&&(i=!0)}),i}function UT(s,t){return s.field(Dr,!1)?t:t.concat(jt.appendConfig.of(YT()))}const bF=s=>{for(let t of jT(s)){let e=cd(s.state,t.from,t.to);if(e)return s.dispatch({effects:UT(s.state,[Zd.of(e),JT(s,e)])}),!0}return!1},xF=s=>{if(!s.state.field(Dr,!1))return!1;let t=[];for(let e of jT(s)){let i=fd(s.state,e.from,e.to);i&&t.push(cc.of(i),JT(s,i,!1))}return t.length&&s.dispatch({effects:t}),t.length>0};function JT(s,t,e=!0){let i=s.state.doc.lineAt(t.from).number,n=s.state.doc.lineAt(t.to).number;return st.announce.of(`${s.state.phrase(e?"Folded lines":"Unfolded lines")} ${i} ${s.state.phrase("to")} ${n}.`)}const SF=s=>{let{state:t}=s,e=[];for(let i=0;i<t.doc.length;){let n=s.lineBlockAt(i),r=cd(t,n.from,n.to);r&&e.push(Zd.of(r)),i=(r?s.lineBlockAt(r.to):n).to+1}return e.length&&s.dispatch({effects:UT(s.state,e)}),!!e.length},vF=s=>{let t=s.state.field(Dr,!1);if(!t||!t.size)return!1;let e=[];return t.between(0,s.state.doc.length,(i,n)=>{e.push(cc.of({from:i,to:n}))}),s.dispatch({effects:e}),!0},kF=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:bF},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:xF},{key:"Ctrl-Alt-[",run:SF},{key:"Ctrl-Alt-]",run:vF}],AF={placeholderDOM:null,placeholderText:"…"},CF=H.define({combine(s){return EO(s,AF)}});function YT(s){return[Dr,TF]}const MF=xt.replace({widget:new class extends lc{toDOM(s){let{state:t}=s,e=t.facet(CF),i=r=>{let o=s.lineBlockAt(s.posAtDOM(r.target)),l=fd(s.state,o.from,o.to);l&&s.dispatch({effects:cc.of(l)}),r.preventDefault()};if(e.placeholderDOM)return e.placeholderDOM(s,i);let n=document.createElement("span");return n.textContent=e.placeholderText,n.setAttribute("aria-label",t.phrase("folded code")),n.title=t.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=i,n}}}),DF={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{}};class Yg extends Mr{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}function OF(s={}){let t=Object.assign(Object.assign({},DF),s),e=new Yg(t,!0),i=new Yg(t,!1),n=ac.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(nr)!=o.state.facet(nr)||o.startState.field(Dr,!1)!=o.state.field(Dr,!1)||$e(o.startState)!=$e(o.state))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new id;for(let h of o.viewportLineBlocks){let a=fd(o.state,h.from,h.to)?i:cd(o.state,h.from,h.to)?e:null;a&&l.add(h.from,h.from,a)}return l.finish()}}),{domEventHandlers:r}=t;return[n,zH({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(n))===null||l===void 0?void 0:l.markers)||Kt.empty},initialSpacer(){return new Yg(t,!1)},domEventHandlers:Object.assign(Object.assign({},r),{click:(o,l,h)=>{if(r.click&&r.click(o,l,h))return!0;let a=fd(o.state,l.from,l.to);if(a)return o.dispatch({effects:cc.of(a)}),!0;let c=cd(o.state,l.from,l.to);return c?(o.dispatch({effects:Zd.of(c)}),!0):!1}})}),YT()]}const TF=st.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Qd{constructor(t,e){let i;function n(l){let h=I.newName();return(i||(i=Object.create(null)))["."+h]=l,h}const r=typeof e.all=="string"?e.all:e.all?n(e.all):void 0,o=e.scope;this.scope=o instanceof Un?l=>l.prop(ld)==o.data:o?l=>l==o:void 0,this.style=zT(t.map(l=>({tag:l.tag,class:l.class||n(Object.assign({},l,{tag:null}))})),{all:r}).style,this.module=i?new I(i):null,this.themeType=e.themeType}static define(t,e){return new Qd(t,e||{})}}const A0=H.define(),XT=H.define({combine(s){return s.length?[s[0]]:null}});function Xg(s){let t=s.facet(A0);return t.length?t:s.facet(XT)}function $F(s,t){let e=[BF],i;return s instanceof Qd&&(s.module&&e.push(st.styleModule.of(s.module)),i=s.themeType),t?.fallback?e.push(XT.of(s)):i?e.push(A0.computeN([st.darkTheme],n=>n.facet(st.darkTheme)==(i=="dark")?[s]:[])):e.push(A0.of(s)),e}class RF{constructor(t){this.markCache=Object.create(null),this.tree=$e(t.state),this.decorations=this.buildDeco(t,Xg(t.state))}update(t){let e=$e(t.state),i=Xg(t.state),n=i!=Xg(t.startState);e.length<t.view.viewport.to&&!n&&e.type==this.tree.type?this.decorations=this.decorations.map(t.changes):(e!=this.tree||t.viewportChanged||n)&&(this.tree=e,this.decorations=this.buildDeco(t.view,i))}buildDeco(t,e){if(!e||!this.tree.length)return xt.none;let i=new id;for(let{from:n,to:r}of t.visibleRanges)_H(this.tree,e,(o,l,h)=>{i.add(o,l,this.markCache[h]||(this.markCache[h]=xt.mark({class:h})))},n,r);return i.finish()}}const BF=wO.high(ac.fromClass(RF,{decorations:s=>s.decorations})),EF=Qd.define([{tag:A.meta,color:"#7a757a"},{tag:A.link,textDecoration:"underline"},{tag:A.heading,textDecoration:"underline",fontWeight:"bold"},{tag:A.emphasis,fontStyle:"italic"},{tag:A.strong,fontWeight:"bold"},{tag:A.strikethrough,textDecoration:"line-through"},{tag:A.keyword,color:"#708"},{tag:[A.atom,A.bool,A.url,A.contentSeparator,A.labelName],color:"#219"},{tag:[A.literal,A.inserted],color:"#164"},{tag:[A.string,A.deleted],color:"#a11"},{tag:[A.regexp,A.escape,A.special(A.string)],color:"#e40"},{tag:A.definition(A.variableName),color:"#00f"},{tag:A.local(A.variableName),color:"#30a"},{tag:[A.typeName,A.namespace],color:"#085"},{tag:A.className,color:"#167"},{tag:[A.special(A.variableName),A.macroName],color:"#256"},{tag:A.definition(A.propertyName),color:"#00c"},{tag:A.comment,color:"#940"},{tag:A.invalid,color:"#f00"}]),PF=st.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),ZT=1e4,QT="()[]{}",_T=H.define({combine(s){return EO(s,{afterCursor:!0,brackets:QT,maxScanDistance:ZT,renderMatch:IF})}}),LF=xt.mark({class:"cm-matchingBracket"}),VF=xt.mark({class:"cm-nonmatchingBracket"});function IF(s){let t=[],e=s.matched?LF:VF;return t.push(e.range(s.start.from,s.start.to)),s.end&&t.push(e.range(s.end.from,s.end.to)),t}const NF=Nr.define({create(){return xt.none},update(s,t){if(!t.docChanged&&!t.selection)return s;let e=[],i=t.state.facet(_T);for(let n of t.state.selection.ranges){if(!n.empty)continue;let r=Jn(t.state,n.head,-1,i)||n.head>0&&Jn(t.state,n.head-1,1,i)||i.afterCursor&&(Jn(t.state,n.head,1,i)||n.head<t.state.doc.length&&Jn(t.state,n.head+1,-1,i));r&&(e=e.concat(i.renderMatch(r,t.state)))}return xt.set(e,!0)},provide:s=>st.decorations.from(s)}),HF=[NF,PF];function FF(s={}){return[_T.of(s),HF]}function C0(s,t,e){let i=s.prop(t<0?j.openedBy:j.closedBy);if(i)return i;if(s.name.length==1){let n=e.indexOf(s.name);if(n>-1&&n%2==(t<0?1:0))return[e[n+t]]}return null}function Jn(s,t,e,i={}){let n=i.maxScanDistance||ZT,r=i.brackets||QT,o=$e(s),l=o.resolveInner(t,e);for(let h=l;h;h=h.parent){let a=C0(h.type,e,r);if(a&&h.from<h.to)return WF(s,t,e,h,a,r)}return zF(s,t,e,o,l.type,n,r)}function WF(s,t,e,i,n,r){let o=i.parent,l={from:i.from,to:i.to},h=0,a=o?.cursor();if(a&&(e<0?a.childBefore(i.from):a.childAfter(i.to)))do if(e<0?a.to<=i.from:a.from>=i.to){if(h==0&&n.indexOf(a.type.name)>-1&&a.from<a.to)return{start:l,end:{from:a.from,to:a.to},matched:!0};if(C0(a.type,e,r))h++;else if(C0(a.type,-e,r)&&(h--,h==0))return{start:l,end:a.from==a.to?void 0:{from:a.from,to:a.to},matched:!1}}while(e<0?a.prevSibling():a.nextSibling());return{start:l,matched:!1}}function zF(s,t,e,i,n,r,o){let l=e<0?s.sliceDoc(t-1,t):s.sliceDoc(t,t+1),h=o.indexOf(l);if(h<0||h%2==0!=e>0)return null;let a={from:e<0?t-1:t,to:e>0?t+1:t},c=s.doc.iterRange(t,e>0?s.doc.length:0),f=0;for(let u=0;!c.next().done&&u<=r;){let d=c.value;e<0&&(u+=d.length);let g=t+u*e;for(let m=e>0?0:d.length-1,p=e>0?d.length:-1;m!=p;m+=e){let y=o.indexOf(d[m]);if(!(y<0||i.resolve(g+m,1).type!=n))if(y%2==0==e>0)f++;else{if(f==1)return{start:a,end:{from:g+m,to:g+m+1},matched:y>>1==h>>1};f--}}e>0&&(u+=d.length)}return c.done?{start:a,matched:!1}:null}const qF=Object.create(null),Ev=[Ei.none],Pv=[],KF=Object.create(null);for(let[s,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])KF[s]=GF(qF,t);function Zg(s,t){Pv.indexOf(s)>-1||(Pv.push(s),console.warn(t))}function GF(s,t){let e=null;for(let r of t.split(".")){let o=s[r]||A[r];o?typeof o=="function"?e?e=o(e):Zg(r,`Modifier ${r} used at start of tag`):e?Zg(r,`Tag ${r} used as modifier`):e=o:Zg(r,`Unknown highlighting tag ${r}`)}if(!e)return 0;let i=t.replace(/ /g,"_"),n=Ei.define({id:Ev.length,name:i,props:[XH({[i]:e})]});return Ev.push(n),n.id}let nt=class t${constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),ru.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),ru.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new Nh(this),r=new Nh(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new Nh(this,t)}iterRange(t,e=this.length){return new e$(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new i$(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?t$.empty:t.length<=32?new en(t):ru.from(en.split(t,[]))}},en=class Pn extends nt{constructor(t,e=jF(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new UF(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new Pn(Lv(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=ou(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Pn(l,o.length+r.length));else{let h=l.length>>1;i.push(new Pn(l.slice(0,h)),new Pn(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof Pn))return super.replace(t,e,i);let n=ou(this.text,ou(i.text,Lv(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new Pn(n,r):ru.from(Pn.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new Pn(i,n)),i=[],n=-1);return n>-1&&e.push(new Pn(i,n)),e}},ru=class to extends nt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new to(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof to))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new en(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof to)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof en&&h&&(g=c[c.length-1])instanceof en&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new en(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:to.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new to(l,e)}};nt.empty=new en([""],0);function jF(s){let t=-1;for(let e of s)t+=e.length+1;return t}function ou(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function Lv(s,t,e){return ou(s,[""],t,e)}let Nh=class{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof en?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof en?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof en){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof en?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}},e$=class{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Nh(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},i$=class{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(nt.prototype[Symbol.iterator]=function(){return this.iter()},Nh.prototype[Symbol.iterator]=e$.prototype[Symbol.iterator]=i$.prototype[Symbol.iterator]=function(){return this});let UF=class{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}},Bo="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<Bo.length;s++)Bo[s]+=Bo[s-1];function JF(s){for(let t=1;t<Bo.length;t+=2)if(Bo[t]>s)return Bo[t-1]<=s;return!1}function Vv(s){return s>=127462&&s<=127487}const Iv=8205;function Ci(s,t,e=!0,i=!0){return(e?n$:YF)(s,t,i)}function n$(s,t,e){if(t==s.length)return t;t&&s$(s.charCodeAt(t))&&r$(s.charCodeAt(t-1))&&t--;let i=Qg(s,t);for(t+=Nv(i);t<s.length;){let n=Qg(s,t);if(i==Iv||n==Iv||e&&JF(n))t+=Nv(n),i=n;else if(Vv(n)){let r=0,o=t-2;for(;o>=0&&Vv(Qg(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function YF(s,t,e){for(;t>0;){let i=n$(s,t-2,e);if(i<t)return i;t--}return 0}function s$(s){return s>=56320&&s<57344}function r$(s){return s>=55296&&s<56320}function Qg(s,t){let e=s.charCodeAt(t);if(!r$(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return s$(i)?(e-55296<<10)+(i-56320)+65536:e}function Nv(s){return s<65536?1:2}const M0=/\r\n?|\n/;var bi=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(bi||(bi={}));let Eo=class lu{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){D0(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new lu(t)}composeDesc(t){return this.empty?t:t.empty?this:o$(this,t)}mapDesc(t,e=!1){return t.empty?this:O0(this,t,e)}mapPos(t,e=-1,i=bi.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=bi.Simple&&a>=t&&(i==bi.TrackDel&&n<t&&a>t||i==bi.TrackBefore&&n<t||i==bi.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new lu(t)}static create(t){return new lu(t)}},bn=class Bs extends Eo{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return D0(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return O0(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(nt.empty);i.push(o?t.slice(r,r+o):nt.empty)}r+=o}return new Bs(e,i)}compose(t){return this.empty?t:t.empty?this:o$(this,t,!0)}map(t,e=!1){return t.empty?this:O0(this,t,e,!0)}iterChanges(t,e=!1){D0(this,t,e)}get desc(){return Eo.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new Sa(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Le(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Le(e,c,f),f>0&&dr(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Le(e,c,-1),Le(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new Bs(e,i),filtered:Eo.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Le(n,e-o,-1);let f=new Bs(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof Bs){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?nt.of(d.split(i||M0)):d:nt.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Le(n,f-o,-1),Le(n,u-f,m),dr(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new Bs(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(nt.empty);i[n]=nt.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new Bs(e,i)}static createSet(t,e){return new Bs(t,e)}};function Le(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function dr(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(nt.empty);s.push(e)}}function D0(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=nt.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function O0(s,t,e,i=!1){let n=[],r=i?[]:null,o=new Sa(s),l=new Sa(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let c=Math.min(l.len,h-a);l.forward(c),Le(n,c,-1),a+=c}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(Le(n,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let c=0,f=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<f)c+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<f){let u=Math.min(l.len,f-a);c+=u,l.forward(u),a+=u}else break;Le(n,c,o.ins),r&&dr(r,n,o.text),h=f,o.next()}else{if(o.done&&l.done)return r?bn.createSet(n,r):Eo.create(n);throw new Error("Mismatched change set lengths")}}function o$(s,t,e=!1){let i=[],n=e?[]:null,r=new Sa(s),o=new Sa(t);for(let l=!1;;){if(r.done&&o.done)return n?bn.createSet(i,n):Eo.create(i);if(r.ins==0)Le(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Le(i,0,o.ins,l),n&&dr(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Le(i,h,c,l),n&&c&&dr(n,i,o.text)}else o.ins==-1?(Le(i,r.off?0:r.len,h,l),n&&dr(n,i,r.textBit(h))):(Le(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&dr(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}let Sa=class{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?nt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?nt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}},Kc=class T0{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new T0(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return M.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return M.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return M.range(t.anchor,t.head)}static create(t,e,i){return new T0(t,e,i)}},M=class fi{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:fi.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new fi([this.main],0)}addRange(t,e=!0){return fi.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,fi.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new fi(t.ranges.map(e=>Kc.fromJSON(e)),t.main)}static single(t,e=t){return new fi([fi.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return fi.normalized(t.slice(),e);i=r.to}return new fi(t,e)}static cursor(t,e=0,i,n){return Kc.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n??33554431)<<5)}static range(t,e,i){let n=(i??33554431)<<5;return e<t?Kc.create(e,t,16|n|8):Kc.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?fi.range(h,l):fi.range(l,h))}}return new fi(t,e)}};function l$(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let Cb=0,Q=class h${constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=r,this.id=Cb++,this.default=t([])}static define(t={}){return new h$(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:Mb),!!t.static,t.enables)}of(t){return new hu([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new hu(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new hu(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}};function Mb(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}let hu=class{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=Cb++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||$0(f,c)){let d=i(f);if(l?!Hv(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d=i(f),g=u.config.address[r];if(g!=null){let m=ud(u,g);if(this.dependencies.every(p=>p instanceof Q?u.facet(p)===f.facet(p):p instanceof fc?u.field(p,!1)==f.field(p,!1):!0)||(l?Hv(d,m,n):n(d,m)))return f.values[o]=m,0}return f.values[o]=d,1}}}};function Hv(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function $0(s,t){let e=!1;for(let i of t)Hh(s,i)&1&&(e=!0);return e}function XF(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=ud(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)Hh(h,a);return h.values[o]=l(h),1},update(h,a){if(!$0(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=$0(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&Mb(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const Fv=Q.define({static:!0});let fc=class a${constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new a$(Cb++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Fv).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,Fv.of({field:this,create:t})]}get extension(){return this}};const eo={lowest:4,low:3,default:2,high:1,highest:0};function Il(s){return t=>new c$(t,s)}const ZF={highest:Il(eo.highest),high:Il(eo.high),default:Il(eo.default),low:Il(eo.low),lowest:Il(eo.lowest)};let c$=class{constructor(t,e){this.inner=t,this.prec=e}},f$=class u${of(t){return new R0(this,t)}reconfigure(t){return u$.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}},R0=class{constructor(t,e){this.compartment=t,this.inner=e}},Wv=class d${constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of QF(t,e,o))u instanceof fc?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,Mb(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>XF(p,g,d))}}let f=a.map(u=>u(l));return new d$(t,o,f,l,h,r)}};function QF(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof R0&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof R0){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof c$)r(o.inner,o.prec);else if(o instanceof fc)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof hu)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,eo.default),i.reduce((o,l)=>o.concat(l))}function Hh(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function ud(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const g$=Q.define(),p$=Q.define({combine:s=>s.some(t=>t),static:!0}),m$=Q.define({combine:s=>s.length?s[0]:void 0,static:!0}),y$=Q.define(),w$=Q.define(),b$=Q.define(),x$=Q.define({combine:s=>s.length?s[0]:!1});let Hr=class{constructor(t,e){this.type=t,this.value=e}static define(){return new _F}},_F=class{of(t){return new Hr(this,t)}},t5=class{constructor(t){this.map=t}of(t){return new De(this,t)}},De=class S${constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new S$(this.type,e)}is(t){return this.type==t}static define(t={}){return new t5(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}};De.reconfigure=De.define();De.appendConfig=De.define();let ti=class lh{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&l$(i,e.newLength),r.some(l=>l.type==lh.time)||(this.annotations=r.concat(lh.time.of(Date.now())))}static create(t,e,i,n,r,o){return new lh(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(lh.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}};ti.time=Hr.define();ti.userEvent=Hr.define();ti.addToHistory=Hr.define();ti.remote=Hr.define();function e5(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function v$(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=bn.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:De.mapEffects(s.effects,n).concat(De.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function B0(s,t,e){let i=t.selection,n=Po(t.annotations);return t.userEvent&&(n=n.concat(ti.userEvent.of(t.userEvent))),{changes:t.changes instanceof bn?t.changes:bn.of(t.changes||[],e,s.facet(m$)),selection:i&&(i instanceof M?i:M.single(i.anchor,i.head)),effects:Po(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function k$(s,t,e){let i=B0(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=v$(i,B0(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=ti.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return n5(e?i5(n):n)}function i5(s){let t=s.startState,e=!0;for(let n of t.facet(y$)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:e5(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=bn.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.invertedDesc}s=ti.create(t,n,s.selection&&s.selection.map(r),De.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(w$);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof ti?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof ti?s=r[0]:s=k$(t,Po(r),!1)}return s}function n5(s){let t=s.startState,e=t.facet(b$),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=v$(s,B0(t,r,s.changes.newLength),!0))}return i==s?s:ti.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const s5=[];function Po(s){return s==null?s5:Array.isArray(s)?s:[s]}var bs=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(bs||(bs={}));const r5=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let E0;try{E0=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function o5(s){if(E0)return E0.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||r5.test(e)))return!0}return!1}function l5(s){return t=>{if(!/\S/.test(t))return bs.Space;if(o5(t))return bs.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return bs.Word;return bs.Other}}let ei=class zi{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Hh(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return Hh(this,i),ud(this,i)}update(...t){return k$(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(f$.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(De.reconfigure)?(e=null,i=o.value):o.is(De.appendConfig)&&(e=null,i=Po(i).concat(o.value));let r;e?r=t.startState.values.slice():(e=Wv.resolve(i,n,this),r=new zi(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new zi(e,t.newDoc,t.newSelection,r,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:M.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=Po(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=De.mapEffects(o,c).concat(De.mapEffects(Po(h.effects),f))}return{changes:n,selection:M.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof bn?t:bn.of(t,this.doc.length,this.facet(zi.lineSeparator))}toText(t){return nt.of(t.split(this.facet(zi.lineSeparator)||M0))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Hh(this,e),ud(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof fc&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}return zi.create({doc:t.doc,selection:M.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=Wv.resolve(t.extensions||[],new Map),i=t.doc instanceof nt?t.doc:nt.of((t.doc||"").split(e.staticFacet(zi.lineSeparator)||M0)),n=t.selection?t.selection instanceof M?t.selection:M.single(t.selection.anchor,t.selection.head):M.single(0);return l$(n,i.length),e.staticFacet(p$)||(n=n.asSingle()),new zi(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(zi.tabSize)}get lineBreak(){return this.facet(zi.lineSeparator)||`
`}get readOnly(){return this.facet(x$)}phrase(t,...e){for(let i of this.facet(zi.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(g$))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return l5(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=Ci(e,o,!1);if(r(e.slice(h,o))!=bs.Word)break;o=h}for(;l<n;){let h=Ci(e,l);if(r(e.slice(l,h))!=bs.Word)break;l=h}return o==l?null:M.range(o+i,l+i)}};ei.allowMultipleSelections=p$;ei.tabSize=Q.define({combine:s=>s.length?s[0]:4});ei.lineSeparator=m$;ei.readOnly=x$;ei.phrases=Q.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});ei.languageData=g$;ei.changeFilter=y$;ei.transactionFilter=w$;ei.transactionExtender=b$;f$.reconfigure=De.define();function h5(s,t,e={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}let rl=class{eq(t){return this==t}range(t,e=t){return P0.create(t,e,this)}};rl.prototype.startSide=rl.prototype.endSide=0;rl.prototype.point=!1;rl.prototype.mapMode=bi.TrackDel;let P0=class A${constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new A$(t,e,i)}};function L0(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}let a5=class C${constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new C$(n,r,i,l):null,pos:o}}},ri=class io{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new io(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(L0)),this.isEmpty)return e.length?io.of(e):this;let l=new D$(this,null,-1).goto(0),h=0,a=[],c=new zv;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(P0.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?io.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new io(i,e,r||io.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return V0.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return V0.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=qv(o,l,i),a=new Nl(o,h,r),c=new Nl(l,h,r);i.iterGaps((f,u,d)=>Kv(a,f,c,u,d,n)),i.empty&&i.length==0&&Kv(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=qv(r,o),h=new Nl(r,l,0).goto(i),a=new Nl(o,l,0).goto(i);for(;;){if(h.to!=a.to||!I0(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new Nl(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new zv;for(let n of t instanceof P0?[t]:e?c5(t):t)i.add(n.from,n.to,n.value);return i.finish()}};ri.empty=new ri([],[],null,-1);function c5(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(L0(t,i)>0)return s.slice().sort(L0);t=i}return s}ri.empty.nextLayer=ri.empty;let zv=class M${constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new a5(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new M$)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(ri.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=ri.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}};function qv(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}let D$=class{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}},V0=class O${constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new D$(o,e,i,r));return n.length==1?n[0]:new O$(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)_g(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)_g(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),_g(this.heap,0)}}};function _g(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}let Nl=class{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=V0.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Gc(this.active,t),Gc(this.activeTo,t),Gc(this.activeRank,t),this.minActive=Gv(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;jc(this.active,e,i),jc(this.activeTo,e,n),jc(this.activeRank,e,r),t&&jc(t,e,this.cursor.from),this.minActive=Gv(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&Gc(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}};function Kv(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to||s.endSide-e.endSide,c=a<0?s.to+h:e.to,f=Math.min(c,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&I0(s.activeForPoint(s.to+h),e.activeForPoint(e.to))||r.comparePoint(l,f,s.point,e.point):f>l&&!I0(s.active,e.active)&&r.compareRange(l,f,s.active,e.active),c>o)break;l=c,a<=0&&s.next(),a>=0&&e.next()}}function I0(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function Gc(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function jc(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function Gv(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function T$(s,t,e=s.length){let i=0;for(let n=0;n<e;)s.charCodeAt(n)==9?(i+=t-i%t,n++):(i++,n=Ci(s,n));return i}function f5(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=Ci(s,n)}return s.length}function dd(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function ol(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function u5(){let s=document.activeElement;for(;s&&s.shadowRoot;)s=s.shadowRoot.activeElement;return s}function N0(s,t){if(!t.anchorNode)return!1;try{return ol(s,t.anchorNode)}catch{return!1}}function va(s){return s.nodeType==3?ka(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function gd(s,t,e,i){return e?jv(s,t,e,i,-1)||jv(s,t,e,i,1):!1}function H0(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function jv(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:pd(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=H0(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?pd(s):0}else return!1}}function pd(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}const $$={left:0,right:0,top:0,bottom:0};function _d(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function d5(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function g5(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView;for(let c=s;c;)if(c.nodeType==1){let f,u=c==h.body;if(u)f=d5(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let m=c.getBoundingClientRect();f={left:m.left,right:m.left+c.clientWidth,top:m.top,bottom:m.top+c.clientHeight}}let d=0,g=0;if(n=="nearest")t.top<f.top?(g=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+g&&(g=t.bottom-f.bottom+g+o)):t.bottom>f.bottom&&(g=t.bottom-f.bottom+o,e<0&&t.top-g<f.top&&(g=-(f.top+g-t.top+o)));else{let m=t.bottom-t.top,p=f.bottom-f.top;g=(n=="center"&&m<=p?t.top+m/2-p/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-p+o)-f.top}if(i=="nearest"?t.left<f.left?(d=-(f.left-t.left+r),e>0&&t.right>f.right+d&&(d=t.right-f.right+d+r)):t.right>f.right&&(d=t.right-f.right+r,e<0&&t.left<f.left+d&&(d=-(f.left+d-t.left+r))):d=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,d||g)if(u)a.scrollBy(d,g);else{if(g){let m=c.scrollTop;c.scrollTop+=g,g=c.scrollTop-m}if(d){let m=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-m}t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(u)break;c=c.assignedSlot||c.parentNode,i=n="nearest"}else if(c.nodeType==11)c=c.host;else break}let p5=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}},Kr=null;function R$(s){if(s.setActive)return s.setActive();if(Kr)return s.focus(Kr);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(Kr==null?{get preventScroll(){return Kr={preventScroll:!0},!0}}:void 0),!Kr){Kr=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let Uv;function ka(s,t,e=t){let i=Uv||(Uv=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function Fh(s,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function m5(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function B$(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}let Ye=class F0{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new F0(t.parentNode,H0(t),e)}static after(t,e){return new F0(t.parentNode,H0(t)+1,e)}};const Db=[];let te=class W0{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let r of this.children){if(r.dirty){if(!r.dom&&(n=i?i.nextSibling:e.firstChild)){let o=W0.get(n);(!o||!o.parent&&o.constructor==r.constructor)&&r.reuseDOM(n)}r.sync(t),r.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=r.dom&&(t.written=!0),r.dom.parentNode==e)for(;n&&n!=r.dom;)n=Jv(n);else e.insertBefore(r.dom,n);i=r.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=Jv(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=pd(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!W0.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Db){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new E$(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}};te.prototype.breakAfter=0;function Jv(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}let E$=class{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function P$(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function L$(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,P$(s,a,c,l,h,i,0,n,r)}let gn=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},z0=typeof document<"u"?document:{documentElement:{style:{}}};const q0=/Edge\/(\d+)/.exec(gn.userAgent),V$=/MSIE \d/.test(gn.userAgent),K0=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(gn.userAgent),tg=!!(V$||K0||q0),Yv=!tg&&/gecko\/(\d+)/i.test(gn.userAgent),tp=!tg&&/Chrome\/(\d+)/.exec(gn.userAgent),y5="webkitFontSmoothing"in z0.documentElement.style,I$=!tg&&/Apple Computer/.test(gn.vendor),Xv=I$&&(/Mobile\/\w+/.test(gn.userAgent)||gn.maxTouchPoints>2);var E={mac:Xv||/Mac/.test(gn.platform),ie:tg,ie_version:V$?z0.documentMode||6:K0?+K0[1]:q0?+q0[1]:0,gecko:Yv,gecko_version:Yv?+(/Firefox\/(\d+)/.exec(gn.userAgent)||[0,0])[1]:0,chrome:!!tp,chrome_version:tp?+tp[1]:0,ios:Xv,android:/Android\b/.test(gn.userAgent),safari:I$,webkit_version:y5?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:z0.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const w5=256;let Aa=class G0 extends te{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof G0)||this.length-(e-t)+i.length>w5)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new G0(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Ye(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return U0(this.dom,t,e)}},Or=class j0 extends te{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(B$(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,r,o){return i&&(!(i instanceof j0&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(L$(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new j0(this.mark,e,o)}domAtPos(t){return F$(this.dom,this.children,t)}coordsAt(t,e){return z$(this,t,e)}};function U0(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?E.chrome||E.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=ka(s,n,r).getClientRects();if(!l.length)return $$;let h=l[(o?o<0:e>=0)?0:l.length-1];return E.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?_d(h,o<0):h||null}let Ob=class hh extends te{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||hh)(t,e,i)}split(t){let e=hh.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof hh)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof hh&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return nt.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):nt.empty}domAtPos(t){return t==0?Ye.before(this.dom):Ye.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return $$;for(let r=t>0?i.length-1:0;n=i[r],!(t>0?r==0:r==i.length-1||n.top<n.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:_d(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},N$=class extends Ob{domAtPos(t){let{topView:e,text:i}=this.widget;return e?J0(t,0,e,i,(n,r)=>n.domAtPos(r),n=>new Ye(i,Math.min(n,i.nodeValue.length))):new Ye(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?H$(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?J0(t,e,i,n,(r,o,l)=>r.coordsAt(o,l),(r,o)=>U0(n,r,o)):U0(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}};function J0(s,t,e,i,n,r){if(e instanceof Or){for(let o of e.children){let l=ol(o.dom,i),h=l?i.nodeValue.length:o.length;if(s<h||s==h&&o.getSide()<=0)return l?J0(s,t,o,i,n,r):n(o,s,t);s-=h}return n(e,e.length,-1)}else return e.dom==i?r(s,t):n(e,s,t)}function H$(s,t,e,i){if(e instanceof Or)for(let n of e.children){let r=0,o=ol(n.dom,i);if(ol(n.dom,s))return r+(o?H$(s,t,n,i):n.localPosFromDOM(s,t));r+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(s,t)}let Y0=class X0 extends te{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof X0&&t.side==this.side}split(){return new X0(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Ye.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=b5(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return nt.empty}};Aa.prototype.children=Ob.prototype.children=Y0.prototype.children=Db;function b5(s,t){let e=s.parent,i=e?e.children.indexOf(s):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof Aa){let r=n.coordsAt(t<0?n.length:0,t);if(r)return r}i+=t}else if(e instanceof Or&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function F$(s,t,e){let i=0;for(let n=0;i<t.length;i++){let r=t[i],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(e>n&&e<o&&r.dom.parentNode==s)return r.domAtPos(e-n);if(e<=n)break;n=o}}for(;i>0;i--){let n=t[i-1].dom;if(n.parentNode==s)return Ye.after(n)}return new Ye(s,0)}function W$(s,t,e){let i,{children:n}=s;e>0&&t instanceof Or&&n.length&&(i=n[n.length-1])instanceof Or&&i.mark.eq(t.mark)?W$(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function z$(s,t,e){for(let r=0,o=0;o<s.children.length;o++){let l=s.children[o],h=r+l.length,a;if((e<=0||h==s.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==s.children.length||(a=s.children[o+1]).length||a.getSide()>0)){let c=0;if(h==r){if(l.getSide()<=0)continue;c=e=-l.getSide()}let f=l.coordsAt(Math.max(0,t-r),e);return c&&f?_d(f,e<0):f}r=h}let i=s.dom.lastChild;if(!i)return s.dom.getBoundingClientRect();let n=va(i);return n[n.length-1]||null}function Z0(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}function Tb(s,t){if(s==t)return!0;if(!s||!t)return!1;let e=Object.keys(s),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||s[n]!==t[n])return!1;return!0}function Q0(s,t,e){let i=null;if(t)for(let n in t)e&&n in e||s.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||s.setAttribute(i=n,e[n]);return!!i}let eg=class{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}};var Ut=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(Ut||(Ut={}));let me=class extends rl{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new q$(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Ca(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=U$(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new Ca(t,i,n,e,t.widget||null,!0)}static line(t){return new $b(t)}static set(t,e=!1){return ri.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};me.none=ri.empty;let q$=class K$ extends me{constructor(t){let{start:e,end:i}=U$(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof K$&&this.tagName==t.tagName&&this.class==t.class&&Tb(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}};q$.prototype.point=!1;let $b=class G$ extends me{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof G$&&Tb(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}};$b.prototype.mapMode=bi.TrackBefore;$b.prototype.point=!0;let Ca=class j$ extends me{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?bi.TrackBefore:bi.TrackAfter:bi.TrackDel}get type(){return this.startSide<this.endSide?Ut.WidgetRange:this.startSide<=0?Ut.WidgetBefore:Ut.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof j$&&x5(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}};Ca.prototype.point=!0;function U$(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function x5(s,t){return s==t||!!(s&&t&&s.compare(t))}function _0(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}let nn=class au extends te{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof au))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),L$(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new au;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Tb(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){W$(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Z0(e,this.attrs||{})),i&&(this.attrs=Z0({class:i},this.attrs||{}))}domAtPos(t){return F$(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(B$(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Q0(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&te.get(i)instanceof Or;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=te.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!E.ios||!this.children.some(n=>n instanceof Aa))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Aa))return null;let i=va(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return z$(this,t,e)}become(t){return!1}get type(){return Ut.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof au)return r;if(o>e)break}n=o+r.breakAfter}return null}},t1=class cu extends te{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof cu)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?Ye.before(this.dom):Ye.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new cu(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Db}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):nt.empty}domBoundsAround(){return null}become(t){return t instanceof cu&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},S5=class J${constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof t1&&t.type==Ut.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new nn),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(Uc(new Y0(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(Uc(new Aa(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof Ca){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof Ca)if(i.block){let{type:h}=i;h==Ut.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new t1(i.widget||new Zv("div"),l,h))}else{let h=Ob.create(i.widget||new Zv("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(Uc(new Y0(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(Uc(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new J$(t,e,i,r);return o.openEnd=ri.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function Uc(s,t){for(let e of t)s=new Or(e,[s],s.length);return s}let Zv=class extends eg{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}};const Y$=Q.define(),X$=Q.define(),Z$=Q.define(),Q$=Q.define(),e1=Q.define(),_$=Q.define(),tR=Q.define({combine:s=>s.some(t=>t)});let Qv=class eR{constructor(t,e="nearest",i="nearest",n=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r}map(t){return t.empty?this:new eR(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}};const _v=De.define({map:(s,t)=>s.map(t)});function vr(s,t,e){let i=s.facet(Q$);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const uc=Q.define({combine:s=>s.length?s[0]:!0});let v5=0;const ah=Q.define();let k5=class i1{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:r}=e||{};return new i1(v5++,t,i,o=>{let l=[ah.of(o)];return r&&l.push(Ma.of(h=>{let a=h.plugin(o);return a?r(a):me.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return i1.define(i=>new t(i),e)}},ep=class{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(vr(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){vr(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){vr(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const iR=Q.define(),nR=Q.define(),Ma=Q.define(),sR=Q.define(),rR=Q.define(),ch=Q.define();let Da=class fu{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new fu(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new fu(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new fu(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}},tk=class oR{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=bn.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new Da(o,l,h,a))),this.changedRanges=n;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}static create(t,e,i){return new oR(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}};var Oe=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(Oe||(Oe={}));const n1=Oe.LTR,A5=Oe.RTL;function lR(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const C5=lR("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),M5=lR("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),s1=Object.create(null),Mn=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);s1[t]=e,s1[e]=-t}function D5(s){return s<=247?C5[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?M5[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||s==8204?256:1}const O5=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;let Lo=class{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?A5:n1}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};const Mt=[];function T5(s,t){let e=s.length,i=t==n1?1:2,n=t==n1?2:1;if(!s||i==1&&!O5.test(s))return hR(e);for(let o=0,l=i,h=i;o<e;o++){let a=D5(s.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),Mt[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=Mt[o];if(a==128)o<e-1&&l==Mt[o+1]&&l&24?a=Mt[o]=l:Mt[o]=256;else if(a==64){let c=o+1;for(;c<e&&Mt[c]==64;)c++;let f=o&&l==8||c<e&&Mt[c]==8?h==1?1:8:256;for(let u=o;u<c;u++)Mt[u]=f;o=c-1}else a==8&&h==1&&(Mt[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,c,f;o<e;o++)if(c=s1[a=s.charCodeAt(o)])if(c<0){for(let u=l-3;u>=0;u-=3)if(Mn[u+1]==-c){let d=Mn[u+2],g=d&2?i:d&4?d&1?n:i:0;g&&(Mt[o]=Mt[Mn[u]]=g),l=u;break}}else{if(Mn.length==189)break;Mn[l++]=o,Mn[l++]=a,Mn[l++]=h}else if((f=Mt[o])==2||f==1){let u=f==i;h=u?0:1;for(let d=l-3;d>=0;d-=3){let g=Mn[d+2];if(g&2)break;if(u)Mn[d+2]|=2;else{if(g&4)break;Mn[d+2]|=4}}}for(let o=0;o<e;o++)if(Mt[o]==256){let l=o+1;for(;l<e&&Mt[l]==256;)l++;let h=(o?Mt[o-1]:i)==1,a=(l<e?Mt[l]:i)==1,c=h==a?h?1:2:i;for(let f=o;f<l;f++)Mt[f]=c;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=Mt[o++]!=1;for(;o<e&&h==(Mt[o]!=1);)o++;if(h)for(let a=o;a>l;){let c=a,f=Mt[--a]!=2;for(;a>l&&f==(Mt[a-1]!=2);)a--;r.push(new Lo(a,c,f?2:1))}else r.push(new Lo(l,o,0))}else for(let o=0;o<e;){let l=o,h=Mt[o++]==2;for(;o<e&&h==(Mt[o]==2);)o++;r.push(new Lo(l,o,h?1:2))}return r}function hR(s){return[new Lo(0,s,0)]}let aR="";function $5(s,t,e,i,n){var r;let o=i.head-s.from,l=-1;if(o==0){if(!n||!s.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==s.length){if(n)return null;let u=t[t.length-1];u.level!=e&&(o=u.side(!0,e),l=t.length-1)}l<0&&(l=Lo.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),c=Ci(s.text,o,a);if(aR=s.text.slice(Math.min(o,c),Math.max(o,c)),c!=h.side(n,e))return M.cursor(c+s.from,a?-1:1,h.level);let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!f&&h.level!=e?M.cursor(n?s.to:s.from,n?-1:1,e):f&&f.level<h.level?M.cursor(f.side(!n,e)+s.from,n?1:-1,f.level):M.cursor(c+s.from,n?-1:1,h.level)}const Ks="￿";let cR=class{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(ei.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Ks}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let r=n.nextSibling;if(r==e)break;let o=te.get(n),l=te.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:ek(n))||ek(r)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=r}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=te.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}};function ek(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}let ik=class{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}},nk=class extends te{constructor(t){super(),this.view=t,this.compositionDeco=me.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new nn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Da(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=me.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=B5(this.view,t.changes)),(E.ie||E.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),r=V5(i,n,t.changes);return e=Da.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let r=E.chrome||E.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof t1&&r.widget instanceof sk&&n.push(r.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let r=n>=0?t[n]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:c,breakAtStart:f,openStart:u,openEnd:d}=S5.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:g,off:m}=i.findPos(l,1),{i:p,off:y}=i.findPos(o,-1);P$(this,p,y,g,m,c,f,u,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||E.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),o=n.empty?r:this.domAtPos(n.head);if(E.gecko&&n.empty&&R5(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new Ye(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!gd(r.node,r.offset,l.anchorNode,l.anchorOffset)||!gd(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{E.android&&E.chrome&&this.dom.contains(l.focusNode)&&I5(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=dd(this.root);if(n.empty){if(E.gecko){let a=P5(r.node,r.offset);if(a&&a!=3){let c=uR(r.node,r.offset,a==1?1:-1);c&&(r=new Ye(c,a==1?0:c.nodeValue.length))}}h.collapse(r.node,r.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new Ye(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new Ye(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=dd(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=nn.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(uc)?this.root.activeElement==this.dom:N0(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=te.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof nn)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=Ut.WidgetBefore&&r.type!=Ut.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==Ut.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==Oe.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?va(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?Oe.RTL:Oe.LTR}measureTextSize(){for(let n of this.children)if(n instanceof nn){let r=n.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=va(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new E$(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(me.replace({widget:new sk(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return me.set(t)}updateDeco(){let t=this.view.state.facet(Ma).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=0,o=0,l=0,h=0;for(let c of this.view.state.facet(rR).map(f=>f(this.view)))if(c){let{left:f,right:u,top:d,bottom:g}=c;f!=null&&(r=Math.max(r,f)),u!=null&&(o=Math.max(o,u)),d!=null&&(l=Math.max(l,d)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};g5(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==Oe.LTR)}};function R5(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}let sk=class extends eg{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function fR(s){let t=s.observer.selectionRange,e=t.focusNode&&uR(t.focusNode,t.focusOffset,0);if(!e)return null;let i=s.docView.nearest(e);if(!i)return null;if(i instanceof nn){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let r=n.previousSibling;for(;r&&!te.get(r);)r=r.previousSibling;let o=r?te.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof nn)break;i=r}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function B5(s,t){let e=fR(s);if(!e)return me.none;let{from:i,to:n,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=s,c=r.nodeType==3?r.nodeValue:new cR([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),Ks)==c)h=l+c.length;else if(a.doc.sliceString(Math.max(0,h-c.length),h,Ks)==c)l=h-c.length;else return me.none;else if(a.doc.sliceString(l,h,Ks)!=c)return me.none;let f=te.get(r);return f instanceof N$?f=f.widget.topView:f&&(f.parent=null),me.set(me.replace({widget:new E5(r,o,f),inclusive:!0}).range(l,h))}let E5=class extends eg{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return N$}};function uR(s,t,e){for(;;){if(s.nodeType==3)return s;if(s.nodeType==1&&t>0&&e<=0)s=s.childNodes[t-1],t=pd(s);else if(s.nodeType==1&&t<s.childNodes.length&&e>=0)s=s.childNodes[t],t=0;else return null}}function P5(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let L5=class{constructor(){this.changes=[]}compareRange(t,e){_0(t,e,this.changes)}comparePoint(t,e){_0(t,e,this.changes)}};function V5(s,t,e){let i=new L5;return ri.compare(s,t,e,i),i.changes}function I5(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function N5(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return M.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=Ci(n.text,r,!1):l=Ci(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=Ci(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=Ci(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return M.range(o+n.from,l+n.from)}function H5(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function F5(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function ip(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function rk(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function ok(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function r1(s,t,e){let i,n,r,o,l,h,a,c;for(let d=s.firstChild;d;d=d.nextSibling){let g=va(d);for(let m=0;m<g.length;m++){let p=g[m];n&&ip(n,p)&&(p=rk(ok(p,n.bottom),n.top));let y=H5(t,p),w=F5(e,p);if(y==0&&w==0)return d.nodeType==3?lk(d,t,e):r1(d,t,e);(!i||o>w||o==w&&r>y)&&(i=d,n=p,r=y,o=w),y==0?e>p.bottom&&(!a||a.bottom<p.bottom)?(l=d,a=p):e<p.top&&(!c||c.top>p.top)&&(h=d,c=p):a&&ip(a,p)?a=ok(a,p.bottom):c&&ip(c,p)&&(c=rk(c,p.top))}}if(a&&a.bottom>=e?(i=l,n=a):c&&c.top<=e&&(i=h,n=c),!i)return{node:s,offset:0};let f=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return lk(i,f,e);if(!r&&i.contentEditable=="true")return r1(i,f,e);let u=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:u}}function lk(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=ka(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if((E.chrome||E.gecko)&&ka(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function dR(s,{x:t,y:e},i,n=-1){var r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,c=e-l;if(c<0)return 0;if(c>a)return s.state.doc.length;for(let y=s.defaultLineHeight/2,w=!1;h=s.elementAtHeight(c),h.type!=Ut.Text;)for(;c=n>0?h.bottom+y:h.top-y,!(c>=0&&c<=a);){if(w)return i?null:0;w=!0,n=-n}e=l+c;let f=h.from;if(f<s.viewport.from)return s.viewport.from==0?0:i?null:hk(s,o,h,t,e);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:i?null:hk(s,o,h,t,e);let u=s.dom.ownerDocument,d=s.root.elementFromPoint?s.root:u,g=d.elementFromPoint(t,e);g&&!s.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=d.elementFromPoint(t,e),g&&!s.contentDOM.contains(g)&&(g=null));let m,p=-1;if(g&&((r=s.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(u.caretPositionFromPoint){let y=u.caretPositionFromPoint(t,e);y&&({offsetNode:m,offset:p}=y)}else if(u.caretRangeFromPoint){let y=u.caretRangeFromPoint(t,e);y&&({startContainer:m,startOffset:p}=y,E.safari&&W5(m,p,t)&&(m=void 0))}}if(!m||!s.docView.dom.contains(m)){let y=nn.find(s.docView,f);if(!y)return c>h.top+h.height/2?h.to:h.from;({node:m,offset:p}=r1(y.dom,t,e))}return s.docView.posFromDOM(m,p)}function hk(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=Math.floor((n-e.top)/s.defaultLineHeight);r+=l*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+f5(o,r,s.state.tabSize)}function W5(s,t,e){let i;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return ka(s,i-1,i).getBoundingClientRect().left>e}function z5(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=!i||!s.lineWrapping?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let h=s.dom.getBoundingClientRect(),a=s.textDirectionAt(n.from),c=s.posAtCoords({x:e==(a==Oe.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(c!=null)return M.cursor(c,e?-1:1)}let o=nn.find(s.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return M.cursor(l,e?-1:1)}function ak(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=$5(n,r,o,l,e),c=aR;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=M.cursor(e?n.from:n.to)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function q5(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==bs.Space&&(n=o),n==o}}function K5(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return M.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.defaultLineHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=dR(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n))return M.cursor(m,t.assoc,void 0,o)}}function np(s,t,e){let i=s.state.facet(sR).map(n=>n(s));for(;;){let n=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?M.cursor(o,1):M.cursor(l,-1),n=!0)});if(!n)return e}}let G5=class{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in ae){let i=ae[e];t.contentDOM.addEventListener(e,n=>{!ck(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))}),this.registeredEvents.push(e)}E.chrome&&E.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,E.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let r of e)if(n=(i=r.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{ck(t,l)&&this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let r=n.handlers[t];if(r)try{if(r.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){vr(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(r){vr(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(E.android&&E.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return E.ios&&(i=gR.find(n=>n.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Fh(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:E.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!E.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};const gR=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],j5=[16,17,18,20,91,92,224,225];let U5=class{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(ei.allowMultipleSelections)&&J5(t,e),this.dragMove=Y5(t,e),this.dragging=X5(t,e)&&Rb(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}};function J5(s,t){let e=s.state.facet(Y$);return e.length?e[0](t):E.mac?t.metaKey:t.ctrlKey}function Y5(s,t){let e=s.state.facet(X$);return e.length?e[0](t):E.mac?!t.altKey:!t.ctrlKey}function X5(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=dd(s.root);if(i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function ck(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=te.get(e))&&i.ignoreEvent(t))return!1;return!0}const ae=Object.create(null),pR=E.ie&&E.ie_version<15||E.ios&&E.webkit_version<604;function Z5(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),mR(s,e.value)},50)}function mR(s,t){let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(o1!=null&&e.selection.ranges.every(h=>h.empty)&&o1==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:M.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:M.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ae.keydown=(s,t)=>{s.inputState.setSelectionOrigin("select"),t.keyCode==27?s.inputState.lastEscPress=Date.now():j5.indexOf(t.keyCode)<0&&(s.inputState.lastEscPress=0)};let yR=0;ae.touchstart=(s,t)=>{yR=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};ae.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};ae.mousedown=(s,t)=>{if(s.observer.flush(),yR>Date.now()-2e3&&Rb(t)==1)return;let e=null;for(let i of s.state.facet(Z$))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=tW(s,t)),e){let i=s.root.activeElement!=s.contentDOM;i&&s.observer.ignore(()=>R$(s.contentDOM)),s.inputState.startMouseSelection(new U5(s,t,e,i))}};function fk(s,t,e,i){if(i==1)return M.cursor(t,e);if(i==2)return N5(s.state,t,e);{let n=nn.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,M.range(o,l)}}let wR=(s,t)=>s>=t.top&&s<=t.bottom,uk=(s,t,e)=>wR(t,e)&&s>=e.left&&s<=e.right;function Q5(s,t,e,i){let n=nn.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&uk(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&uk(e,i,l)?1:o&&wR(i,o)?-1:1}function dk(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:Q5(s,e,t.clientX,t.clientY)}}const _5=E.ie&&E.ie_version<=11;let gk=null,pk=0,mk=0;function Rb(s){if(!_5)return s.detail;let t=gk,e=mk;return gk=s,mk=Date.now(),pk=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(pk+1)%3:1}function tW(s,t){let e=dk(s,t),i=Rb(t),n=s.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),n=n.map(l.changes),o=null)},get(l,h,a){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=r:(c=r=dk(s,l),o=l),!c||!e)return n;let f=fk(s,c.pos,c.bias,i);if(e.pos!=c.pos&&!h){let u=fk(s,e.pos,e.bias,i),d=Math.min(u.from,f.from),g=Math.max(u.to,f.to);f=d<f.from?M.range(d,g):M.range(g,d)}return h?n.replaceRange(n.main.extend(f.from,f.to)):a?n.addRange(f):M.create([f])}}}ae.dragstart=(s,t)=>{let{selection:{main:e}}=s.state,{mouseSelection:i}=s.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",s.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function yk(s,t,e,i){if(!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=s.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}ae.drop=(s,t)=>{if(!t.dataTransfer)return;if(s.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,r=()=>{++n==e.length&&yk(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else yk(s,t,t.dataTransfer.getData("Text"),!0)};ae.paste=(s,t)=>{if(s.state.readOnly)return t.preventDefault();s.observer.flush();let e=pR?null:t.clipboardData;e?(mR(s,e.getData("text/plain")),t.preventDefault()):Z5(s)};function eW(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function iW(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(s.lineBreak),ranges:e,linewise:i}}let o1=null;ae.copy=ae.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=iW(s.state);if(!e&&!n)return;o1=n?e:null;let r=pR?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):eW(s,e),t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function bR(s){setTimeout(()=>{s.hasFocus!=s.inputState.notifiedFocused&&s.update([])},10)}ae.focus=bR;ae.blur=s=>{s.observer.clearSelectionRange(),bR(s)};function xR(s,t){if(s.docView.compositionDeco.size){s.inputState.rapidCompositionStart=t;try{s.update([])}finally{s.inputState.rapidCompositionStart=!1}}}ae.compositionstart=ae.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0,s.docView.compositionDeco.size&&(s.observer.flush(),xR(s,!0)))};ae.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionFirstChange=null,setTimeout(()=>{s.inputState.composing<0&&xR(s,!1)},50)};ae.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};ae.beforeinput=(s,t)=>{var e;let i;if(E.chrome&&E.android&&(i=gR.find(n=>n.inputType==t.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}};const wk=["pre-wrap","normal","pre-line","break-spaces"];let nW=class{constructor(){this.doc=nt.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return wk.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r){let o=wk.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<r.length;h++){let a=r[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}},sW=class{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}},wo=class SR{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new SR(this.from,this.length+t.length,this.top,this.height+t.height,e)}};var ht=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(ht||(ht={}));const uu=.001;let Qn=class du{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>uu&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return du.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:c}=n[o],f=r.lineAt(l,ht.ByPosNoHeight,e,0,0),u=f.to>=h?f:r.lineAt(h,ht.ByPosNoHeight,e,0,0);for(c+=u.to-h,h=u.to;o>0&&f.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<f.from&&(f=r.lineAt(l,ht.ByPosNoHeight,e,0,0));a+=f.from-l,l=f.from;let d=lW.build(i,t,a,c);r=r.replace(l,h,d)}return r.updateHeight(i,0)}static empty(){return new Fn(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new rW(du.of(t.slice(0,e)),o,du.of(t.slice(i)))}};Qn.prototype.size=1;let vR=class extends Qn{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new wo(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Fn=class l1 extends vR{constructor(t,e){super(t,e,Ut.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof l1||n instanceof Vo&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Vo?n=new l1(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Qn.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},Vo=class qi extends Qn{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:c}=e.line(r+h);return new wo(a,c,i+l*h,l,Ut.Text)}lineAt(t,e,i,n,r){if(e==ht.ByHeight)return this.blockAt(t,i,n,r);if(e==ht.ByPosNoHeight){let{from:f,to:u}=i.lineAt(t);return new wo(f,u-f,0,0,Ut.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:c}=i.lineAt(t);return new wo(h,a,n+l*(c-o),l,Ut.Text)}forEachLine(t,e,i,n,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),c=Math.min(r+this.length,e);a<=c;){let f=i.lineAt(a);a==t&&(n+=h*(f.number-l)),o(new wo(f.from,f.length,n,h,Ut.Text)),n+=h,a=f.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof qi?i[i.length-1]=new qi(r.length+n):i.push(null,new qi(n-1))}if(t>0){let r=i[0];r instanceof qi?i[0]=new qi(t+r.length):i.unshift(new qi(t-1),null)}return Qn.of(i)}decomposeLeft(t,e){e.push(new qi(t-1),null)}decomposeRight(t,e){e.push(null,new qi(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new qi(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let f=t.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];h==-1?h=u:Math.abs(u-h)>=uu&&(h=-2);let d=new Fn(f,u);d.outdated=!1,o.push(d),l+=f+1}l<=r&&o.push(null,new qi(r-l).updateHeight(t,l));let c=Qn.of(o);return t.heightChanged=a||h<0||Math.abs(c.height-this.height)>=uu||Math.abs(h-this.lines(t.doc,e).lineHeight)>=uu,c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},rW=class extends Qn{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==ht.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==ht.ByPosNoHeight?ht.ByPosNoHeight:ht.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,ht.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&bk(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),bk(r,l)}return Qn.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Qn.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function bk(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof Vo&&(i=s[t+1])instanceof Vo&&s.splice(t-1,3,new Vo(e.length+1+i.length))}const oW=5;let lW=class kR{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Fn?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Fn(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new vR(r,n,i.type)):(r||n>=oW)&&this.addLineDeco(n,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Fn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Vo(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Fn)return t;let e=new Fn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==Ut.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Ut.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Fn)&&!this.isCovered?this.nodes.push(new Fn(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof Fn&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new kR(i,t);return ri.spans(e,i,n,r,0),r.finish(i)}};function hW(s,t,e){let i=new aW;return ri.compare(s,t,e,i,0),i.changes}let aW=class{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&_0(t,e,this.changes,5)}};function cW(s,t){let e=s.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=s.ownerDocument.body;for(let h=s.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,c=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&c.overflow!="visible"){let f=a.getBoundingClientRect();i=Math.max(i,f.left),n=Math.min(n,f.right),r=Math.max(r,f.top),o=Math.min(o,f.bottom)}h=c.position=="absolute"||c.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}function fW(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}let sp=class{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t){return me.replace({widget:new uW(this.size,t)}).range(this.from,this.to)}},uW=class extends eg{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}},xk=class{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new nW,this.scaler=kk,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Oe.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Ma).filter(e=>typeof e!="function"),this.heightMap=Qn.empty().applyChanges(this.stateDeco,nt.empty,this.heightOracle.setDoc(t.doc),[new Da(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=me.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new Jc(r,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?kk:new pW(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:fh(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ma).filter(a=>typeof a!="function");let n=t.changedRanges,r=Da.extendWithRanges(n,hW(i,this.stateDeco,t?t.changes:bn.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?Oe.RTL:Oe.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,c=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let u=(this.printing?fW:cW)(e,this.paddingTop),d=u.top-this.pixelViewport.top,g=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let w=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(w)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:x,charWidth:b}=t.docView.measureTextSize();o=n.refresh(r,x,b,p/b,w),o&&(t.docView.minWidth=0,h|=8)}d>0&&g>0?a=Math.max(d,g):d<0&&g<0&&(a=Math.min(d,g)),n.heightChanged=!1;for(let x of this.viewports){let b=x.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(x);this.heightMap=this.heightMap.updateHeight(n,0,o,new sW(x.from,b))}n.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new Jc(n.lineAt(o-i*1e3,ht.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,ht.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,ht.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new Jc(n.lineAt(u-1e3/2,ht.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,ht.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new Jc(this.heightMap.lineAt(i,ht.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,ht.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,ht.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,ht.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new sp(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=Oe.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=dW(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=Yc(n,(this.visibleTop-i.top-a)/i.height),o=Yc(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;r=Yc(n,(this.pixelViewport.left-c)/a),o=Yc(n,(this.pixelViewport.right+c)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&vk(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&vk(l,h.to-10,h.to+10);for(let{from:a,to:c}of l)c-a>1e3&&e.push(gW(t,f=>f.from>=i.from&&f.to<=i.to&&Math.abs(f.from-a)<1e3&&Math.abs(f.to-c)<1e3)||new sp(a,c,this.gapSize(i,a,c,n)))}return e}gapSize(t,e,i,n){let r=Sk(n,i)-Sk(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){sp.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=me.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];ri.spans(t,this.viewport.from,this.viewport.to,{span(n,r){e.push({from:n,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=e[r].from||n.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||fh(this.heightMap.lineAt(t,ht.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return fh(this.heightMap.lineAt(this.scaler.fromDOM(t),ht.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return fh(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},Jc=class{constructor(t,e){this.from=t,this.to=e}};function dW(s,t,e){let i=[],n=s,r=0;return ri.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function Yc({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function Sk(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function vk(s,t,e){for(let i=0;i<s.length;i++){let n=s[i];if(n.from<e&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>e&&r.push({from:e,to:n.to}),s.splice(i,1,...r),i+=r.length-1}}}function gW(s,t){for(let e of s)if(t(e))return e}const kk={toDOM(s){return s},fromDOM(s){return s},scale:1};let pW=class{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,ht.ByPos,t,0,0).top,c=e.lineAt(h,ht.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}};function fh(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new wo(s.from,s.length,e,i-e,Array.isArray(s.type)?s.type.map(n=>fh(n,t)):s.type)}const Xc=Q.define({combine:s=>s.join(" ")}),h1=Q.define({combine:s=>s.indexOf(!0)>-1}),a1=I.newName(),AR=I.newName(),CR=I.newName(),MR={"&light":"."+AR,"&dark":"."+CR};function c1(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const mW=c1("."+a1,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},MR),yW={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},rp=E.ie&&E.ie_version<=11;let wW=class{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new p5,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(E.ie&&E.ie_version<=11||E.ios&&t.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),rp&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(uc)?e.root.activeElement!=this.dom:!N0(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((E.ie&&E.ie_version<=11||E.android&&E.chrome)&&!e.state.selection.main.empty&&i.focusNode&&gd(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=dd(t),i=E.safari&&t.nodeType==11&&u5()==this.view.contentDOM&&bW(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,yW),rp&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),rp&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Fh(this.view.contentDOM,i.key,i.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&N0(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=Ak(e,t.previousSibling||t.target.previousSibling,-1),n=Ak(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function Ak(s,t,e){for(;t;){let i=te.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function bW(s){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return gd(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}function xW(s,t,e,i){let n,r,o=s.state.selection.main;if(t>-1){let l=s.docView.domBoundsAround(t,e,0);if(!l||s.state.readOnly)return!1;let{from:h,to:a}=l,c=s.docView.impreciseHead||s.docView.impreciseAnchor?[]:vW(s),f=new cR(c,s.state);f.readRange(l.startDOM,l.endDOM);let u=o.from,d=null;(s.inputState.lastKeyCode===8&&s.inputState.lastKeyTime>Date.now()-100||E.android&&f.text.length<a-h)&&(u=o.to,d="end");let g=SW(s.state.doc.sliceString(h,a,Ks),f.text,u-h,d);g&&(E.chrome&&s.inputState.lastKeyCode==13&&g.toB==g.from+2&&f.text.slice(g.from,g.toB)==Ks+Ks&&g.toB--,n={from:h+g.from,to:h+g.toA,insert:nt.of(f.text.slice(g.from,g.toB).split(Ks))}),r=kW(c,h)}else if(s.hasFocus||!s.state.facet(uc)){let l=s.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=s.docView,c=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!ol(s.contentDOM,l.focusNode)?s.state.selection.main.head:s.docView.posFromDOM(l.focusNode,l.focusOffset),f=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!ol(s.contentDOM,l.anchorNode)?s.state.selection.main.anchor:s.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||f!=o.anchor)&&(r=M.single(f,c))}if(!n&&!r)return!1;if(!n&&i&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,n.from).append(n.insert).append(s.state.doc.slice(n.to,o.to))}:(E.mac||E.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:nt.of([" "])}),n){let l=s.state;if(E.ios&&s.inputState.flushIOSKey(s)||E.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&Fh(s.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&Fh(s.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&Fh(s.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(s.state.facet(_$).some(f=>f(s,n.from,n.to,h)))return!0;s.inputState.composing>=0&&s.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&s.inputState.composing<0){let f=o.from<n.from?l.sliceDoc(o.from,n.from):"",u=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(s.state.toText(f+n.insert.sliceString(0,void 0,s.state.lineBreak)+u))}else{let f=l.changes(n),u=r&&!l.selection.main.eq(r.main)&&r.main.to<=f.newLength?r.main:void 0;if(l.selection.ranges.length>1&&s.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=s.state.sliceDoc(n.from,n.to),g=fR(s)||s.state.doc.lineAt(o.head),m=o.to-n.to,p=o.to-o.from;a=l.changeByRange(y=>{if(y.from==o.from&&y.to==o.to)return{changes:f,range:u||y.map(f)};let w=y.to-m,x=w-d.length;if(y.to-y.from!=p||s.state.sliceDoc(x,w)!=d||g&&y.to>=g.from&&y.from<=g.to)return{range:y};let b=l.changes({from:x,to:w,insert:n.insert}),S=y.to-o.to;return{changes:b,range:u?M.range(Math.max(0,u.anchor+S),Math.max(0,u.head+S)):y.map(b)}})}else a={changes:f,selection:u&&l.selection.replaceRange(u)}}let c="input.type";return s.composing&&(c+=".compose",s.inputState.compositionFirstChange&&(c+=".start",s.inputState.compositionFirstChange=!1)),s.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(o)){let l=!1,h="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(l=!0),h=s.inputState.lastSelectionOrigin),s.dispatch({selection:r,scrollIntoView:l,userEvent:h}),!0}else return!1}function SW(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function vW(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new ik(e,i)),(n!=e||r!=i)&&t.push(new ik(n,r))),t}function kW(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?M.single(e+t,i+t):null}let Vt=class DR{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||m5(t.parent)||document,this.viewState=new xk(t.state||ei.create()),this.plugins=this.state.facet(ah).map(e=>new ep(e));for(let e of this.plugins)e.update(this);this.observer=new wW(this,(e,i,n)=>xW(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new G5(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new nk(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof ti?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let l of t){if(l.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=l.state}if(this.destroyed){this.viewState.state=r;return}if(this.observer.clear(),r.facet(ei.phrases)!=this.state.facet(ei.phrases))return this.setState(r);n=tk.create(this,r,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new Qv(h.empty?h:M.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(_v)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=Mk.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(ch)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Xc)!=n.state.facet(Xc)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(e1))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new xk(t),this.plugins=t.facet(ah).map(i=>new ep(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new nk(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ah),i=t.state.facet(ah);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new ep(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let n=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(f=>{try{return f.read(this)}catch(u){return vr(this.state,u),Ck}}),h=tk.create(this,this.state,[]),a=!1,c=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let f=0;f<o.length;f++)if(l[f]!=Ck)try{let u=o[f];u.write&&u.write(l[f],this)}catch(u){vr(this.state,u)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),a&&this.docView.updateSelection(!0),this.viewport.from==n.from&&this.viewport.to==n.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(e1))i(e)}get themeClasses(){return a1+" "+(this.state.facet(h1)?CR:AR)+" "+this.state.facet(Xc)}updateAttrs(){let t=Dk(this,iR,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(uc)?"true":"false",class:"cm-content",style:`${E.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Dk(this,nR,e);let i=this.observer.ignore(()=>{let n=Q0(this.contentDOM,this.contentAttrs,e),r=Q0(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(DR.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(ch),I.mount(this.root,this.styleModules.concat(mW).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return np(this,t,ak(this,t,e,i))}moveByGroup(t,e){return np(this,t,ak(this,t,e,i=>q5(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return z5(this,t,e,i)}moveVertically(t,e,i){return np(this,t,K5(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),dR(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[Lo.find(r,t-n.from,-1,e)];return _d(i,o.dir==Oe.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(tR)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>AW)return hR(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=T5(t.text,e);return this.bidiCache.push(new Mk(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||E.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{R$(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return _v.of(new Qv(typeof t=="number"?M.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return k5.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=I.newName(),n=[Xc.of(i),ch.of(c1(`.${i}`,t))];return e&&e.dark&&n.push(h1.of(!0)),n}static baseTheme(t){return ZF.lowest(ch.of(c1("."+a1,t,MR)))}};Vt.styleModule=ch;Vt.inputHandler=_$;Vt.perLineTextDirection=tR;Vt.exceptionSink=Q$;Vt.updateListener=e1;Vt.editable=uc;Vt.mouseSelectionStyle=Z$;Vt.dragMovesSelection=X$;Vt.clickAddsSelectionRange=Y$;Vt.decorations=Ma;Vt.atomicRanges=sR;Vt.scrollMargins=rR;Vt.darkTheme=h1;Vt.contentAttributes=nR;Vt.editorAttributes=iR;Vt.lineWrapping=Vt.contentAttributes.of({class:"cm-lineWrapping"});Vt.announce=De.define();const AW=4096,Ck={};let Mk=class OR{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:Oe.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new OR(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}};function Dk(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&Z0(o,e)}return e}const CW=!E.ios,MW={".cm-line":{}};CW&&(MW[".cm-line"].caretColor="transparent !important");let ll=class extends rl{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}};ll.prototype.elementClass="";ll.prototype.toDOM=void 0;ll.prototype.mapMode=bi.TrackBefore;ll.prototype.startSide=ll.prototype.endSide=-1;ll.prototype.point=!0;const DW=s=>{let t=Eb(s.state);return t.line?OW(s):t.block?$W(s):!1};function Bb(s,t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let n=s(t,e);return n?(i(e.update(n)),!0):!1}}const OW=Bb(EW,0),TW=Bb(TR,0),$W=Bb((s,t)=>TR(s,t,BW(t)),0);function Eb(s,t=s.selection.main.head){let e=s.languageDataAt("commentTokens",t);return e.length?e[0]:{}}const Hl=50;function RW(s,{open:t,close:e},i,n){let r=s.sliceDoc(i-Hl,i),o=s.sliceDoc(n,n+Hl),l=/\s*$/.exec(r)[0].length,h=/^\s*/.exec(o)[0].length,a=r.length-l;if(r.slice(a-t.length,a)==t&&o.slice(h,h+e.length)==e)return{open:{pos:i-l,margin:l&&1},close:{pos:n+h,margin:h&&1}};let c,f;n-i<=2*Hl?c=f=s.sliceDoc(i,n):(c=s.sliceDoc(i,i+Hl),f=s.sliceDoc(n-Hl,n));let u=/^\s*/.exec(c)[0].length,d=/\s*$/.exec(f)[0].length,g=f.length-d-e.length;return c.slice(u,u+t.length)==t&&f.slice(g,g+e.length)==e?{open:{pos:i+u+t.length,margin:/\s/.test(c.charAt(u+t.length))?1:0},close:{pos:n-d-e.length,margin:/\s/.test(f.charAt(g-1))?1:0}}:null}function BW(s){let t=[];for(let e of s.selection.ranges){let i=s.doc.lineAt(e.from),n=e.to<=i.to?i:s.doc.lineAt(e.to),r=t.length-1;r>=0&&t[r].to>i.from?t[r].to=n.to:t.push({from:i.from,to:n.to})}return t}function TR(s,t,e=t.selection.ranges){let i=e.map(r=>Eb(t,r.from).block);if(!i.every(r=>r))return null;let n=e.map((r,o)=>RW(t,i[o],r.from,r.to));if(s!=2&&!n.every(r=>r))return{changes:t.changes(e.map((r,o)=>n[o]?[]:[{from:r.from,insert:i[o].open+" "},{from:r.to,insert:" "+i[o].close}]))};if(s!=1&&n.some(r=>r)){let r=[];for(let o=0,l;o<n.length;o++)if(l=n[o]){let h=i[o],{open:a,close:c}=l;r.push({from:a.pos-h.open.length,to:a.pos+a.margin},{from:c.pos-c.margin,to:c.pos+h.close.length})}return{changes:r}}return null}function EW(s,t,e=t.selection.ranges){let i=[],n=-1;for(let{from:r,to:o}of e){let l=i.length,h=1e9;for(let a=r;a<=o;){let c=t.doc.lineAt(a);if(c.from>n&&(r==o||o>c.from)){n=c.from;let f=Eb(t,a).line;if(!f)continue;let u=/^\s*/.exec(c.text)[0].length,d=u==c.length,g=c.text.slice(u,u+f.length)==f?u:-1;u<c.text.length&&u<h&&(h=u),i.push({line:c,comment:g,token:f,indent:u,empty:d,single:!1})}a=c.to+1}if(h<1e9)for(let a=l;a<i.length;a++)i[a].indent<i[a].line.text.length&&(i[a].indent=h);i.length==l+1&&(i[l].single=!0)}if(s!=2&&i.some(r=>r.comment<0&&(!r.empty||r.single))){let r=[];for(let{line:l,token:h,indent:a,empty:c,single:f}of i)(f||!c)&&r.push({from:l.from+a,insert:h+" "});let o=t.changes(r);return{changes:o,selection:t.selection.map(o,1)}}else if(s!=1&&i.some(r=>r.comment>=0)){let r=[];for(let{line:o,comment:l,token:h}of i)if(l>=0){let a=o.from+l,c=a+h.length;o.text[c-o.from]==" "&&c++,r.push({from:a,to:c})}return{changes:r}}return null}const f1=Hr.define(),PW=Hr.define(),LW=Q.define(),$R=Q.define({combine(s){return h5(s,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function VW(s){let t=0;return s.iterChangedRanges((e,i)=>t=i),t}const RR=fc.define({create(){return Yn.empty},update(s,t){let e=t.state.facet($R),i=t.annotation(f1);if(i){let h=t.docChanged?M.single(VW(t.changes)):void 0,a=Xe.fromTransaction(t,h),c=i.side,f=c==0?s.undone:s.done;return a?f=md(f,f.length,e.minDepth,a):f=LR(f,t.startState.selection),new Yn(c==0?i.rest:f,c==0?f:i.rest)}let n=t.annotation(PW);if((n=="full"||n=="before")&&(s=s.isolate()),t.annotation(ti.addToHistory)===!1)return t.changes.empty?s:s.addMapping(t.changes.desc);let r=Xe.fromTransaction(t),o=t.annotation(ti.time),l=t.annotation(ti.userEvent);return r?s=s.addChanges(r,o,l,e.newGroupDelay,e.minDepth):t.selection&&(s=s.addSelection(t.startState.selection,o,l,e.newGroupDelay)),(n=="full"||n=="after")&&(s=s.isolate()),s},toJSON(s){return{done:s.done.map(t=>t.toJSON()),undone:s.undone.map(t=>t.toJSON())}},fromJSON(s){return new Yn(s.done.map(Xe.fromJSON),s.undone.map(Xe.fromJSON))}});function IW(s={}){return[RR,$R.of(s),Vt.domEventHandlers({beforeinput(t,e){let i=t.inputType=="historyUndo"?BR:t.inputType=="historyRedo"?ER:null;return i?(t.preventDefault(),i(e)):!1}})]}function ig(s,t){return function({state:e,dispatch:i}){if(!t&&e.readOnly)return!1;let n=e.field(RR,!1);if(!n)return!1;let r=n.pop(s,e,t);return r?(i(r),!0):!1}}const BR=ig(0,!1),ER=ig(1,!1),NW=ig(0,!0),HW=ig(1,!0);class Xe{constructor(t,e,i,n,r){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=n,this.selectionsAfter=r}setSelAfter(t){return new Xe(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(e=this.mapped)===null||e===void 0?void 0:e.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(t){return new Xe(t.changes&&bn.fromJSON(t.changes),[],t.mapped&&Eo.fromJSON(t.mapped),t.startSelection&&M.fromJSON(t.startSelection),t.selectionsAfter.map(M.fromJSON))}static fromTransaction(t,e){let i=Ri;for(let n of t.startState.facet(LW)){let r=n(t);r.length&&(i=i.concat(r))}return!i.length&&t.changes.empty?null:new Xe(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,Ri)}static selection(t){return new Xe(void 0,Ri,void 0,void 0,t)}}function md(s,t,e,i){let n=t+1>e+20?t-e-1:0,r=s.slice(n,t);return r.push(i),r}function FW(s,t){let e=[],i=!1;return s.iterChangedRanges((n,r)=>e.push(n,r)),t.iterChangedRanges((n,r,o,l)=>{for(let h=0;h<e.length;){let a=e[h++],c=e[h++];l>=a&&o<=c&&(i=!0)}}),i}function WW(s,t){return s.ranges.length==t.ranges.length&&s.ranges.filter((e,i)=>e.empty!=t.ranges[i].empty).length===0}function PR(s,t){return s.length?t.length?s.concat(t):s:t}const Ri=[],zW=200;function LR(s,t){if(s.length){let e=s[s.length-1],i=e.selectionsAfter.slice(Math.max(0,e.selectionsAfter.length-zW));return i.length&&i[i.length-1].eq(t)?s:(i.push(t),md(s,s.length-1,1e9,e.setSelAfter(i)))}else return[Xe.selection([t])]}function qW(s){let t=s[s.length-1],e=s.slice();return e[s.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),e}function op(s,t){if(!s.length)return s;let e=s.length,i=Ri;for(;e;){let n=KW(s[e-1],t,i);if(n.changes&&!n.changes.empty||n.effects.length){let r=s.slice(0,e);return r[e-1]=n,r}else t=n.mapped,e--,i=n.selectionsAfter}return i.length?[Xe.selection(i)]:Ri}function KW(s,t,e){let i=PR(s.selectionsAfter.length?s.selectionsAfter.map(l=>l.map(t)):Ri,e);if(!s.changes)return Xe.selection(i);let n=s.changes.map(t),r=t.mapDesc(s.changes,!0),o=s.mapped?s.mapped.composeDesc(r):r;return new Xe(n,De.mapEffects(s.effects,t),o,s.startSelection.map(r),i)}const GW=/^(input\.type|delete)($|\.)/;class Yn{constructor(t,e,i=0,n=void 0){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new Yn(this.done,this.undone):this}addChanges(t,e,i,n,r){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&t.changes&&(!i||GW.test(i))&&(!l.selectionsAfter.length&&e-this.prevTime<n&&FW(l.changes,t.changes)||i=="input.type.compose")?o=md(o,o.length-1,r,new Xe(t.changes.compose(l.changes),PR(t.effects,l.effects),l.mapped,l.startSelection,Ri)):o=md(o,o.length,r,t),new Yn(o,Ri,e,i)}addSelection(t,e,i,n){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:Ri;return r.length>0&&e-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&WW(r[r.length-1],t)?this:new Yn(LR(this.done,t),this.undone,e,i)}addMapping(t){return new Yn(op(this.done,t),op(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let n=t==0?this.done:this.undone;if(n.length==0)return null;let r=n[n.length-1];if(i&&r.selectionsAfter.length)return e.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:f1.of({side:t,rest:qW(n)}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let o=n.length==1?Ri:n.slice(0,n.length-1);return r.mapped&&(o=op(o,r.mapped)),e.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:f1.of({side:t,rest:o}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}Yn.empty=new Yn(Ri,Ri);const jW=[{key:"Mod-z",run:BR,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:ER,preventDefault:!0},{key:"Mod-u",run:NW,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:HW,preventDefault:!0}];function Cl(s,t){return M.create(s.ranges.map(t),s.mainIndex)}function fs(s,t){return s.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function Ts({state:s,dispatch:t},e){let i=Cl(s.selection,e);return i.eq(s.selection)?!1:(t(fs(s,i)),!0)}function ng(s,t){return M.cursor(t?s.to:s.from)}function VR(s,t){return Ts(s,e=>e.empty?s.moveByChar(e,t):ng(e,t))}function Li(s){return s.textDirectionAt(s.state.selection.main.head)==Oe.LTR}const IR=s=>VR(s,!Li(s)),NR=s=>VR(s,Li(s));function HR(s,t){return Ts(s,e=>e.empty?s.moveByGroup(e,t):ng(e,t))}const UW=s=>HR(s,!Li(s)),JW=s=>HR(s,Li(s));function YW(s,t,e){if(t.type.prop(e))return!0;let i=t.to-t.from;return i&&(i>2||/[^\s,.;:]/.test(s.sliceDoc(t.from,t.to)))||t.firstChild}function sg(s,t,e){let i=$e(s).resolveInner(t.head),n=e?j.closedBy:j.openedBy;for(let h=t.head;;){let a=e?i.childAfter(h):i.childBefore(h);if(!a)break;YW(s,a,n)?i=a:h=e?a.to:a.from}let r=i.type.prop(n),o,l;return r&&(o=e?Jn(s,i.from,1):Jn(s,i.to,-1))&&o.matched?l=e?o.end.to:o.end.from:l=e?i.to:i.from,M.cursor(l,e?-1:1)}const XW=s=>Ts(s,t=>sg(s.state,t,!Li(s))),ZW=s=>Ts(s,t=>sg(s.state,t,Li(s)));function FR(s,t){return Ts(s,e=>{if(!e.empty)return ng(e,t);let i=s.moveVertically(e,t);return i.head!=e.head?i:s.moveToLineBoundary(e,t)})}const WR=s=>FR(s,!1),zR=s=>FR(s,!0);function qR(s,t){let{state:e}=s,i=Cl(e.selection,l=>l.empty?s.moveVertically(l,t,Math.min(s.dom.clientHeight,innerHeight)):ng(l,t));if(i.eq(e.selection))return!1;let n=s.coordsAtPos(e.selection.main.head),r=s.scrollDOM.getBoundingClientRect(),o;return n&&n.top>r.top&&n.bottom<r.bottom&&n.top-r.top<=s.scrollDOM.scrollHeight-s.scrollDOM.scrollTop-s.scrollDOM.clientHeight&&(o=Vt.scrollIntoView(i.main.head,{y:"start",yMargin:n.top-r.top})),s.dispatch(fs(e,i),{effects:o}),!0}const Ok=s=>qR(s,!1),u1=s=>qR(s,!0);function rg(s,t,e){let i=s.lineBlockAt(t.head),n=s.moveToLineBoundary(t,e);if(n.head==t.head&&n.head!=(e?i.to:i.from)&&(n=s.moveToLineBoundary(t,e,!1)),!e&&n.head==i.from&&i.length){let r=/^\s*/.exec(s.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;r&&t.head!=i.from+r&&(n=M.cursor(i.from+r))}return n}const Tk=s=>Ts(s,t=>rg(s,t,!0)),$k=s=>Ts(s,t=>rg(s,t,!1)),QW=s=>Ts(s,t=>M.cursor(s.lineBlockAt(t.head).from,1)),_W=s=>Ts(s,t=>M.cursor(s.lineBlockAt(t.head).to,-1));function t6(s,t,e){let i=!1,n=Cl(s.selection,r=>{let o=Jn(s,r.head,-1)||Jn(s,r.head,1)||r.head>0&&Jn(s,r.head-1,1)||r.head<s.doc.length&&Jn(s,r.head+1,-1);if(!o||!o.end)return r;i=!0;let l=o.start.from==r.head?o.end.to:o.end.from;return M.cursor(l)});return i?(t(fs(s,n)),!0):!1}const e6=({state:s,dispatch:t})=>t6(s,t);function us(s,t){let e=Cl(s.state.selection,i=>{let n=t(i);return M.range(i.anchor,n.head,n.goalColumn)});return e.eq(s.state.selection)?!1:(s.dispatch(fs(s.state,e)),!0)}function KR(s,t){return us(s,e=>s.moveByChar(e,t))}const GR=s=>KR(s,!Li(s)),jR=s=>KR(s,Li(s));function UR(s,t){return us(s,e=>s.moveByGroup(e,t))}const i6=s=>UR(s,!Li(s)),n6=s=>UR(s,Li(s)),s6=s=>us(s,t=>sg(s.state,t,!Li(s))),r6=s=>us(s,t=>sg(s.state,t,Li(s)));function JR(s,t){return us(s,e=>s.moveVertically(e,t))}const YR=s=>JR(s,!1),XR=s=>JR(s,!0);function ZR(s,t){return us(s,e=>s.moveVertically(e,t,Math.min(s.dom.clientHeight,innerHeight)))}const Rk=s=>ZR(s,!1),Bk=s=>ZR(s,!0),Ek=s=>us(s,t=>rg(s,t,!0)),Pk=s=>us(s,t=>rg(s,t,!1)),o6=s=>us(s,t=>M.cursor(s.lineBlockAt(t.head).from)),l6=s=>us(s,t=>M.cursor(s.lineBlockAt(t.head).to)),Lk=({state:s,dispatch:t})=>(t(fs(s,{anchor:0})),!0),Vk=({state:s,dispatch:t})=>(t(fs(s,{anchor:s.doc.length})),!0),Ik=({state:s,dispatch:t})=>(t(fs(s,{anchor:s.selection.main.anchor,head:0})),!0),Nk=({state:s,dispatch:t})=>(t(fs(s,{anchor:s.selection.main.anchor,head:s.doc.length})),!0),h6=({state:s,dispatch:t})=>(t(s.update({selection:{anchor:0,head:s.doc.length},userEvent:"select"})),!0),a6=({state:s,dispatch:t})=>{let e=hg(s).map(({from:i,to:n})=>M.range(i,Math.min(n+1,s.doc.length)));return t(s.update({selection:M.create(e),userEvent:"select"})),!0},c6=({state:s,dispatch:t})=>{let e=Cl(s.selection,i=>{var n;let r=$e(s).resolveInner(i.head,1);for(;!(r.from<i.from&&r.to>=i.to||r.to>i.to&&r.from<=i.from||!(!((n=r.parent)===null||n===void 0)&&n.parent));)r=r.parent;return M.range(r.to,r.from)});return t(fs(s,e)),!0},f6=({state:s,dispatch:t})=>{let e=s.selection,i=null;return e.ranges.length>1?i=M.create([e.main]):e.main.empty||(i=M.create([M.cursor(e.main.head)])),i?(t(fs(s,i)),!0):!1};function og({state:s,dispatch:t},e){if(s.readOnly)return!1;let i="delete.selection",n=s.changeByRange(r=>{let{from:o,to:l}=r;if(o==l){let h=e(o);h<o?i="delete.backward":h>o&&(i="delete.forward"),o=Math.min(o,h),l=Math.max(l,h)}return o==l?{range:r}:{changes:{from:o,to:l},range:M.cursor(o)}});return n.changes.empty?!1:(t(s.update(n,{scrollIntoView:!0,userEvent:i})),!0)}function lg(s,t,e){if(s instanceof Vt)for(let i of s.state.facet(Vt.atomicRanges).map(n=>n(s)))i.between(t,t,(n,r)=>{n<t&&r>t&&(t=e?r:n)});return t}const QR=(s,t)=>og(s,e=>{let{state:i}=s,n=i.doc.lineAt(e),r,o;if(!t&&e>n.from&&e<n.from+200&&!/[^ \t]/.test(r=n.text.slice(0,e-n.from))){if(r[r.length-1]=="	")return e-1;let l=T$(r,i.tabSize),h=l%ad(i)||ad(i);for(let a=0;a<h&&r[r.length-1-a]==" ";a++)e--;o=e}else o=Ci(n.text,e-n.from,t,t)+n.from,o==e&&n.number!=(t?i.doc.lines:1)&&(o+=t?1:-1);return lg(s,o,t)}),d1=s=>QR(s,!1),_R=s=>QR(s,!0),tB=(s,t)=>og(s,e=>{let i=e,{state:n}=s,r=n.doc.lineAt(i),o=n.charCategorizer(i);for(let l=null;;){if(i==(t?r.to:r.from)){i==e&&r.number!=(t?n.doc.lines:1)&&(i+=t?1:-1);break}let h=Ci(r.text,i-r.from,t)+r.from,a=r.text.slice(Math.min(i,h)-r.from,Math.max(i,h)-r.from),c=o(a);if(l!=null&&c!=l)break;(a!=" "||i!=e)&&(l=c),i=h}return lg(s,i,t)}),eB=s=>tB(s,!1),u6=s=>tB(s,!0),iB=s=>og(s,t=>{let e=s.lineBlockAt(t).to;return lg(s,t<e?e:Math.min(s.state.doc.length,t+1),!0)}),d6=s=>og(s,t=>{let e=s.lineBlockAt(t).from;return lg(s,t>e?e:Math.max(0,t-1),!1)}),g6=({state:s,dispatch:t})=>{if(s.readOnly)return!1;let e=s.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:nt.of(["",""])},range:M.cursor(i.from)}));return t(s.update(e,{scrollIntoView:!0,userEvent:"input"})),!0},p6=({state:s,dispatch:t})=>{if(s.readOnly)return!1;let e=s.changeByRange(i=>{if(!i.empty||i.from==0||i.from==s.doc.length)return{range:i};let n=i.from,r=s.doc.lineAt(n),o=n==r.from?n-1:Ci(r.text,n-r.from,!1)+r.from,l=n==r.to?n+1:Ci(r.text,n-r.from,!0)+r.from;return{changes:{from:o,to:l,insert:s.doc.slice(n,l).append(s.doc.slice(o,n))},range:M.cursor(l)}});return e.changes.empty?!1:(t(s.update(e,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function hg(s){let t=[],e=-1;for(let i of s.selection.ranges){let n=s.doc.lineAt(i.from),r=s.doc.lineAt(i.to);if(!i.empty&&i.to==r.from&&(r=s.doc.lineAt(i.to-1)),e>=n.number){let o=t[t.length-1];o.to=r.to,o.ranges.push(i)}else t.push({from:n.from,to:r.to,ranges:[i]});e=r.number+1}return t}function nB(s,t,e){if(s.readOnly)return!1;let i=[],n=[];for(let r of hg(s)){if(e?r.to==s.doc.length:r.from==0)continue;let o=s.doc.lineAt(e?r.to+1:r.from-1),l=o.length+1;if(e){i.push({from:r.to,to:o.to},{from:r.from,insert:o.text+s.lineBreak});for(let h of r.ranges)n.push(M.range(Math.min(s.doc.length,h.anchor+l),Math.min(s.doc.length,h.head+l)))}else{i.push({from:o.from,to:r.from},{from:r.to,insert:s.lineBreak+o.text});for(let h of r.ranges)n.push(M.range(h.anchor-l,h.head-l))}}return i.length?(t(s.update({changes:i,scrollIntoView:!0,selection:M.create(n,s.selection.mainIndex),userEvent:"move.line"})),!0):!1}const m6=({state:s,dispatch:t})=>nB(s,t,!1),y6=({state:s,dispatch:t})=>nB(s,t,!0);function sB(s,t,e){if(s.readOnly)return!1;let i=[];for(let n of hg(s))e?i.push({from:n.from,insert:s.doc.slice(n.from,n.to)+s.lineBreak}):i.push({from:n.to,insert:s.lineBreak+s.doc.slice(n.from,n.to)});return t(s.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const w6=({state:s,dispatch:t})=>sB(s,t,!1),b6=({state:s,dispatch:t})=>sB(s,t,!0),x6=s=>{if(s.state.readOnly)return!1;let{state:t}=s,e=t.changes(hg(t).map(({from:n,to:r})=>(n>0?n--:r<t.doc.length&&r++,{from:n,to:r}))),i=Cl(t.selection,n=>s.moveVertically(n,!0)).map(e);return s.dispatch({changes:e,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function S6(s,t){if(/\(\)|\[\]|\{\}/.test(s.sliceDoc(t-1,t+1)))return{from:t,to:t};let e=$e(s).resolveInner(t),i=e.childBefore(t),n=e.childAfter(t),r;return i&&n&&i.to<=t&&n.from>=t&&(r=i.type.prop(j.closedBy))&&r.indexOf(n.name)>-1&&s.doc.lineAt(i.to).from==s.doc.lineAt(n.from).from?{from:i.to,to:n.from}:null}const v6=rB(!1),k6=rB(!0);function rB(s){return({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(n=>{let{from:r,to:o}=n,l=t.doc.lineAt(r),h=!s&&r==o&&S6(t,r);s&&(r=o=(o<=l.to?l:t.doc.lineAt(o)).to);let a=new Xd(t,{simulateBreak:r,simulateDoubleBreak:!!h}),c=kb(a,r);for(c==null&&(c=/^\s*/.exec(t.doc.lineAt(r).text)[0].length);o<l.to&&/\s/.test(l.text[o-l.from]);)o++;h?{from:r,to:o}=h:r>l.from&&r<l.from+100&&!/\S/.test(l.text.slice(0,r))&&(r=l.from);let f=["",xa(t,c)];return h&&f.push(xa(t,a.lineIndent(l.from,-1))),{changes:{from:r,to:o,insert:nt.of(f)},range:M.cursor(r+1+f[1].length)}});return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function Pb(s,t){let e=-1;return s.changeByRange(i=>{let n=[];for(let o=i.from;o<=i.to;){let l=s.doc.lineAt(o);l.number>e&&(i.empty||i.to>l.from)&&(t(l,n,i),e=l.number),o=l.to+1}let r=s.changes(n);return{changes:n,range:M.range(r.mapPos(i.anchor,1),r.mapPos(i.head,1))}})}const A6=({state:s,dispatch:t})=>{if(s.readOnly)return!1;let e=Object.create(null),i=new Xd(s,{overrideIndentation:r=>{let o=e[r];return o??-1}}),n=Pb(s,(r,o,l)=>{let h=kb(i,r.from);if(h==null)return;/\S/.test(r.text)||(h=0);let a=/^\s*/.exec(r.text)[0],c=xa(s,h);(a!=c||l.from<r.from+a.length)&&(e[r.from]=h,o.push({from:r.from,to:r.from+a.length,insert:c}))});return n.changes.empty||t(s.update(n,{userEvent:"indent"})),!0},C6=({state:s,dispatch:t})=>s.readOnly?!1:(t(s.update(Pb(s,(e,i)=>{i.push({from:e.from,insert:s.facet(vb)})}),{userEvent:"input.indent"})),!0),M6=({state:s,dispatch:t})=>s.readOnly?!1:(t(s.update(Pb(s,(e,i)=>{let n=/^\s*/.exec(e.text)[0];if(!n)return;let r=T$(n,s.tabSize),o=0,l=xa(s,Math.max(0,r-ad(s)));for(;o<n.length&&o<l.length&&n.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:e.from+o,to:e.from+n.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),D6=[{key:"Ctrl-b",run:IR,shift:GR,preventDefault:!0},{key:"Ctrl-f",run:NR,shift:jR},{key:"Ctrl-p",run:WR,shift:YR},{key:"Ctrl-n",run:zR,shift:XR},{key:"Ctrl-a",run:QW,shift:o6},{key:"Ctrl-e",run:_W,shift:l6},{key:"Ctrl-d",run:_R},{key:"Ctrl-h",run:d1},{key:"Ctrl-k",run:iB},{key:"Ctrl-Alt-h",run:eB},{key:"Ctrl-o",run:g6},{key:"Ctrl-t",run:p6},{key:"Ctrl-v",run:u1}],O6=[{key:"ArrowLeft",run:IR,shift:GR,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:UW,shift:i6},{mac:"Cmd-ArrowLeft",run:$k,shift:Pk},{key:"ArrowRight",run:NR,shift:jR,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:JW,shift:n6},{mac:"Cmd-ArrowRight",run:Tk,shift:Ek},{key:"ArrowUp",run:WR,shift:YR,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Lk,shift:Ik},{mac:"Ctrl-ArrowUp",run:Ok,shift:Rk},{key:"ArrowDown",run:zR,shift:XR,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Vk,shift:Nk},{mac:"Ctrl-ArrowDown",run:u1,shift:Bk},{key:"PageUp",run:Ok,shift:Rk},{key:"PageDown",run:u1,shift:Bk},{key:"Home",run:$k,shift:Pk,preventDefault:!0},{key:"Mod-Home",run:Lk,shift:Ik},{key:"End",run:Tk,shift:Ek,preventDefault:!0},{key:"Mod-End",run:Vk,shift:Nk},{key:"Enter",run:v6},{key:"Mod-a",run:h6},{key:"Backspace",run:d1,shift:d1},{key:"Delete",run:_R},{key:"Mod-Backspace",mac:"Alt-Backspace",run:eB},{key:"Mod-Delete",mac:"Alt-Delete",run:u6},{mac:"Mod-Backspace",run:d6},{mac:"Mod-Delete",run:iB}].concat(D6.map(s=>({mac:s.key,run:s.run,shift:s.shift}))),T6=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:XW,shift:s6},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:ZW,shift:r6},{key:"Alt-ArrowUp",run:m6},{key:"Shift-Alt-ArrowUp",run:w6},{key:"Alt-ArrowDown",run:y6},{key:"Shift-Alt-ArrowDown",run:b6},{key:"Escape",run:f6},{key:"Mod-Enter",run:k6},{key:"Alt-l",mac:"Ctrl-l",run:a6},{key:"Mod-i",run:c6,preventDefault:!0},{key:"Mod-[",run:M6},{key:"Mod-]",run:C6},{key:"Mod-Alt-\\",run:A6},{key:"Shift-Mod-k",run:x6},{key:"Shift-Mod-\\",run:e6},{key:"Mod-/",run:DW},{key:"Alt-A",run:TW}].concat(O6);let yt=class oB{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),gu.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),gu.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new Wh(this),r=new Wh(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new Wh(this,t)}iterRange(t,e=this.length){return new lB(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new hB(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?oB.empty:t.length<=32?new sn(t):gu.from(sn.split(t,[]))}},sn=class Ln extends yt{constructor(t,e=$6(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new R6(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new Ln(Hk(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=pu(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Ln(l,o.length+r.length));else{let h=l.length>>1;i.push(new Ln(l.slice(0,h)),new Ln(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof Ln))return super.replace(t,e,i);let n=pu(this.text,pu(i.text,Hk(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new Ln(n,r):gu.from(Ln.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new Ln(i,n)),i=[],n=-1);return n>-1&&e.push(new Ln(i,n)),e}},gu=class no extends yt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new no(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof no))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new sn(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof no)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof sn&&h&&(g=c[c.length-1])instanceof sn&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new sn(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:no.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new no(l,e)}};yt.empty=new sn([""],0);function $6(s){let t=-1;for(let e of s)t+=e.length+1;return t}function pu(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function Hk(s,t,e){return pu(s,[""],t,e)}let Wh=class{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof sn?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof sn?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof sn){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof sn?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}},lB=class{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Wh(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},hB=class{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(yt.prototype[Symbol.iterator]=function(){return this.iter()},Wh.prototype[Symbol.iterator]=lB.prototype[Symbol.iterator]=hB.prototype[Symbol.iterator]=function(){return this});let R6=class{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}},Io="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<Io.length;s++)Io[s]+=Io[s-1];function B6(s){for(let t=1;t<Io.length;t+=2)if(Io[t]>s)return Io[t-1]<=s;return!1}function Fk(s){return s>=127462&&s<=127487}const Wk=8205;function Gs(s,t,e=!0,i=!0){return(e?aB:E6)(s,t,i)}function aB(s,t,e){if(t==s.length)return t;t&&cB(s.charCodeAt(t))&&fB(s.charCodeAt(t-1))&&t--;let i=mu(s,t);for(t+=g1(i);t<s.length;){let n=mu(s,t);if(i==Wk||n==Wk||e&&B6(n))t+=g1(n),i=n;else if(Fk(n)){let r=0,o=t-2;for(;o>=0&&Fk(mu(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function E6(s,t,e){for(;t>0;){let i=aB(s,t-2,e);if(i<t)return i;t--}return 0}function cB(s){return s>=56320&&s<57344}function fB(s){return s>=55296&&s<56320}function mu(s,t){let e=s.charCodeAt(t);if(!fB(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return cB(i)?(e-55296<<10)+(i-56320)+65536:e}function P6(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}function g1(s){return s<65536?1:2}const p1=/\r\n?|\n/;var xi=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(xi||(xi={}));let zh=class yu{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){m1(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new yu(t)}composeDesc(t){return this.empty?t:t.empty?this:uB(this,t)}mapDesc(t,e=!1){return t.empty?this:y1(this,t,e)}mapPos(t,e=-1,i=xi.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=xi.Simple&&a>=t&&(i==xi.TrackDel&&n<t&&a>t||i==xi.TrackBefore&&n<t||i==xi.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new yu(t)}static create(t){return new yu(t)}},ls=class Es extends zh{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return m1(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return y1(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(yt.empty);i.push(o?t.slice(r,r+o):yt.empty)}r+=o}return new Es(e,i)}compose(t){return this.empty?t:t.empty?this:uB(this,t,!0)}map(t,e=!1){return t.empty?this:y1(this,t,e,!0)}iterChanges(t,e=!1){m1(this,t,e)}get desc(){return zh.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new Oa(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Ve(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Ve(e,c,f),f>0&&gr(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Ve(e,c,-1),Ve(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new Es(e,i),filtered:zh.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Ve(n,e-o,-1);let f=new Es(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof Es){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?yt.of(d.split(i||p1)):d:yt.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Ve(n,f-o,-1),Ve(n,u-f,m),gr(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new Es(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(yt.empty);i[n]=yt.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new Es(e,i)}static createSet(t,e){return new Es(t,e)}};function Ve(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function gr(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(yt.empty);s.push(e)}}function m1(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=yt.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function y1(s,t,e,i=!1){let n=[],r=i?[]:null,o=new Oa(s),l=new Oa(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let c=Math.min(l.len,h-a);l.forward(c),Ve(n,c,-1),a+=c}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(Ve(n,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let c=0,f=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<f)c+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<f){let u=Math.min(l.len,f-a);c+=u,l.forward(u),a+=u}else break;Ve(n,c,o.ins),r&&gr(r,n,o.text),h=f,o.next()}else{if(o.done&&l.done)return r?ls.createSet(n,r):zh.create(n);throw new Error("Mismatched change set lengths")}}function uB(s,t,e=!1){let i=[],n=e?[]:null,r=new Oa(s),o=new Oa(t);for(let l=!1;;){if(r.done&&o.done)return n?ls.createSet(i,n):zh.create(i);if(r.ins==0)Ve(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Ve(i,0,o.ins,l),n&&gr(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Ve(i,h,c,l),n&&c&&gr(n,i,o.text)}else o.ins==-1?(Ve(i,r.off?0:r.len,h,l),n&&gr(n,i,r.textBit(h))):(Ve(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&gr(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}let Oa=class{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?yt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?yt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}},Zc=class w1{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new w1(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return V.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return V.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return V.range(t.anchor,t.head)}static create(t,e,i){return new w1(t,e,i)}},V=class ui{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:ui.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ui([this.main],0)}addRange(t,e=!0){return ui.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,ui.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ui(t.ranges.map(e=>Zc.fromJSON(e)),t.main)}static single(t,e=t){return new ui([ui.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return ui.normalized(t.slice(),e);i=r.to}return new ui(t,e)}static cursor(t,e=0,i,n){return Zc.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n??33554431)<<5)}static range(t,e,i){let n=(i??33554431)<<5;return e<t?Zc.create(e,t,16|n|8):Zc.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?ui.range(h,l):ui.range(l,h))}}return new ui(t,e)}};function dB(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let Lb=0,U=class gB{constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=r,this.id=Lb++,this.default=t([])}static define(t={}){return new gB(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:Vb),!!t.static,t.enables)}of(t){return new wu([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new wu(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new wu(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}};function Vb(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}let wu=class{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=Lb++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||b1(f,c)){let d=i(f);if(l?!zk(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d=i(f),g=u.config.address[r];if(g!=null){let m=yd(u,g);if(this.dependencies.every(p=>p instanceof U?u.facet(p)===f.facet(p):p instanceof Ml?u.field(p,!1)==f.field(p,!1):!0)||(l?zk(d,m,n):n(d,m)))return f.values[o]=m,0}return f.values[o]=d,1}}}};function zk(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function b1(s,t){let e=!1;for(let i of t)qh(s,i)&1&&(e=!0);return e}function L6(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=yd(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)qh(h,a);return h.values[o]=l(h),1},update(h,a){if(!b1(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=b1(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&Vb(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const qk=U.define({static:!0});let Ml=class pB{constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new pB(Lb++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(qk).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,qk.of({field:this,create:t})]}get extension(){return this}};const so={lowest:4,low:3,default:2,high:1,highest:0};function Fl(s){return t=>new yB(t,s)}const mB={highest:Fl(so.highest),high:Fl(so.high),default:Fl(so.default),low:Fl(so.low),lowest:Fl(so.lowest)};let yB=class{constructor(t,e){this.inner=t,this.prec=e}},wB=class bB{of(t){return new x1(this,t)}reconfigure(t){return bB.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}},x1=class{constructor(t,e){this.compartment=t,this.inner=e}},Kk=class xB{constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of V6(t,e,o))u instanceof Ml?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,Vb(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>L6(p,g,d))}}let f=a.map(u=>u(l));return new xB(t,o,f,l,h,r)}};function V6(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof x1&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof x1){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof yB)r(o.inner,o.prec);else if(o instanceof Ml)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof wu)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,so.default),i.reduce((o,l)=>o.concat(l))}function qh(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function yd(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const SB=U.define(),vB=U.define({combine:s=>s.some(t=>t),static:!0}),kB=U.define({combine:s=>s.length?s[0]:void 0,static:!0}),AB=U.define(),CB=U.define(),MB=U.define(),DB=U.define({combine:s=>s.length?s[0]:!1});let dc=class{constructor(t,e){this.type=t,this.value=e}static define(){return new I6}},I6=class{of(t){return new dc(this,t)}},N6=class{constructor(t){this.map=t}of(t){return new qt(this,t)}},qt=class OB{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new OB(this.type,e)}is(t){return this.type==t}static define(t={}){return new N6(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}};qt.reconfigure=qt.define();qt.appendConfig=qt.define();let pn=class uh{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&dB(i,e.newLength),r.some(l=>l.type==uh.time)||(this.annotations=r.concat(uh.time.of(Date.now())))}static create(t,e,i,n,r,o){return new uh(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(uh.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}};pn.time=dc.define();pn.userEvent=dc.define();pn.addToHistory=dc.define();pn.remote=dc.define();function H6(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function TB(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=ls.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:qt.mapEffects(s.effects,n).concat(qt.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function S1(s,t,e){let i=t.selection,n=No(t.annotations);return t.userEvent&&(n=n.concat(pn.userEvent.of(t.userEvent))),{changes:t.changes instanceof ls?t.changes:ls.of(t.changes||[],e,s.facet(kB)),selection:i&&(i instanceof V?i:V.single(i.anchor,i.head)),effects:No(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function $B(s,t,e){let i=S1(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=TB(i,S1(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=pn.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return W6(e?F6(n):n)}function F6(s){let t=s.startState,e=!0;for(let n of t.facet(AB)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:H6(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=ls.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.invertedDesc}s=pn.create(t,n,s.selection&&s.selection.map(r),qt.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(CB);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof pn?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof pn?s=r[0]:s=$B(t,No(r),!1)}return s}function W6(s){let t=s.startState,e=t.facet(MB),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=TB(s,S1(t,r,s.changes.newLength),!0))}return i==s?s:pn.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const z6=[];function No(s){return s==null?z6:Array.isArray(s)?s:[s]}var Mi=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(Mi||(Mi={}));const q6=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let v1;try{v1=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function K6(s){if(v1)return v1.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||q6.test(e)))return!0}return!1}function G6(s){return t=>{if(!/\S/.test(t))return Mi.Space;if(K6(t))return Mi.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return Mi.Word;return Mi.Other}}let ii=class Ki{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)qh(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return qh(this,i),yd(this,i)}update(...t){return $B(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(wB.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(qt.reconfigure)?(e=null,i=o.value):o.is(qt.appendConfig)&&(e=null,i=No(i).concat(o.value));let r;e?r=t.startState.values.slice():(e=Kk.resolve(i,n,this),r=new Ki(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new Ki(e,t.newDoc,t.newSelection,r,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:V.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=No(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=qt.mapEffects(o,c).concat(qt.mapEffects(No(h.effects),f))}return{changes:n,selection:V.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof ls?t:ls.of(t,this.doc.length,this.facet(Ki.lineSeparator))}toText(t){return yt.of(t.split(this.facet(Ki.lineSeparator)||p1))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(qh(this,e),yd(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof Ml&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}return Ki.create({doc:t.doc,selection:V.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=Kk.resolve(t.extensions||[],new Map),i=t.doc instanceof yt?t.doc:yt.of((t.doc||"").split(e.staticFacet(Ki.lineSeparator)||p1)),n=t.selection?t.selection instanceof V?t.selection:V.single(t.selection.anchor,t.selection.head):V.single(0);return dB(n,i.length),e.staticFacet(vB)||(n=n.asSingle()),new Ki(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(Ki.tabSize)}get lineBreak(){return this.facet(Ki.lineSeparator)||`
`}get readOnly(){return this.facet(DB)}phrase(t,...e){for(let i of this.facet(Ki.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(SB))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return G6(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=Gs(e,o,!1);if(r(e.slice(h,o))!=Mi.Word)break;o=h}for(;l<n;){let h=Gs(e,l);if(r(e.slice(l,h))!=Mi.Word)break;l=h}return o==l?null:V.range(o+i,l+i)}};ii.allowMultipleSelections=vB;ii.tabSize=U.define({combine:s=>s.length?s[0]:4});ii.lineSeparator=kB;ii.readOnly=DB;ii.phrases=U.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});ii.languageData=SB;ii.changeFilter=AB;ii.transactionFilter=CB;ii.transactionExtender=MB;wB.reconfigure=qt.define();function j6(s,t,e={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}let hl=class{eq(t){return this==t}range(t,e=t){return k1.create(t,e,this)}};hl.prototype.startSide=hl.prototype.endSide=0;hl.prototype.point=!1;hl.prototype.mapMode=xi.TrackDel;let k1=class RB{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new RB(t,e,i)}};function A1(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}let U6=class BB{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new BB(n,r,i,l):null,pos:o}}},oi=class ro{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new ro(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(A1)),this.isEmpty)return e.length?ro.of(e):this;let l=new PB(this,null,-1).goto(0),h=0,a=[],c=new C1;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(k1.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?ro.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new ro(i,e,r||ro.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return M1.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return M1.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=Gk(o,l,i),a=new Wl(o,h,r),c=new Wl(l,h,r);i.iterGaps((f,u,d)=>jk(a,f,c,u,d,n)),i.empty&&i.length==0&&jk(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=Gk(r,o),h=new Wl(r,l,0).goto(i),a=new Wl(o,l,0).goto(i);for(;;){if(h.to!=a.to||!D1(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new Wl(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new C1;for(let n of t instanceof k1?[t]:e?J6(t):t)i.add(n.from,n.to,n.value);return i.finish()}};oi.empty=new oi([],[],null,-1);function J6(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(A1(t,i)>0)return s.slice().sort(A1);t=i}return s}oi.empty.nextLayer=oi.empty;let C1=class EB{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new U6(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new EB)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(oi.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=oi.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}};function Gk(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}let PB=class{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}},M1=class LB{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new PB(o,e,i,r));return n.length==1?n[0]:new LB(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)lp(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)lp(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),lp(this.heap,0)}}};function lp(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}let Wl=class{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=M1.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Qc(this.active,t),Qc(this.activeTo,t),Qc(this.activeRank,t),this.minActive=Uk(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;_c(this.active,e,i),_c(this.activeTo,e,n),_c(this.activeRank,e,r),t&&_c(t,e,this.cursor.from),this.minActive=Uk(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&Qc(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}};function jk(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to||s.endSide-e.endSide,c=a<0?s.to+h:e.to,f=Math.min(c,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&D1(s.activeForPoint(s.to+h),e.activeForPoint(e.to))||r.comparePoint(l,f,s.point,e.point):f>l&&!D1(s.active,e.active)&&r.compareRange(l,f,s.active,e.active),c>o)break;l=c,a<=0&&s.next(),a>=0&&e.next()}}function D1(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function Qc(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function _c(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function Uk(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function Y6(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=Gs(s,n)}return s.length}function wd(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function al(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function X6(){let s=document.activeElement;for(;s&&s.shadowRoot;)s=s.shadowRoot.activeElement;return s}function O1(s,t){if(!t.anchorNode)return!1;try{return al(s,t.anchorNode)}catch{return!1}}function Ta(s){return s.nodeType==3?$a(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function bd(s,t,e,i){return e?Jk(s,t,e,i,-1)||Jk(s,t,e,i,1):!1}function T1(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function Jk(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:xd(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=T1(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?xd(s):0}else return!1}}function xd(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}const VB={left:0,right:0,top:0,bottom:0};function ag(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function Z6(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function Q6(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView;for(let c=s;c;)if(c.nodeType==1){let f,u=c==h.body;if(u)f=Z6(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let m=c.getBoundingClientRect();f={left:m.left,right:m.left+c.clientWidth,top:m.top,bottom:m.top+c.clientHeight}}let d=0,g=0;if(n=="nearest")t.top<f.top?(g=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+g&&(g=t.bottom-f.bottom+g+o)):t.bottom>f.bottom&&(g=t.bottom-f.bottom+o,e<0&&t.top-g<f.top&&(g=-(f.top+g-t.top+o)));else{let m=t.bottom-t.top,p=f.bottom-f.top;g=(n=="center"&&m<=p?t.top+m/2-p/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-p+o)-f.top}if(i=="nearest"?t.left<f.left?(d=-(f.left-t.left+r),e>0&&t.right>f.right+d&&(d=t.right-f.right+d+r)):t.right>f.right&&(d=t.right-f.right+r,e<0&&t.left<f.left+d&&(d=-(f.left+d-t.left+r))):d=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,d||g)if(u)a.scrollBy(d,g);else{if(g){let m=c.scrollTop;c.scrollTop+=g,g=c.scrollTop-m}if(d){let m=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-m}t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(u)break;c=c.assignedSlot||c.parentNode,i=n="nearest"}else if(c.nodeType==11)c=c.host;else break}let _6=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}},Gr=null;function IB(s){if(s.setActive)return s.setActive();if(Gr)return s.focus(Gr);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(Gr==null?{get preventScroll(){return Gr={preventScroll:!0},!0}}:void 0),!Gr){Gr=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let Yk;function $a(s,t,e=t){let i=Yk||(Yk=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function Kh(s,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function t9(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function NB(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}let Ze=class $1{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new $1(t.parentNode,T1(t),e)}static after(t,e){return new $1(t.parentNode,T1(t)+1,e)}};const Ib=[];let ee=class R1{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let r of this.children){if(r.dirty){if(!r.dom&&(n=i?i.nextSibling:e.firstChild)){let o=R1.get(n);(!o||!o.parent&&o.constructor==r.constructor)&&r.reuseDOM(n)}r.sync(t),r.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=r.dom&&(t.written=!0),r.dom.parentNode==e)for(;n&&n!=r.dom;)n=Xk(n);else e.insertBefore(r.dom,n);i=r.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=Xk(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=xd(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!R1.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Ib){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new HB(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}};ee.prototype.breakAfter=0;function Xk(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}let HB=class{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function FB(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function WB(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,FB(s,a,c,l,h,i,0,n,r)}let Si=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},B1=typeof document<"u"?document:{documentElement:{style:{}}};const E1=/Edge\/(\d+)/.exec(Si.userAgent),zB=/MSIE \d/.test(Si.userAgent),P1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Si.userAgent),cg=!!(zB||P1||E1),Zk=!cg&&/gecko\/(\d+)/i.test(Si.userAgent),hp=!cg&&/Chrome\/(\d+)/.exec(Si.userAgent),e9="webkitFontSmoothing"in B1.documentElement.style,qB=!cg&&/Apple Computer/.test(Si.vendor),Qk=qB&&(/Mobile\/\w+/.test(Si.userAgent)||Si.maxTouchPoints>2);var $={mac:Qk||/Mac/.test(Si.platform),windows:/Win/.test(Si.platform),linux:/Linux|X11/.test(Si.platform),ie:cg,ie_version:zB?B1.documentMode||6:P1?+P1[1]:E1?+E1[1]:0,gecko:Zk,gecko_version:Zk?+(/Firefox\/(\d+)/.exec(Si.userAgent)||[0,0])[1]:0,chrome:!!hp,chrome_version:hp?+hp[1]:0,ios:Qk,android:/Android\b/.test(Si.userAgent),safari:qB,webkit_version:e9?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:B1.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const i9=256;let Ra=class L1 extends ee{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof L1)||this.length-(e-t)+i.length>i9)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new L1(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Ze(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return I1(this.dom,t,e)}},Tr=class V1 extends ee{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(NB(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,r,o){return i&&(!(i instanceof V1&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(WB(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new V1(this.mark,e,o)}domAtPos(t){return jB(this.dom,this.children,t)}coordsAt(t,e){return JB(this,t,e)}};function I1(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?$.chrome||$.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=$a(s,n,r).getClientRects();if(!l.length)return VB;let h=l[(o?o<0:e>=0)?0:l.length-1];return $.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?ag(h,o<0):h||null}let Nb=class dh extends ee{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||dh)(t,e,i)}split(t){let e=dh.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof dh)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof dh&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return yt.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):yt.empty}domAtPos(t){return t==0?Ze.before(this.dom):Ze.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return VB;for(let r=t>0?i.length-1:0;n=i[r],!(t>0?r==0:r==i.length-1||n.top<n.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:ag(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},KB=class extends Nb{domAtPos(t){let{topView:e,text:i}=this.widget;return e?N1(t,0,e,i,(n,r)=>n.domAtPos(r),n=>new Ze(i,Math.min(n,i.nodeValue.length))):new Ze(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?GB(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?N1(t,e,i,n,(r,o,l)=>r.coordsAt(o,l),(r,o)=>I1(n,r,o)):I1(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}};function N1(s,t,e,i,n,r){if(e instanceof Tr){for(let o of e.children){let l=al(o.dom,i),h=l?i.nodeValue.length:o.length;if(s<h||s==h&&o.getSide()<=0)return l?N1(s,t,o,i,n,r):n(o,s,t);s-=h}return n(e,e.length,-1)}else return e.dom==i?r(s,t):n(e,s,t)}function GB(s,t,e,i){if(e instanceof Tr)for(let n of e.children){let r=0,o=al(n.dom,i);if(al(n.dom,s))return r+(o?GB(s,t,n,i):n.localPosFromDOM(s,t));r+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(s,t)}let H1=class F1 extends ee{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof F1&&t.side==this.side}split(){return new F1(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Ze.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=n9(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return yt.empty}};Ra.prototype.children=Nb.prototype.children=H1.prototype.children=Ib;function n9(s,t){let e=s.parent,i=e?e.children.indexOf(s):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof Ra){let r=n.coordsAt(t<0?n.length:0,t);if(r)return r}i+=t}else if(e instanceof Tr&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function jB(s,t,e){let i=0;for(let n=0;i<t.length;i++){let r=t[i],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(e>n&&e<o&&r.dom.parentNode==s)return r.domAtPos(e-n);if(e<=n)break;n=o}}for(;i>0;i--){let n=t[i-1].dom;if(n.parentNode==s)return Ze.after(n)}return new Ze(s,0)}function UB(s,t,e){let i,{children:n}=s;e>0&&t instanceof Tr&&n.length&&(i=n[n.length-1])instanceof Tr&&i.mark.eq(t.mark)?UB(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function JB(s,t,e){for(let r=0,o=0;o<s.children.length;o++){let l=s.children[o],h=r+l.length,a;if((e<=0||h==s.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==s.children.length||(a=s.children[o+1]).length||a.getSide()>0)){let c=0;if(h==r){if(l.getSide()<=0)continue;c=e=-l.getSide()}let f=l.coordsAt(Math.max(0,t-r),e);return c&&f?ag(f,e<0):f}r=h}let i=s.dom.lastChild;if(!i)return s.dom.getBoundingClientRect();let n=Ta(i);return n[n.length-1]||null}function W1(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}function Hb(s,t){if(s==t)return!0;if(!s||!t)return!1;let e=Object.keys(s),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||s[n]!==t[n])return!1;return!0}function z1(s,t,e){let i=null;if(t)for(let n in t)e&&n in e||s.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||s.setAttribute(i=n,e[n]);return!!i}let fg=class{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}};var Jt=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(Jt||(Jt={}));let Z=class extends hl{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new YB(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Ba(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=_B(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new Ba(t,i,n,e,t.widget||null,!0)}static line(t){return new Fb(t)}static set(t,e=!1){return oi.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};Z.none=oi.empty;let YB=class XB extends Z{constructor(t){let{start:e,end:i}=_B(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof XB&&this.tagName==t.tagName&&this.class==t.class&&Hb(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}};YB.prototype.point=!1;let Fb=class ZB extends Z{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof ZB&&Hb(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}};Fb.prototype.mapMode=xi.TrackBefore;Fb.prototype.point=!0;let Ba=class QB extends Z{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?xi.TrackBefore:xi.TrackAfter:xi.TrackDel}get type(){return this.startSide<this.endSide?Jt.WidgetRange:this.startSide<=0?Jt.WidgetBefore:Jt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof QB&&s9(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}};Ba.prototype.point=!0;function _B(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function s9(s,t){return s==t||!!(s&&t&&s.compare(t))}function q1(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}let rn=class bu extends ee{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof bu))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),WB(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new bu;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Hb(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){UB(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=W1(e,this.attrs||{})),i&&(this.attrs=W1({class:i},this.attrs||{}))}domAtPos(t){return jB(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(NB(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(z1(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&ee.get(i)instanceof Tr;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=ee.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!$.ios||!this.children.some(n=>n instanceof Ra))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Ra))return null;let i=Ta(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return JB(this,t,e)}become(t){return!1}get type(){return Jt.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof bu)return r;if(o>e)break}n=o+r.breakAfter}return null}},K1=class xu extends ee{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof xu)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?Ze.before(this.dom):Ze.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new xu(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Ib}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):yt.empty}domBoundsAround(){return null}become(t){return t instanceof xu&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},r9=class tE{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof K1&&t.type==Jt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new rn),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(tf(new H1(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(tf(new Ra(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof Ba){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof Ba)if(i.block){let{type:h}=i;h==Jt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new K1(i.widget||new _k("div"),l,h))}else{let h=Nb.create(i.widget||new _k("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(tf(new H1(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(tf(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new tE(t,e,i,r);return o.openEnd=oi.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function tf(s,t){for(let e of t)s=new Tr(e,[s],s.length);return s}let _k=class extends fg{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}};const eE=U.define(),iE=U.define(),nE=U.define(),sE=U.define(),G1=U.define(),rE=U.define(),oE=U.define({combine:s=>s.some(t=>t)});let t2=class lE{constructor(t,e="nearest",i="nearest",n=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r}map(t){return t.empty?this:new lE(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}};const e2=qt.define({map:(s,t)=>s.map(t)});function kr(s,t,e){let i=s.facet(sE);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const gc=U.define({combine:s=>s.length?s[0]:!0});let o9=0;const gh=U.define();let ug=class j1{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:r}=e||{};return new j1(o9++,t,i,o=>{let l=[gh.of(o)];return r&&l.push(Ea.of(h=>{let a=h.plugin(o);return a?r(a):Z.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return j1.define(i=>new t(i),e)}},ap=class{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(kr(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){kr(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){kr(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const hE=U.define(),aE=U.define(),Ea=U.define(),cE=U.define(),fE=U.define(),ph=U.define();let Pa=class Su{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new Su(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new Su(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new Su(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}},i2=class uE{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=ls.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new Pa(o,l,h,a))),this.changedRanges=n;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}static create(t,e,i){return new uE(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}};var He=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(He||(He={}));const U1=He.LTR,l9=He.RTL;function dE(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const h9=dE("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),a9=dE("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),J1=Object.create(null),Dn=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);J1[t]=e,J1[e]=-t}function c9(s){return s<=247?h9[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?a9[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||s==8204?256:1}const f9=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;let Ho=class{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?l9:U1}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};const Dt=[];function u9(s,t){let e=s.length,i=t==U1?1:2,n=t==U1?2:1;if(!s||i==1&&!f9.test(s))return gE(e);for(let o=0,l=i,h=i;o<e;o++){let a=c9(s.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),Dt[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=Dt[o];if(a==128)o<e-1&&l==Dt[o+1]&&l&24?a=Dt[o]=l:Dt[o]=256;else if(a==64){let c=o+1;for(;c<e&&Dt[c]==64;)c++;let f=o&&l==8||c<e&&Dt[c]==8?h==1?1:8:256;for(let u=o;u<c;u++)Dt[u]=f;o=c-1}else a==8&&h==1&&(Dt[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,c,f;o<e;o++)if(c=J1[a=s.charCodeAt(o)])if(c<0){for(let u=l-3;u>=0;u-=3)if(Dn[u+1]==-c){let d=Dn[u+2],g=d&2?i:d&4?d&1?n:i:0;g&&(Dt[o]=Dt[Dn[u]]=g),l=u;break}}else{if(Dn.length==189)break;Dn[l++]=o,Dn[l++]=a,Dn[l++]=h}else if((f=Dt[o])==2||f==1){let u=f==i;h=u?0:1;for(let d=l-3;d>=0;d-=3){let g=Dn[d+2];if(g&2)break;if(u)Dn[d+2]|=2;else{if(g&4)break;Dn[d+2]|=4}}}for(let o=0;o<e;o++)if(Dt[o]==256){let l=o+1;for(;l<e&&Dt[l]==256;)l++;let h=(o?Dt[o-1]:i)==1,a=(l<e?Dt[l]:i)==1,c=h==a?h?1:2:i;for(let f=o;f<l;f++)Dt[f]=c;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=Dt[o++]!=1;for(;o<e&&h==(Dt[o]!=1);)o++;if(h)for(let a=o;a>l;){let c=a,f=Dt[--a]!=2;for(;a>l&&f==(Dt[a-1]!=2);)a--;r.push(new Ho(a,c,f?2:1))}else r.push(new Ho(l,o,0))}else for(let o=0;o<e;){let l=o,h=Dt[o++]==2;for(;o<e&&h==(Dt[o]==2);)o++;r.push(new Ho(l,o,h?1:2))}return r}function gE(s){return[new Ho(0,s,0)]}let pE="";function d9(s,t,e,i,n){var r;let o=i.head-s.from,l=-1;if(o==0){if(!n||!s.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==s.length){if(n)return null;let u=t[t.length-1];u.level!=e&&(o=u.side(!0,e),l=t.length-1)}l<0&&(l=Ho.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),c=Gs(s.text,o,a);if(pE=s.text.slice(Math.min(o,c),Math.max(o,c)),c!=h.side(n,e))return V.cursor(c+s.from,a?-1:1,h.level);let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!f&&h.level!=e?V.cursor(n?s.to:s.from,n?-1:1,e):f&&f.level<h.level?V.cursor(f.side(!n,e)+s.from,n?1:-1,f.level):V.cursor(c+s.from,n?-1:1,h.level)}const js="￿";let mE=class{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(ii.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=js}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let r=n.nextSibling;if(r==e)break;let o=ee.get(n),l=ee.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:n2(n))||n2(r)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=r}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=ee.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}};function n2(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}let s2=class{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}},r2=class extends ee{constructor(t){super(),this.view=t,this.compositionDeco=Z.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new rn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Pa(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Z.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=p9(this.view,t.changes)),($.ie||$.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),r=b9(i,n,t.changes);return e=Pa.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let r=$.chrome||$.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof K1&&r.widget instanceof o2&&n.push(r.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let r=n>=0?t[n]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:c,breakAtStart:f,openStart:u,openEnd:d}=r9.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:g,off:m}=i.findPos(l,1),{i:p,off:y}=i.findPos(o,-1);FB(this,p,y,g,m,c,f,u,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||$.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),o=n.empty?r:this.domAtPos(n.head);if($.gecko&&n.empty&&g9(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new Ze(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!bd(r.node,r.offset,l.anchorNode,l.anchorOffset)||!bd(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{$.android&&$.chrome&&this.dom.contains(l.focusNode)&&x9(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=wd(this.root);if(n.empty){if($.gecko){let a=y9(r.node,r.offset);if(a&&a!=3){let c=wE(r.node,r.offset,a==1?1:-1);c&&(r=new Ze(c,a==1?0:c.nodeValue.length))}}h.collapse(r.node,r.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new Ze(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new Ze(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=wd(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=rn.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(gc)?this.root.activeElement==this.dom:O1(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=ee.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof rn)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=Jt.WidgetBefore&&r.type!=Jt.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==Jt.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==He.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?Ta(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?He.RTL:He.LTR}measureTextSize(){for(let n of this.children)if(n instanceof rn){let r=n.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=Ta(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new HB(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(Z.replace({widget:new o2(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return Z.set(t)}updateDeco(){let t=this.view.state.facet(Ea).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=0,o=0,l=0,h=0;for(let c of this.view.state.facet(fE).map(f=>f(this.view)))if(c){let{left:f,right:u,top:d,bottom:g}=c;f!=null&&(r=Math.max(r,f)),u!=null&&(o=Math.max(o,u)),d!=null&&(l=Math.max(l,d)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};Q6(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==He.LTR)}};function g9(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}let o2=class extends fg{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function yE(s){let t=s.observer.selectionRange,e=t.focusNode&&wE(t.focusNode,t.focusOffset,0);if(!e)return null;let i=s.docView.nearest(e);if(!i)return null;if(i instanceof rn){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let r=n.previousSibling;for(;r&&!ee.get(r);)r=r.previousSibling;let o=r?ee.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof rn)break;i=r}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function p9(s,t){let e=yE(s);if(!e)return Z.none;let{from:i,to:n,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=s,c=r.nodeType==3?r.nodeValue:new mE([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),js)==c)h=l+c.length;else if(a.doc.sliceString(Math.max(0,h-c.length),h,js)==c)l=h-c.length;else return Z.none;else if(a.doc.sliceString(l,h,js)!=c)return Z.none;let f=ee.get(r);return f instanceof KB?f=f.widget.topView:f&&(f.parent=null),Z.set(Z.replace({widget:new m9(r,o,f),inclusive:!0}).range(l,h))}let m9=class extends fg{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return KB}};function wE(s,t,e){for(;;){if(s.nodeType==3)return s;if(s.nodeType==1&&t>0&&e<=0)s=s.childNodes[t-1],t=xd(s);else if(s.nodeType==1&&t<s.childNodes.length&&e>=0)s=s.childNodes[t],t=0;else return null}}function y9(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let w9=class{constructor(){this.changes=[]}compareRange(t,e){q1(t,e,this.changes)}comparePoint(t,e){q1(t,e,this.changes)}};function b9(s,t,e){let i=new w9;return oi.compare(s,t,e,i),i.changes}function x9(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function S9(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return V.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=Gs(n.text,r,!1):l=Gs(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=Gs(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=Gs(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return V.range(o+n.from,l+n.from)}function v9(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function k9(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function cp(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function l2(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function h2(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function Y1(s,t,e){let i,n,r,o,l,h,a,c;for(let d=s.firstChild;d;d=d.nextSibling){let g=Ta(d);for(let m=0;m<g.length;m++){let p=g[m];n&&cp(n,p)&&(p=l2(h2(p,n.bottom),n.top));let y=v9(t,p),w=k9(e,p);if(y==0&&w==0)return d.nodeType==3?a2(d,t,e):Y1(d,t,e);(!i||o>w||o==w&&r>y)&&(i=d,n=p,r=y,o=w),y==0?e>p.bottom&&(!a||a.bottom<p.bottom)?(l=d,a=p):e<p.top&&(!c||c.top>p.top)&&(h=d,c=p):a&&cp(a,p)?a=h2(a,p.bottom):c&&cp(c,p)&&(c=l2(c,p.top))}}if(a&&a.bottom>=e?(i=l,n=a):c&&c.top<=e&&(i=h,n=c),!i)return{node:s,offset:0};let f=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return a2(i,f,e);if(!r&&i.contentEditable=="true")return Y1(i,f,e);let u=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:u}}function a2(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=$a(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if(($.chrome||$.gecko)&&$a(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function bE(s,{x:t,y:e},i,n=-1){var r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,c=e-l;if(c<0)return 0;if(c>a)return s.state.doc.length;for(let y=s.defaultLineHeight/2,w=!1;h=s.elementAtHeight(c),h.type!=Jt.Text;)for(;c=n>0?h.bottom+y:h.top-y,!(c>=0&&c<=a);){if(w)return i?null:0;w=!0,n=-n}e=l+c;let f=h.from;if(f<s.viewport.from)return s.viewport.from==0?0:i?null:c2(s,o,h,t,e);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:i?null:c2(s,o,h,t,e);let u=s.dom.ownerDocument,d=s.root.elementFromPoint?s.root:u,g=d.elementFromPoint(t,e);g&&!s.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=d.elementFromPoint(t,e),g&&!s.contentDOM.contains(g)&&(g=null));let m,p=-1;if(g&&((r=s.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(u.caretPositionFromPoint){let y=u.caretPositionFromPoint(t,e);y&&({offsetNode:m,offset:p}=y)}else if(u.caretRangeFromPoint){let y=u.caretRangeFromPoint(t,e);y&&({startContainer:m,startOffset:p}=y,$.safari&&A9(m,p,t)&&(m=void 0))}}if(!m||!s.docView.dom.contains(m)){let y=rn.find(s.docView,f);if(!y)return c>h.top+h.height/2?h.to:h.from;({node:m,offset:p}=Y1(y.dom,t,e))}return s.docView.posFromDOM(m,p)}function c2(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=Math.floor((n-e.top)/s.defaultLineHeight);r+=l*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+Y6(o,r,s.state.tabSize)}function A9(s,t,e){let i;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return $a(s,i-1,i).getBoundingClientRect().left>e}function C9(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=!i||!s.lineWrapping?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let h=s.dom.getBoundingClientRect(),a=s.textDirectionAt(n.from),c=s.posAtCoords({x:e==(a==He.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(c!=null)return V.cursor(c,e?-1:1)}let o=rn.find(s.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return V.cursor(l,e?-1:1)}function f2(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=d9(n,r,o,l,e),c=pE;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=V.cursor(e?n.from:n.to)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function M9(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==Mi.Space&&(n=o),n==o}}function D9(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return V.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.defaultLineHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=bE(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n))return V.cursor(m,t.assoc,void 0,o)}}function fp(s,t,e){let i=s.state.facet(cE).map(n=>n(s));for(;;){let n=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?V.cursor(o,1):V.cursor(l,-1),n=!0)});if(!n)return e}}let O9=class{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in ce){let i=ce[e];t.contentDOM.addEventListener(e,n=>{!u2(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))}),this.registeredEvents.push(e)}$.chrome&&$.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,$.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let r of e)if(n=(i=r.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{u2(t,l)&&this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let r=n.handlers[t];if(r)try{if(r.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){kr(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(r){kr(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if($.android&&$.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return $.ios&&(i=xE.find(n=>n.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Kh(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:$.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!$.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};const xE=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],SE=[16,17,18,20,91,92,224,225];let T9=class{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(ii.allowMultipleSelections)&&$9(t,e),this.dragMove=R9(t,e),this.dragging=B9(t,e)&&Wb(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}};function $9(s,t){let e=s.state.facet(eE);return e.length?e[0](t):$.mac?t.metaKey:t.ctrlKey}function R9(s,t){let e=s.state.facet(iE);return e.length?e[0](t):$.mac?!t.altKey:!t.ctrlKey}function B9(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=wd(s.root);if(i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function u2(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=ee.get(e))&&i.ignoreEvent(t))return!1;return!0}const ce=Object.create(null),vE=$.ie&&$.ie_version<15||$.ios&&$.webkit_version<604;function E9(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),kE(s,e.value)},50)}function kE(s,t){let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(X1!=null&&e.selection.ranges.every(h=>h.empty)&&X1==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:V.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:V.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ce.keydown=(s,t)=>{s.inputState.setSelectionOrigin("select"),t.keyCode==27?s.inputState.lastEscPress=Date.now():SE.indexOf(t.keyCode)<0&&(s.inputState.lastEscPress=0)};let AE=0;ce.touchstart=(s,t)=>{AE=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};ce.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};ce.mousedown=(s,t)=>{if(s.observer.flush(),AE>Date.now()-2e3&&Wb(t)==1)return;let e=null;for(let i of s.state.facet(nE))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=V9(s,t)),e){let i=s.root.activeElement!=s.contentDOM;i&&s.observer.ignore(()=>IB(s.contentDOM)),s.inputState.startMouseSelection(new T9(s,t,e,i))}};function d2(s,t,e,i){if(i==1)return V.cursor(t,e);if(i==2)return S9(s.state,t,e);{let n=rn.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,V.range(o,l)}}let CE=(s,t)=>s>=t.top&&s<=t.bottom,g2=(s,t,e)=>CE(t,e)&&s>=e.left&&s<=e.right;function P9(s,t,e,i){let n=rn.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&g2(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&g2(e,i,l)?1:o&&CE(i,o)?-1:1}function p2(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:P9(s,e,t.clientX,t.clientY)}}const L9=$.ie&&$.ie_version<=11;let m2=null,y2=0,w2=0;function Wb(s){if(!L9)return s.detail;let t=m2,e=w2;return m2=s,w2=Date.now(),y2=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(y2+1)%3:1}function V9(s,t){let e=p2(s,t),i=Wb(t),n=s.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),n=n.map(l.changes),o=null)},get(l,h,a){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=r:(c=r=p2(s,l),o=l),!c||!e)return n;let f=d2(s,c.pos,c.bias,i);if(e.pos!=c.pos&&!h){let u=d2(s,e.pos,e.bias,i),d=Math.min(u.from,f.from),g=Math.max(u.to,f.to);f=d<f.from?V.range(d,g):V.range(g,d)}return h?n.replaceRange(n.main.extend(f.from,f.to)):a?n.addRange(f):V.create([f])}}}ce.dragstart=(s,t)=>{let{selection:{main:e}}=s.state,{mouseSelection:i}=s.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",s.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function b2(s,t,e,i){if(!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=s.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}ce.drop=(s,t)=>{if(!t.dataTransfer)return;if(s.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,r=()=>{++n==e.length&&b2(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else b2(s,t,t.dataTransfer.getData("Text"),!0)};ce.paste=(s,t)=>{if(s.state.readOnly)return t.preventDefault();s.observer.flush();let e=vE?null:t.clipboardData;e?(kE(s,e.getData("text/plain")),t.preventDefault()):E9(s)};function I9(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function N9(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(s.lineBreak),ranges:e,linewise:i}}let X1=null;ce.copy=ce.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=N9(s.state);if(!e&&!n)return;X1=n?e:null;let r=vE?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):I9(s,e),t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function ME(s){setTimeout(()=>{s.hasFocus!=s.inputState.notifiedFocused&&s.update([])},10)}ce.focus=ME;ce.blur=s=>{s.observer.clearSelectionRange(),ME(s)};function DE(s,t){if(s.docView.compositionDeco.size){s.inputState.rapidCompositionStart=t;try{s.update([])}finally{s.inputState.rapidCompositionStart=!1}}}ce.compositionstart=ce.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0,s.docView.compositionDeco.size&&(s.observer.flush(),DE(s,!0)))};ce.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionFirstChange=null,setTimeout(()=>{s.inputState.composing<0&&DE(s,!1)},50)};ce.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};ce.beforeinput=(s,t)=>{var e;let i;if($.chrome&&$.android&&(i=xE.find(n=>n.inputType==t.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}};const x2=["pre-wrap","normal","pre-line","break-spaces"];let H9=class{constructor(){this.doc=yt.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return x2.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r){let o=x2.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<r.length;h++){let a=r[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}},F9=class{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}},bo=class OE{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new OE(this.from,this.length+t.length,this.top,this.height+t.height,e)}};var at=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(at||(at={}));const vu=.001;let _n=class ku{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>vu&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return ku.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:c}=n[o],f=r.lineAt(l,at.ByPosNoHeight,e,0,0),u=f.to>=h?f:r.lineAt(h,at.ByPosNoHeight,e,0,0);for(c+=u.to-h,h=u.to;o>0&&f.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<f.from&&(f=r.lineAt(l,at.ByPosNoHeight,e,0,0));a+=f.from-l,l=f.from;let d=q9.build(i,t,a,c);r=r.replace(l,h,d)}return r.updateHeight(i,0)}static empty(){return new Wn(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new W9(ku.of(t.slice(0,e)),o,ku.of(t.slice(i)))}};_n.prototype.size=1;let TE=class extends _n{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new bo(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Wn=class Z1 extends TE{constructor(t,e){super(t,e,Jt.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof Z1||n instanceof Fo&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Fo?n=new Z1(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):_n.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},Fo=class Gi extends _n{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:c}=e.line(r+h);return new bo(a,c,i+l*h,l,Jt.Text)}lineAt(t,e,i,n,r){if(e==at.ByHeight)return this.blockAt(t,i,n,r);if(e==at.ByPosNoHeight){let{from:f,to:u}=i.lineAt(t);return new bo(f,u-f,0,0,Jt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:c}=i.lineAt(t);return new bo(h,a,n+l*(c-o),l,Jt.Text)}forEachLine(t,e,i,n,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),c=Math.min(r+this.length,e);a<=c;){let f=i.lineAt(a);a==t&&(n+=h*(f.number-l)),o(new bo(f.from,f.length,n,h,Jt.Text)),n+=h,a=f.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof Gi?i[i.length-1]=new Gi(r.length+n):i.push(null,new Gi(n-1))}if(t>0){let r=i[0];r instanceof Gi?i[0]=new Gi(t+r.length):i.unshift(new Gi(t-1),null)}return _n.of(i)}decomposeLeft(t,e){e.push(new Gi(t-1),null)}decomposeRight(t,e){e.push(null,new Gi(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new Gi(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let f=t.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];h==-1?h=u:Math.abs(u-h)>=vu&&(h=-2);let d=new Wn(f,u);d.outdated=!1,o.push(d),l+=f+1}l<=r&&o.push(null,new Gi(r-l).updateHeight(t,l));let c=_n.of(o);return t.heightChanged=a||h<0||Math.abs(c.height-this.height)>=vu||Math.abs(h-this.lines(t.doc,e).lineHeight)>=vu,c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},W9=class extends _n{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==at.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==at.ByPosNoHeight?at.ByPosNoHeight:at.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,at.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&S2(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),S2(r,l)}return _n.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?_n.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function S2(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof Fo&&(i=s[t+1])instanceof Fo&&s.splice(t-1,3,new Fo(e.length+1+i.length))}const z9=5;let q9=class $E{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Wn?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Wn(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new TE(r,n,i.type)):(r||n>=z9)&&this.addLineDeco(n,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Wn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Fo(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Wn)return t;let e=new Wn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==Jt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Jt.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Wn)&&!this.isCovered?this.nodes.push(new Wn(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof Wn&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new $E(i,t);return oi.spans(e,i,n,r,0),r.finish(i)}};function K9(s,t,e){let i=new G9;return oi.compare(s,t,e,i,0),i.changes}let G9=class{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&q1(t,e,this.changes,5)}};function j9(s,t){let e=s.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=s.ownerDocument.body;for(let h=s.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,c=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&c.overflow!="visible"){let f=a.getBoundingClientRect();i=Math.max(i,f.left),n=Math.min(n,f.right),r=Math.max(r,f.top),o=Math.min(o,f.bottom)}h=c.position=="absolute"||c.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}function U9(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}let up=class{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t){return Z.replace({widget:new J9(this.size,t)}).range(this.from,this.to)}},J9=class extends fg{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}},v2=class{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new H9,this.scaler=C2,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=He.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Ea).filter(e=>typeof e!="function"),this.heightMap=_n.empty().applyChanges(this.stateDeco,yt.empty,this.heightOracle.setDoc(t.doc),[new Pa(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Z.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new ef(r,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?C2:new Z9(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:mh(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ea).filter(a=>typeof a!="function");let n=t.changedRanges,r=Pa.extendWithRanges(n,K9(i,this.stateDeco,t?t.changes:ls.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?He.RTL:He.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,c=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let u=(this.printing?U9:j9)(e,this.paddingTop),d=u.top-this.pixelViewport.top,g=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let w=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(w)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:x,charWidth:b}=t.docView.measureTextSize();o=n.refresh(r,x,b,p/b,w),o&&(t.docView.minWidth=0,h|=8)}d>0&&g>0?a=Math.max(d,g):d<0&&g<0&&(a=Math.min(d,g)),n.heightChanged=!1;for(let x of this.viewports){let b=x.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(x);this.heightMap=this.heightMap.updateHeight(n,0,o,new F9(x.from,b))}n.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new ef(n.lineAt(o-i*1e3,at.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,at.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,at.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new ef(n.lineAt(u-1e3/2,at.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,at.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new ef(this.heightMap.lineAt(i,at.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,at.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,at.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,at.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new up(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=He.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=Y9(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=nf(n,(this.visibleTop-i.top-a)/i.height),o=nf(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;r=nf(n,(this.pixelViewport.left-c)/a),o=nf(n,(this.pixelViewport.right+c)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&A2(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&A2(l,h.to-10,h.to+10);for(let{from:a,to:c}of l)c-a>1e3&&e.push(X9(t,f=>f.from>=i.from&&f.to<=i.to&&Math.abs(f.from-a)<1e3&&Math.abs(f.to-c)<1e3)||new up(a,c,this.gapSize(i,a,c,n)))}return e}gapSize(t,e,i,n){let r=k2(n,i)-k2(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){up.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Z.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];oi.spans(t,this.viewport.from,this.viewport.to,{span(n,r){e.push({from:n,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=e[r].from||n.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||mh(this.heightMap.lineAt(t,at.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return mh(this.heightMap.lineAt(this.scaler.fromDOM(t),at.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return mh(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},ef=class{constructor(t,e){this.from=t,this.to=e}};function Y9(s,t,e){let i=[],n=s,r=0;return oi.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function nf({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function k2(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function A2(s,t,e){for(let i=0;i<s.length;i++){let n=s[i];if(n.from<e&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>e&&r.push({from:e,to:n.to}),s.splice(i,1,...r),i+=r.length-1}}}function X9(s,t){for(let e of s)if(t(e))return e}const C2={toDOM(s){return s},fromDOM(s){return s},scale:1};let Z9=class{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,at.ByPos,t,0,0).top,c=e.lineAt(h,at.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}};function mh(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new bo(s.from,s.length,e,i-e,Array.isArray(s.type)?s.type.map(n=>mh(n,t)):s.type)}const sf=U.define({combine:s=>s.join(" ")}),Q1=U.define({combine:s=>s.indexOf(!0)>-1}),_1=I.newName(),RE=I.newName(),BE=I.newName(),EE={"&light":"."+RE,"&dark":"."+BE};function ty(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const Q9=ty("."+_1,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},EE),_9={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},dp=$.ie&&$.ie_version<=11;let tz=class{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new _6,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);($.ie&&$.ie_version<=11||$.ios&&t.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),dp&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(gc)?e.root.activeElement!=this.dom:!O1(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||(($.ie&&$.ie_version<=11||$.android&&$.chrome)&&!e.state.selection.main.empty&&i.focusNode&&bd(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=wd(t),i=$.safari&&t.nodeType==11&&X6()==this.view.contentDOM&&ez(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,_9),dp&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),dp&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Kh(this.view.contentDOM,i.key,i.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&O1(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=M2(e,t.previousSibling||t.target.previousSibling,-1),n=M2(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function M2(s,t,e){for(;t;){let i=ee.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function ez(s){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return bd(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}function iz(s,t,e,i){let n,r,o=s.state.selection.main;if(t>-1){let l=s.docView.domBoundsAround(t,e,0);if(!l||s.state.readOnly)return!1;let{from:h,to:a}=l,c=s.docView.impreciseHead||s.docView.impreciseAnchor?[]:sz(s),f=new mE(c,s.state);f.readRange(l.startDOM,l.endDOM);let u=o.from,d=null;(s.inputState.lastKeyCode===8&&s.inputState.lastKeyTime>Date.now()-100||$.android&&f.text.length<a-h)&&(u=o.to,d="end");let g=nz(s.state.doc.sliceString(h,a,js),f.text,u-h,d);g&&($.chrome&&s.inputState.lastKeyCode==13&&g.toB==g.from+2&&f.text.slice(g.from,g.toB)==js+js&&g.toB--,n={from:h+g.from,to:h+g.toA,insert:yt.of(f.text.slice(g.from,g.toB).split(js))}),r=rz(c,h)}else if(s.hasFocus||!s.state.facet(gc)){let l=s.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=s.docView,c=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!al(s.contentDOM,l.focusNode)?s.state.selection.main.head:s.docView.posFromDOM(l.focusNode,l.focusOffset),f=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!al(s.contentDOM,l.anchorNode)?s.state.selection.main.anchor:s.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||f!=o.anchor)&&(r=V.single(f,c))}if(!n&&!r)return!1;if(!n&&i&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,n.from).append(n.insert).append(s.state.doc.slice(n.to,o.to))}:($.mac||$.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:yt.of([" "])}),n){let l=s.state;if($.ios&&s.inputState.flushIOSKey(s)||$.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&Kh(s.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&Kh(s.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&Kh(s.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(s.state.facet(rE).some(f=>f(s,n.from,n.to,h)))return!0;s.inputState.composing>=0&&s.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&s.inputState.composing<0){let f=o.from<n.from?l.sliceDoc(o.from,n.from):"",u=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(s.state.toText(f+n.insert.sliceString(0,void 0,s.state.lineBreak)+u))}else{let f=l.changes(n),u=r&&!l.selection.main.eq(r.main)&&r.main.to<=f.newLength?r.main:void 0;if(l.selection.ranges.length>1&&s.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=s.state.sliceDoc(n.from,n.to),g=yE(s)||s.state.doc.lineAt(o.head),m=o.to-n.to,p=o.to-o.from;a=l.changeByRange(y=>{if(y.from==o.from&&y.to==o.to)return{changes:f,range:u||y.map(f)};let w=y.to-m,x=w-d.length;if(y.to-y.from!=p||s.state.sliceDoc(x,w)!=d||g&&y.to>=g.from&&y.from<=g.to)return{range:y};let b=l.changes({from:x,to:w,insert:n.insert}),S=y.to-o.to;return{changes:b,range:u?V.range(Math.max(0,u.anchor+S),Math.max(0,u.head+S)):y.map(b)}})}else a={changes:f,selection:u&&l.selection.replaceRange(u)}}let c="input.type";return s.composing&&(c+=".compose",s.inputState.compositionFirstChange&&(c+=".start",s.inputState.compositionFirstChange=!1)),s.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(o)){let l=!1,h="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(l=!0),h=s.inputState.lastSelectionOrigin),s.dispatch({selection:r,scrollIntoView:l,userEvent:h}),!0}else return!1}function nz(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function sz(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new s2(e,i)),(n!=e||r!=i)&&t.push(new s2(n,r))),t}function rz(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?V.single(e+t,i+t):null}let St=class PE{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||t9(t.parent)||document,this.viewState=new v2(t.state||ii.create()),this.plugins=this.state.facet(gh).map(e=>new ap(e));for(let e of this.plugins)e.update(this);this.observer=new tz(this,(e,i,n)=>iz(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new O9(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new r2(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof pn?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let l of t){if(l.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=l.state}if(this.destroyed){this.viewState.state=r;return}if(this.observer.clear(),r.facet(ii.phrases)!=this.state.facet(ii.phrases))return this.setState(r);n=i2.create(this,r,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new t2(h.empty?h:V.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(e2)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=O2.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(ph)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(sf)!=n.state.facet(sf)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(G1))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new v2(t),this.plugins=t.facet(gh).map(i=>new ap(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new r2(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(gh),i=t.state.facet(gh);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new ap(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let n=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(f=>{try{return f.read(this)}catch(u){return kr(this.state,u),D2}}),h=i2.create(this,this.state,[]),a=!1,c=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let f=0;f<o.length;f++)if(l[f]!=D2)try{let u=o[f];u.write&&u.write(l[f],this)}catch(u){kr(this.state,u)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),a&&this.docView.updateSelection(!0),this.viewport.from==n.from&&this.viewport.to==n.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(G1))i(e)}get themeClasses(){return _1+" "+(this.state.facet(Q1)?BE:RE)+" "+this.state.facet(sf)}updateAttrs(){let t=T2(this,hE,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(gc)?"true":"false",class:"cm-content",style:`${$.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),T2(this,aE,e);let i=this.observer.ignore(()=>{let n=z1(this.contentDOM,this.contentAttrs,e),r=z1(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(PE.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(ph),I.mount(this.root,this.styleModules.concat(Q9).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return fp(this,t,f2(this,t,e,i))}moveByGroup(t,e){return fp(this,t,f2(this,t,e,i=>M9(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return C9(this,t,e,i)}moveVertically(t,e,i){return fp(this,t,D9(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),bE(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[Ho.find(r,t-n.from,-1,e)];return ag(i,o.dir==He.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(oE)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>oz)return gE(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=u9(t.text,e);return this.bidiCache.push(new O2(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||$.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{IB(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return e2.of(new t2(typeof t=="number"?V.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return ug.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=I.newName(),n=[sf.of(i),ph.of(ty(`.${i}`,t))];return e&&e.dark&&n.push(Q1.of(!0)),n}static baseTheme(t){return mB.lowest(ph.of(ty("."+_1,t,EE)))}};St.styleModule=ph;St.inputHandler=rE;St.perLineTextDirection=oE;St.exceptionSink=sE;St.updateListener=G1;St.editable=gc;St.mouseSelectionStyle=nE;St.dragMovesSelection=iE;St.clickAddsSelectionRange=eE;St.decorations=Ea;St.atomicRanges=cE;St.scrollMargins=fE;St.darkTheme=Q1;St.contentAttributes=aE;St.editorAttributes=hE;St.lineWrapping=St.contentAttributes.of({class:"cm-lineWrapping"});St.announce=qt.define();const oz=4096,D2={};let O2=class LE{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:He.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new LE(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}};function T2(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&W1(o,e)}return e}const lz=$.mac?"mac":$.windows?"win":$.linux?"linux":"key";function hz(s,t){const e=s.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let n,r,o,l;for(let h=0;h<e.length-1;++h){const a=e[h];if(/^(cmd|meta|m)$/i.test(a))l=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))t=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function gp(s,t,e){return t.altKey&&(s="Alt-"+s),t.ctrlKey&&(s="Ctrl-"+s),t.metaKey&&(s="Meta-"+s),e!==!1&&t.shiftKey&&(s="Shift-"+s),s}const az=St.domEventHandlers({keydown(s,t){return IE(VE(t.state),s,t,"editor")}}),cz=U.define({enables:az}),$2=new WeakMap;function VE(s){let t=s.facet(cz),e=$2.get(t);return e||$2.set(t,e=dz(t.reduce((i,n)=>i.concat(n),[]))),e}function fz(s,t,e){return IE(VE(s.state),t,s,e)}let Hs=null;const uz=4e3;function dz(s,t=lz){let e=Object.create(null),i=Object.create(null),n=(o,l)=>{let h=i[o];if(h==null)i[o]=l;else if(h!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,h,a)=>{let c=e[o]||(e[o]=Object.create(null)),f=l.split(/ (?!$)/).map(g=>hz(g,t));for(let g=1;g<f.length;g++){let m=f.slice(0,g).join(" ");n(m,!0),c[m]||(c[m]={preventDefault:!0,commands:[p=>{let y=Hs={view:p,prefix:m,scope:o};return setTimeout(()=>{Hs==y&&(Hs=null)},uz),!0}]})}let u=f.join(" ");n(u,!1);let d=c[u]||(c[u]={preventDefault:!1,commands:[]});d.commands.push(h),a&&(d.preventDefault=!0)};for(let o of s){let l=o[t]||o.key;if(l)for(let h of o.scope?o.scope.split(" "):["editor"])r(h,l,o.run,o.preventDefault),o.shift&&r(h,"Shift-"+l,o.shift,o.preventDefault)}return e}function IE(s,t,e,i){let n=ob(t),r=n.length==1&&n!=" ",o="",l=!1;Hs&&Hs.view==e&&Hs.scope==i&&(o=Hs.prefix+" ",(l=SE.indexOf(t.keyCode)<0)&&(Hs=null));let h=f=>{if(f){for(let u of f.commands)if(u(e))return!0;f.preventDefault&&(l=!0)}return!1},a=s[i],c;if(a){if(h(a[o+gp(n,t,!r)]))return!0;if(r&&(t.shiftKey||t.altKey||t.metaKey)&&(c=rs[t.keyCode])&&c!=n){if(h(a[o+gp(c,t,!0)]))return!0}else if(r&&t.shiftKey&&h(a[o+gp(n,t,!0)]))return!0}return l}const gz=!$.ios,pz={".cm-line":{}};gz&&(pz[".cm-line"].caretColor="transparent !important");const R2=U.define({combine(s){let t,e;for(let i of s)t=t||i.topContainer,e=e||i.bottomContainer;return{topContainer:t,bottomContainer:e}}});function Sd(s,t){let e=s.plugin(NE),i=e?e.specs.indexOf(t):-1;return i>-1?e.panels[i]:null}const NE=ug.fromClass(class{constructor(s){this.input=s.state.facet(vd),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(e=>e(s));let t=s.state.facet(R2);this.top=new rf(s,!0,t.topContainer),this.bottom=new rf(s,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(s){let t=s.state.facet(R2);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new rf(s.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new rf(s.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let e=s.state.facet(vd);if(e!=this.input){let i=e.filter(h=>h),n=[],r=[],o=[],l=[];for(let h of i){let a=this.specs.indexOf(h),c;a<0?(c=h(s.view),l.push(c)):(c=this.panels[a],c.update&&c.update(s)),n.push(c),(c.top?r:o).push(c)}this.specs=i,this.panels=n,this.top.sync(r),this.bottom.sync(o);for(let h of l)h.dom.classList.add("cm-panel"),h.mount&&h.mount()}else for(let i of this.panels)i.update&&i.update(s)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:s=>St.scrollMargins.of(t=>{let e=t.plugin(s);return e&&{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}})});let rf=class{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=B2(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=B2(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}};function B2(s){let t=s.nextSibling;return s.remove(),t}const vd=U.define({enables:NE});let cl=class extends hl{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}};cl.prototype.elementClass="";cl.prototype.toDOM=void 0;cl.prototype.mapMode=xi.TrackBefore;cl.prototype.startSide=cl.prototype.endSide=-1;cl.prototype.point=!0;function vt(){var s=arguments[0];typeof s=="string"&&(s=document.createElement(s));var t=1,e=arguments[1];if(e&&typeof e=="object"&&e.nodeType==null&&!Array.isArray(e)){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=e[i];typeof n=="string"?s.setAttribute(i,n):n!=null&&(s[i]=n)}t++}for(;t<arguments.length;t++)HE(s,arguments[t]);return s}function HE(s,t){if(typeof t=="string")s.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)s.appendChild(t);else if(Array.isArray(t))for(var e=0;e<t.length;e++)HE(s,t[e]);else throw new RangeError("Unsupported child node: "+t)}const E2=typeof String.prototype.normalize=="function"?s=>s.normalize("NFKD"):s=>s;class fl{constructor(t,e,i=0,n=t.length,r){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(i,n),this.bufferStart=i,this.normalize=r?o=>r(E2(o)):E2,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return mu(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let e=P6(t),i=this.bufferStart+this.bufferPos;this.bufferPos+=g1(t);let n=this.normalize(e);for(let r=0,o=i;;r++){let l=n.charCodeAt(r),h=this.match(l,o);if(h)return this.value=h,this;if(r==n.length-1)break;o==i&&r<e.length&&e.charCodeAt(r)==l&&o++}}}match(t,e){let i=null;for(let n=0;n<this.matches.length;n+=2){let r=this.matches[n],o=!1;this.query.charCodeAt(r)==t&&(r==this.query.length-1?i={from:this.matches[n+1],to:e+1}:(this.matches[n]++,o=!0)),o||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==t&&(this.query.length==1?i={from:e,to:e+1}:this.matches.push(1,e)),i}}typeof Symbol<"u"&&(fl.prototype[Symbol.iterator]=function(){return this});const FE={from:-1,to:-1,match:/.*/.exec("")},zb="gm"+(/x/.unicode==null?"":"u");class WE{constructor(t,e,i,n=0,r=t.length){if(this.to=r,this.curLine="",this.done=!1,this.value=FE,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new zE(t,e,i,n,r);this.re=new RegExp(e,zb+(i?.ignoreCase?"i":"")),this.iter=t.iter();let o=t.lineAt(n);this.curLineStart=o.from,this.matchPos=n,this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){let i=this.curLineStart+e.index,n=i+e[0].length;if(this.matchPos=n+(i==n?1:0),i==this.curLine.length&&this.nextLine(),i<n||i>this.value.to)return this.value={from:i,to:n,match:e},this;t=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),t=0;else return this.done=!0,this}}}const pp=new WeakMap;class Wo{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,i){let n=pp.get(t);if(!n||n.from>=i||n.to<=e){let l=new Wo(e,t.sliceString(e,i));return pp.set(t,l),l}if(n.from==e&&n.to==i)return n;let{text:r,from:o}=n;return o>e&&(r=t.sliceString(e,o)+r,o=e),n.to<i&&(r+=t.sliceString(n.to,i)),pp.set(t,new Wo(o,r)),new Wo(e,r.slice(e-o,i-o))}}class zE{constructor(t,e,i,n,r){this.text=t,this.to=r,this.done=!1,this.value=FE,this.matchPos=n,this.re=new RegExp(e,zb+(i?.ignoreCase?"i":"")),this.flat=Wo.get(t,n,this.chunkEnd(n+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t&&(this.re.lastIndex=t+1,e=this.re.exec(this.flat.text)),e&&this.flat.to<this.to&&e.index+e[0].length>this.flat.text.length-10&&(e=null),e){let i=this.flat.from+e.index,n=i+e[0].length;return this.value={from:i,to:n,match:e},this.matchPos=n+(i==n?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=Wo.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}}typeof Symbol<"u"&&(WE.prototype[Symbol.iterator]=zE.prototype[Symbol.iterator]=function(){return this});function mz(s){try{return new RegExp(s,zb),!0}catch{return!1}}function ey(s){let t=vt("input",{class:"cm-textfield",name:"line"}),e=vt("form",{class:"cm-gotoLine",onkeydown:n=>{n.keyCode==27?(n.preventDefault(),s.dispatch({effects:kd.of(!1)}),s.focus()):n.keyCode==13&&(n.preventDefault(),i())},onsubmit:n=>{n.preventDefault(),i()}},vt("label",s.state.phrase("Go to line"),": ",t)," ",vt("button",{class:"cm-button",type:"submit"},s.state.phrase("go")));function i(){let n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!n)return;let{state:r}=s,o=r.doc.lineAt(r.selection.main.head),[,l,h,a,c]=n,f=a?+a.slice(1):0,u=h?+h:o.number;if(h&&c){let g=u/100;l&&(g=g*(l=="-"?-1:1)+o.number/r.doc.lines),u=Math.round(r.doc.lines*g)}else h&&l&&(u=u*(l=="-"?-1:1)+o.number);let d=r.doc.line(Math.max(1,Math.min(r.doc.lines,u)));s.dispatch({effects:kd.of(!1),selection:V.cursor(d.from+Math.max(0,Math.min(f,d.length))),scrollIntoView:!0}),s.focus()}return{dom:e}}const kd=qt.define(),P2=Ml.define({create(){return!0},update(s,t){for(let e of t.effects)e.is(kd)&&(s=e.value);return s},provide:s=>vd.from(s,t=>t?ey:null)}),yz=s=>{let t=Sd(s,ey);if(!t){let e=[kd.of(!0)];s.state.field(P2,!1)==null&&e.push(qt.appendConfig.of([P2,wz])),s.dispatch({effects:e}),t=Sd(s,ey)}return t&&t.dom.querySelector("input").focus(),!0},wz=St.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),bz={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},xz=U.define({combine(s){return j6(s,bz,{highlightWordAroundCursor:(t,e)=>t||e,minSelectionLength:Math.min,maxMatches:Math.min})}});function Sz(s){return[Mz,Cz]}const vz=Z.mark({class:"cm-selectionMatch"}),kz=Z.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function L2(s,t,e,i){return(e==0||s(t.sliceDoc(e-1,e))!=Mi.Word)&&(i==t.doc.length||s(t.sliceDoc(i,i+1))!=Mi.Word)}function Az(s,t,e,i){return s(t.sliceDoc(e,e+1))==Mi.Word&&s(t.sliceDoc(i-1,i))==Mi.Word}const Cz=ug.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.selectionSet||s.docChanged||s.viewportChanged)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let t=s.state.facet(xz),{state:e}=s,i=e.selection;if(i.ranges.length>1)return Z.none;let n=i.main,r,o=null;if(n.empty){if(!t.highlightWordAroundCursor)return Z.none;let h=e.wordAt(n.head);if(!h)return Z.none;o=e.charCategorizer(n.head),r=e.sliceDoc(h.from,h.to)}else{let h=n.to-n.from;if(h<t.minSelectionLength||h>200)return Z.none;if(t.wholeWords){if(r=e.sliceDoc(n.from,n.to),o=e.charCategorizer(n.head),!(L2(o,e,n.from,n.to)&&Az(o,e,n.from,n.to)))return Z.none}else if(r=e.sliceDoc(n.from,n.to).trim(),!r)return Z.none}let l=[];for(let h of s.visibleRanges){let a=new fl(e.doc,r,h.from,h.to);for(;!a.next().done;){let{from:c,to:f}=a.value;if((!o||L2(o,e,c,f))&&(n.empty&&c<=n.from&&f>=n.to?l.push(kz.range(c,f)):(c>=n.to||f<=n.from)&&l.push(vz.range(c,f)),l.length>t.maxMatches))return Z.none}}return Z.set(l)}},{decorations:s=>s.decorations}),Mz=St.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Dz=({state:s,dispatch:t})=>{let{selection:e}=s,i=V.create(e.ranges.map(n=>s.wordAt(n.head)||V.cursor(n.head)),e.mainIndex);return i.eq(e)?!1:(t(s.update({selection:i})),!0)};function Oz(s,t){let{main:e,ranges:i}=s.selection,n=s.wordAt(e.head),r=n&&n.from==e.from&&n.to==e.to;for(let o=!1,l=new fl(s.doc,t,i[i.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new fl(s.doc,t,0,Math.max(0,i[i.length-1].from-1)),o=!0}else{if(o&&i.some(h=>h.from==l.value.from))continue;if(r){let h=s.wordAt(l.value.from);if(!h||h.from!=l.value.from||h.to!=l.value.to)continue}return l.value}}const Tz=({state:s,dispatch:t})=>{let{ranges:e}=s.selection;if(e.some(r=>r.from===r.to))return Dz({state:s,dispatch:t});let i=s.sliceDoc(e[0].from,e[0].to);if(s.selection.ranges.some(r=>s.sliceDoc(r.from,r.to)!=i))return!1;let n=Oz(s,i);return n?(t(s.update({selection:s.selection.addRange(V.range(n.from,n.to),!1),effects:St.scrollIntoView(n.to)})),!0):!1},qb=U.define({combine(s){var t;return{top:s.reduce((e,i)=>e??i.top,void 0)||!1,caseSensitive:s.reduce((e,i)=>e??i.caseSensitive,void 0)||!1,createPanel:((t=s.find(e=>e.createPanel))===null||t===void 0?void 0:t.createPanel)||(e=>new Hz(e))}}});class qE{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||mz(this.search)),this.unquoted=t.literal?this.search:this.search.replace(/\\([nrt\\])/g,(e,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp}create(){return this.regexp?new Rz(this):new $z(this)}getCursor(t,e=0,i=t.length){return this.regexp?lo(this,t,e,i):oo(this,t,e,i)}}let KE=class{constructor(t){this.spec=t}};function oo(s,t,e,i){return new fl(t,s.unquoted,e,i,s.caseSensitive?void 0:n=>n.toLowerCase())}class $z extends KE{constructor(t){super(t)}nextMatch(t,e,i){let n=oo(this.spec,t,i,t.length).nextOverlapping();return n.done&&(n=oo(this.spec,t,0,e).nextOverlapping()),n.done?null:n.value}prevMatchInRange(t,e,i){for(let n=i;;){let r=Math.max(e,n-1e4-this.spec.unquoted.length),o=oo(this.spec,t,r,n),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(r==e)return null;n-=1e4}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace}matchAll(t,e){let i=oo(this.spec,t,0,t.length),n=[];for(;!i.next().done;){if(n.length>=e)return null;n.push(i.value)}return n}highlight(t,e,i,n){let r=oo(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,t.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}function lo(s,t,e,i){return new WE(t,s.search,s.caseSensitive?void 0:{ignoreCase:!0},e,i)}class Rz extends KE{nextMatch(t,e,i){let n=lo(this.spec,t,i,t.length).next();return n.done&&(n=lo(this.spec,t,0,e).next()),n.done?null:n.value}prevMatchInRange(t,e,i){for(let n=1;;n++){let r=Math.max(e,i-n*1e4),o=lo(this.spec,t,r,i),l=null;for(;!o.next().done;)l=o.value;if(l&&(r==e||l.from>r+10))return l;if(r==e)return null}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.length)}getReplacement(t){return this.spec.replace.replace(/\$([$&\d+])/g,(e,i)=>i=="$"?"$":i=="&"?t.match[0]:i!="0"&&+i<t.match.length?t.match[i]:e)}matchAll(t,e){let i=lo(this.spec,t,0,t.length),n=[];for(;!i.next().done;){if(n.length>=e)return null;n.push(i.value)}return n}highlight(t,e,i,n){let r=lo(this.spec,t,Math.max(0,e-250),Math.min(i+250,t.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}const La=qt.define(),Kb=qt.define(),tr=Ml.define({create(s){return new mp(iy(s).create(),null)},update(s,t){for(let e of t.effects)e.is(La)?s=new mp(e.value.create(),s.panel):e.is(Kb)&&(s=new mp(s.query,e.value?Gb:null));return s},provide:s=>vd.from(s,t=>t.panel)});class mp{constructor(t,e){this.query=t,this.panel=e}}const Bz=Z.mark({class:"cm-searchMatch"}),Ez=Z.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Pz=ug.fromClass(class{constructor(s){this.view=s,this.decorations=this.highlight(s.state.field(tr))}update(s){let t=s.state.field(tr);(t!=s.startState.field(tr)||s.docChanged||s.selectionSet||s.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:s,panel:t}){if(!t||!s.spec.valid)return Z.none;let{view:e}=this,i=new C1;for(let n=0,r=e.visibleRanges,o=r.length;n<o;n++){let{from:l,to:h}=r[n];for(;n<o-1&&h>r[n+1].from-500;)h=r[++n].to;s.highlight(e.state.doc,l,h,(a,c)=>{let f=e.state.selection.ranges.some(u=>u.from==a&&u.to==c);i.add(a,c,f?Ez:Bz)})}return i.finish()}},{decorations:s=>s.decorations});function pc(s){return t=>{let e=t.state.field(tr,!1);return e&&e.query.spec.valid?s(t,e):GE(t)}}const Ad=pc((s,{query:t})=>{let{from:e,to:i}=s.state.selection.main,n=t.nextMatch(s.state.doc,e,i);return!n||n.from==e&&n.to==i?!1:(s.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:jb(s,n),userEvent:"select.search"}),!0)}),Cd=pc((s,{query:t})=>{let{state:e}=s,{from:i,to:n}=e.selection.main,r=t.prevMatch(e.doc,i,n);return r?(s.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:jb(s,r),userEvent:"select.search"}),!0):!1}),Lz=pc((s,{query:t})=>{let e=t.matchAll(s.state.doc,1e3);return!e||!e.length?!1:(s.dispatch({selection:V.create(e.map(i=>V.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),Vz=({state:s,dispatch:t})=>{let e=s.selection;if(e.ranges.length>1||e.main.empty)return!1;let{from:i,to:n}=e.main,r=[],o=0;for(let l=new fl(s.doc,s.sliceDoc(i,n));!l.next().done;){if(r.length>1e3)return!1;l.value.from==i&&(o=r.length),r.push(V.range(l.value.from,l.value.to))}return t(s.update({selection:V.create(r,o),userEvent:"select.search.matches"})),!0},V2=pc((s,{query:t})=>{let{state:e}=s,{from:i,to:n}=e.selection.main;if(e.readOnly)return!1;let r=t.nextMatch(e.doc,i,i);if(!r)return!1;let o=[],l,h;if(r.from==i&&r.to==n&&(h=e.toText(t.getReplacement(r)),o.push({from:r.from,to:r.to,insert:h}),r=t.nextMatch(e.doc,r.from,r.to)),r){let a=o.length==0||o[0].from>=r.to?0:r.to-r.from-h.length;l={anchor:r.from-a,head:r.to-a}}return s.dispatch({changes:o,selection:l,scrollIntoView:!!l,effects:r?jb(s,r):void 0,userEvent:"input.replace"}),!0}),Iz=pc((s,{query:t})=>{if(s.state.readOnly)return!1;let e=t.matchAll(s.state.doc,1e9).map(i=>{let{from:n,to:r}=i;return{from:n,to:r,insert:t.getReplacement(i)}});return e.length?(s.dispatch({changes:e,userEvent:"input.replace.all"}),!0):!1});function Gb(s){return s.state.facet(qb).createPanel(s)}function iy(s,t){var e;let i=s.selection.main,n=i.empty||i.to>i.from+100?"":s.sliceDoc(i.from,i.to),r=(e=t?.caseSensitive)!==null&&e!==void 0?e:s.facet(qb).caseSensitive;return t&&!n?t:new qE({search:n.replace(/\n/g,"\\n"),caseSensitive:r})}const GE=s=>{let t=s.state.field(tr,!1);if(t&&t.panel){let e=Sd(s,Gb);if(!e)return!1;let i=e.dom.querySelector("[name=search]");if(i!=s.root.activeElement){let n=iy(s.state,t.query.spec);n.valid&&s.dispatch({effects:La.of(n)}),i.focus(),i.select()}}else s.dispatch({effects:[Kb.of(!0),t?La.of(iy(s.state,t.query.spec)):qt.appendConfig.of(Wz)]});return!0},jE=s=>{let t=s.state.field(tr,!1);if(!t||!t.panel)return!1;let e=Sd(s,Gb);return e&&e.dom.contains(s.root.activeElement)&&s.focus(),s.dispatch({effects:Kb.of(!1)}),!0},Nz=[{key:"Mod-f",run:GE,scope:"editor search-panel"},{key:"F3",run:Ad,shift:Cd,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Ad,shift:Cd,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:jE,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Vz},{key:"Alt-g",run:yz},{key:"Mod-d",run:Tz,preventDefault:!0}];class Hz{constructor(t){this.view=t;let e=this.query=t.state.field(tr).query.spec;this.commit=this.commit.bind(this),this.searchField=vt("input",{value:e.search,placeholder:Ti(t,"Find"),"aria-label":Ti(t,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=vt("input",{value:e.replace,placeholder:Ti(t,"Replace"),"aria-label":Ti(t,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=vt("input",{type:"checkbox",name:"case",checked:e.caseSensitive,onchange:this.commit}),this.reField=vt("input",{type:"checkbox",name:"re",checked:e.regexp,onchange:this.commit});function i(n,r,o){return vt("button",{class:"cm-button",name:n,onclick:r,type:"button"},o)}this.dom=vt("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,i("next",()=>Ad(t),[Ti(t,"next")]),i("prev",()=>Cd(t),[Ti(t,"previous")]),i("select",()=>Lz(t),[Ti(t,"all")]),vt("label",null,[this.caseField,Ti(t,"match case")]),vt("label",null,[this.reField,Ti(t,"regexp")]),...t.state.readOnly?[]:[vt("br"),this.replaceField,i("replace",()=>V2(t),[Ti(t,"replace")]),i("replaceAll",()=>Iz(t),[Ti(t,"replace all")]),vt("button",{name:"close",onclick:()=>jE(t),"aria-label":Ti(t,"close"),type:"button"},["×"])]])}commit(){let t=new qE({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:La.of(t)}))}keydown(t){fz(this.view,t,"search-panel")?t.preventDefault():t.keyCode==13&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?Cd:Ad)(this.view)):t.keyCode==13&&t.target==this.replaceField&&(t.preventDefault(),V2(this.view))}update(t){for(let e of t.transactions)for(let i of e.effects)i.is(La)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(qb).top}}function Ti(s,t){return s.state.phrase(t)}const of=30,lf=/[\s\.,:;?!]/;function jb(s,{from:t,to:e}){let i=s.state.doc.lineAt(t).from,n=s.state.doc.lineAt(e).to,r=Math.max(i,t-of),o=Math.min(n,e+of),l=s.state.sliceDoc(r,o);if(r!=i){for(let h=0;h<of;h++)if(!lf.test(l[h+1])&&lf.test(l[h])){l=l.slice(h);break}}if(o!=n){for(let h=l.length-1;h>l.length-of;h--)if(!lf.test(l[h-1])&&lf.test(l[h])){l=l.slice(0,h);break}}return St.announce.of(`${s.state.phrase("current match")}. ${l} ${s.state.phrase("on line")} ${s.state.doc.lineAt(t).number}`)}const Fz=St.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Wz=[tr,mB.lowest(Pz),Fz];let wt=class UE{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),Au.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Au.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new Gh(this),r=new Gh(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new Gh(this,t)}iterRange(t,e=this.length){return new JE(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new YE(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?UE.empty:t.length<=32?new on(t):Au.from(on.split(t,[]))}},on=class Vn extends wt{constructor(t,e=zz(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new qz(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new Vn(I2(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=Cu(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Vn(l,o.length+r.length));else{let h=l.length>>1;i.push(new Vn(l.slice(0,h)),new Vn(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof Vn))return super.replace(t,e,i);let n=Cu(this.text,Cu(i.text,I2(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new Vn(n,r):Au.from(Vn.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new Vn(i,n)),i=[],n=-1);return n>-1&&e.push(new Vn(i,n)),e}},Au=class ho extends wt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new ho(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof ho))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new on(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof ho)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof on&&h&&(g=c[c.length-1])instanceof on&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new on(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:ho.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new ho(l,e)}};wt.empty=new on([""],0);function zz(s){let t=-1;for(let e of s)t+=e.length+1;return t}function Cu(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function I2(s,t,e){return Cu(s,[""],t,e)}let Gh=class{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof on?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof on?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof on){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof on?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}},JE=class{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Gh(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},YE=class{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(wt.prototype[Symbol.iterator]=function(){return this.iter()},Gh.prototype[Symbol.iterator]=JE.prototype[Symbol.iterator]=YE.prototype[Symbol.iterator]=function(){return this});let qz=class{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}},zo="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<zo.length;s++)zo[s]+=zo[s-1];function Kz(s){for(let t=1;t<zo.length;t+=2)if(zo[t]>s)return zo[t-1]<=s;return!1}function N2(s){return s>=127462&&s<=127487}const H2=8205;function Us(s,t,e=!0,i=!0){return(e?XE:Gz)(s,t,i)}function XE(s,t,e){if(t==s.length)return t;t&&ZE(s.charCodeAt(t))&&QE(s.charCodeAt(t-1))&&t--;let i=qe(s,t);for(t+=Xi(i);t<s.length;){let n=qe(s,t);if(i==H2||n==H2||e&&Kz(n))t+=Xi(n),i=n;else if(N2(n)){let r=0,o=t-2;for(;o>=0&&N2(qe(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function Gz(s,t,e){for(;t>0;){let i=XE(s,t-2,e);if(i<t)return i;t--}return 0}function ZE(s){return s>=56320&&s<57344}function QE(s){return s>=55296&&s<56320}function qe(s,t){let e=s.charCodeAt(t);if(!QE(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return ZE(i)?(e-55296<<10)+(i-56320)+65536:e}function _E(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}function Xi(s){return s<65536?1:2}const ny=/\r\n?|\n/;var Ge=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(Ge||(Ge={}));let jh=class Mu{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){sy(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new Mu(t)}composeDesc(t){return this.empty?t:t.empty?this:tP(this,t)}mapDesc(t,e=!1){return t.empty?this:ry(this,t,e)}mapPos(t,e=-1,i=Ge.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=Ge.Simple&&a>=t&&(i==Ge.TrackDel&&n<t&&a>t||i==Ge.TrackBefore&&n<t||i==Ge.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Mu(t)}static create(t){return new Mu(t)}},hs=class Ps extends jh{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return sy(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return ry(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(wt.empty);i.push(o?t.slice(r,r+o):wt.empty)}r+=o}return new Ps(e,i)}compose(t){return this.empty?t:t.empty?this:tP(this,t,!0)}map(t,e=!1){return t.empty?this:ry(this,t,e,!0)}iterChanges(t,e=!1){sy(this,t,e)}get desc(){return jh.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new Va(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Ie(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Ie(e,c,f),f>0&&pr(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Ie(e,c,-1),Ie(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new Ps(e,i),filtered:jh.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Ie(n,e-o,-1);let f=new Ps(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof Ps){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?wt.of(d.split(i||ny)):d:wt.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Ie(n,f-o,-1),Ie(n,u-f,m),pr(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new Ps(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(wt.empty);i[n]=wt.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new Ps(e,i)}static createSet(t,e){return new Ps(t,e)}};function Ie(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function pr(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(wt.empty);s.push(e)}}function sy(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=wt.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function ry(s,t,e,i=!1){let n=[],r=i?[]:null,o=new Va(s),l=new Va(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let c=Math.min(l.len,h-a);l.forward(c),Ie(n,c,-1),a+=c}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(Ie(n,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let c=0,f=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<f)c+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<f){let u=Math.min(l.len,f-a);c+=u,l.forward(u),a+=u}else break;Ie(n,c,o.ins),r&&pr(r,n,o.text),h=f,o.next()}else{if(o.done&&l.done)return r?hs.createSet(n,r):jh.create(n);throw new Error("Mismatched change set lengths")}}function tP(s,t,e=!1){let i=[],n=e?[]:null,r=new Va(s),o=new Va(t);for(let l=!1;;){if(r.done&&o.done)return n?hs.createSet(i,n):jh.create(i);if(r.ins==0)Ie(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Ie(i,0,o.ins,l),n&&pr(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Ie(i,h,c,l),n&&c&&pr(n,i,o.text)}else o.ins==-1?(Ie(i,r.off?0:r.len,h,l),n&&pr(n,i,r.textBit(h))):(Ie(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&pr(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}let Va=class{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?wt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?wt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}},hf=class oy{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new oy(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return P.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return P.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return P.range(t.anchor,t.head)}static create(t,e,i){return new oy(t,e,i)}},P=class di{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:di.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new di([this.main],0)}addRange(t,e=!0){return di.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,di.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new di(t.ranges.map(e=>hf.fromJSON(e)),t.main)}static single(t,e=t){return new di([di.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return di.normalized(t.slice(),e);i=r.to}return new di(t,e)}static cursor(t,e=0,i,n){return hf.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n??33554431)<<5)}static range(t,e,i){let n=(i??33554431)<<5;return e<t?hf.create(e,t,16|n|8):hf.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?di.range(h,l):di.range(l,h))}}return new di(t,e)}};function eP(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let Ub=0,Y=class iP{constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=r,this.id=Ub++,this.default=t([])}static define(t={}){return new iP(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:Jb),!!t.static,t.enables)}of(t){return new Du([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Du(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Du(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}};function Jb(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}let Du=class{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=Ub++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||ly(f,c)){let d=i(f);if(l?!F2(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d=i(f),g=u.config.address[r];if(g!=null){let m=Md(u,g);if(this.dependencies.every(p=>p instanceof Y?u.facet(p)===f.facet(p):p instanceof Dl?u.field(p,!1)==f.field(p,!1):!0)||(l?F2(d,m,n):n(d,m)))return f.values[o]=m,0}return f.values[o]=d,1}}}};function F2(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function ly(s,t){let e=!1;for(let i of t)Uh(s,i)&1&&(e=!0);return e}function jz(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=Md(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)Uh(h,a);return h.values[o]=l(h),1},update(h,a){if(!ly(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=ly(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&Jb(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const W2=Y.define({static:!0});let Dl=class nP{constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new nP(Ub++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(W2).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,W2.of({field:this,create:t})]}get extension(){return this}};const ao={lowest:4,low:3,default:2,high:1,highest:0};function zl(s){return t=>new rP(t,s)}const sP={highest:zl(ao.highest),high:zl(ao.high),default:zl(ao.default),low:zl(ao.low),lowest:zl(ao.lowest)};let rP=class{constructor(t,e){this.inner=t,this.prec=e}},oP=class lP{of(t){return new hy(this,t)}reconfigure(t){return lP.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}},hy=class{constructor(t,e){this.compartment=t,this.inner=e}},z2=class hP{constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of Uz(t,e,o))u instanceof Dl?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,Jb(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>jz(p,g,d))}}let f=a.map(u=>u(l));return new hP(t,o,f,l,h,r)}};function Uz(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof hy&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof hy){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof rP)r(o.inner,o.prec);else if(o instanceof Dl)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof Du)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,ao.default),i.reduce((o,l)=>o.concat(l))}function Uh(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function Md(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const aP=Y.define(),cP=Y.define({combine:s=>s.some(t=>t),static:!0}),fP=Y.define({combine:s=>s.length?s[0]:void 0,static:!0}),uP=Y.define(),dP=Y.define(),gP=Y.define(),pP=Y.define({combine:s=>s.length?s[0]:!1});let mc=class{constructor(t,e){this.type=t,this.value=e}static define(){return new Jz}},Jz=class{of(t){return new mc(this,t)}},Yz=class{constructor(t){this.map=t}of(t){return new Ht(this,t)}},Ht=class mP{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new mP(this.type,e)}is(t){return this.type==t}static define(t={}){return new Yz(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}};Ht.reconfigure=Ht.define();Ht.appendConfig=Ht.define();let mn=class yh{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&eP(i,e.newLength),r.some(l=>l.type==yh.time)||(this.annotations=r.concat(yh.time.of(Date.now())))}static create(t,e,i,n,r,o){return new yh(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(yh.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}};mn.time=mc.define();mn.userEvent=mc.define();mn.addToHistory=mc.define();mn.remote=mc.define();function Xz(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function yP(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=hs.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:Ht.mapEffects(s.effects,n).concat(Ht.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function ay(s,t,e){let i=t.selection,n=qo(t.annotations);return t.userEvent&&(n=n.concat(mn.userEvent.of(t.userEvent))),{changes:t.changes instanceof hs?t.changes:hs.of(t.changes||[],e,s.facet(fP)),selection:i&&(i instanceof P?i:P.single(i.anchor,i.head)),effects:qo(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function wP(s,t,e){let i=ay(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=yP(i,ay(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=mn.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Qz(e?Zz(n):n)}function Zz(s){let t=s.startState,e=!0;for(let n of t.facet(uP)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:Xz(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=hs.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.invertedDesc}s=mn.create(t,n,s.selection&&s.selection.map(r),Ht.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(dP);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof mn?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof mn?s=r[0]:s=wP(t,qo(r),!1)}return s}function Qz(s){let t=s.startState,e=t.facet(gP),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=yP(s,ay(t,r,s.changes.newLength),!0))}return i==s?s:mn.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const _z=[];function qo(s){return s==null?_z:Array.isArray(s)?s:[s]}var ln=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(ln||(ln={}));const tq=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let cy;try{cy=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function eq(s){if(cy)return cy.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||tq.test(e)))return!0}return!1}function iq(s){return t=>{if(!/\S/.test(t))return ln.Space;if(eq(t))return ln.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return ln.Word;return ln.Other}}let ni=class ji{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Uh(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return Uh(this,i),Md(this,i)}update(...t){return wP(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(oP.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(Ht.reconfigure)?(e=null,i=o.value):o.is(Ht.appendConfig)&&(e=null,i=qo(i).concat(o.value));let r;e?r=t.startState.values.slice():(e=z2.resolve(i,n,this),r=new ji(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new ji(e,t.newDoc,t.newSelection,r,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:P.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=qo(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=Ht.mapEffects(o,c).concat(Ht.mapEffects(qo(h.effects),f))}return{changes:n,selection:P.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof hs?t:hs.of(t,this.doc.length,this.facet(ji.lineSeparator))}toText(t){return wt.of(t.split(this.facet(ji.lineSeparator)||ny))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Uh(this,e),Md(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof Dl&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}return ji.create({doc:t.doc,selection:P.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=z2.resolve(t.extensions||[],new Map),i=t.doc instanceof wt?t.doc:wt.of((t.doc||"").split(e.staticFacet(ji.lineSeparator)||ny)),n=t.selection?t.selection instanceof P?t.selection:P.single(t.selection.anchor,t.selection.head):P.single(0);return eP(n,i.length),e.staticFacet(cP)||(n=n.asSingle()),new ji(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(ji.tabSize)}get lineBreak(){return this.facet(ji.lineSeparator)||`
`}get readOnly(){return this.facet(pP)}phrase(t,...e){for(let i of this.facet(ji.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(aP))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return iq(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=Us(e,o,!1);if(r(e.slice(h,o))!=ln.Word)break;o=h}for(;l<n;){let h=Us(e,l);if(r(e.slice(l,h))!=ln.Word)break;l=h}return o==l?null:P.range(o+i,l+i)}};ni.allowMultipleSelections=cP;ni.tabSize=Y.define({combine:s=>s.length?s[0]:4});ni.lineSeparator=fP;ni.readOnly=pP;ni.phrases=Y.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});ni.languageData=aP;ni.changeFilter=uP;ni.transactionFilter=dP;ni.transactionExtender=gP;oP.reconfigure=Ht.define();function nq(s,t,e={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}let $r=class{eq(t){return this==t}range(t,e=t){return fy.create(t,e,this)}};$r.prototype.startSide=$r.prototype.endSide=0;$r.prototype.point=!1;$r.prototype.mapMode=Ge.TrackDel;let fy=class bP{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new bP(t,e,i)}};function uy(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}let sq=class xP{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new xP(n,r,i,l):null,pos:o}}},Re=class co{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new co(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(uy)),this.isEmpty)return e.length?co.of(e):this;let l=new vP(this,null,-1).goto(0),h=0,a=[],c=new q2;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(fy.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?co.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new co(i,e,r||co.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return dy.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return dy.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=K2(o,l,i),a=new ql(o,h,r),c=new ql(l,h,r);i.iterGaps((f,u,d)=>G2(a,f,c,u,d,n)),i.empty&&i.length==0&&G2(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=K2(r,o),h=new ql(r,l,0).goto(i),a=new ql(o,l,0).goto(i);for(;;){if(h.to!=a.to||!gy(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new ql(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new q2;for(let n of t instanceof fy?[t]:e?rq(t):t)i.add(n.from,n.to,n.value);return i.finish()}};Re.empty=new Re([],[],null,-1);function rq(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(uy(t,i)>0)return s.slice().sort(uy);t=i}return s}Re.empty.nextLayer=Re.empty;let q2=class SP{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new sq(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new SP)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(Re.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=Re.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}};function K2(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}let vP=class{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}},dy=class kP{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new vP(o,e,i,r));return n.length==1?n[0]:new kP(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)yp(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)yp(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),yp(this.heap,0)}}};function yp(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}let ql=class{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=dy.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){af(this.active,t),af(this.activeTo,t),af(this.activeRank,t),this.minActive=j2(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;cf(this.active,e,i),cf(this.activeTo,e,n),cf(this.activeRank,e,r),t&&cf(t,e,this.cursor.from),this.minActive=j2(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&af(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}};function G2(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to||s.endSide-e.endSide,c=a<0?s.to+h:e.to,f=Math.min(c,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&gy(s.activeForPoint(s.to+h),e.activeForPoint(e.to))||r.comparePoint(l,f,s.point,e.point):f>l&&!gy(s.active,e.active)&&r.compareRange(l,f,s.active,e.active),c>o)break;l=c,a<=0&&s.next(),a>=0&&e.next()}}function gy(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function af(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function cf(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function j2(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function oq(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=Us(s,n)}return s.length}function Dd(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function ul(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function lq(){let s=document.activeElement;for(;s&&s.shadowRoot;)s=s.shadowRoot.activeElement;return s}function py(s,t){if(!t.anchorNode)return!1;try{return ul(s,t.anchorNode)}catch{return!1}}function Ia(s){return s.nodeType==3?Na(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function Od(s,t,e,i){return e?U2(s,t,e,i,-1)||U2(s,t,e,i,1):!1}function my(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function U2(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:Td(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=my(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?Td(s):0}else return!1}}function Td(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}const AP={left:0,right:0,top:0,bottom:0};function dg(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function hq(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function aq(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView;for(let c=s;c;)if(c.nodeType==1){let f,u=c==h.body;if(u)f=hq(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let m=c.getBoundingClientRect();f={left:m.left,right:m.left+c.clientWidth,top:m.top,bottom:m.top+c.clientHeight}}let d=0,g=0;if(n=="nearest")t.top<f.top?(g=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+g&&(g=t.bottom-f.bottom+g+o)):t.bottom>f.bottom&&(g=t.bottom-f.bottom+o,e<0&&t.top-g<f.top&&(g=-(f.top+g-t.top+o)));else{let m=t.bottom-t.top,p=f.bottom-f.top;g=(n=="center"&&m<=p?t.top+m/2-p/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-p+o)-f.top}if(i=="nearest"?t.left<f.left?(d=-(f.left-t.left+r),e>0&&t.right>f.right+d&&(d=t.right-f.right+d+r)):t.right>f.right&&(d=t.right-f.right+r,e<0&&t.left<f.left+d&&(d=-(f.left+d-t.left+r))):d=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,d||g)if(u)a.scrollBy(d,g);else{if(g){let m=c.scrollTop;c.scrollTop+=g,g=c.scrollTop-m}if(d){let m=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-m}t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(u)break;c=c.assignedSlot||c.parentNode,i=n="nearest"}else if(c.nodeType==11)c=c.host;else break}let cq=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}},jr=null;function CP(s){if(s.setActive)return s.setActive();if(jr)return s.focus(jr);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(jr==null?{get preventScroll(){return jr={preventScroll:!0},!0}}:void 0),!jr){jr=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let J2;function Na(s,t,e=t){let i=J2||(J2=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function Jh(s,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function fq(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function MP(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}let Qe=class yy{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new yy(t.parentNode,my(t),e)}static after(t,e){return new yy(t.parentNode,my(t)+1,e)}};const Yb=[];let ie=class wy{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let r of this.children){if(r.dirty){if(!r.dom&&(n=i?i.nextSibling:e.firstChild)){let o=wy.get(n);(!o||!o.parent&&o.constructor==r.constructor)&&r.reuseDOM(n)}r.sync(t),r.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=r.dom&&(t.written=!0),r.dom.parentNode==e)for(;n&&n!=r.dom;)n=Y2(n);else e.insertBefore(r.dom,n);i=r.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=Y2(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=Td(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!wy.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Yb){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new DP(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}};ie.prototype.breakAfter=0;function Y2(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}let DP=class{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function OP(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function TP(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,OP(s,a,c,l,h,i,0,n,r)}let vi=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},by=typeof document<"u"?document:{documentElement:{style:{}}};const xy=/Edge\/(\d+)/.exec(vi.userAgent),$P=/MSIE \d/.test(vi.userAgent),Sy=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(vi.userAgent),gg=!!($P||Sy||xy),X2=!gg&&/gecko\/(\d+)/i.test(vi.userAgent),wp=!gg&&/Chrome\/(\d+)/.exec(vi.userAgent),uq="webkitFontSmoothing"in by.documentElement.style,RP=!gg&&/Apple Computer/.test(vi.vendor),Z2=RP&&(/Mobile\/\w+/.test(vi.userAgent)||vi.maxTouchPoints>2);var O={mac:Z2||/Mac/.test(vi.platform),windows:/Win/.test(vi.platform),linux:/Linux|X11/.test(vi.platform),ie:gg,ie_version:$P?by.documentMode||6:Sy?+Sy[1]:xy?+xy[1]:0,gecko:X2,gecko_version:X2?+(/Firefox\/(\d+)/.exec(vi.userAgent)||[0,0])[1]:0,chrome:!!wp,chrome_version:wp?+wp[1]:0,ios:Z2,android:/Android\b/.test(vi.userAgent),safari:RP,webkit_version:uq?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:by.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const dq=256;let Ha=class vy extends ie{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof vy)||this.length-(e-t)+i.length>dq)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new vy(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new Qe(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Ay(this.dom,t,e)}},Rr=class ky extends ie{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(MP(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,r,o){return i&&(!(i instanceof ky&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(TP(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new ky(this.mark,e,o)}domAtPos(t){return PP(this.dom,this.children,t)}coordsAt(t,e){return VP(this,t,e)}};function Ay(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?O.chrome||O.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=Na(s,n,r).getClientRects();if(!l.length)return AP;let h=l[(o?o<0:e>=0)?0:l.length-1];return O.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?dg(h,o<0):h||null}let Xb=class wh extends ie{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||wh)(t,e,i)}split(t){let e=wh.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof wh)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof wh&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return wt.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):wt.empty}domAtPos(t){return t==0?Qe.before(this.dom):Qe.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return AP;for(let r=t>0?i.length-1:0;n=i[r],!(t>0?r==0:r==i.length-1||n.top<n.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:dg(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},BP=class extends Xb{domAtPos(t){let{topView:e,text:i}=this.widget;return e?Cy(t,0,e,i,(n,r)=>n.domAtPos(r),n=>new Qe(i,Math.min(n,i.nodeValue.length))):new Qe(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?EP(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?Cy(t,e,i,n,(r,o,l)=>r.coordsAt(o,l),(r,o)=>Ay(n,r,o)):Ay(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}};function Cy(s,t,e,i,n,r){if(e instanceof Rr){for(let o of e.children){let l=ul(o.dom,i),h=l?i.nodeValue.length:o.length;if(s<h||s==h&&o.getSide()<=0)return l?Cy(s,t,o,i,n,r):n(o,s,t);s-=h}return n(e,e.length,-1)}else return e.dom==i?r(s,t):n(e,s,t)}function EP(s,t,e,i){if(e instanceof Rr)for(let n of e.children){let r=0,o=ul(n.dom,i);if(ul(n.dom,s))return r+(o?EP(s,t,n,i):n.localPosFromDOM(s,t));r+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(s,t)}let My=class Dy extends ie{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Dy&&t.side==this.side}split(){return new Dy(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return Qe.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=gq(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return wt.empty}};Ha.prototype.children=Xb.prototype.children=My.prototype.children=Yb;function gq(s,t){let e=s.parent,i=e?e.children.indexOf(s):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof Ha){let r=n.coordsAt(t<0?n.length:0,t);if(r)return r}i+=t}else if(e instanceof Rr&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function PP(s,t,e){let i=0;for(let n=0;i<t.length;i++){let r=t[i],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(e>n&&e<o&&r.dom.parentNode==s)return r.domAtPos(e-n);if(e<=n)break;n=o}}for(;i>0;i--){let n=t[i-1].dom;if(n.parentNode==s)return Qe.after(n)}return new Qe(s,0)}function LP(s,t,e){let i,{children:n}=s;e>0&&t instanceof Rr&&n.length&&(i=n[n.length-1])instanceof Rr&&i.mark.eq(t.mark)?LP(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function VP(s,t,e){for(let r=0,o=0;o<s.children.length;o++){let l=s.children[o],h=r+l.length,a;if((e<=0||h==s.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==s.children.length||(a=s.children[o+1]).length||a.getSide()>0)){let c=0;if(h==r){if(l.getSide()<=0)continue;c=e=-l.getSide()}let f=l.coordsAt(Math.max(0,t-r),e);return c&&f?dg(f,e<0):f}r=h}let i=s.dom.lastChild;if(!i)return s.dom.getBoundingClientRect();let n=Ia(i);return n[n.length-1]||null}function Oy(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}function Zb(s,t){if(s==t)return!0;if(!s||!t)return!1;let e=Object.keys(s),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||s[n]!==t[n])return!1;return!0}function Ty(s,t,e){let i=null;if(t)for(let n in t)e&&n in e||s.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||s.setAttribute(i=n,e[n]);return!!i}let pg=class{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}};var Yt=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(Yt||(Yt={}));let ye=class extends $r{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new IP(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Fa(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=WP(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new Fa(t,i,n,e,t.widget||null,!0)}static line(t){return new Qb(t)}static set(t,e=!1){return Re.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};ye.none=Re.empty;let IP=class NP extends ye{constructor(t){let{start:e,end:i}=WP(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof NP&&this.tagName==t.tagName&&this.class==t.class&&Zb(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}};IP.prototype.point=!1;let Qb=class HP extends ye{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof HP&&Zb(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}};Qb.prototype.mapMode=Ge.TrackBefore;Qb.prototype.point=!0;let Fa=class FP extends ye{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?Ge.TrackBefore:Ge.TrackAfter:Ge.TrackDel}get type(){return this.startSide<this.endSide?Yt.WidgetRange:this.startSide<=0?Yt.WidgetBefore:Yt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof FP&&pq(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}};Fa.prototype.point=!0;function WP(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function pq(s,t){return s==t||!!(s&&t&&s.compare(t))}function $y(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}let hn=class Ou extends ie{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof Ou))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),TP(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new Ou;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Zb(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){LP(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Oy(e,this.attrs||{})),i&&(this.attrs=Oy({class:i},this.attrs||{}))}domAtPos(t){return PP(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(MP(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Ty(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&ie.get(i)instanceof Rr;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=ie.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!O.ios||!this.children.some(n=>n instanceof Ha))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof Ha))return null;let i=Ia(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return VP(this,t,e)}become(t){return!1}get type(){return Yt.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof Ou)return r;if(o>e)break}n=o+r.breakAfter}return null}},Ry=class Tu extends ie{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof Tu)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?Qe.before(this.dom):Qe.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Tu(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Yb}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):wt.empty}domBoundsAround(){return null}become(t){return t instanceof Tu&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},mq=class zP{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof Ry&&t.type==Yt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new hn),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(ff(new My(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(ff(new Ha(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof Fa){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof Fa)if(i.block){let{type:h}=i;h==Yt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Ry(i.widget||new Q2("div"),l,h))}else{let h=Xb.create(i.widget||new Q2("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(ff(new My(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(ff(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new zP(t,e,i,r);return o.openEnd=Re.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function ff(s,t){for(let e of t)s=new Rr(e,[s],s.length);return s}let Q2=class extends pg{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}};const qP=Y.define(),KP=Y.define(),GP=Y.define(),jP=Y.define(),By=Y.define(),UP=Y.define(),JP=Y.define({combine:s=>s.some(t=>t)});let _2=class YP{constructor(t,e="nearest",i="nearest",n=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r}map(t){return t.empty?this:new YP(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}};const tA=Ht.define({map:(s,t)=>s.map(t)});function ts(s,t,e){let i=s.facet(jP);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const yc=Y.define({combine:s=>s.length?s[0]:!0});let yq=0;const bh=Y.define();let _b=class Ey{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:r}=e||{};return new Ey(yq++,t,i,o=>{let l=[bh.of(o)];return r&&l.push(Wa.of(h=>{let a=h.plugin(o);return a?r(a):ye.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return Ey.define(i=>new t(i),e)}},bp=class{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(ts(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){ts(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){ts(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const XP=Y.define(),ZP=Y.define(),Wa=Y.define(),QP=Y.define(),_P=Y.define(),xh=Y.define();let za=class $u{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new $u(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new $u(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new $u(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}},eA=class tL{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=hs.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new za(o,l,h,a))),this.changedRanges=n;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}static create(t,e,i){return new tL(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}};var we=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(we||(we={}));const Py=we.LTR,wq=we.RTL;function eL(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const bq=eL("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),xq=eL("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Ly=Object.create(null),On=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);Ly[t]=e,Ly[e]=-t}function Sq(s){return s<=247?bq[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?xq[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||s==8204?256:1}const vq=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;let Ko=class{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?wq:Py}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};const Ot=[];function kq(s,t){let e=s.length,i=t==Py?1:2,n=t==Py?2:1;if(!s||i==1&&!vq.test(s))return iL(e);for(let o=0,l=i,h=i;o<e;o++){let a=Sq(s.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),Ot[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=Ot[o];if(a==128)o<e-1&&l==Ot[o+1]&&l&24?a=Ot[o]=l:Ot[o]=256;else if(a==64){let c=o+1;for(;c<e&&Ot[c]==64;)c++;let f=o&&l==8||c<e&&Ot[c]==8?h==1?1:8:256;for(let u=o;u<c;u++)Ot[u]=f;o=c-1}else a==8&&h==1&&(Ot[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,c,f;o<e;o++)if(c=Ly[a=s.charCodeAt(o)])if(c<0){for(let u=l-3;u>=0;u-=3)if(On[u+1]==-c){let d=On[u+2],g=d&2?i:d&4?d&1?n:i:0;g&&(Ot[o]=Ot[On[u]]=g),l=u;break}}else{if(On.length==189)break;On[l++]=o,On[l++]=a,On[l++]=h}else if((f=Ot[o])==2||f==1){let u=f==i;h=u?0:1;for(let d=l-3;d>=0;d-=3){let g=On[d+2];if(g&2)break;if(u)On[d+2]|=2;else{if(g&4)break;On[d+2]|=4}}}for(let o=0;o<e;o++)if(Ot[o]==256){let l=o+1;for(;l<e&&Ot[l]==256;)l++;let h=(o?Ot[o-1]:i)==1,a=(l<e?Ot[l]:i)==1,c=h==a?h?1:2:i;for(let f=o;f<l;f++)Ot[f]=c;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=Ot[o++]!=1;for(;o<e&&h==(Ot[o]!=1);)o++;if(h)for(let a=o;a>l;){let c=a,f=Ot[--a]!=2;for(;a>l&&f==(Ot[a-1]!=2);)a--;r.push(new Ko(a,c,f?2:1))}else r.push(new Ko(l,o,0))}else for(let o=0;o<e;){let l=o,h=Ot[o++]==2;for(;o<e&&h==(Ot[o]==2);)o++;r.push(new Ko(l,o,h?1:2))}return r}function iL(s){return[new Ko(0,s,0)]}let nL="";function Aq(s,t,e,i,n){var r;let o=i.head-s.from,l=-1;if(o==0){if(!n||!s.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==s.length){if(n)return null;let u=t[t.length-1];u.level!=e&&(o=u.side(!0,e),l=t.length-1)}l<0&&(l=Ko.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),c=Us(s.text,o,a);if(nL=s.text.slice(Math.min(o,c),Math.max(o,c)),c!=h.side(n,e))return P.cursor(c+s.from,a?-1:1,h.level);let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!f&&h.level!=e?P.cursor(n?s.to:s.from,n?-1:1,e):f&&f.level<h.level?P.cursor(f.side(!n,e)+s.from,n?1:-1,f.level):P.cursor(c+s.from,n?-1:1,h.level)}const Js="￿";let sL=class{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(ni.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Js}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let r=n.nextSibling;if(r==e)break;let o=ie.get(n),l=ie.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:iA(n))||iA(r)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=r}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=ie.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}};function iA(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}let nA=class{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}},sA=class extends ie{constructor(t){super(),this.view=t,this.compositionDeco=ye.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new hn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new za(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ye.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=Mq(this.view,t.changes)),(O.ie||O.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),r=$q(i,n,t.changes);return e=za.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let r=O.chrome||O.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof Ry&&r.widget instanceof rA&&n.push(r.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let r=n>=0?t[n]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:c,breakAtStart:f,openStart:u,openEnd:d}=mq.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:g,off:m}=i.findPos(l,1),{i:p,off:y}=i.findPos(o,-1);OP(this,p,y,g,m,c,f,u,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||O.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),o=n.empty?r:this.domAtPos(n.head);if(O.gecko&&n.empty&&Cq(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new Qe(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!Od(r.node,r.offset,l.anchorNode,l.anchorOffset)||!Od(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{O.android&&O.chrome&&this.dom.contains(l.focusNode)&&Rq(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Dd(this.root);if(n.empty){if(O.gecko){let a=Oq(r.node,r.offset);if(a&&a!=3){let c=oL(r.node,r.offset,a==1?1:-1);c&&(r=new Qe(c,a==1?0:c.nodeValue.length))}}h.collapse(r.node,r.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new Qe(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new Qe(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Dd(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=hn.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(yc)?this.root.activeElement==this.dom:py(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=ie.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof hn)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=Yt.WidgetBefore&&r.type!=Yt.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==Yt.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==we.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?Ia(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?we.RTL:we.LTR}measureTextSize(){for(let n of this.children)if(n instanceof hn){let r=n.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=Ia(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new DP(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(ye.replace({widget:new rA(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return ye.set(t)}updateDeco(){let t=this.view.state.facet(Wa).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=0,o=0,l=0,h=0;for(let c of this.view.state.facet(_P).map(f=>f(this.view)))if(c){let{left:f,right:u,top:d,bottom:g}=c;f!=null&&(r=Math.max(r,f)),u!=null&&(o=Math.max(o,u)),d!=null&&(l=Math.max(l,d)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};aq(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==we.LTR)}};function Cq(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}let rA=class extends pg{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function rL(s){let t=s.observer.selectionRange,e=t.focusNode&&oL(t.focusNode,t.focusOffset,0);if(!e)return null;let i=s.docView.nearest(e);if(!i)return null;if(i instanceof hn){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let r=n.previousSibling;for(;r&&!ie.get(r);)r=r.previousSibling;let o=r?ie.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof hn)break;i=r}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function Mq(s,t){let e=rL(s);if(!e)return ye.none;let{from:i,to:n,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=s,c=r.nodeType==3?r.nodeValue:new sL([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),Js)==c)h=l+c.length;else if(a.doc.sliceString(Math.max(0,h-c.length),h,Js)==c)l=h-c.length;else return ye.none;else if(a.doc.sliceString(l,h,Js)!=c)return ye.none;let f=ie.get(r);return f instanceof BP?f=f.widget.topView:f&&(f.parent=null),ye.set(ye.replace({widget:new Dq(r,o,f),inclusive:!0}).range(l,h))}let Dq=class extends pg{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return BP}};function oL(s,t,e){for(;;){if(s.nodeType==3)return s;if(s.nodeType==1&&t>0&&e<=0)s=s.childNodes[t-1],t=Td(s);else if(s.nodeType==1&&t<s.childNodes.length&&e>=0)s=s.childNodes[t],t=0;else return null}}function Oq(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let Tq=class{constructor(){this.changes=[]}compareRange(t,e){$y(t,e,this.changes)}comparePoint(t,e){$y(t,e,this.changes)}};function $q(s,t,e){let i=new Tq;return Re.compare(s,t,e,i),i.changes}function Rq(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function Bq(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return P.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=Us(n.text,r,!1):l=Us(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=Us(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=Us(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return P.range(o+n.from,l+n.from)}function Eq(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function Pq(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function xp(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function oA(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function lA(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function Vy(s,t,e){let i,n,r,o,l,h,a,c;for(let d=s.firstChild;d;d=d.nextSibling){let g=Ia(d);for(let m=0;m<g.length;m++){let p=g[m];n&&xp(n,p)&&(p=oA(lA(p,n.bottom),n.top));let y=Eq(t,p),w=Pq(e,p);if(y==0&&w==0)return d.nodeType==3?hA(d,t,e):Vy(d,t,e);(!i||o>w||o==w&&r>y)&&(i=d,n=p,r=y,o=w),y==0?e>p.bottom&&(!a||a.bottom<p.bottom)?(l=d,a=p):e<p.top&&(!c||c.top>p.top)&&(h=d,c=p):a&&xp(a,p)?a=lA(a,p.bottom):c&&xp(c,p)&&(c=oA(c,p.top))}}if(a&&a.bottom>=e?(i=l,n=a):c&&c.top<=e&&(i=h,n=c),!i)return{node:s,offset:0};let f=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return hA(i,f,e);if(!r&&i.contentEditable=="true")return Vy(i,f,e);let u=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:u}}function hA(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=Na(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if((O.chrome||O.gecko)&&Na(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function lL(s,{x:t,y:e},i,n=-1){var r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,c=e-l;if(c<0)return 0;if(c>a)return s.state.doc.length;for(let y=s.defaultLineHeight/2,w=!1;h=s.elementAtHeight(c),h.type!=Yt.Text;)for(;c=n>0?h.bottom+y:h.top-y,!(c>=0&&c<=a);){if(w)return i?null:0;w=!0,n=-n}e=l+c;let f=h.from;if(f<s.viewport.from)return s.viewport.from==0?0:i?null:aA(s,o,h,t,e);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:i?null:aA(s,o,h,t,e);let u=s.dom.ownerDocument,d=s.root.elementFromPoint?s.root:u,g=d.elementFromPoint(t,e);g&&!s.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=d.elementFromPoint(t,e),g&&!s.contentDOM.contains(g)&&(g=null));let m,p=-1;if(g&&((r=s.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(u.caretPositionFromPoint){let y=u.caretPositionFromPoint(t,e);y&&({offsetNode:m,offset:p}=y)}else if(u.caretRangeFromPoint){let y=u.caretRangeFromPoint(t,e);y&&({startContainer:m,startOffset:p}=y,O.safari&&Lq(m,p,t)&&(m=void 0))}}if(!m||!s.docView.dom.contains(m)){let y=hn.find(s.docView,f);if(!y)return c>h.top+h.height/2?h.to:h.from;({node:m,offset:p}=Vy(y.dom,t,e))}return s.docView.posFromDOM(m,p)}function aA(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=Math.floor((n-e.top)/s.defaultLineHeight);r+=l*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+oq(o,r,s.state.tabSize)}function Lq(s,t,e){let i;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return Na(s,i-1,i).getBoundingClientRect().left>e}function Vq(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=!i||!s.lineWrapping?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let h=s.dom.getBoundingClientRect(),a=s.textDirectionAt(n.from),c=s.posAtCoords({x:e==(a==we.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(c!=null)return P.cursor(c,e?-1:1)}let o=hn.find(s.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return P.cursor(l,e?-1:1)}function cA(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=Aq(n,r,o,l,e),c=nL;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=P.cursor(e?n.from:n.to)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function Iq(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==ln.Space&&(n=o),n==o}}function Nq(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return P.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.defaultLineHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=lL(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n))return P.cursor(m,t.assoc,void 0,o)}}function Sp(s,t,e){let i=s.state.facet(QP).map(n=>n(s));for(;;){let n=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?P.cursor(o,1):P.cursor(l,-1),n=!0)});if(!n)return e}}let Hq=class{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in fe){let i=fe[e];t.contentDOM.addEventListener(e,n=>{!fA(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))}),this.registeredEvents.push(e)}O.chrome&&O.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,O.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let r of e)if(n=(i=r.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{fA(t,l)&&this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let r=n.handlers[t];if(r)try{if(r.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){ts(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(r){ts(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(O.android&&O.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return O.ios&&(i=hL.find(n=>n.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Jh(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:O.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!O.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};const hL=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],aL=[16,17,18,20,91,92,224,225];let Fq=class{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(ni.allowMultipleSelections)&&Wq(t,e),this.dragMove=zq(t,e),this.dragging=qq(t,e)&&tx(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}};function Wq(s,t){let e=s.state.facet(qP);return e.length?e[0](t):O.mac?t.metaKey:t.ctrlKey}function zq(s,t){let e=s.state.facet(KP);return e.length?e[0](t):O.mac?!t.altKey:!t.ctrlKey}function qq(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=Dd(s.root);if(i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function fA(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=ie.get(e))&&i.ignoreEvent(t))return!1;return!0}const fe=Object.create(null),cL=O.ie&&O.ie_version<15||O.ios&&O.webkit_version<604;function Kq(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),fL(s,e.value)},50)}function fL(s,t){let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(Iy!=null&&e.selection.ranges.every(h=>h.empty)&&Iy==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:P.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:P.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}fe.keydown=(s,t)=>{s.inputState.setSelectionOrigin("select"),t.keyCode==27?s.inputState.lastEscPress=Date.now():aL.indexOf(t.keyCode)<0&&(s.inputState.lastEscPress=0)};let uL=0;fe.touchstart=(s,t)=>{uL=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};fe.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};fe.mousedown=(s,t)=>{if(s.observer.flush(),uL>Date.now()-2e3&&tx(t)==1)return;let e=null;for(let i of s.state.facet(GP))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=Uq(s,t)),e){let i=s.root.activeElement!=s.contentDOM;i&&s.observer.ignore(()=>CP(s.contentDOM)),s.inputState.startMouseSelection(new Fq(s,t,e,i))}};function uA(s,t,e,i){if(i==1)return P.cursor(t,e);if(i==2)return Bq(s.state,t,e);{let n=hn.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,P.range(o,l)}}let dL=(s,t)=>s>=t.top&&s<=t.bottom,dA=(s,t,e)=>dL(t,e)&&s>=e.left&&s<=e.right;function Gq(s,t,e,i){let n=hn.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&dA(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&dA(e,i,l)?1:o&&dL(i,o)?-1:1}function gA(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:Gq(s,e,t.clientX,t.clientY)}}const jq=O.ie&&O.ie_version<=11;let pA=null,mA=0,yA=0;function tx(s){if(!jq)return s.detail;let t=pA,e=yA;return pA=s,yA=Date.now(),mA=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(mA+1)%3:1}function Uq(s,t){let e=gA(s,t),i=tx(t),n=s.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),n=n.map(l.changes),o=null)},get(l,h,a){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=r:(c=r=gA(s,l),o=l),!c||!e)return n;let f=uA(s,c.pos,c.bias,i);if(e.pos!=c.pos&&!h){let u=uA(s,e.pos,e.bias,i),d=Math.min(u.from,f.from),g=Math.max(u.to,f.to);f=d<f.from?P.range(d,g):P.range(g,d)}return h?n.replaceRange(n.main.extend(f.from,f.to)):a?n.addRange(f):P.create([f])}}}fe.dragstart=(s,t)=>{let{selection:{main:e}}=s.state,{mouseSelection:i}=s.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",s.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function wA(s,t,e,i){if(!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=s.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}fe.drop=(s,t)=>{if(!t.dataTransfer)return;if(s.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,r=()=>{++n==e.length&&wA(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else wA(s,t,t.dataTransfer.getData("Text"),!0)};fe.paste=(s,t)=>{if(s.state.readOnly)return t.preventDefault();s.observer.flush();let e=cL?null:t.clipboardData;e?(fL(s,e.getData("text/plain")),t.preventDefault()):Kq(s)};function Jq(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function Yq(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(s.lineBreak),ranges:e,linewise:i}}let Iy=null;fe.copy=fe.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=Yq(s.state);if(!e&&!n)return;Iy=n?e:null;let r=cL?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):Jq(s,e),t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function gL(s){setTimeout(()=>{s.hasFocus!=s.inputState.notifiedFocused&&s.update([])},10)}fe.focus=gL;fe.blur=s=>{s.observer.clearSelectionRange(),gL(s)};function pL(s,t){if(s.docView.compositionDeco.size){s.inputState.rapidCompositionStart=t;try{s.update([])}finally{s.inputState.rapidCompositionStart=!1}}}fe.compositionstart=fe.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0,s.docView.compositionDeco.size&&(s.observer.flush(),pL(s,!0)))};fe.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionFirstChange=null,setTimeout(()=>{s.inputState.composing<0&&pL(s,!1)},50)};fe.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};fe.beforeinput=(s,t)=>{var e;let i;if(O.chrome&&O.android&&(i=hL.find(n=>n.inputType==t.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}};const bA=["pre-wrap","normal","pre-line","break-spaces"];let Xq=class{constructor(){this.doc=wt.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return bA.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r){let o=bA.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<r.length;h++){let a=r[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}},Zq=class{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}},xo=class mL{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new mL(this.from,this.length+t.length,this.top,this.height+t.height,e)}};var ct=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(ct||(ct={}));const Ru=.001;let es=class Bu{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>Ru&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Bu.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:c}=n[o],f=r.lineAt(l,ct.ByPosNoHeight,e,0,0),u=f.to>=h?f:r.lineAt(h,ct.ByPosNoHeight,e,0,0);for(c+=u.to-h,h=u.to;o>0&&f.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<f.from&&(f=r.lineAt(l,ct.ByPosNoHeight,e,0,0));a+=f.from-l,l=f.from;let d=t7.build(i,t,a,c);r=r.replace(l,h,d)}return r.updateHeight(i,0)}static empty(){return new zn(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new Qq(Bu.of(t.slice(0,e)),o,Bu.of(t.slice(i)))}};es.prototype.size=1;let yL=class extends es{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new xo(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},zn=class Ny extends yL{constructor(t,e){super(t,e,Yt.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof Ny||n instanceof Go&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Go?n=new Ny(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):es.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},Go=class Ui extends es{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:c}=e.line(r+h);return new xo(a,c,i+l*h,l,Yt.Text)}lineAt(t,e,i,n,r){if(e==ct.ByHeight)return this.blockAt(t,i,n,r);if(e==ct.ByPosNoHeight){let{from:f,to:u}=i.lineAt(t);return new xo(f,u-f,0,0,Yt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:c}=i.lineAt(t);return new xo(h,a,n+l*(c-o),l,Yt.Text)}forEachLine(t,e,i,n,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),c=Math.min(r+this.length,e);a<=c;){let f=i.lineAt(a);a==t&&(n+=h*(f.number-l)),o(new xo(f.from,f.length,n,h,Yt.Text)),n+=h,a=f.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof Ui?i[i.length-1]=new Ui(r.length+n):i.push(null,new Ui(n-1))}if(t>0){let r=i[0];r instanceof Ui?i[0]=new Ui(t+r.length):i.unshift(new Ui(t-1),null)}return es.of(i)}decomposeLeft(t,e){e.push(new Ui(t-1),null)}decomposeRight(t,e){e.push(null,new Ui(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new Ui(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let f=t.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];h==-1?h=u:Math.abs(u-h)>=Ru&&(h=-2);let d=new zn(f,u);d.outdated=!1,o.push(d),l+=f+1}l<=r&&o.push(null,new Ui(r-l).updateHeight(t,l));let c=es.of(o);return t.heightChanged=a||h<0||Math.abs(c.height-this.height)>=Ru||Math.abs(h-this.lines(t.doc,e).lineHeight)>=Ru,c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},Qq=class extends es{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==ct.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==ct.ByPosNoHeight?ct.ByPosNoHeight:ct.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,ct.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&xA(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),xA(r,l)}return es.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?es.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function xA(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof Go&&(i=s[t+1])instanceof Go&&s.splice(t-1,3,new Go(e.length+1+i.length))}const _q=5;let t7=class wL{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof zn?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new zn(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new yL(r,n,i.type)):(r||n>=_q)&&this.addLineDeco(n,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new zn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Go(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof zn)return t;let e=new zn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==Yt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Yt.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof zn)&&!this.isCovered?this.nodes.push(new zn(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof zn&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new wL(i,t);return Re.spans(e,i,n,r,0),r.finish(i)}};function e7(s,t,e){let i=new i7;return Re.compare(s,t,e,i,0),i.changes}let i7=class{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&$y(t,e,this.changes,5)}};function n7(s,t){let e=s.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=s.ownerDocument.body;for(let h=s.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,c=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&c.overflow!="visible"){let f=a.getBoundingClientRect();i=Math.max(i,f.left),n=Math.min(n,f.right),r=Math.max(r,f.top),o=Math.min(o,f.bottom)}h=c.position=="absolute"||c.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}function s7(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}let vp=class{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t){return ye.replace({widget:new r7(this.size,t)}).range(this.from,this.to)}},r7=class extends pg{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}},SA=class{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Xq,this.scaler=AA,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=we.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Wa).filter(e=>typeof e!="function"),this.heightMap=es.empty().applyChanges(this.stateDeco,wt.empty,this.heightOracle.setDoc(t.doc),[new za(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ye.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new uf(r,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?AA:new h7(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:Sh(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Wa).filter(a=>typeof a!="function");let n=t.changedRanges,r=za.extendWithRanges(n,e7(i,this.stateDeco,t?t.changes:hs.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?we.RTL:we.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,c=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let u=(this.printing?s7:n7)(e,this.paddingTop),d=u.top-this.pixelViewport.top,g=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let w=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(w)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:x,charWidth:b}=t.docView.measureTextSize();o=n.refresh(r,x,b,p/b,w),o&&(t.docView.minWidth=0,h|=8)}d>0&&g>0?a=Math.max(d,g):d<0&&g<0&&(a=Math.min(d,g)),n.heightChanged=!1;for(let x of this.viewports){let b=x.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(x);this.heightMap=this.heightMap.updateHeight(n,0,o,new Zq(x.from,b))}n.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new uf(n.lineAt(o-i*1e3,ct.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,ct.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,ct.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new uf(n.lineAt(u-1e3/2,ct.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,ct.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new uf(this.heightMap.lineAt(i,ct.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,ct.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,ct.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,ct.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new vp(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=we.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=o7(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=df(n,(this.visibleTop-i.top-a)/i.height),o=df(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;r=df(n,(this.pixelViewport.left-c)/a),o=df(n,(this.pixelViewport.right+c)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&kA(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&kA(l,h.to-10,h.to+10);for(let{from:a,to:c}of l)c-a>1e3&&e.push(l7(t,f=>f.from>=i.from&&f.to<=i.to&&Math.abs(f.from-a)<1e3&&Math.abs(f.to-c)<1e3)||new vp(a,c,this.gapSize(i,a,c,n)))}return e}gapSize(t,e,i,n){let r=vA(n,i)-vA(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){vp.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=ye.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Re.spans(t,this.viewport.from,this.viewport.to,{span(n,r){e.push({from:n,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=e[r].from||n.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||Sh(this.heightMap.lineAt(t,ct.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Sh(this.heightMap.lineAt(this.scaler.fromDOM(t),ct.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Sh(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},uf=class{constructor(t,e){this.from=t,this.to=e}};function o7(s,t,e){let i=[],n=s,r=0;return Re.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function df({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function vA(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function kA(s,t,e){for(let i=0;i<s.length;i++){let n=s[i];if(n.from<e&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>e&&r.push({from:e,to:n.to}),s.splice(i,1,...r),i+=r.length-1}}}function l7(s,t){for(let e of s)if(t(e))return e}const AA={toDOM(s){return s},fromDOM(s){return s},scale:1};let h7=class{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,ct.ByPos,t,0,0).top,c=e.lineAt(h,ct.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}};function Sh(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new xo(s.from,s.length,e,i-e,Array.isArray(s.type)?s.type.map(n=>Sh(n,t)):s.type)}const gf=Y.define({combine:s=>s.join(" ")}),Hy=Y.define({combine:s=>s.indexOf(!0)>-1}),Fy=I.newName(),bL=I.newName(),xL=I.newName(),SL={"&light":"."+bL,"&dark":"."+xL};function Wy(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const a7=Wy("."+Fy,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},SL),c7={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},kp=O.ie&&O.ie_version<=11;let f7=class{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new cq,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(O.ie&&O.ie_version<=11||O.ios&&t.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),kp&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(yc)?e.root.activeElement!=this.dom:!py(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((O.ie&&O.ie_version<=11||O.android&&O.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Od(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Dd(t),i=O.safari&&t.nodeType==11&&lq()==this.view.contentDOM&&u7(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,c7),kp&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),kp&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Jh(this.view.contentDOM,i.key,i.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&py(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=CA(e,t.previousSibling||t.target.previousSibling,-1),n=CA(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function CA(s,t,e){for(;t;){let i=ie.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function u7(s){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return Od(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}function d7(s,t,e,i){let n,r,o=s.state.selection.main;if(t>-1){let l=s.docView.domBoundsAround(t,e,0);if(!l||s.state.readOnly)return!1;let{from:h,to:a}=l,c=s.docView.impreciseHead||s.docView.impreciseAnchor?[]:p7(s),f=new sL(c,s.state);f.readRange(l.startDOM,l.endDOM);let u=o.from,d=null;(s.inputState.lastKeyCode===8&&s.inputState.lastKeyTime>Date.now()-100||O.android&&f.text.length<a-h)&&(u=o.to,d="end");let g=g7(s.state.doc.sliceString(h,a,Js),f.text,u-h,d);g&&(O.chrome&&s.inputState.lastKeyCode==13&&g.toB==g.from+2&&f.text.slice(g.from,g.toB)==Js+Js&&g.toB--,n={from:h+g.from,to:h+g.toA,insert:wt.of(f.text.slice(g.from,g.toB).split(Js))}),r=m7(c,h)}else if(s.hasFocus||!s.state.facet(yc)){let l=s.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=s.docView,c=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!ul(s.contentDOM,l.focusNode)?s.state.selection.main.head:s.docView.posFromDOM(l.focusNode,l.focusOffset),f=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!ul(s.contentDOM,l.anchorNode)?s.state.selection.main.anchor:s.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||f!=o.anchor)&&(r=P.single(f,c))}if(!n&&!r)return!1;if(!n&&i&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,n.from).append(n.insert).append(s.state.doc.slice(n.to,o.to))}:(O.mac||O.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:wt.of([" "])}),n){let l=s.state;if(O.ios&&s.inputState.flushIOSKey(s)||O.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&Jh(s.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&Jh(s.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&Jh(s.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(s.state.facet(UP).some(f=>f(s,n.from,n.to,h)))return!0;s.inputState.composing>=0&&s.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&s.inputState.composing<0){let f=o.from<n.from?l.sliceDoc(o.from,n.from):"",u=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(s.state.toText(f+n.insert.sliceString(0,void 0,s.state.lineBreak)+u))}else{let f=l.changes(n),u=r&&!l.selection.main.eq(r.main)&&r.main.to<=f.newLength?r.main:void 0;if(l.selection.ranges.length>1&&s.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=s.state.sliceDoc(n.from,n.to),g=rL(s)||s.state.doc.lineAt(o.head),m=o.to-n.to,p=o.to-o.from;a=l.changeByRange(y=>{if(y.from==o.from&&y.to==o.to)return{changes:f,range:u||y.map(f)};let w=y.to-m,x=w-d.length;if(y.to-y.from!=p||s.state.sliceDoc(x,w)!=d||g&&y.to>=g.from&&y.from<=g.to)return{range:y};let b=l.changes({from:x,to:w,insert:n.insert}),S=y.to-o.to;return{changes:b,range:u?P.range(Math.max(0,u.anchor+S),Math.max(0,u.head+S)):y.map(b)}})}else a={changes:f,selection:u&&l.selection.replaceRange(u)}}let c="input.type";return s.composing&&(c+=".compose",s.inputState.compositionFirstChange&&(c+=".start",s.inputState.compositionFirstChange=!1)),s.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(o)){let l=!1,h="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(l=!0),h=s.inputState.lastSelectionOrigin),s.dispatch({selection:r,scrollIntoView:l,userEvent:h}),!0}else return!1}function g7(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function p7(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new nA(e,i)),(n!=e||r!=i)&&t.push(new nA(n,r))),t}function m7(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?P.single(e+t,i+t):null}let Bt=class vL{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||fq(t.parent)||document,this.viewState=new SA(t.state||ni.create()),this.plugins=this.state.facet(bh).map(e=>new bp(e));for(let e of this.plugins)e.update(this);this.observer=new f7(this,(e,i,n)=>d7(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new Hq(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new sA(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof mn?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let l of t){if(l.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=l.state}if(this.destroyed){this.viewState.state=r;return}if(this.observer.clear(),r.facet(ni.phrases)!=this.state.facet(ni.phrases))return this.setState(r);n=eA.create(this,r,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new _2(h.empty?h:P.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(tA)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=DA.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(xh)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(gf)!=n.state.facet(gf)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(By))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new SA(t),this.plugins=t.facet(bh).map(i=>new bp(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new sA(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(bh),i=t.state.facet(bh);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new bp(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let n=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(f=>{try{return f.read(this)}catch(u){return ts(this.state,u),MA}}),h=eA.create(this,this.state,[]),a=!1,c=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let f=0;f<o.length;f++)if(l[f]!=MA)try{let u=o[f];u.write&&u.write(l[f],this)}catch(u){ts(this.state,u)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),a&&this.docView.updateSelection(!0),this.viewport.from==n.from&&this.viewport.to==n.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(By))i(e)}get themeClasses(){return Fy+" "+(this.state.facet(Hy)?xL:bL)+" "+this.state.facet(gf)}updateAttrs(){let t=OA(this,XP,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(yc)?"true":"false",class:"cm-content",style:`${O.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),OA(this,ZP,e);let i=this.observer.ignore(()=>{let n=Ty(this.contentDOM,this.contentAttrs,e),r=Ty(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(vL.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(xh),I.mount(this.root,this.styleModules.concat(a7).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Sp(this,t,cA(this,t,e,i))}moveByGroup(t,e){return Sp(this,t,cA(this,t,e,i=>Iq(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return Vq(this,t,e,i)}moveVertically(t,e,i){return Sp(this,t,Nq(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),lL(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[Ko.find(r,t-n.from,-1,e)];return dg(i,o.dir==we.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(JP)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>y7)return iL(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=kq(t.text,e);return this.bidiCache.push(new DA(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||O.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{CP(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return tA.of(new _2(typeof t=="number"?P.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return _b.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=I.newName(),n=[gf.of(i),xh.of(Wy(`.${i}`,t))];return e&&e.dark&&n.push(Hy.of(!0)),n}static baseTheme(t){return sP.lowest(xh.of(Wy("."+Fy,t,SL)))}};Bt.styleModule=xh;Bt.inputHandler=UP;Bt.perLineTextDirection=JP;Bt.exceptionSink=jP;Bt.updateListener=By;Bt.editable=yc;Bt.mouseSelectionStyle=GP;Bt.dragMovesSelection=KP;Bt.clickAddsSelectionRange=qP;Bt.decorations=Wa;Bt.atomicRanges=QP;Bt.scrollMargins=_P;Bt.darkTheme=Hy;Bt.contentAttributes=ZP;Bt.editorAttributes=XP;Bt.lineWrapping=Bt.contentAttributes.of({class:"cm-lineWrapping"});Bt.announce=Ht.define();const y7=4096,MA={};let DA=class kL{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:we.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new kL(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}};function OA(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&Oy(o,e)}return e}const w7=O.mac?"mac":O.windows?"win":O.linux?"linux":"key";function b7(s,t){const e=s.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let n,r,o,l;for(let h=0;h<e.length-1;++h){const a=e[h];if(/^(cmd|meta|m)$/i.test(a))l=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))t=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Ap(s,t,e){return t.altKey&&(s="Alt-"+s),t.ctrlKey&&(s="Ctrl-"+s),t.metaKey&&(s="Meta-"+s),e!==!1&&t.shiftKey&&(s="Shift-"+s),s}const x7=Bt.domEventHandlers({keydown(s,t){return A7(S7(t.state),s,t,"editor")}}),AL=Y.define({enables:x7}),TA=new WeakMap;function S7(s){let t=s.facet(AL),e=TA.get(t);return e||TA.set(t,e=k7(t.reduce((i,n)=>i.concat(n),[]))),e}let Fs=null;const v7=4e3;function k7(s,t=w7){let e=Object.create(null),i=Object.create(null),n=(o,l)=>{let h=i[o];if(h==null)i[o]=l;else if(h!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,h,a)=>{let c=e[o]||(e[o]=Object.create(null)),f=l.split(/ (?!$)/).map(g=>b7(g,t));for(let g=1;g<f.length;g++){let m=f.slice(0,g).join(" ");n(m,!0),c[m]||(c[m]={preventDefault:!0,commands:[p=>{let y=Fs={view:p,prefix:m,scope:o};return setTimeout(()=>{Fs==y&&(Fs=null)},v7),!0}]})}let u=f.join(" ");n(u,!1);let d=c[u]||(c[u]={preventDefault:!1,commands:[]});d.commands.push(h),a&&(d.preventDefault=!0)};for(let o of s){let l=o[t]||o.key;if(l)for(let h of o.scope?o.scope.split(" "):["editor"])r(h,l,o.run,o.preventDefault),o.shift&&r(h,"Shift-"+l,o.shift,o.preventDefault)}return e}function A7(s,t,e,i){let n=ob(t),r=n.length==1&&n!=" ",o="",l=!1;Fs&&Fs.view==e&&Fs.scope==i&&(o=Fs.prefix+" ",(l=aL.indexOf(t.keyCode)<0)&&(Fs=null));let h=f=>{if(f){for(let u of f.commands)if(u(e))return!0;f.preventDefault&&(l=!0)}return!1},a=s[i],c;if(a){if(h(a[o+Ap(n,t,!r)]))return!0;if(r&&(t.shiftKey||t.altKey||t.metaKey)&&(c=rs[t.keyCode])&&c!=n){if(h(a[o+Ap(c,t,!0)]))return!0}else if(r&&t.shiftKey&&h(a[o+Ap(n,t,!0)]))return!0}return l}const C7=!O.ios,M7={".cm-line":{}};C7&&(M7[".cm-line"].caretColor="transparent !important");const Cp="-10000px";let D7=class{constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter(n=>n),this.tooltipViews=this.tooltips.map(i)}update(t){let e=t.state.facet(this.facet),i=e.filter(r=>r);if(e===this.input){for(let r of this.tooltipViews)r.update&&r.update(t);return!1}let n=[];for(let r=0;r<i.length;r++){let o=i[r],l=-1;if(o){for(let h=0;h<this.tooltips.length;h++){let a=this.tooltips[h];a&&a.create==o.create&&(l=h)}if(l<0)n[r]=this.createTooltipView(o);else{let h=n[r]=this.tooltipViews[l];h.update&&h.update(t)}}}for(let r of this.tooltipViews)n.indexOf(r)<0&&r.dom.remove();return this.input=e,this.tooltips=i,this.tooltipViews=n,!0}};function O7(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const Mp=Y.define({combine:s=>{var t,e,i;return{position:O.ios?"absolute":((t=s.find(n=>n.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((e=s.find(n=>n.parent))===null||e===void 0?void 0:e.parent)||null,tooltipSpace:((i=s.find(n=>n.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||O7}}}),CL=_b.fromClass(class{constructor(s){var t;this.view=s,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=s.state.facet(Mp);this.position=e.position,this.parent=e.parent,this.classes=s.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new D7(s,ML,i=>this.createTooltip(i)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(t=s.dom.ownerDocument.defaultView)===null||t===void 0||t.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let s of this.manager.tooltipViews)this.intersectionObserver.observe(s.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(s){s.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(s);t&&this.observeIntersection();let e=t||s.geometryChanged,i=s.state.facet(Mp);if(i.position!=this.position){this.position=i.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;e=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);e=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);e&&this.maybeMeasure()}createTooltip(s){let t=s.create(this.view);if(t.dom.classList.add("cm-tooltip"),s.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",t.dom.appendChild(e)}return t.dom.style.position=this.position,t.dom.style.top=Cp,this.container.appendChild(t.dom),t.mount&&t.mount(this.view),t}destroy(){var s,t;(s=this.view.dom.ownerDocument.defaultView)===null||s===void 0||s.removeEventListener("resize",this.measureSoon);for(let{dom:e}of this.manager.tooltipViews)e.remove();(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let s=this.view.dom.getBoundingClientRect();return{editor:s,parent:this.parent?this.container.getBoundingClientRect():s,pos:this.manager.tooltips.map((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(({dom:t})=>t.getBoundingClientRect()),space:this.view.state.facet(Mp).tooltipSpace(this.view)}}writeMeasure(s){let{editor:t,space:e}=s,i=[];for(let n=0;n<this.manager.tooltips.length;n++){let r=this.manager.tooltips[n],o=this.manager.tooltipViews[n],{dom:l}=o,h=s.pos[n],a=s.size[n];if(!h||h.bottom<=Math.max(t.top,e.top)||h.top>=Math.min(t.bottom,e.bottom)||h.right<Math.max(t.left,e.left)-.1||h.left>Math.min(t.right,e.right)+.1){l.style.top=Cp;continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,f=c?7:0,u=a.right-a.left,d=a.bottom-a.top,g=o.offset||$7,m=this.view.textDirection==we.LTR,p=a.width>e.right-e.left?m?e.left:e.right-a.width:m?Math.min(h.left-(c?14:0)+g.x,e.right-u):Math.max(e.left,h.left-u+(c?14:0)-g.x),y=!!r.above;!r.strictSide&&(y?h.top-(a.bottom-a.top)-g.y<e.top:h.bottom+(a.bottom-a.top)+g.y>e.bottom)&&y==e.bottom-h.bottom>h.top-e.top&&(y=!y);let w=y?h.top-d-f-g.y:h.bottom+f+g.y,x=p+u;if(o.overlap!==!0)for(let b of i)b.left<x&&b.right>p&&b.top<w+d&&b.bottom>w&&(w=y?b.top-d-2-f:b.bottom+f+2);this.position=="absolute"?(l.style.top=w-s.parent.top+"px",l.style.left=p-s.parent.left+"px"):(l.style.top=w+"px",l.style.left=p+"px"),c&&(c.style.left=`${h.left+(m?g.x:-g.x)-(p+14-7)}px`),o.overlap!==!0&&i.push({left:p,top:w,right:x,bottom:w+d}),l.classList.toggle("cm-tooltip-above",y),l.classList.toggle("cm-tooltip-below",!y),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let s of this.manager.tooltipViews)s.dom.style.top=Cp}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),T7=Bt.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),$7={x:0,y:0},ML=Y.define({enables:[CL,T7]});function R7(s,t){let e=s.plugin(CL);if(!e)return null;let i=e.manager.tooltips.indexOf(t);return i<0?null:e.manager.tooltipViews[i]}let dl=class extends $r{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}};dl.prototype.elementClass="";dl.prototype.toDOM=void 0;dl.prototype.mapMode=Ge.TrackBefore;dl.prototype.startSide=dl.prototype.endSide=-1;dl.prototype.point=!0;class DL{constructor(t,e,i){this.state=t,this.pos=e,this.explicit=i,this.abortListeners=[]}tokenBefore(t){let e=$e(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),n=e.text.slice(i-e.from,this.pos-e.from),r=n.search(OL(t,!1));return r<0?null:{from:i+r,to:this.pos,text:n.slice(r)}}get aborted(){return this.abortListeners==null}addEventListener(t,e){t=="abort"&&this.abortListeners&&this.abortListeners.push(e)}}function $A(s){let t=Object.keys(s).join(""),e=/\w/.test(t);return e&&(t=t.replace(/\w/g,"")),`[${e?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function B7(s){let t=Object.create(null),e=Object.create(null);for(let{label:n}of s){t[n[0]]=!0;for(let r=1;r<n.length;r++)e[n[r]]=!0}let i=$A(t)+$A(e)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function E7(s){let t=s.map(n=>typeof n=="string"?{label:n}:n),[e,i]=t.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:B7(t);return n=>{let r=n.matchBefore(i);return r||n.explicit?{from:r?r.from:n.pos,options:t,validFor:e}:null}}class RA{constructor(t,e,i){this.completion=t,this.source=e,this.match=i}}function er(s){return s.selection.main.head}function OL(s,t){var e;let{source:i}=s,n=t&&i[0]!="^",r=i[i.length-1]!="$";return!n&&!r?s:new RegExp(`${n?"^":""}(?:${i})${r?"$":""}`,(e=s.flags)!==null&&e!==void 0?e:s.ignoreCase?"i":"")}function P7(s,t,e,i){return Object.assign(Object.assign({},s.changeByRange(n=>{if(n==s.selection.main)return{changes:{from:e,to:i,insert:t},range:P.cursor(e+t.length)};let r=i-e;return!n.empty||r&&s.sliceDoc(n.from-r,n.from)!=s.sliceDoc(e,i)?{range:n}:{changes:{from:n.from-r,to:n.from,insert:t},range:P.cursor(n.from-r+t.length)}})),{userEvent:"input.complete"})}function TL(s,t){const e=t.completion.apply||t.completion.label;let i=t.source;typeof e=="string"?s.dispatch(P7(s.state,e,i.from,i.to)):e(s,t.completion,i.from,i.to)}const BA=new WeakMap;function L7(s){if(!Array.isArray(s))return s;let t=BA.get(s);return t||BA.set(s,t=E7(s)),t}class V7{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let e=0;e<t.length;){let i=qe(t,e),n=Xi(i);this.chars.push(i);let r=t.slice(e,e+n),o=r.toUpperCase();this.folded.push(qe(o==r?r.toLowerCase():o,0)),e+=n}this.astral=t.length!=this.chars.length}match(t){if(this.pattern.length==0)return[0];if(t.length<this.pattern.length)return null;let{chars:e,folded:i,any:n,precise:r,byWord:o}=this;if(e.length==1){let w=qe(t,0);return w==e[0]?[0,0,Xi(w)]:w==i[0]?[-200,0,Xi(w)]:null}let l=t.indexOf(this.pattern);if(l==0)return[0,0,this.pattern.length];let h=e.length,a=0;if(l<0){for(let w=0,x=Math.min(t.length,200);w<x&&a<h;){let b=qe(t,w);(b==e[a]||b==i[a])&&(n[a++]=w),w+=Xi(b)}if(a<h)return null}let c=0,f=0,u=!1,d=0,g=-1,m=-1,p=/[a-z]/.test(t),y=!0;for(let w=0,x=Math.min(t.length,200),b=0;w<x&&f<h;){let S=qe(t,w);l<0&&(c<h&&S==e[c]&&(r[c++]=w),d<h&&(S==e[d]||S==i[d]?(d==0&&(g=w),m=w+1,d++):d=0));let v,L=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(v=_E(S))!=v.toLowerCase()?1:v!=v.toUpperCase()?2:0;(!w||L==1&&p||b==0&&L!=0)&&(e[f]==S||i[f]==S&&(u=!0)?o[f++]=w:o.length&&(y=!1)),b=L,w+=Xi(S)}return f==h&&o[0]==0&&y?this.result(-100+(u?-200:0),o,t):d==h&&g==0?[-200-t.length,0,m]:l>-1?[-700-t.length,l,l+this.pattern.length]:d==h?[-900-t.length,g,m]:f==h?this.result(-100+(u?-200:0)+-700+(y?0:-1100),o,t):e.length==2?null:this.result((n[0]?-700:0)+-200+-1100,n,t)}result(t,e,i){let n=[t-i.length],r=1;for(let o of e){let l=o+(this.astral?Xi(qe(i,o)):1);r>1&&n[r-1]==o?n[r-1]=l:(n[r++]=o,n[r++]=l)}return n}}const sr=Y.define({combine(s){return nq(s,{activateOnTyping:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(t,e)=>t&&e,closeOnBlur:(t,e)=>t&&e,icons:(t,e)=>t&&e,optionClass:(t,e)=>i=>I7(t(i),e(i)),addToOptions:(t,e)=>t.concat(e)})}});function I7(s,t){return s?t?s+" "+t:s:t}function N7(s){let t=s.addToOptions.slice();return s.icons&&t.push({render(e){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),e.type&&i.classList.add(...e.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),i.setAttribute("aria-hidden","true"),i},position:20}),t.push({render(e,i,n){let r=document.createElement("span");r.className="cm-completionLabel";let{label:o}=e,l=0;for(let h=1;h<n.length;){let a=n[h++],c=n[h++];a>l&&r.appendChild(document.createTextNode(o.slice(l,a)));let f=r.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(o.slice(a,c))),f.className="cm-completionMatchedText",l=c}return l<o.length&&r.appendChild(document.createTextNode(o.slice(l))),r},position:50},{render(e){if(!e.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=e.detail,i},position:80}),t.sort((e,i)=>e.position-i.position).map(e=>e.render)}function EA(s,t,e){if(s<=e)return{from:0,to:s};if(t<=s>>1){let n=Math.floor(t/e);return{from:n*e,to:(n+1)*e}}let i=Math.floor((s-t)/e);return{from:s-(i+1)*e,to:s-i*e}}class H7{constructor(t,e){this.view=t,this.stateField=e,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:l=>this.positionInfo(l),key:this};let i=t.state.field(e),{options:n,selected:r}=i.open,o=t.state.facet(sr);this.optionContent=N7(o),this.optionClass=o.optionClass,this.range=EA(n.length,r,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",l=>{for(let h=l.target,a;h&&h!=this.dom;h=h.parentNode)if(h.nodeName=="LI"&&(a=/-(\d+)$/.exec(h.id))&&+a[1]<n.length){TL(t,n[+a[1]]),l.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(n,i.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(t){t.state.field(this.stateField)!=t.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;if((e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=EA(e.options.length,e.selected,this.view.state.facet(sr).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e.options,t.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(e.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=e.options[e.selected],{info:n}=i;if(!n)return;let r=typeof n=="string"?document.createTextNode(n):n(i);if(!r)return;"then"in r?r.then(o=>{o&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(o)}).catch(o=>ts(this.view.state,o,"completion info")):this.addInfoPane(r)}}addInfoPane(t){let e=this.info=document.createElement("div");e.className="cm-tooltip cm-completionInfo",e.appendChild(t),this.dom.appendChild(e),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(t){let e=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)n==t?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),e=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return e&&W7(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=t.getBoundingClientRect();if(n.top>Math.min(innerHeight,e.bottom)-10||n.bottom<Math.max(0,e.top)+10)return null;let r=Math.max(0,Math.min(n.top,innerHeight-i.height))-e.top,o=this.view.textDirection==we.RTL,l=e.left,h=innerWidth-e.right;return o&&l<Math.min(i.width,h)?o=!1:!o&&h<Math.min(i.width,l)&&(o=!0),{top:r,left:o}}positionInfo(t){this.info&&(this.info.style.top=(t?t.top:-1e6)+"px",t&&(this.info.classList.toggle("cm-completionInfo-left",t.left),this.info.classList.toggle("cm-completionInfo-right",!t.left)))}createListBox(t,e,i){const n=document.createElement("ul");n.id=e,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));for(let r=i.from;r<i.to;r++){let{completion:o,match:l}=t[r];const h=n.appendChild(document.createElement("li"));h.id=e+"-"+r,h.setAttribute("role","option");let a=this.optionClass(o);a&&(h.className=a);for(let c of this.optionContent){let f=c(o,this.view.state,l);f&&h.appendChild(f)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<t.length&&n.classList.add("cm-completionListIncompleteBottom"),n}}function F7(s){return t=>new H7(t,s)}function W7(s,t){let e=s.getBoundingClientRect(),i=t.getBoundingClientRect();i.top<e.top?s.scrollTop-=e.top-i.top:i.bottom>e.bottom&&(s.scrollTop+=i.bottom-e.bottom)}function PA(s){return(s.boost||0)*100+(s.apply?10:0)+(s.info?5:0)+(s.type?1:0)}function z7(s,t){let e=[],i=0;for(let o of s)if(o.hasResult())if(o.result.filter===!1){let l=o.result.getMatch;for(let h of o.result.options){let a=[1e9-i++];if(l)for(let c of l(h))a.push(c);e.push(new RA(h,o,a))}}else{let l=new V7(t.sliceDoc(o.from,o.to)),h;for(let a of o.result.options)(h=l.match(a.label))&&(a.boost!=null&&(h[0]+=a.boost),e.push(new RA(a,o,h)))}let n=[],r=null;for(let o of e.sort(j7))!r||r.label!=o.completion.label||r.detail!=o.completion.detail||r.type!=null&&o.completion.type!=null&&r.type!=o.completion.type||r.apply!=o.completion.apply?n.push(o):PA(o.completion)>PA(r)&&(n[n.length-1]=o),r=o.completion;return n}class Yh{constructor(t,e,i,n,r){this.options=t,this.attrs=e,this.tooltip=i,this.timestamp=n,this.selected=r}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new Yh(this.options,LA(e,t),this.tooltip,this.timestamp,t)}static build(t,e,i,n,r){let o=z7(t,e);if(!o.length)return null;let l=0;if(n&&n.selected){let h=n.options[n.selected].completion;for(let a=0;a<o.length;a++)if(o[a].completion==h){l=a;break}}return new Yh(o,LA(i,l),{pos:t.reduce((h,a)=>a.hasResult()?Math.min(h,a.from):h,1e8),create:F7($i),above:r.aboveCursor},n?n.timestamp:Date.now(),l)}map(t){return new Yh(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class $d{constructor(t,e,i){this.active=t,this.id=e,this.open=i}static start(){return new $d(G7,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:e}=t,i=e.facet(sr),r=(i.override||e.languageDataAt("autocomplete",er(e)).map(L7)).map(l=>(this.active.find(a=>a.source==l)||new Ke(l,this.active.some(a=>a.state!=0)?1:0)).update(t,i));r.length==this.active.length&&r.every((l,h)=>l==this.active[h])&&(r=this.active);let o=t.selection||r.some(l=>l.hasResult()&&t.changes.touchesRange(l.from,l.to))||!q7(r,this.active)?Yh.build(r,e,this.id,this.open,i):this.open&&t.docChanged?this.open.map(t.changes):this.open;!o&&r.every(l=>l.state!=1)&&r.some(l=>l.hasResult())&&(r=r.map(l=>l.hasResult()?new Ke(l.source,0):l));for(let l of t.effects)l.is(RL)&&(o=o&&o.setSelected(l.value,this.id));return r==this.active&&o==this.open?this:new $d(r,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:K7}}function q7(s,t){if(s==t)return!0;for(let e=0,i=0;;){for(;e<s.length&&!s[e].hasResult;)e++;for(;i<t.length&&!t[i].hasResult;)i++;let n=e==s.length,r=i==t.length;if(n||r)return n==r;if(s[e++].result!=t[i++].result)return!1}}const K7={"aria-autocomplete":"list"};function LA(s,t){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":s+"-"+t,"aria-controls":s}}const G7=[];function j7(s,t){let e=t.match[0]-s.match[0];return e||s.completion.label.localeCompare(t.completion.label)}function zy(s){return s.isUserEvent("input.type")?"input":s.isUserEvent("delete.backward")?"delete":null}class Ke{constructor(t,e,i=-1){this.source=t,this.state=e,this.explicitPos=i}hasResult(){return!1}update(t,e){let i=zy(t),n=this;i?n=n.handleUserEvent(t,i,e):t.docChanged?n=n.handleChange(t):t.selection&&n.state!=0&&(n=new Ke(n.source,0));for(let r of t.effects)if(r.is(ex))n=new Ke(n.source,1,r.value?er(t.state):-1);else if(r.is(Rd))n=new Ke(n.source,0);else if(r.is($L))for(let o of r.value)o.source==n.source&&(n=o);return n}handleUserEvent(t,e,i){return e=="delete"||!i.activateOnTyping?this.map(t.changes):new Ke(this.source,1)}handleChange(t){return t.changes.touchesRange(er(t.startState))?new Ke(this.source,0):this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new Ke(this.source,this.state,t.mapPos(this.explicitPos))}}class Xh extends Ke{constructor(t,e,i,n,r){super(t,2,e),this.result=i,this.from=n,this.to=r}hasResult(){return!0}handleUserEvent(t,e,i){var n;let r=t.changes.mapPos(this.from),o=t.changes.mapPos(this.to,1),l=er(t.state);if((this.explicitPos<0?l<=r:l<this.from)||l>o||e=="delete"&&er(t.startState)==this.from)return new Ke(this.source,e=="input"&&i.activateOnTyping?1:0);let h=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos),a;return U7(this.result.validFor,t.state,r,o)?new Xh(this.source,h,this.result,r,o):this.result.update&&(a=this.result.update(this.result,r,o,new DL(t.state,l,h>=0)))?new Xh(this.source,h,a,a.from,(n=a.to)!==null&&n!==void 0?n:er(t.state)):new Ke(this.source,1,h)}handleChange(t){return t.changes.touchesRange(this.from,this.to)?new Ke(this.source,0):this.map(t.changes)}map(t){return t.empty?this:new Xh(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1))}}function U7(s,t,e,i){if(!s)return!1;let n=t.sliceDoc(e,i);return typeof s=="function"?s(n,e,i,t):OL(s,!0).test(n)}const ex=Ht.define(),Rd=Ht.define(),$L=Ht.define({map(s,t){return s.map(e=>e.map(t))}}),RL=Ht.define(),$i=Dl.define({create(){return $d.start()},update(s,t){return s.update(t)},provide:s=>[ML.from(s,t=>t.tooltip),Bt.contentAttributes.from(s,t=>t.attrs)]}),BL=75;function pf(s,t="option"){return e=>{let i=e.state.field($i,!1);if(!i||!i.open||Date.now()-i.open.timestamp<BL)return!1;let n=1,r;t=="page"&&(r=R7(e,i.open.tooltip))&&(n=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let o=i.open.selected+n*(s?1:-1),{length:l}=i.open.options;return o<0?o=t=="page"?0:l-1:o>=l&&(o=t=="page"?l-1:0),e.dispatch({effects:RL.of(o)}),!0}}const J7=s=>{let t=s.state.field($i,!1);return s.state.readOnly||!t||!t.open||Date.now()-t.open.timestamp<BL?!1:(TL(s,t.open.options[t.open.selected]),!0)},Y7=s=>s.state.field($i,!1)?(s.dispatch({effects:ex.of(!0)}),!0):!1,X7=s=>{let t=s.state.field($i,!1);return!t||!t.active.some(e=>e.state!=0)?!1:(s.dispatch({effects:Rd.of(null)}),!0)};class Z7{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const VA=50,Q7=50,_7=1e3,tK=_b.fromClass(class{constructor(s){this.view=s,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let t of s.state.field($i).active)t.state==1&&this.startQuery(t)}update(s){let t=s.state.field($i);if(!s.selectionSet&&!s.docChanged&&s.startState.field($i)==t)return;let e=s.transactions.some(i=>(i.selection||i.docChanged)&&!zy(i));for(let i=0;i<this.running.length;i++){let n=this.running[i];if(e||n.updates.length+s.transactions.length>Q7&&Date.now()-n.time>_7){for(let r of n.context.abortListeners)try{r()}catch(o){ts(this.view.state,o)}n.context.abortListeners=null,this.running.splice(i--,1)}else n.updates.push(...s.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=t.active.some(i=>i.state==1&&!this.running.some(n=>n.active.source==i.source))?setTimeout(()=>this.startUpdate(),VA):-1,this.composing!=0)for(let i of s.transactions)zy(i)=="input"?this.composing=2:this.composing==2&&i.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:s}=this.view,t=s.field($i);for(let e of t.active)e.state==1&&!this.running.some(i=>i.active.source==e.source)&&this.startQuery(e)}startQuery(s){let{state:t}=this.view,e=er(t),i=new DL(t,e,s.explicitPos==e),n=new Z7(s,i);this.running.push(n),Promise.resolve(s.source(i)).then(r=>{n.context.aborted||(n.done=r||null,this.scheduleAccept())},r=>{this.view.dispatch({effects:Rd.of(null)}),ts(this.view.state,r)})}scheduleAccept(){this.running.every(s=>s.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),VA))}accept(){var s;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],e=this.view.state.facet(sr);for(let i=0;i<this.running.length;i++){let n=this.running[i];if(n.done===void 0)continue;if(this.running.splice(i--,1),n.done){let o=new Xh(n.active.source,n.active.explicitPos,n.done,n.done.from,(s=n.done.to)!==null&&s!==void 0?s:er(n.updates.length?n.updates[0].startState:this.view.state));for(let l of n.updates)o=o.update(l,e);if(o.hasResult()){t.push(o);continue}}let r=this.view.state.field($i).active.find(o=>o.source==n.active.source);if(r&&r.state==1)if(n.done==null){let o=new Ke(n.active.source,0);for(let l of n.updates)o=o.update(l,e);o.state!=1&&t.push(o)}else this.startQuery(r)}t.length&&this.view.dispatch({effects:$L.of(t)})}},{eventHandlers:{blur(){let s=this.view.state.field($i,!1);s&&s.tooltip&&this.view.state.facet(sr).closeOnBlur&&this.view.dispatch({effects:Rd.of(null)})},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:ex.of(!1)}),20),this.composing=0}}}),eK=Bt.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),Bd={brackets:["(","[","{","'",'"'],before:")]}:;>"},mr=Ht.define({map(s,t){let e=t.mapPos(s,-1,Ge.TrackAfter);return e??void 0}}),ix=Ht.define({map(s,t){return t.mapPos(s)}}),nx=new class extends $r{};nx.startSide=1;nx.endSide=-1;const EL=Dl.define({create(){return Re.empty},update(s,t){if(t.selection){let e=t.state.doc.lineAt(t.selection.main.head).from,i=t.startState.doc.lineAt(t.startState.selection.main.head).from;e!=t.changes.mapPos(i,-1)&&(s=Re.empty)}s=s.map(t.changes);for(let e of t.effects)e.is(mr)?s=s.update({add:[nx.range(e.value,e.value+1)]}):e.is(ix)&&(s=s.update({filter:i=>i!=e.value}));return s}});function iK(){return[sK,EL]}const Dp="()[]{}<>";function PL(s){for(let t=0;t<Dp.length;t+=2)if(Dp.charCodeAt(t)==s)return Dp.charAt(t+1);return _E(s<128?s:s+1)}function LL(s,t){return s.languageDataAt("closeBrackets",t)[0]||Bd}const nK=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),sK=Bt.inputHandler.of((s,t,e,i)=>{if((nK?s.composing:s.compositionStarted)||s.state.readOnly)return!1;let n=s.state.selection.main;if(i.length>2||i.length==2&&Xi(qe(i,0))==1||t!=n.from||e!=n.to)return!1;let r=lK(s.state,i);return r?(s.dispatch(r),!0):!1}),rK=({state:s,dispatch:t})=>{if(s.readOnly)return!1;let i=LL(s,s.selection.main.head).brackets||Bd.brackets,n=null,r=s.changeByRange(o=>{if(o.empty){let l=hK(s.doc,o.head);for(let h of i)if(h==l&&mg(s.doc,o.head)==PL(qe(h,0)))return{changes:{from:o.head-h.length,to:o.head+h.length},range:P.cursor(o.head-h.length),userEvent:"delete.backward"}}return{range:n=o}});return n||t(s.update(r,{scrollIntoView:!0})),!n},oK=[{key:"Backspace",run:rK}];function lK(s,t){let e=LL(s,s.selection.main.head),i=e.brackets||Bd.brackets;for(let n of i){let r=PL(qe(n,0));if(t==n)return r==n?fK(s,n,i.indexOf(n+n+n)>-1):aK(s,n,r,e.before||Bd.before);if(t==r&&VL(s,s.selection.main.from))return cK(s,n,r)}return null}function VL(s,t){let e=!1;return s.field(EL).between(0,s.doc.length,i=>{i==t&&(e=!0)}),e}function mg(s,t){let e=s.sliceString(t,t+2);return e.slice(0,Xi(qe(e,0)))}function hK(s,t){let e=s.sliceString(t-2,t);return Xi(qe(e,0))==e.length?e:e.slice(1)}function aK(s,t,e,i){let n=null,r=s.changeByRange(o=>{if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:e,from:o.to}],effects:mr.of(o.to+t.length),range:P.range(o.anchor+t.length,o.head+t.length)};let l=mg(s.doc,o.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:t+e,from:o.head},effects:mr.of(o.head+t.length),range:P.cursor(o.head+t.length)}:{range:n=o}});return n?null:s.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function cK(s,t,e){let i=null,n=s.selection.ranges.map(r=>r.empty&&mg(s.doc,r.head)==e?P.cursor(r.head+e.length):i=r);return i?null:s.update({selection:P.create(n,s.selection.mainIndex),scrollIntoView:!0,effects:s.selection.ranges.map(({from:r})=>ix.of(r))})}function fK(s,t,e){let i=null,n=s.changeByRange(r=>{if(!r.empty)return{changes:[{insert:t,from:r.from},{insert:t,from:r.to}],effects:mr.of(r.to+t.length),range:P.range(r.anchor+t.length,r.head+t.length)};let o=r.head,l=mg(s.doc,o);if(l==t){if(IA(s,o))return{changes:{insert:t+t,from:o},effects:mr.of(o+t.length),range:P.cursor(o+t.length)};if(VL(s,o)){let h=e&&s.sliceDoc(o,o+t.length*3)==t+t+t;return{range:P.cursor(o+t.length*(h?3:1)),effects:ix.of(o)}}}else{if(e&&s.sliceDoc(o-2*t.length,o)==t+t&&IA(s,o-2*t.length))return{changes:{insert:t+t+t+t,from:o},effects:mr.of(o+t.length),range:P.cursor(o+t.length)};if(s.charCategorizer(o)(l)!=ln.Word){let h=s.sliceDoc(o-1,o);if(h!=t&&s.charCategorizer(o)(h)!=ln.Word&&!uK(s,o,t))return{changes:{insert:t+t,from:o},effects:mr.of(o+t.length),range:P.cursor(o+t.length)}}}return{range:i=r}});return i?null:s.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function IA(s,t){let e=$e(s).resolveInner(t+1);return e.parent&&e.from==t}function uK(s,t,e){let i=$e(s).resolveInner(t,-1);for(let n=0;n<5;n++){if(s.sliceDoc(i.from,i.from+e.length)==e)return!0;let r=i.to==t&&i.parent;if(!r)break;i=r}return!1}function dK(s={}){return[$i,sr.of(s),tK,gK,eK]}const IL=[{key:"Ctrl-Space",run:Y7},{key:"Escape",run:X7},{key:"ArrowDown",run:pf(!0)},{key:"ArrowUp",run:pf(!1)},{key:"PageDown",run:pf(!0,"page")},{key:"PageUp",run:pf(!1,"page")},{key:"Enter",run:J7}],gK=sP.highest(AL.computeN([sr],s=>s.facet(sr).defaultKeymap?[IL]:[]));let bt=class NL{constructor(){}lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),Eu.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){let i=[];return this.decompose(t,e,i,0),Eu.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new Zh(this),r=new Zh(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new Zh(this,t)}iterRange(t,e=this.length){return new HL(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new FL(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?NL.empty:t.length<=32?new an(t):Eu.from(an.split(t,[]))}},an=class In extends bt{constructor(t,e=pK(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new mK(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new In(NA(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=Pu(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new In(l,o.length+r.length));else{let h=l.length>>1;i.push(new In(l.slice(0,h)),new In(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof In))return super.replace(t,e,i);let n=Pu(this.text,Pu(i.text,NA(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new In(n,r):Eu.from(In.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new In(i,n)),i=[],n=-1);return n>-1&&e.push(new In(i,n)),e}},Eu=class fo extends bt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new fo(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof fo))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new an(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof fo)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof an&&h&&(g=c[c.length-1])instanceof an&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new an(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:fo.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new fo(l,e)}};bt.empty=new an([""],0);function pK(s){let t=-1;for(let e of s)t+=e.length+1;return t}function Pu(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function NA(s,t,e){return Pu(s,[""],t,e)}let Zh=class{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof an?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof an?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof an){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof an?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}},HL=class{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Zh(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},FL=class{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(bt.prototype[Symbol.iterator]=function(){return this.iter()},Zh.prototype[Symbol.iterator]=HL.prototype[Symbol.iterator]=FL.prototype[Symbol.iterator]=function(){return this});let mK=class{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}},jo="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<jo.length;s++)jo[s]+=jo[s-1];function yK(s){for(let t=1;t<jo.length;t+=2)if(jo[t]>s)return jo[t-1]<=s;return!1}function HA(s){return s>=127462&&s<=127487}const FA=8205;function Ys(s,t,e=!0,i=!0){return(e?WL:wK)(s,t,i)}function WL(s,t,e){if(t==s.length)return t;t&&zL(s.charCodeAt(t))&&qL(s.charCodeAt(t-1))&&t--;let i=Op(s,t);for(t+=WA(i);t<s.length;){let n=Op(s,t);if(i==FA||n==FA||e&&yK(n))t+=WA(n),i=n;else if(HA(n)){let r=0,o=t-2;for(;o>=0&&HA(Op(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function wK(s,t,e){for(;t>0;){let i=WL(s,t-2,e);if(i<t)return i;t--}return 0}function zL(s){return s>=56320&&s<57344}function qL(s){return s>=55296&&s<56320}function Op(s,t){let e=s.charCodeAt(t);if(!qL(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return zL(i)?(e-55296<<10)+(i-56320)+65536:e}function WA(s){return s<65536?1:2}const qy=/\r\n?|\n/;var je=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(je||(je={}));let Qh=class Lu{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){Ky(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new Lu(t)}composeDesc(t){return this.empty?t:t.empty?this:KL(this,t)}mapDesc(t,e=!1){return t.empty?this:Gy(this,t,e)}mapPos(t,e=-1,i=je.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=je.Simple&&a>=t&&(i==je.TrackDel&&n<t&&a>t||i==je.TrackBefore&&n<t||i==je.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Lu(t)}static create(t){return new Lu(t)}},as=class Ls extends Qh{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Ky(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return Gy(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(bt.empty);i.push(o?t.slice(r,r+o):bt.empty)}r+=o}return new Ls(e,i)}compose(t){return this.empty?t:t.empty?this:KL(this,t,!0)}map(t,e=!1){return t.empty?this:Gy(this,t,e,!0)}iterChanges(t,e=!1){Ky(this,t,e)}get desc(){return Qh.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new qa(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Ne(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Ne(e,c,f),f>0&&yr(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Ne(e,c,-1),Ne(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new Ls(e,i),filtered:Qh.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Ne(n,e-o,-1);let f=new Ls(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof Ls){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?bt.of(d.split(i||qy)):d:bt.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Ne(n,f-o,-1),Ne(n,u-f,m),yr(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new Ls(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(bt.empty);i[n]=bt.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new Ls(e,i)}static createSet(t,e){return new Ls(t,e)}};function Ne(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function yr(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(bt.empty);s.push(e)}}function Ky(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=bt.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function Gy(s,t,e,i=!1){let n=[],r=i?[]:null,o=new qa(s),l=new qa(t);for(let h=0,a=0;;)if(o.ins==-1)h+=o.len,o.next();else if(l.ins==-1&&a<h){let c=Math.min(l.len,h-a);l.forward(c),Ne(n,c,-1),a+=c}else if(l.ins>=0&&(o.done||a<h||a==h&&(l.len<o.len||l.len==o.len&&!e))){for(Ne(n,l.ins,-1);h>a&&!o.done&&h+o.len<a+l.len;)h+=o.len,o.next();a+=l.len,l.next()}else if(o.ins>=0){let c=0,f=h+o.len;for(;;)if(l.ins>=0&&a>h&&a+l.len<f)c+=l.ins,a+=l.len,l.next();else if(l.ins==-1&&a<f){let u=Math.min(l.len,f-a);c+=u,l.forward(u),a+=u}else break;Ne(n,c,o.ins),r&&yr(r,n,o.text),h=f,o.next()}else{if(o.done&&l.done)return r?as.createSet(n,r):Qh.create(n);throw new Error("Mismatched change set lengths")}}function KL(s,t,e=!1){let i=[],n=e?[]:null,r=new qa(s),o=new qa(t);for(let l=!1;;){if(r.done&&o.done)return n?as.createSet(i,n):Qh.create(i);if(r.ins==0)Ne(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Ne(i,0,o.ins,l),n&&yr(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Ne(i,h,c,l),n&&c&&yr(n,i,o.text)}else o.ins==-1?(Ne(i,r.off?0:r.len,h,l),n&&yr(n,i,r.textBit(h))):(Ne(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&yr(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}let qa=class{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?bt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?bt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}},mf=class jy{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let t=this.flags&3;return t==3?null:t}get goalColumn(){let t=this.flags>>5;return t==33554431?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new jy(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return q.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return q.range(this.anchor,i)}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return q.range(t.anchor,t.head)}static create(t,e,i){return new jy(t,e,i)}},q=class gi{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:gi.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new gi([this.main],0)}addRange(t,e=!0){return gi.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,gi.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new gi(t.ranges.map(e=>mf.fromJSON(e)),t.main)}static single(t,e=t){return new gi([gi.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return gi.normalized(t.slice(),e);i=r.to}return new gi(t,e)}static cursor(t,e=0,i,n){return mf.create(t,t,(e==0?0:e<0?4:8)|(i==null?3:Math.min(2,i))|(n??33554431)<<5)}static range(t,e,i){let n=(i??33554431)<<5;return e<t?mf.create(e,t,16|n|8):mf.create(t,e,n|(e>t?4:0))}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?gi.range(h,l):gi.range(l,h))}}return new gi(t,e)}};function GL(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let sx=0,G=class jL{constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.extensions=r,this.id=sx++,this.default=t([])}static define(t={}){return new jL(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:rx),!!t.static,t.enables)}of(t){return new Vu([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vu(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vu(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}};function rx(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}let Vu=class{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=sx++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||Uy(f,c)){let d=i(f);if(l?!zA(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d=i(f),g=u.config.address[r];if(g!=null){let m=Ed(u,g);if(this.dependencies.every(p=>p instanceof G?u.facet(p)===f.facet(p):p instanceof Ol?u.field(p,!1)==f.field(p,!1):!0)||(l?zA(d,m,n):n(d,m)))return f.values[o]=m,0}return f.values[o]=d,1}}}};function zA(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function Uy(s,t){let e=!1;for(let i of t)_h(s,i)&1&&(e=!0);return e}function bK(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=Ed(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)_h(h,a);return h.values[o]=l(h),1},update(h,a){if(!Uy(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=Uy(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&rx(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const qA=G.define({static:!0});let Ol=class UL{constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new UL(sx++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(qA).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,qA.of({field:this,create:t})]}get extension(){return this}};const uo={lowest:4,low:3,default:2,high:1,highest:0};function Kl(s){return t=>new JL(t,s)}const xK={highest:Kl(uo.highest),high:Kl(uo.high),default:Kl(uo.default),low:Kl(uo.low),lowest:Kl(uo.lowest)};let JL=class{constructor(t,e){this.inner=t,this.prec=e}},YL=class XL{of(t){return new Jy(this,t)}reconfigure(t){return XL.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}},Jy=class{constructor(t,e){this.compartment=t,this.inner=e}},KA=class ZL{constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of SK(t,e,o))u instanceof Ol?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,rx(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>bK(p,g,d))}}let f=a.map(u=>u(l));return new ZL(t,o,f,l,h,r)}};function SK(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof Jy&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof Jy){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof JL)r(o.inner,o.prec);else if(o instanceof Ol)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof Vu)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,l);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,uo.default),i.reduce((o,l)=>o.concat(l))}function _h(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function Ed(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const QL=G.define(),_L=G.define({combine:s=>s.some(t=>t),static:!0}),tV=G.define({combine:s=>s.length?s[0]:void 0,static:!0}),eV=G.define(),iV=G.define(),nV=G.define(),sV=G.define({combine:s=>s.length?s[0]:!1});let wc=class{constructor(t,e){this.type=t,this.value=e}static define(){return new vK}},vK=class{of(t){return new wc(this,t)}},kK=class{constructor(t){this.map=t}of(t){return new Ft(this,t)}},Ft=class rV{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new rV(this.type,e)}is(t){return this.type==t}static define(t={}){return new kK(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}};Ft.reconfigure=Ft.define();Ft.appendConfig=Ft.define();let yn=class vh{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&GL(i,e.newLength),r.some(l=>l.type==vh.time)||(this.annotations=r.concat(vh.time.of(Date.now())))}static create(t,e,i,n,r,o){return new vh(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(vh.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}};yn.time=wc.define();yn.userEvent=wc.define();yn.addToHistory=wc.define();yn.remote=wc.define();function AK(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function oV(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=as.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:Ft.mapEffects(s.effects,n).concat(Ft.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function Yy(s,t,e){let i=t.selection,n=Uo(t.annotations);return t.userEvent&&(n=n.concat(yn.userEvent.of(t.userEvent))),{changes:t.changes instanceof as?t.changes:as.of(t.changes||[],e,s.facet(tV)),selection:i&&(i instanceof q?i:q.single(i.anchor,i.head)),effects:Uo(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function lV(s,t,e){let i=Yy(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=oV(i,Yy(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=yn.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return MK(e?CK(n):n)}function CK(s){let t=s.startState,e=!0;for(let n of t.facet(eV)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:AK(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=as.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.invertedDesc}s=yn.create(t,n,s.selection&&s.selection.map(r),Ft.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(iV);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof yn?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof yn?s=r[0]:s=lV(t,Uo(r),!1)}return s}function MK(s){let t=s.startState,e=t.facet(nV),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=oV(s,Yy(t,r,s.changes.newLength),!0))}return i==s?s:yn.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const DK=[];function Uo(s){return s==null?DK:Array.isArray(s)?s:[s]}var xs=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(xs||(xs={}));const OK=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Xy;try{Xy=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function TK(s){if(Xy)return Xy.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||OK.test(e)))return!0}return!1}function $K(s){return t=>{if(!/\S/.test(t))return xs.Space;if(TK(t))return xs.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return xs.Word;return xs.Other}}let si=class Ji{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)_h(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return _h(this,i),Ed(this,i)}update(...t){return lV(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let o of t.effects)o.is(YL.reconfigure)?(e&&(n=new Map,e.compartments.forEach((l,h)=>n.set(h,l)),e=null),n.set(o.value.compartment,o.value.extension)):o.is(Ft.reconfigure)?(e=null,i=o.value):o.is(Ft.appendConfig)&&(e=null,i=Uo(i).concat(o.value));let r;e?r=t.startState.values.slice():(e=KA.resolve(i,n,this),r=new Ji(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new Ji(e,t.newDoc,t.newSelection,r,(o,l)=>l.update(o,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:q.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=Uo(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=Ft.mapEffects(o,c).concat(Ft.mapEffects(Uo(h.effects),f))}return{changes:n,selection:q.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof as?t:as.of(t,this.doc.length,this.facet(Ji.lineSeparator))}toText(t){return bt.of(t.split(this.facet(Ji.lineSeparator)||qy))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(_h(this,e),Ed(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof Ol&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}return Ji.create({doc:t.doc,selection:q.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=KA.resolve(t.extensions||[],new Map),i=t.doc instanceof bt?t.doc:bt.of((t.doc||"").split(e.staticFacet(Ji.lineSeparator)||qy)),n=t.selection?t.selection instanceof q?t.selection:q.single(t.selection.anchor,t.selection.head):q.single(0);return GL(n,i.length),e.staticFacet(_L)||(n=n.asSingle()),new Ji(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(Ji.tabSize)}get lineBreak(){return this.facet(Ji.lineSeparator)||`
`}get readOnly(){return this.facet(sV)}phrase(t,...e){for(let i of this.facet(Ji.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(QL))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return $K(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=Ys(e,o,!1);if(r(e.slice(h,o))!=xs.Word)break;o=h}for(;l<n;){let h=Ys(e,l);if(r(e.slice(l,h))!=xs.Word)break;l=h}return o==l?null:q.range(o+i,l+i)}};si.allowMultipleSelections=_L;si.tabSize=G.define({combine:s=>s.length?s[0]:4});si.lineSeparator=tV;si.readOnly=sV;si.phrases=G.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});si.languageData=QL;si.changeFilter=eV;si.transactionFilter=iV;si.transactionExtender=nV;YL.reconfigure=Ft.define();function RK(s,t,e={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(e,r))i[r]=e[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in t)i[n]===void 0&&(i[n]=t[n]);return i}let gl=class{eq(t){return this==t}range(t,e=t){return Zy.create(t,e,this)}};gl.prototype.startSide=gl.prototype.endSide=0;gl.prototype.point=!1;gl.prototype.mapMode=je.TrackDel;let Zy=class hV{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new hV(t,e,i)}};function Qy(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}let BK=class aV{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new aV(n,r,i,l):null,pos:o}}},li=class go{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new go(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(Qy)),this.isEmpty)return e.length?go.of(e):this;let l=new fV(this,null,-1).goto(0),h=0,a=[],c=new GA;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(Zy.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?go.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new go(i,e,r||go.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return _y.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return _y.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=jA(o,l,i),a=new Gl(o,h,r),c=new Gl(l,h,r);i.iterGaps((f,u,d)=>UA(a,f,c,u,d,n)),i.empty&&i.length==0&&UA(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=1e9);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=jA(r,o),h=new Gl(r,l,0).goto(i),a=new Gl(o,l,0).goto(i);for(;;){if(h.to!=a.to||!tw(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new Gl(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point?(n.point(l,a,o.point,o.activeForPoint(o.to),h,o.pointRank),h=o.openEnd(a)+(o.to>a?1:0)):a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a)),o.to>i)break;l=o.to,o.next()}return h}static of(t,e=!1){let i=new GA;for(let n of t instanceof Zy?[t]:e?EK(t):t)i.add(n.from,n.to,n.value);return i.finish()}};li.empty=new li([],[],null,-1);function EK(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(Qy(t,i)>0)return s.slice().sort(Qy);t=i}return s}li.empty.nextLayer=li.empty;let GA=class cV{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(t){this.chunks.push(new BK(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new cV)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(li.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=li.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}};function jA(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}let fV=class{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}},_y=class uV{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new fV(o,e,i,r));return n.length==1?n[0]:new uV(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)Tp(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)Tp(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Tp(this.heap,0)}}};function Tp(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}let Gl=class{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=_y.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){yf(this.active,t),yf(this.activeTo,t),yf(this.activeRank,t),this.minActive=JA(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=r;)e++;wf(this.active,e,i),wf(this.activeTo,e,n),wf(this.activeRank,e,r),t&&wf(t,e,this.cursor.from),this.minActive=JA(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&yf(i,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<t&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let r=0;for(;r<i.length&&i[r]<t;)r++;this.openStart=r+n}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}};function UA(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to||s.endSide-e.endSide,c=a<0?s.to+h:e.to,f=Math.min(c,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&tw(s.activeForPoint(s.to+h),e.activeForPoint(e.to))||r.comparePoint(l,f,s.point,e.point):f>l&&!tw(s.active,e.active)&&r.compareRange(l,f,s.active,e.active),c>o)break;l=c,a<=0&&s.next(),a>=0&&e.next()}}function tw(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function yf(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function wf(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function JA(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function PK(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=Ys(s,n)}return s.length}function Pd(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function pl(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function LK(){let s=document.activeElement;for(;s&&s.shadowRoot;)s=s.shadowRoot.activeElement;return s}function ew(s,t){if(!t.anchorNode)return!1;try{return pl(s,t.anchorNode)}catch{return!1}}function Ka(s){return s.nodeType==3?Ga(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function Ld(s,t,e,i){return e?YA(s,t,e,i,-1)||YA(s,t,e,i,1):!1}function iw(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function YA(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:Vd(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=iw(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?Vd(s):0}else return!1}}function Vd(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}const dV={left:0,right:0,top:0,bottom:0};function yg(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function VK(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function IK(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView;for(let c=s;c;)if(c.nodeType==1){let f,u=c==h.body;if(u)f=VK(a);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let m=c.getBoundingClientRect();f={left:m.left,right:m.left+c.clientWidth,top:m.top,bottom:m.top+c.clientHeight}}let d=0,g=0;if(n=="nearest")t.top<f.top?(g=-(f.top-t.top+o),e>0&&t.bottom>f.bottom+g&&(g=t.bottom-f.bottom+g+o)):t.bottom>f.bottom&&(g=t.bottom-f.bottom+o,e<0&&t.top-g<f.top&&(g=-(f.top+g-t.top+o)));else{let m=t.bottom-t.top,p=f.bottom-f.top;g=(n=="center"&&m<=p?t.top+m/2-p/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-p+o)-f.top}if(i=="nearest"?t.left<f.left?(d=-(f.left-t.left+r),e>0&&t.right>f.right+d&&(d=t.right-f.right+d+r)):t.right>f.right&&(d=t.right-f.right+r,e<0&&t.left<f.left+d&&(d=-(f.left+d-t.left+r))):d=(i=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:i=="start"==l?t.left-r:t.right-(f.right-f.left)+r)-f.left,d||g)if(u)a.scrollBy(d,g);else{if(g){let m=c.scrollTop;c.scrollTop+=g,g=c.scrollTop-m}if(d){let m=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-m}t={left:t.left-d,top:t.top-g,right:t.right-d,bottom:t.bottom-g}}if(u)break;c=c.assignedSlot||c.parentNode,i=n="nearest"}else if(c.nodeType==11)c=c.host;else break}let NK=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}},Ur=null;function gV(s){if(s.setActive)return s.setActive();if(Ur)return s.focus(Ur);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(Ur==null?{get preventScroll(){return Ur={preventScroll:!0},!0}}:void 0),!Ur){Ur=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let XA;function Ga(s,t,e=t){let i=XA||(XA=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function ta(s,t,e){let i={key:t,code:t,keyCode:e,which:e,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function HK(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function pV(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}let _e=class nw{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new nw(t.parentNode,iw(t),e)}static after(t,e){return new nw(t.parentNode,iw(t)+1,e)}};const ox=[];let ne=class sw{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}coordsAt(t,e){return null}sync(t){if(this.dirty&2){let e=this.dom,i=null,n;for(let r of this.children){if(r.dirty){if(!r.dom&&(n=i?i.nextSibling:e.firstChild)){let o=sw.get(n);(!o||!o.parent&&o.constructor==r.constructor)&&r.reuseDOM(n)}r.sync(t),r.dirty=0}if(n=i?i.nextSibling:e.firstChild,t&&!t.written&&t.node==e&&n!=r.dom&&(t.written=!0),r.dom.parentNode==e)for(;n&&n!=r.dom;)n=ZA(n);else e.insertBefore(r.dom,n);i=r.dom}for(n=i?i.nextSibling:e.firstChild,n&&t&&t.node==e&&(t.written=!0);n;)n=ZA(n)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(t),e.dirty=0)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=Vd(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!sw.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty&&this.markParentsDirty(!0))}setDOM(t){this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=ox){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&r.destroy()}this.children.splice(t,e-t,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new mV(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}merge(t,e,i,n,r,o){return!1}become(t){return!1}getSide(){return 0}destroy(){this.parent=null}};ne.prototype.breakAfter=0;function ZA(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}let mV=class{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}};function yV(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&n<d.length?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:(n&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function wV(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,yV(s,a,c,l,h,i,0,n,r)}let wn=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},rw=typeof document<"u"?document:{documentElement:{style:{}}};const ow=/Edge\/(\d+)/.exec(wn.userAgent),bV=/MSIE \d/.test(wn.userAgent),lw=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(wn.userAgent),wg=!!(bV||lw||ow),QA=!wg&&/gecko\/(\d+)/i.test(wn.userAgent),$p=!wg&&/Chrome\/(\d+)/.exec(wn.userAgent),FK="webkitFontSmoothing"in rw.documentElement.style,xV=!wg&&/Apple Computer/.test(wn.vendor),_A=xV&&(/Mobile\/\w+/.test(wn.userAgent)||wn.maxTouchPoints>2);var R={mac:_A||/Mac/.test(wn.platform),ie:wg,ie_version:bV?rw.documentMode||6:lw?+lw[1]:ow?+ow[1]:0,gecko:QA,gecko_version:QA?+(/Firefox\/(\d+)/.exec(wn.userAgent)||[0,0])[1]:0,chrome:!!$p,chrome_version:$p?+$p[1]:0,ios:_A,android:/Android\b/.test(wn.userAgent),safari:xV,webkit_version:FK?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:rw.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const WK=256;let ja=class hw extends ne{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return i&&(!(i instanceof hw)||this.length-(e-t)+i.length>WK)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new hw(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new _e(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return cw(this.dom,t,e)}},Br=class aw extends ne{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(pV(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t)}merge(t,e,i,n,r,o){return i&&(!(i instanceof aw&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(wV(this,t,e,i?i.children:[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new aw(this.mark,e,o)}domAtPos(t){return kV(this.dom,this.children,t)}coordsAt(t,e){return CV(this,t,e)}};function cw(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?R.chrome||R.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=Ga(s,n,r).getClientRects();if(!l.length)return dV;let h=l[(o?o<0:e>=0)?0:l.length-1];return R.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?yg(h,o<0):h||null}let lx=class kh extends ne{constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}static create(t,e,i){return new(t.customView||kh)(t,e,i)}split(t){let e=kh.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof kh)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t.length==this.length&&t instanceof kh&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.eq(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return bt.empty;let t=this;for(;t.parent;)t=t.parent;let e=t.editorView,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):bt.empty}domAtPos(t){return t==0?_e.before(this.dom):_e.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.dom.getClientRects(),n=null;if(!i.length)return dV;for(let r=t>0?i.length-1:0;n=i[r],!(t>0?r==0:r==i.length-1||n.top<n.bottom);r+=t>0?-1:1);return t==0&&e>0||t==this.length&&e<=0?n:yg(n,t==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}};class SV extends lx{domAtPos(t){let{topView:e,text:i}=this.widget;return e?fw(t,0,e,i,(n,r)=>n.domAtPos(r),n=>new _e(i,Math.min(n,i.nodeValue.length))):new _e(i,Math.min(t,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){let{topView:i,text:n}=this.widget;return i?vV(t,e,i,n):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){let{topView:i,text:n}=this.widget;return i?fw(t,e,i,n,(r,o,l)=>r.coordsAt(o,l),(r,o)=>cw(n,r,o)):cw(n,t,e)}destroy(){var t;super.destroy(),(t=this.widget.topView)===null||t===void 0||t.destroy()}get isEditable(){return!0}}function fw(s,t,e,i,n,r){if(e instanceof Br){for(let o of e.children){let l=pl(o.dom,i),h=l?i.nodeValue.length:o.length;if(s<h||s==h&&o.getSide()<=0)return l?fw(s,t,o,i,n,r):n(o,s,t);s-=h}return n(e,e.length,-1)}else return e.dom==i?r(s,t):n(e,s,t)}function vV(s,t,e,i){if(e instanceof Br)for(let n of e.children){let r=0,o=pl(n.dom,i);if(pl(n.dom,s))return r+(o?vV(s,t,n,i):n.localPosFromDOM(s,t));r+=o?i.nodeValue.length:n.length}else if(e.dom==i)return Math.min(t,i.nodeValue.length);return e.localPosFromDOM(s,t)}let uw=class dw extends ne{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof dw&&t.side==this.side}split(){return new dw(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return _e.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){let e=this.dom.getBoundingClientRect(),i=zK(this,this.side>0?-1:1);return i&&i.top<e.bottom&&i.bottom>e.top?{left:e.left,right:e.right,top:i.top,bottom:i.bottom}:e}get overrideDOMText(){return bt.empty}};ja.prototype.children=lx.prototype.children=uw.prototype.children=ox;function zK(s,t){let e=s.parent,i=e?e.children.indexOf(s):-1;for(;e&&i>=0;)if(t<0?i>0:i<e.children.length){let n=e.children[i+t];if(n instanceof ja){let r=n.coordsAt(t<0?n.length:0,t);if(r)return r}i+=t}else if(e instanceof Br&&e.parent)i=e.parent.children.indexOf(e)+(t<0?0:1),e=e.parent;else{let n=e.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function kV(s,t,e){let i=0;for(let n=0;i<t.length;i++){let r=t[i],o=n+r.length;if(!(o==n&&r.getSide()<=0)){if(e>n&&e<o&&r.dom.parentNode==s)return r.domAtPos(e-n);if(e<=n)break;n=o}}for(;i>0;i--){let n=t[i-1].dom;if(n.parentNode==s)return _e.after(n)}return new _e(s,0)}function AV(s,t,e){let i,{children:n}=s;e>0&&t instanceof Br&&n.length&&(i=n[n.length-1])instanceof Br&&i.mark.eq(t.mark)?AV(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function CV(s,t,e){for(let r=0,o=0;o<s.children.length;o++){let l=s.children[o],h=r+l.length,a;if((e<=0||h==s.length||l.getSide()>0?h>=t:h>t)&&(t<h||o+1==s.children.length||(a=s.children[o+1]).length||a.getSide()>0)){let c=0;if(h==r){if(l.getSide()<=0)continue;c=e=-l.getSide()}let f=l.coordsAt(Math.max(0,t-r),e);return c&&f?yg(f,e<0):f}r=h}let i=s.dom.lastChild;if(!i)return s.dom.getBoundingClientRect();let n=Ka(i);return n[n.length-1]||null}function gw(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}function hx(s,t){if(s==t)return!0;if(!s||!t)return!1;let e=Object.keys(s),i=Object.keys(t);if(e.length!=i.length)return!1;for(let n of e)if(i.indexOf(n)==-1||s[n]!==t[n])return!1;return!0}function pw(s,t,e){let i=null;if(t)for(let n in t)e&&n in e||s.removeAttribute(i=n);if(e)for(let n in e)t&&t[n]==e[n]||s.setAttribute(i=n,e[n]);return!!i}let bc=class{eq(t){return!1}updateDOM(t){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}get customView(){return null}destroy(t){}};var Xt=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(Xt||(Xt={}));let kt=class extends gl{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new MV(t)}static widget(t){let e=t.side||0,i=!!t.block;return e+=i?e>0?3e8:-4e8:e>0?1e8:-1e8,new Ua(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=$V(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new Ua(t,i,n,e,t.widget||null,!0)}static line(t){return new ax(t)}static set(t,e=!1){return li.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};kt.none=li.empty;let MV=class DV extends kt{constructor(t){let{start:e,end:i}=$V(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof DV&&this.tagName==t.tagName&&this.class==t.class&&hx(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}};MV.prototype.point=!1;let ax=class OV extends kt{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof OV&&hx(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}};ax.prototype.mapMode=je.TrackBefore;ax.prototype.point=!0;let Ua=class TV extends kt{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?je.TrackBefore:je.TrackAfter:je.TrackDel}get type(){return this.startSide<this.endSide?Xt.WidgetRange:this.startSide<=0?Xt.WidgetBefore:Xt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(t){return t instanceof TV&&qK(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}};Ua.prototype.point=!0;function $V(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function qK(s,t){return s==t||!!(s&&t&&s.compare(t))}function mw(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}let cn=class Iu extends ne{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof Iu))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),wV(this,t,e,i?i.children:[],r,o),!0}split(t){let e=new Iu;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){hx(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){AV(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=gw(e,this.attrs||{})),i&&(this.attrs=gw({class:i},this.attrs||{}))}domAtPos(t){return kV(this.dom,this.children,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.dirty|=6)}sync(t){var e;this.dom?this.dirty&4&&(pV(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(pw(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t);let i=this.dom.lastChild;for(;i&&ne.get(i)instanceof Br;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((e=ne.get(i))===null||e===void 0?void 0:e.isEditable)==!1&&(!R.ios||!this.children.some(n=>n instanceof ja))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0;for(let e of this.children){if(!(e instanceof ja))return null;let i=Ka(e.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}}coordsAt(t,e){return CV(this,t,e)}become(t){return!1}get type(){return Xt.Text}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof Iu)return r;if(o>e)break}n=o+r.breakAfter}return null}},yw=class Nu extends ne{constructor(t,e,i){super(),this.widget=t,this.length=e,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof Nu)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?_e.before(this.dom):_e.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Nu(this.widget,e,this.type);return i.breakAfter=this.breakAfter,i}get children(){return ox}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):bt.empty}domBoundsAround(){return null}become(t){return t instanceof Nu&&t.type==this.type&&t.widget.constructor==this.widget.constructor?(t.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},KK=class RV{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof yw&&t.type==Xt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new cn),this.atCursorPos=!0),this.curLine}flushBuffer(t){this.pendingBuffer&&(this.curLine.append(bf(new uw(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer([]),this.curLine=null,this.content.push(t)}finish(t){t?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,t--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,i)),this.getLine().append(bf(new ja(this.text.slice(this.textOff,this.textOff+n)),e),i),this.atCursorPos=!0,this.textOff+=n,t-=n,i=0}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof Ua){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof Ua)if(i.block){let{type:h}=i;h==Xt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new yw(i.widget||new tC("div"),l,h))}else{let h=lx.create(i.widget||new tC("span"),l,i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(bf(new uw(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(bf(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new RV(t,e,i,r);return o.openEnd=li.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function bf(s,t){for(let e of t)s=new Br(e,[s],s.length);return s}let tC=class extends bc{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}};const BV=G.define(),EV=G.define(),PV=G.define(),LV=G.define(),ww=G.define(),VV=G.define(),IV=G.define({combine:s=>s.some(t=>t)});let eC=class NV{constructor(t,e="nearest",i="nearest",n=5,r=5){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r}map(t){return t.empty?this:new NV(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}};const iC=Ft.define({map:(s,t)=>s.map(t)});function Cs(s,t,e){let i=s.facet(LV);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const xc=G.define({combine:s=>s.length?s[0]:!0});let GK=0;const Ah=G.define();let Sc=class bw{constructor(t,e,i,n){this.id=t,this.create=e,this.domEventHandlers=i,this.extension=n(this)}static define(t,e){const{eventHandlers:i,provide:n,decorations:r}=e||{};return new bw(GK++,t,i,o=>{let l=[Ah.of(o)];return r&&l.push(Ja.of(h=>{let a=h.plugin(o);return a?r(a):kt.none})),n&&l.push(n(o)),l})}static fromClass(t,e){return bw.define(i=>new t(i),e)}},Rp=class{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(Cs(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){Cs(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){Cs(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}};const HV=G.define(),FV=G.define(),Ja=G.define(),WV=G.define(),zV=G.define(),Ch=G.define();let Ya=class Hu{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new Hu(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new Hu(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new Hu(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}},nC=class qV{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=as.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,l,h,a)=>n.push(new Ya(o,l,h,a))),this.changedRanges=n;let r=t.hasFocus;r!=t.inputState.notifiedFocused&&(t.inputState.notifiedFocused=r,this.flags|=1)}static create(t,e,i){return new qV(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}};var be=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(be||(be={}));const xw=be.LTR,jK=be.RTL;function KV(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const UK=KV("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),JK=KV("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Sw=Object.create(null),Tn=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);Sw[t]=e,Sw[e]=-t}function YK(s){return s<=247?UK[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?JK[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||s==8204?256:1}const XK=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;let Jo=class{constructor(t,e,i){this.from=t,this.to=e,this.level=i}get dir(){return this.level%2?jK:xw}side(t,e){return this.dir==e==t?this.to:this.from}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};const Tt=[];function ZK(s,t){let e=s.length,i=t==xw?1:2,n=t==xw?2:1;if(!s||i==1&&!XK.test(s))return GV(e);for(let o=0,l=i,h=i;o<e;o++){let a=YK(s.charCodeAt(o));a==512?a=l:a==8&&h==4&&(a=16),Tt[o]=a==4?2:a,a&7&&(h=a),l=a}for(let o=0,l=i,h=i;o<e;o++){let a=Tt[o];if(a==128)o<e-1&&l==Tt[o+1]&&l&24?a=Tt[o]=l:Tt[o]=256;else if(a==64){let c=o+1;for(;c<e&&Tt[c]==64;)c++;let f=o&&l==8||c<e&&Tt[c]==8?h==1?1:8:256;for(let u=o;u<c;u++)Tt[u]=f;o=c-1}else a==8&&h==1&&(Tt[o]=1);l=a,a&7&&(h=a)}for(let o=0,l=0,h=0,a,c,f;o<e;o++)if(c=Sw[a=s.charCodeAt(o)])if(c<0){for(let u=l-3;u>=0;u-=3)if(Tn[u+1]==-c){let d=Tn[u+2],g=d&2?i:d&4?d&1?n:i:0;g&&(Tt[o]=Tt[Tn[u]]=g),l=u;break}}else{if(Tn.length==189)break;Tn[l++]=o,Tn[l++]=a,Tn[l++]=h}else if((f=Tt[o])==2||f==1){let u=f==i;h=u?0:1;for(let d=l-3;d>=0;d-=3){let g=Tn[d+2];if(g&2)break;if(u)Tn[d+2]|=2;else{if(g&4)break;Tn[d+2]|=4}}}for(let o=0;o<e;o++)if(Tt[o]==256){let l=o+1;for(;l<e&&Tt[l]==256;)l++;let h=(o?Tt[o-1]:i)==1,a=(l<e?Tt[l]:i)==1,c=h==a?h?1:2:i;for(let f=o;f<l;f++)Tt[f]=c;o=l-1}let r=[];if(i==1)for(let o=0;o<e;){let l=o,h=Tt[o++]!=1;for(;o<e&&h==(Tt[o]!=1);)o++;if(h)for(let a=o;a>l;){let c=a,f=Tt[--a]!=2;for(;a>l&&f==(Tt[a-1]!=2);)a--;r.push(new Jo(a,c,f?2:1))}else r.push(new Jo(l,o,0))}else for(let o=0;o<e;){let l=o,h=Tt[o++]==2;for(;o<e&&h==(Tt[o]==2);)o++;r.push(new Jo(l,o,h?1:2))}return r}function GV(s){return[new Jo(0,s,0)]}let jV="";function QK(s,t,e,i,n){var r;let o=i.head-s.from,l=-1;if(o==0){if(!n||!s.length)return null;t[0].level!=e&&(o=t[0].side(!1,e),l=0)}else if(o==s.length){if(n)return null;let u=t[t.length-1];u.level!=e&&(o=u.side(!0,e),l=t.length-1)}l<0&&(l=Jo.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc));let h=t[l];o==h.side(n,e)&&(h=t[l+=n?1:-1],o=h.side(!n,e));let a=n==(h.dir==e),c=Ys(s.text,o,a);if(jV=s.text.slice(Math.min(o,c),Math.max(o,c)),c!=h.side(n,e))return q.cursor(c+s.from,a?-1:1,h.level);let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return!f&&h.level!=e?q.cursor(n?s.to:s.from,n?-1:1,e):f&&f.level<h.level?q.cursor(f.side(!n,e)+s.from,n?1:-1,f.level):q.cursor(c+s.from,n?-1:1,h.level)}const Xs="￿";let UV=class{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(si.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Xs}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n),this.readNode(n);let r=n.nextSibling;if(r==e)break;let o=ne.get(n),l=ne.get(r);(o&&l?o.breakAfter:(o?o.breakAfter:sC(n))||sC(r)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=r}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=ne.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+Math.min(e,i.offset))}};function sC(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}let rC=class{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}},oC=class extends ne{constructor(t){super(),this.view=t,this.compositionDeco=kt.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new cn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Ya(0,0,0,t.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(t){let e=t.changedRanges;this.minWidth>0&&e.length&&(e.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=kt.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=tG(this.view,t.changes)),(R.ie||R.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,n=this.updateDeco(),r=sG(i,n,t.changes);return e=Ya.extendWithRanges(e,r),this.dirty==0&&e.length==0?!1:(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let r=R.chrome||R.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(r),this.dirty=0,r&&(r.written||i.selectionRange.focusNode!=r.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let r of this.children)r instanceof yw&&r.widget instanceof lC&&n.push(r.dom);i.updateGaps(n)}updateChildren(t,e){let i=this.childCursor(e);for(let n=t.length-1;;n--){let r=n>=0?t[n]:null;if(!r)break;let{fromA:o,toA:l,fromB:h,toB:a}=r,{content:c,breakAtStart:f,openStart:u,openEnd:d}=KK.build(this.view.state.doc,h,a,this.decorations,this.dynamicDecorationMap),{i:g,off:m}=i.findPos(l,1),{i:p,off:y}=i.findPos(o,-1);yV(this,p,y,g,m,c,f,u,d)}}updateSelection(t=!1,e=!1){if(t&&this.view.observer.readSelectionRange(),!(e||this.mayControlSelection())||R.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),o=n.empty?r:this.domAtPos(n.head);if(R.gecko&&n.empty&&_K(r)){let h=document.createTextNode("");this.view.observer.ignore(()=>r.node.insertBefore(h,r.node.childNodes[r.offset]||null)),r=o=new _e(h,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!Ld(r.node,r.offset,l.anchorNode,l.anchorOffset)||!Ld(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{R.android&&R.chrome&&this.dom.contains(l.focusNode)&&rG(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Pd(this.root);if(n.empty){if(R.gecko){let a=iG(r.node,r.offset);if(a&&a!=3){let c=YV(r.node,r.offset,a==1?1:-1);c&&(r=new _e(c,a==1?0:c.nodeValue.length))}}h.collapse(r.node,r.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend)h.collapse(r.node,r.offset),h.extend(o.node,o.offset);else{let a=document.createRange();n.anchor>n.head&&([r,o]=[o,r]),a.setEnd(o.node,o.offset),a.setStart(r.node,r.offset),h.removeAllRanges(),h.addRange(a)}}),this.view.observer.setSelectionRange(r,o)),this.impreciseAnchor=r.precise?null:new _e(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new _e(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let t=this.view.state.selection.main,e=Pd(this.root);if(!t.empty||!t.assoc||!e.modify)return;let i=cn.find(this,t.head);if(!i)return;let n=i.posAtStart;if(t.head==n||t.head==n+i.length)return;let r=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!r||!o||r.bottom>o.top)return;let l=this.domAtPos(t.head+t.assoc);e.collapse(l.node,l.offset),e.modify("move",t.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(xc)?this.root.activeElement==this.dom:ew(this.dom,this.view.observer.selectionRange)}nearest(t){for(let e=t;e;){let i=ne.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof cn)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],o=i-r.breakAfter-r.length;if(t>o||t==o&&r.type!=Xt.WidgetBefore&&r.type!=Xt.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==Xt.WidgetBefore&&e>-2))return r.coordsAt(t-o,e);i=o}}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==be.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?Ka(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?be.RTL:be.LTR}measureTextSize(){for(let n of this.children)if(n instanceof cn){let r=n.measureTextSize();if(r)return r}let t=document.createElement("div"),e,i;return t.className="cm-line",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=Ka(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,t.remove()}),{lineHeight:e,charWidth:i}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new mV(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=e.lineBlockAt(o).bottom-e.lineBlockAt(i).top;t.push(kt.replace({widget:new lC(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return kt.set(t)}updateDeco(){let t=this.view.state.facet(Ja).map((e,i)=>(this.dynamicDecorationMap[i]=typeof e=="function")?e(this.view):e);for(let e=t.length;e<t.length+3;e++)this.dynamicDecorationMap[e]=!1;return this.decorations=[...t,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=0,o=0,l=0,h=0;for(let c of this.view.state.facet(zV).map(f=>f(this.view)))if(c){let{left:f,right:u,top:d,bottom:g}=c;f!=null&&(r=Math.max(r,f)),u!=null&&(o=Math.max(o,u)),d!=null&&(l=Math.max(l,d)),g!=null&&(h=Math.max(h,g))}let a={left:i.left-r,top:i.top-l,right:i.right+o,bottom:i.bottom+h};IK(this.view.scrollDOM,a,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==be.LTR)}};function _K(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}let lC=class extends bc{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function JV(s){let t=s.observer.selectionRange,e=t.focusNode&&YV(t.focusNode,t.focusOffset,0);if(!e)return null;let i=s.docView.nearest(e);if(!i)return null;if(i instanceof cn){let n=e;for(;n.parentNode!=i.dom;)n=n.parentNode;let r=n.previousSibling;for(;r&&!ne.get(r);)r=r.previousSibling;let o=r?ne.get(r).posAtEnd:i.posAtStart;return{from:o,to:o,node:n,text:e}}else{for(;;){let{parent:r}=i;if(!r)return null;if(r instanceof cn)break;i=r}let n=i.posAtStart;return{from:n,to:n+i.length,node:i.dom,text:e}}}function tG(s,t){let e=JV(s);if(!e)return kt.none;let{from:i,to:n,node:r,text:o}=e,l=t.mapPos(i,1),h=Math.max(l,t.mapPos(n,-1)),{state:a}=s,c=r.nodeType==3?r.nodeValue:new UV([],a).readRange(r.firstChild,null).text;if(h-l<c.length)if(a.doc.sliceString(l,Math.min(a.doc.length,l+c.length),Xs)==c)h=l+c.length;else if(a.doc.sliceString(Math.max(0,h-c.length),h,Xs)==c)l=h-c.length;else return kt.none;else if(a.doc.sliceString(l,h,Xs)!=c)return kt.none;let f=ne.get(r);return f instanceof SV?f=f.widget.topView:f&&(f.parent=null),kt.set(kt.replace({widget:new eG(r,o,f),inclusive:!0}).range(l,h))}class eG extends bc{constructor(t,e,i){super(),this.top=t,this.text=e,this.topView=i}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return SV}}function YV(s,t,e){for(;;){if(s.nodeType==3)return s;if(s.nodeType==1&&t>0&&e<=0)s=s.childNodes[t-1],t=Vd(s);else if(s.nodeType==1&&t<s.childNodes.length&&e>=0)s=s.childNodes[t],t=0;else return null}}function iG(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let nG=class{constructor(){this.changes=[]}compareRange(t,e){mw(t,e,this.changes)}comparePoint(t,e){mw(t,e,this.changes)}};function sG(s,t,e){let i=new nG;return li.compare(s,t,e,i),i.changes}function rG(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function oG(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return q.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=Ys(n.text,r,!1):l=Ys(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=Ys(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=Ys(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return q.range(o+n.from,l+n.from)}function lG(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function hG(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function Bp(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function hC(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function aC(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function vw(s,t,e){let i,n,r,o,l,h,a,c;for(let d=s.firstChild;d;d=d.nextSibling){let g=Ka(d);for(let m=0;m<g.length;m++){let p=g[m];n&&Bp(n,p)&&(p=hC(aC(p,n.bottom),n.top));let y=lG(t,p),w=hG(e,p);if(y==0&&w==0)return d.nodeType==3?cC(d,t,e):vw(d,t,e);(!i||o>w||o==w&&r>y)&&(i=d,n=p,r=y,o=w),y==0?e>p.bottom&&(!a||a.bottom<p.bottom)?(l=d,a=p):e<p.top&&(!c||c.top>p.top)&&(h=d,c=p):a&&Bp(a,p)?a=aC(a,p.bottom):c&&Bp(c,p)&&(c=hC(c,p.top))}}if(a&&a.bottom>=e?(i=l,n=a):c&&c.top<=e&&(i=h,n=c),!i)return{node:s,offset:0};let f=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return cC(i,f,e);if(!r&&i.contentEditable=="true")return vw(i,f,e);let u=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:u}}function cC(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=Ga(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if((R.chrome||R.gecko)&&Ga(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function XV(s,{x:t,y:e},i,n=-1){var r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,c=e-l;if(c<0)return 0;if(c>a)return s.state.doc.length;for(let y=s.defaultLineHeight/2,w=!1;h=s.elementAtHeight(c),h.type!=Xt.Text;)for(;c=n>0?h.bottom+y:h.top-y,!(c>=0&&c<=a);){if(w)return i?null:0;w=!0,n=-n}e=l+c;let f=h.from;if(f<s.viewport.from)return s.viewport.from==0?0:i?null:fC(s,o,h,t,e);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:i?null:fC(s,o,h,t,e);let u=s.dom.ownerDocument,d=s.root.elementFromPoint?s.root:u,g=d.elementFromPoint(t,e);g&&!s.contentDOM.contains(g)&&(g=null),g||(t=Math.max(o.left+1,Math.min(o.right-1,t)),g=d.elementFromPoint(t,e),g&&!s.contentDOM.contains(g)&&(g=null));let m,p=-1;if(g&&((r=s.docView.nearest(g))===null||r===void 0?void 0:r.isEditable)!=!1){if(u.caretPositionFromPoint){let y=u.caretPositionFromPoint(t,e);y&&({offsetNode:m,offset:p}=y)}else if(u.caretRangeFromPoint){let y=u.caretRangeFromPoint(t,e);y&&({startContainer:m,startOffset:p}=y,R.safari&&aG(m,p,t)&&(m=void 0))}}if(!m||!s.docView.dom.contains(m)){let y=cn.find(s.docView,f);if(!y)return c>h.top+h.height/2?h.to:h.from;({node:m,offset:p}=vw(y.dom,t,e))}return s.docView.posFromDOM(m,p)}function fC(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=Math.floor((n-e.top)/s.defaultLineHeight);r+=l*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+PK(o,r,s.state.tabSize)}function aG(s,t,e){let i;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return Ga(s,i-1,i).getBoundingClientRect().left>e}function cG(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=!i||!s.lineWrapping?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let h=s.dom.getBoundingClientRect(),a=s.textDirectionAt(n.from),c=s.posAtCoords({x:e==(a==be.LTR)?h.right-1:h.left+1,y:(r.top+r.bottom)/2});if(c!=null)return q.cursor(c,e?-1:1)}let o=cn.find(s.docView,t.head),l=o?e?o.posAtEnd:o.posAtStart:e?n.to:n.from;return q.cursor(l,e?-1:1)}function uC(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=QK(n,r,o,l,e),c=jV;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=q.cursor(e?n.from:n.to)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function fG(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==xs.Space&&(n=o),n==o}}function uG(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return q.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.defaultLineHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=XV(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n))return q.cursor(m,t.assoc,void 0,o)}}function Ep(s,t,e){let i=s.state.facet(WV).map(n=>n(s));for(;;){let n=!1;for(let r of i)r.between(e.from-1,e.from+1,(o,l,h)=>{e.from>o&&e.from<l&&(e=t.from>e.from?q.cursor(o,1):q.cursor(l,-1),n=!0)});if(!n)return e}}let dG=class{constructor(t){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let e in ue){let i=ue[e];t.contentDOM.addEventListener(e,n=>{!dC(t,n)||this.ignoreDuringComposition(n)||e=="keydown"&&this.keydown(t,n)||(this.mustFlushObserver(n)&&t.observer.forceFlush(),this.runCustomHandlers(e,t,n)?n.preventDefault():i(t,n))}),this.registeredEvents.push(e)}R.chrome&&R.chrome_version>=102&&t.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?t.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,t.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=t.hasFocus,R.safari&&t.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}ensureHandlers(t,e){var i;let n;this.customHandlers=[];for(let r of e)if(n=(i=r.update(t).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let o in n)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),t.contentDOM.addEventListener(o,l=>{dC(t,l)&&this.runCustomHandlers(o,t,l)&&l.preventDefault()}))}}runCustomHandlers(t,e,i){for(let n of this.customHandlers){let r=n.handlers[t];if(r)try{if(r.call(n.plugin,i,e)||i.defaultPrevented)return!0}catch(o){Cs(e.state,o)}}return!1}runScrollHandlers(t,e){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,e,t)}catch(r){Cs(t.state,r)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(R.android&&R.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return R.ios&&(i=ZV.find(n=>n.keyCode==e.keyCode))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(t),250),!0):!1}flushIOSKey(t){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,ta(t.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:R.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!R.ios}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};const ZV=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],gG=[16,17,18,20,91,92,224,225];let pG=class{constructor(t,e,i,n){this.view=t,this.style=i,this.mustSelect=n,this.lastEvent=e;let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(si.allowMultipleSelections)&&mG(t,e),this.dragMove=yG(t,e),this.dragging=wG(t,e)&&cx(e)==1?null:!1,this.dragging===!1&&(e.preventDefault(),this.select(e))}move(t){if(t.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=t)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(t){let e=this.style.get(t,this.extend,this.multiple);(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}};function mG(s,t){let e=s.state.facet(BV);return e.length?e[0](t):R.mac?t.metaKey:t.ctrlKey}function yG(s,t){let e=s.state.facet(EV);return e.length?e[0](t):R.mac?!t.altKey:!t.ctrlKey}function wG(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=Pd(s.root);if(i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function dC(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=ne.get(e))&&i.ignoreEvent(t))return!1;return!0}const ue=Object.create(null),QV=R.ie&&R.ie_version<15||R.ios&&R.webkit_version<604;function bG(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),_V(s,e.value)},50)}function _V(s,t){let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(kw!=null&&e.selection.ranges.every(h=>h.empty)&&kw==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:q.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:q.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ue.keydown=(s,t)=>{s.inputState.setSelectionOrigin("select"),t.keyCode==27?s.inputState.lastEscPress=Date.now():gG.indexOf(t.keyCode)<0&&(s.inputState.lastEscPress=0)};let t3=0;ue.touchstart=(s,t)=>{t3=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};ue.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};ue.mousedown=(s,t)=>{if(s.observer.flush(),t3>Date.now()-2e3&&cx(t)==1)return;let e=null;for(let i of s.state.facet(PV))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=vG(s,t)),e){let i=s.root.activeElement!=s.contentDOM;i&&s.observer.ignore(()=>gV(s.contentDOM)),s.inputState.startMouseSelection(new pG(s,t,e,i))}};function gC(s,t,e,i){if(i==1)return q.cursor(t,e);if(i==2)return oG(s.state,t,e);{let n=cn.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,q.range(o,l)}}let e3=(s,t)=>s>=t.top&&s<=t.bottom,pC=(s,t,e)=>e3(t,e)&&s>=e.left&&s<=e.right;function xG(s,t,e,i){let n=cn.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&pC(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&pC(e,i,l)?1:o&&e3(i,o)?-1:1}function mC(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:xG(s,e,t.clientX,t.clientY)}}const SG=R.ie&&R.ie_version<=11;let yC=null,wC=0,bC=0;function cx(s){if(!SG)return s.detail;let t=yC,e=bC;return yC=s,bC=Date.now(),wC=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(wC+1)%3:1}function vG(s,t){let e=mC(s,t),i=cx(t),n=s.state.selection,r=e,o=t;return{update(l){l.docChanged&&(e&&(e.pos=l.changes.mapPos(e.pos)),n=n.map(l.changes),o=null)},get(l,h,a){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=r:(c=r=mC(s,l),o=l),!c||!e)return n;let f=gC(s,c.pos,c.bias,i);if(e.pos!=c.pos&&!h){let u=gC(s,e.pos,e.bias,i),d=Math.min(u.from,f.from),g=Math.max(u.to,f.to);f=d<f.from?q.range(d,g):q.range(g,d)}return h?n.replaceRange(n.main.extend(f.from,f.to)):a?n.addRange(f):q.create([f])}}}ue.dragstart=(s,t)=>{let{selection:{main:e}}=s.state,{mouseSelection:i}=s.inputState;i&&(i.dragging=e),t.dataTransfer&&(t.dataTransfer.setData("Text",s.state.sliceDoc(e.from,e.to)),t.dataTransfer.effectAllowed="copyMove")};function xC(s,t,e,i){if(!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=s.inputState,o=i&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"})}ue.drop=(s,t)=>{if(!t.dataTransfer)return;if(s.state.readOnly)return t.preventDefault();let e=t.dataTransfer.files;if(e&&e.length){t.preventDefault();let i=Array(e.length),n=0,r=()=>{++n==e.length&&xC(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}}else xC(s,t,t.dataTransfer.getData("Text"),!0)};ue.paste=(s,t)=>{if(s.state.readOnly)return t.preventDefault();s.observer.flush();let e=QV?null:t.clipboardData;e?(_V(s,e.getData("text/plain")),t.preventDefault()):bG(s)};function kG(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function AG(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:t.join(s.lineBreak),ranges:e,linewise:i}}let kw=null;ue.copy=ue.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=AG(s.state);if(!e&&!n)return;kw=n?e:null;let r=QV?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",e)):kG(s,e),t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function i3(s){setTimeout(()=>{s.hasFocus!=s.inputState.notifiedFocused&&s.update([])},10)}ue.focus=i3;ue.blur=s=>{s.observer.clearSelectionRange(),i3(s)};function n3(s,t){if(s.docView.compositionDeco.size){s.inputState.rapidCompositionStart=t;try{s.update([])}finally{s.inputState.rapidCompositionStart=!1}}}ue.compositionstart=ue.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0,s.docView.compositionDeco.size&&(s.observer.flush(),n3(s,!0)))};ue.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionFirstChange=null,setTimeout(()=>{s.inputState.composing<0&&n3(s,!1)},50)};ue.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};ue.beforeinput=(s,t)=>{var e;let i;if(R.chrome&&R.android&&(i=ZV.find(n=>n.inputType==t.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}};const SC=["pre-wrap","normal","pre-line","break-spaces"];let CG=class{constructor(){this.doc=bt.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return SC.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r){let o=SC.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=e,this.charWidth=i,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<r.length;h++){let a=r[h];a<0?h++:this.heightSamples[Math.floor(a*10)]=!0}}return l}},MG=class{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}},So=class s3{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){let e=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new s3(this.from,this.length+t.length,this.top,this.height+t.height,e)}};var ft=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(ft||(ft={}));const Fu=.001;let is=class Wu{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>Fu&&(t.heightChanged=!0),this.height=e)}replace(t,e,i){return Wu.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this;for(let o=n.length-1;o>=0;o--){let{fromA:l,toA:h,fromB:a,toB:c}=n[o],f=r.lineAt(l,ft.ByPosNoHeight,e,0,0),u=f.to>=h?f:r.lineAt(h,ft.ByPosNoHeight,e,0,0);for(c+=u.to-h,h=u.to;o>0&&f.from<=n[o-1].toA;)l=n[o-1].fromA,a=n[o-1].fromB,o--,l<f.from&&(f=r.lineAt(l,ft.ByPosNoHeight,e,0,0));a+=f.from-l,l=f.from;let d=TG.build(i,t,a,c);r=r.replace(l,h,d)}return r.updateHeight(i,0)}static empty(){return new qn(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new DG(Wu.of(t.slice(0,e)),o,Wu.of(t.slice(i)))}};is.prototype.size=1;let r3=class extends is{constructor(t,e,i){super(t,e),this.type=i}blockAt(t,e,i,n){return new So(n,this.length,i,this.height,this.type)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(t,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},qn=class Aw extends r3{constructor(t,e){super(t,e,Xt.Text),this.collapsed=0,this.widgetHeight=0}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof Aw||n instanceof Yo&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Yo?n=new Aw(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):is.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(t,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},Yo=class Yi extends is{constructor(t){super(t,0)}lines(t,e){let i=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,lineHeight:l}=this.lines(e,n),h=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:a,length:c}=e.line(r+h);return new So(a,c,i+l*h,l,Xt.Text)}lineAt(t,e,i,n,r){if(e==ft.ByHeight)return this.blockAt(t,i,n,r);if(e==ft.ByPosNoHeight){let{from:f,to:u}=i.lineAt(t);return new So(f,u-f,0,0,Xt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,r),{from:h,length:a,number:c}=i.lineAt(t);return new So(h,a,n+l*(c-o),l,Xt.Text)}forEachLine(t,e,i,n,r,o){let{firstLine:l,lineHeight:h}=this.lines(i,r);for(let a=Math.max(t,r),c=Math.min(r+this.length,e);a<=c;){let f=i.lineAt(a);a==t&&(n+=h*(f.number-l)),o(new So(f.from,f.length,n,h,Xt.Text)),n+=h,a=f.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof Yi?i[i.length-1]=new Yi(r.length+n):i.push(null,new Yi(n-1))}if(t>0){let r=i[0];r instanceof Yi?i[0]=new Yi(t+r.length):i.unshift(new Yi(t-1),null)}return is.of(i)}decomposeLeft(t,e){e.push(new Yi(t-1),null)}decomposeRight(t,e){e.push(null,new Yi(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1,a=t.heightChanged;for(n.from>e&&o.push(new Yi(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let f=t.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];h==-1?h=u:Math.abs(u-h)>=Fu&&(h=-2);let d=new qn(f,u);d.outdated=!1,o.push(d),l+=f+1}l<=r&&o.push(null,new Yi(r-l).updateHeight(t,l));let c=is.of(o);return t.heightChanged=a||h<0||Math.abs(c.height-this.height)>=Fu||Math.abs(h-this.lines(t.doc,e).lineHeight)>=Fu,c}else(i||this.outdated)&&(this.setHeight(t,t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},DG=class extends is{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==ft.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==ft.ByPosNoHeight?ft.ByPosNoHeight:ft.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,ft.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&vC(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),vC(r,l)}return is.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?is.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function vC(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof Yo&&(i=s[t+1])instanceof Yo&&s.splice(t-1,3,new Yo(e.length+1+i.length))}const OG=5;let TG=class o3{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof qn?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new qn(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=e-t;i.block?this.addBlock(new r3(r,n,i.type)):(r||n>=OG)&&this.addLineDeco(n,r)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new qn(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new Yo(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof qn)return t;let e=new qn(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine(),t.type==Xt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,t.type!=Xt.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){let i=this.ensureLine();i.length+=e,i.collapsed+=e,i.widgetHeight=Math.max(i.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof qn)&&!this.isCovered?this.nodes.push(new qn(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof qn&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new o3(i,t);return li.spans(e,i,n,r,0),r.finish(i)}};function $G(s,t,e){let i=new RG;return li.compare(s,t,e,i,0),i.changes}let RG=class{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&mw(t,e,this.changes,5)}};function BG(s,t){let e=s.getBoundingClientRect(),i=Math.max(0,e.left),n=Math.min(innerWidth,e.right),r=Math.max(0,e.top),o=Math.min(innerHeight,e.bottom),l=s.ownerDocument.body;for(let h=s.parentNode;h&&h!=l;)if(h.nodeType==1){let a=h,c=window.getComputedStyle(a);if((a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)&&c.overflow!="visible"){let f=a.getBoundingClientRect();i=Math.max(i,f.left),n=Math.min(n,f.right),r=Math.max(r,f.top),o=Math.min(o,f.bottom)}h=c.position=="absolute"||c.position=="fixed"?a.offsetParent:a.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:i-e.left,right:Math.max(i,n)-e.left,top:r-(e.top+t),bottom:Math.max(r,o)-(e.top+t)}}function EG(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}let Pp=class{constructor(t,e,i){this.from=t,this.to=e,this.size=i}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t){return kt.replace({widget:new PG(this.size,t)}).range(this.from,this.to)}},PG=class extends bc{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}},kC=class{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new CG,this.scaler=MC,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=be.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=t.facet(Ja).filter(e=>typeof e!="function"),this.heightMap=is.empty().applyChanges(this.stateDeco,bt.empty,this.heightOracle.setDoc(t.doc),[new Ya(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=kt.set(this.lineGaps.map(e=>e.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new xf(r,o))}}this.viewports=t.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?MC:new IG(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,t=>{this.viewportLines.push(this.scaler.scale==1?t:Mh(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ja).filter(a=>typeof a!="function");let n=t.changedRanges,r=Ya.extendWithRanges(n,$G(i,this.stateDeco,t?t.changes:as.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(t.flags|=2);let l=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=!t.changes.empty||t.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?be.RTL:be.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=o||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;this.contentDOMHeight=e.clientHeight,this.mustMeasureContent=!1;let h=0,a=0,c=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let u=(this.printing?EG:BG)(e,this.paddingTop),d=u.top-this.pixelViewport.top,g=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let m=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(m!=this.inView&&(this.inView=m,m&&(l=!0)),!this.inView)return 0;let p=e.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let w=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(w)&&(o=!0),o||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:x,charWidth:b}=t.docView.measureTextSize();o=n.refresh(r,x,b,p/b,w),o&&(t.docView.minWidth=0,h|=8)}d>0&&g>0?a=Math.max(d,g):d<0&&g<0&&(a=Math.min(d,g)),n.heightChanged=!1;for(let x of this.viewports){let b=x.from==this.viewport.from?w:t.docView.measureVisibleLineHeights(x);this.heightMap=this.heightMap.updateHeight(n,0,o,new MG(x.from,b))}n.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,a)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(a,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:o,visibleBottom:l}=this,h=new xf(n.lineAt(o-i*1e3,ft.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,ft.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,ft.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new xf(n.lineAt(u-1e3/2,ft.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,ft.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new xf(this.heightMap.lineAt(i,ft.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,ft.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,ft.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(e,ft.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new Pp(e.mapPos(n.from),e.mapPos(n.to),n.size));return i}ensureLineGaps(t){let e=[];if(this.defaultTextDirection!=be.LTR)return e;for(let i of this.viewportLines){if(i.length<4e3)continue;let n=LG(i.from,i.to,this.stateDeco);if(n.total<4e3)continue;let r,o;if(this.heightOracle.lineWrapping){let a=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;r=Sf(n,(this.visibleTop-i.top-a)/i.height),o=Sf(n,(this.visibleBottom-i.top+a)/i.height)}else{let a=n.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;r=Sf(n,(this.pixelViewport.left-c)/a),o=Sf(n,(this.pixelViewport.right+c)/a)}let l=[];r>i.from&&l.push({from:i.from,to:r}),o<i.to&&l.push({from:o,to:i.to});let h=this.state.selection.main;h.from>=i.from&&h.from<=i.to&&CC(l,h.from-10,h.from+10),!h.empty&&h.to>=i.from&&h.to<=i.to&&CC(l,h.to-10,h.to+10);for(let{from:a,to:c}of l)c-a>1e3&&e.push(VG(t,f=>f.from>=i.from&&f.to<=i.to&&Math.abs(f.from-a)<1e3&&Math.abs(f.to-c)<1e3)||new Pp(a,c,this.gapSize(i,a,c,n)))}return e}gapSize(t,e,i,n){let r=AC(n,i)-AC(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){Pp.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=kt.set(t.map(e=>e.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];li.spans(t,this.viewport.from,this.viewport.to,{span(n,r){e.push({from:n,to:r})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=e[r].from||n.to!=e[r].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||Mh(this.heightMap.lineAt(t,ft.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(t){return Mh(this.heightMap.lineAt(this.scaler.fromDOM(t),ft.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(t){return Mh(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},xf=class{constructor(t,e){this.from=t,this.to=e}};function LG(s,t,e){let i=[],n=s,r=0;return li.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function Sf({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function AC(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function CC(s,t,e){for(let i=0;i<s.length;i++){let n=s[i];if(n.from<e&&n.to>t){let r=[];n.from<t&&r.push({from:n.from,to:t}),n.to>e&&r.push({from:e,to:n.to}),s.splice(i,1,...r),i+=r.length-1}}}function VG(s,t){for(let e of s)if(t(e))return e}const MC={toDOM(s){return s},fromDOM(s){return s},scale:1};let IG=class{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,ft.ByPos,t,0,0).top,c=e.lineAt(h,ft.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}};function Mh(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new So(s.from,s.length,e,i-e,Array.isArray(s.type)?s.type.map(n=>Mh(n,t)):s.type)}const vf=G.define({combine:s=>s.join(" ")}),Cw=G.define({combine:s=>s.indexOf(!0)>-1}),Mw=I.newName(),l3=I.newName(),h3=I.newName(),a3={"&light":"."+l3,"&dark":"."+h3};function Dw(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const NG=Dw("."+Mw,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},a3),HG={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Lp=R.ie&&R.ie_version<=11;let FG=class{constructor(t,e,i){this.view=t,this.onChange=e,this.onScrollChanged=i,this.active=!1,this.selectionRange=new NK,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(R.ie&&R.ie_version<=11||R.ios&&t.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),Lp&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(t.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:e}=this,i=this.selectionRange;if(e.state.facet(xc)?e.root.activeElement!=this.dom:!ew(e.dom,i))return;let n=i.anchorNode&&e.docView.nearest(i.anchorNode);n&&n.ignoreEvent(t)||((R.ie&&R.ie_version<=11||R.android&&R.chrome)&&!e.state.selection.main.empty&&i.focusNode&&Ld(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:t}=this.view,e=Pd(t),i=R.safari&&t.nodeType==11&&LK()==this.view.contentDOM&&WG(this.view)||e;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,HG),Lp&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Lp&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||ta(this.view.contentDOM,i.key,i.keyCode)}),(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let t=this.queue;for(let r of this.observer.takeRecords())t.push(r);t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;t&&this.readSelectionRange();let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&ew(this.dom,this.selectionRange);if(e<0&&!r)return;this.selectionChanged=!1;let o=this.view.state,l=this.onChange(e,i,n);return this.view.state==o&&this.view.update([]),l}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.dirty|=4),t.type=="childList"){let i=DC(e,t.previousSibling||t.target.previousSibling,-1),n=DC(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function DC(s,t,e){for(;t;){let i=ne.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function WG(s){let t=null;function e(h){h.preventDefault(),h.stopImmediatePropagation(),t=h.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",e,!0),document.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",e,!0),!t)return null;let i=t.startContainer,n=t.startOffset,r=t.endContainer,o=t.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return Ld(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}function zG(s,t,e,i){let n,r,o=s.state.selection.main;if(t>-1){let l=s.docView.domBoundsAround(t,e,0);if(!l||s.state.readOnly)return!1;let{from:h,to:a}=l,c=s.docView.impreciseHead||s.docView.impreciseAnchor?[]:KG(s),f=new UV(c,s.state);f.readRange(l.startDOM,l.endDOM);let u=o.from,d=null;(s.inputState.lastKeyCode===8&&s.inputState.lastKeyTime>Date.now()-100||R.android&&f.text.length<a-h)&&(u=o.to,d="end");let g=qG(s.state.doc.sliceString(h,a,Xs),f.text,u-h,d);g&&(R.chrome&&s.inputState.lastKeyCode==13&&g.toB==g.from+2&&f.text.slice(g.from,g.toB)==Xs+Xs&&g.toB--,n={from:h+g.from,to:h+g.toA,insert:bt.of(f.text.slice(g.from,g.toB).split(Xs))}),r=GG(c,h)}else if(s.hasFocus||!s.state.facet(xc)){let l=s.observer.selectionRange,{impreciseHead:h,impreciseAnchor:a}=s.docView,c=h&&h.node==l.focusNode&&h.offset==l.focusOffset||!pl(s.contentDOM,l.focusNode)?s.state.selection.main.head:s.docView.posFromDOM(l.focusNode,l.focusOffset),f=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!pl(s.contentDOM,l.anchorNode)?s.state.selection.main.anchor:s.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||f!=o.anchor)&&(r=q.single(f,c))}if(!n&&!r)return!1;if(!n&&i&&!o.empty&&r&&r.main.empty?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,o.to)}:n&&n.from>=o.from&&n.to<=o.to&&(n.from!=o.from||n.to!=o.to)&&o.to-o.from-(n.to-n.from)<=4?n={from:o.from,to:o.to,insert:s.state.doc.slice(o.from,n.from).append(n.insert).append(s.state.doc.slice(n.to,o.to))}:(R.mac||R.android)&&n&&n.from==n.to&&n.from==o.head-1&&n.insert.toString()=="."&&(n={from:o.from,to:o.to,insert:bt.of([" "])}),n){let l=s.state;if(R.ios&&s.inputState.flushIOSKey(s)||R.android&&(n.from==o.from&&n.to==o.to&&n.insert.length==1&&n.insert.lines==2&&ta(s.contentDOM,"Enter",13)||n.from==o.from-1&&n.to==o.to&&n.insert.length==0&&ta(s.contentDOM,"Backspace",8)||n.from==o.from&&n.to==o.to+1&&n.insert.length==0&&ta(s.contentDOM,"Delete",46)))return!0;let h=n.insert.toString();if(s.state.facet(VV).some(f=>f(s,n.from,n.to,h)))return!0;s.inputState.composing>=0&&s.inputState.composing++;let a;if(n.from>=o.from&&n.to<=o.to&&n.to-n.from>=(o.to-o.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&s.inputState.composing<0){let f=o.from<n.from?l.sliceDoc(o.from,n.from):"",u=o.to>n.to?l.sliceDoc(n.to,o.to):"";a=l.replaceSelection(s.state.toText(f+n.insert.sliceString(0,void 0,s.state.lineBreak)+u))}else{let f=l.changes(n),u=r&&!l.selection.main.eq(r.main)&&r.main.to<=f.newLength?r.main:void 0;if(l.selection.ranges.length>1&&s.inputState.composing>=0&&n.to<=o.to&&n.to>=o.to-10){let d=s.state.sliceDoc(n.from,n.to),g=JV(s)||s.state.doc.lineAt(o.head),m=o.to-n.to,p=o.to-o.from;a=l.changeByRange(y=>{if(y.from==o.from&&y.to==o.to)return{changes:f,range:u||y.map(f)};let w=y.to-m,x=w-d.length;if(y.to-y.from!=p||s.state.sliceDoc(x,w)!=d||g&&y.to>=g.from&&y.from<=g.to)return{range:y};let b=l.changes({from:x,to:w,insert:n.insert}),S=y.to-o.to;return{changes:b,range:u?q.range(Math.max(0,u.anchor+S),Math.max(0,u.head+S)):y.map(b)}})}else a={changes:f,selection:u&&l.selection.replaceRange(u)}}let c="input.type";return s.composing&&(c+=".compose",s.inputState.compositionFirstChange&&(c+=".start",s.inputState.compositionFirstChange=!1)),s.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(o)){let l=!1,h="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(l=!0),h=s.inputState.lastSelectionOrigin),s.dispatch({selection:r,scrollIntoView:l,userEvent:h}),!0}else return!1}function qG(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function KG(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new rC(e,i)),(n!=e||r!=i)&&t.push(new rC(n,r))),t}function GG(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?q.single(e+t,i+t):null}let Et=class c3{constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=t.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=t.root||HK(t.parent)||document,this.viewState=new kC(t.state||si.create()),this.plugins=this.state.facet(Ah).map(e=>new Rp(e));for(let e of this.plugins)e.update(this);this.observer=new FG(this,(e,i,n)=>zG(this,e,i,n),e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()}),this.inputState=new dG(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new oC(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...t){this._dispatch(t.length==1&&t[0]instanceof yn?t[0]:this.state.update(...t))}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let l of t){if(l.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=l.state}if(this.destroyed){this.viewState.state=r;return}if(this.observer.clear(),r.facet(si.phrases)!=this.state.facet(si.phrases))return this.setState(r);n=nC.create(this,r,t);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let l of t){if(o&&(o=o.map(l.changes)),l.scrollIntoView){let{main:h}=l.state.selection;o=new eC(h.empty?h:q.cursor(h.head,h.head>h.anchor?-1:1))}for(let h of l.effects)h.is(iC)&&(o=h.value)}this.viewState.update(n,o),this.bidiCache=TC.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(Ch)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(l=>l.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(vf)!=n.state.facet(vf)&&(this.viewState.mustMeasureContent=!0),(e||i||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let l of this.state.facet(ww))l(n)}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new kC(t),this.plugins=t.facet(Ah).map(i=>new Rp(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new oC(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(Ah),i=t.state.facet(Ah);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new Rp(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(t=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.flush();let e=null;try{for(let i=0;;i++){this.updateState=1;let n=this.viewport,r=this.viewState.measure(this);if(!r&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];r&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(f=>{try{return f.read(this)}catch(u){return Cs(this.state,u),OC}}),h=nC.create(this,this.state,[]),a=!1,c=!1;h.flags|=r,e?e.flags|=r:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),a=this.docView.update(h));for(let f=0;f<o.length;f++)if(l[f]!=OC)try{let u=o[f];u.write&&u.write(l[f],this)}catch(u){Cs(this.state,u)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),a&&this.docView.updateSelection(!0),this.viewport.from==n.from&&this.viewport.to==n.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let i of this.state.facet(ww))i(e)}get themeClasses(){return Mw+" "+(this.state.facet(Cw)?h3:l3)+" "+this.state.facet(vf)}updateAttrs(){let t=$C(this,HV,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(xc)?"true":"false",class:"cm-content",style:`${R.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),$C(this,FV,e);let i=this.observer.ignore(()=>{let n=pw(this.contentDOM,this.contentAttrs,e),r=pw(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(c3.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(Ch),I.mount(this.root,this.styleModules.concat(NG).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),t){if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Ep(this,t,uC(this,t,e,i))}moveByGroup(t,e){return Ep(this,t,uC(this,t,e,i=>fG(this,t.head,i)))}moveToLineBoundary(t,e,i=!0){return cG(this,t,e,i)}moveVertically(t,e,i){return Ep(this,t,uG(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),XV(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[Jo.find(r,t-n.from,-1,e)];return yg(i,o.dir==be.LTR==e>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(IV)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>jG)return GV(t.length);let e=this.textDirectionAt(t.from);for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e)return n.order;let i=ZK(t.text,e);return this.bidiCache.push(new TC(t.from,t.to,e,i)),i}get hasFocus(){var t;return(document.hasFocus()||R.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{gV(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return iC.of(new eC(typeof t=="number"?q.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return Sc.define(()=>({}),{eventHandlers:t})}static theme(t,e){let i=I.newName(),n=[vf.of(i),Ch.of(Dw(`.${i}`,t))];return e&&e.dark&&n.push(Cw.of(!0)),n}static baseTheme(t){return xK.lowest(Ch.of(Dw("."+Mw,t,a3)))}};Et.styleModule=Ch;Et.inputHandler=VV;Et.perLineTextDirection=IV;Et.exceptionSink=LV;Et.updateListener=ww;Et.editable=xc;Et.mouseSelectionStyle=PV;Et.dragMovesSelection=EV;Et.clickAddsSelectionRange=BV;Et.decorations=Ja;Et.atomicRanges=WV;Et.scrollMargins=zV;Et.darkTheme=Cw;Et.contentAttributes=FV;Et.editorAttributes=HV;Et.lineWrapping=Et.contentAttributes.of({class:"cm-lineWrapping"});Et.announce=Ft.define();const jG=4096,OC={};let TC=class f3{constructor(t,e,i,n){this.from=t,this.to=e,this.dir=i,this.order=n}static update(t,e){if(e.empty)return t;let i=[],n=t.length?t[t.length-1].dir:be.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new f3(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.order))}return i}};function $C(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&gw(o,e)}return e}const UG=!R.ios,JG={".cm-line":{}};UG&&(JG[".cm-line"].caretColor="transparent !important");const Vp="-10000px";class u3{constructor(t,e,i){this.facet=e,this.createTooltipView=i,this.input=t.state.facet(e),this.tooltips=this.input.filter(n=>n),this.tooltipViews=this.tooltips.map(i)}update(t){let e=t.state.facet(this.facet),i=e.filter(r=>r);if(e===this.input){for(let r of this.tooltipViews)r.update&&r.update(t);return!1}let n=[];for(let r=0;r<i.length;r++){let o=i[r],l=-1;if(o){for(let h=0;h<this.tooltips.length;h++){let a=this.tooltips[h];a&&a.create==o.create&&(l=h)}if(l<0)n[r]=this.createTooltipView(o);else{let h=n[r]=this.tooltipViews[l];h.update&&h.update(t)}}}for(let r of this.tooltipViews)n.indexOf(r)<0&&r.dom.remove();return this.input=e,this.tooltips=i,this.tooltipViews=n,!0}}function YG(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const Ip=G.define({combine:s=>{var t,e,i;return{position:R.ios?"absolute":((t=s.find(n=>n.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((e=s.find(n=>n.parent))===null||e===void 0?void 0:e.parent)||null,tooltipSpace:((i=s.find(n=>n.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||YG}}}),XG=Sc.fromClass(class{constructor(s){var t;this.view=s,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=s.state.facet(Ip);this.position=e.position,this.parent=e.parent,this.classes=s.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new u3(s,d3,i=>this.createTooltip(i)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(t=s.dom.ownerDocument.defaultView)===null||t===void 0||t.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let s of this.manager.tooltipViews)this.intersectionObserver.observe(s.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(s){s.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(s);t&&this.observeIntersection();let e=t||s.geometryChanged,i=s.state.facet(Ip);if(i.position!=this.position){this.position=i.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;e=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);e=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);e&&this.maybeMeasure()}createTooltip(s){let t=s.create(this.view);if(t.dom.classList.add("cm-tooltip"),s.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",t.dom.appendChild(e)}return t.dom.style.position=this.position,t.dom.style.top=Vp,this.container.appendChild(t.dom),t.mount&&t.mount(this.view),t}destroy(){var s,t;(s=this.view.dom.ownerDocument.defaultView)===null||s===void 0||s.removeEventListener("resize",this.measureSoon);for(let{dom:e}of this.manager.tooltipViews)e.remove();(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let s=this.view.dom.getBoundingClientRect();return{editor:s,parent:this.parent?this.container.getBoundingClientRect():s,pos:this.manager.tooltips.map((t,e)=>{let i=this.manager.tooltipViews[e];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(({dom:t})=>t.getBoundingClientRect()),space:this.view.state.facet(Ip).tooltipSpace(this.view)}}writeMeasure(s){let{editor:t,space:e}=s,i=[];for(let n=0;n<this.manager.tooltips.length;n++){let r=this.manager.tooltips[n],o=this.manager.tooltipViews[n],{dom:l}=o,h=s.pos[n],a=s.size[n];if(!h||h.bottom<=Math.max(t.top,e.top)||h.top>=Math.min(t.bottom,e.bottom)||h.right<Math.max(t.left,e.left)-.1||h.left>Math.min(t.right,e.right)+.1){l.style.top=Vp;continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,f=c?7:0,u=a.right-a.left,d=a.bottom-a.top,g=o.offset||QG,m=this.view.textDirection==be.LTR,p=a.width>e.right-e.left?m?e.left:e.right-a.width:m?Math.min(h.left-(c?14:0)+g.x,e.right-u):Math.max(e.left,h.left-u+(c?14:0)-g.x),y=!!r.above;!r.strictSide&&(y?h.top-(a.bottom-a.top)-g.y<e.top:h.bottom+(a.bottom-a.top)+g.y>e.bottom)&&y==e.bottom-h.bottom>h.top-e.top&&(y=!y);let w=y?h.top-d-f-g.y:h.bottom+f+g.y,x=p+u;if(o.overlap!==!0)for(let b of i)b.left<x&&b.right>p&&b.top<w+d&&b.bottom>w&&(w=y?b.top-d-2-f:b.bottom+f+2);this.position=="absolute"?(l.style.top=w-s.parent.top+"px",l.style.left=p-s.parent.left+"px"):(l.style.top=w+"px",l.style.left=p+"px"),c&&(c.style.left=`${h.left+(m?g.x:-g.x)-(p+14-7)}px`),o.overlap!==!0&&i.push({left:p,top:w,right:x,bottom:w+d}),l.classList.toggle("cm-tooltip-above",y),l.classList.toggle("cm-tooltip-below",!y),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let s of this.manager.tooltipViews)s.dom.style.top=Vp}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),ZG=Et.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),QG={x:0,y:0},d3=G.define({enables:[XG,ZG]}),Id=G.define();class fx{constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new u3(t,Id,e=>this.createHostedView(e))}static create(t){return new fx(t)}createHostedView(t){let e=t.create(this.view);return e.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(e.dom),this.mounted&&e.mount&&e.mount(this.view),e}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned()}update(t){this.manager.update(t)}}const _G=d3.compute([Id],s=>{let t=s.facet(Id).filter(e=>e);return t.length===0?null:{pos:Math.min(...t.map(e=>e.pos)),end:Math.max(...t.filter(e=>e.end!=null).map(e=>e.end)),create:fx.create,above:t[0].above,arrow:t.some(e=>e.arrow)}});class tj{constructor(t,e,i,n,r){this.view=t,this.source=e,this.field=i,this.setHover=n,this.hoverTime=r,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:t}=this,e=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(e==null)return;let i=this.view.coordsAtPos(e);if(i==null||t.y<i.top||t.y>i.bottom||t.x<i.left-this.view.defaultCharacterWidth||t.x>i.right+this.view.defaultCharacterWidth)return;let n=this.view.bidiSpans(this.view.state.doc.lineAt(e)).find(l=>l.from<=e&&l.to>=e),r=n&&n.dir==be.RTL?-1:1,o=this.source(this.view,e,t.x<i.left?-r:r);if(o?.then){let l=this.pending={pos:e};o.then(h=>{this.pending==l&&(this.pending=null,h&&this.view.dispatch({effects:this.setHover.of(h)}))},h=>Cs(this.view.state,h,"hover tooltip"))}else o&&this.view.dispatch({effects:this.setHover.of(o)})}mousemove(t){var e;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!ej(this.lastMove.target)||this.pending){let{pos:n}=i||this.pending,r=(e=i?.end)!==null&&e!==void 0?e:n;(n==r?this.view.posAtCoords(this.lastMove)!=n:!ij(this.view,n,r,t.clientX,t.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function ej(s){for(let t=s;t;t=t.parentNode)if(t.nodeType==1&&t.classList.contains("cm-tooltip"))return!0;return!1}function ij(s,t,e,i,n,r){let o=document.createRange(),l=s.domAtPos(t),h=s.domAtPos(e);o.setEnd(h.node,h.offset),o.setStart(l.node,l.offset);let a=o.getClientRects();o.detach();for(let c=0;c<a.length;c++){let f=a[c];if(Math.max(f.top-n,n-f.bottom,f.left-i,i-f.right)<=r)return!0}return!1}function nj(s,t={}){let e=Ft.define(),i=Ol.define({create(){return null},update(n,r){if(n&&(t.hideOnChange&&(r.docChanged||r.selection)||t.hideOn&&t.hideOn(r,n)))return null;if(n&&r.docChanged){let o=r.changes.mapPos(n.pos,-1,je.TrackDel);if(o==null)return null;let l=Object.assign(Object.create(null),n);l.pos=o,n.end!=null&&(l.end=r.changes.mapPos(n.end)),n=l}for(let o of r.effects)o.is(e)&&(n=o.value),o.is(sj)&&(n=null);return n},provide:n=>Id.from(n)});return[i,Sc.define(n=>new tj(n,s,i,e,t.hoverTime||300)),_G]}const sj=Ft.define(),RC=G.define({combine(s){let t,e;for(let i of s)t=t||i.topContainer,e=e||i.bottomContainer;return{topContainer:t,bottomContainer:e}}});function rj(s,t){let e=s.plugin(g3),i=e?e.specs.indexOf(t):-1;return i>-1?e.panels[i]:null}const g3=Sc.fromClass(class{constructor(s){this.input=s.state.facet(Ow),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(e=>e(s));let t=s.state.facet(RC);this.top=new kf(s,!0,t.topContainer),this.bottom=new kf(s,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(s){let t=s.state.facet(RC);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new kf(s.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new kf(s.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let e=s.state.facet(Ow);if(e!=this.input){let i=e.filter(h=>h),n=[],r=[],o=[],l=[];for(let h of i){let a=this.specs.indexOf(h),c;a<0?(c=h(s.view),l.push(c)):(c=this.panels[a],c.update&&c.update(s)),n.push(c),(c.top?r:o).push(c)}this.specs=i,this.panels=n,this.top.sync(r),this.bottom.sync(o);for(let h of l)h.dom.classList.add("cm-panel"),h.mount&&h.mount()}else for(let i of this.panels)i.update&&i.update(s)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:s=>Et.scrollMargins.of(t=>{let e=t.plugin(s);return e&&{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}})});class kf{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=BC(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=BC(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function BC(s){let t=s.nextSibling;return s.remove(),t}const Ow=G.define({enables:g3});let ml=class extends gl{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}};ml.prototype.elementClass="";ml.prototype.toDOM=void 0;ml.prototype.mapMode=je.TrackBefore;ml.prototype.startSide=ml.prototype.endSide=-1;ml.prototype.point=!0;class oj{constructor(t,e,i){this.from=t,this.to=e,this.diagnostic=i}}class ar{constructor(t,e,i){this.diagnostics=t,this.panel=e,this.selected=i}static init(t,e,i){let n=t,r=i.facet(vo).markerFilter;r&&(n=r(n));let o=kt.set(n.map(l=>l.from==l.to||l.from==l.to-1&&i.doc.lineAt(l.from).to==l.from?kt.widget({widget:new mj(l),diagnostic:l}).range(l.from):kt.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity},diagnostic:l}).range(l.from,l.to)),!0);return new ar(o,e,yl(o))}}function yl(s,t=null,e=0){let i=null;return s.between(e,1e9,(n,r,{spec:o})=>{if(!(t&&o.diagnostic!=t))return i=new oj(n,r,o.diagnostic),!1}),i}function lj(s,t){return!!(s.effects.some(e=>e.is(ux))||s.changes.touchesRange(t.pos))}function p3(s,t){return s.field(Di,!1)?t:t.concat(Ft.appendConfig.of([Di,Et.decorations.compute([Di],e=>{let{selected:i,panel:n}=e.field(Di);return!i||!n||i.from==i.to?kt.none:kt.set([aj.range(i.from,i.to)])}),nj(cj,{hideOn:lj}),wj]))}function hj(s,t){return{effects:p3(s,[ux.of(t)])}}const ux=Ft.define(),dx=Ft.define(),m3=Ft.define(),Di=Ol.define({create(){return new ar(kt.none,null,null)},update(s,t){if(t.docChanged){let e=s.diagnostics.map(t.changes),i=null;if(s.selected){let n=t.changes.mapPos(s.selected.from,1);i=yl(e,s.selected.diagnostic,n)||yl(e,null,n)}s=new ar(e,s.panel,i)}for(let e of t.effects)e.is(ux)?s=ar.init(e.value,s.panel,t.state):e.is(dx)?s=new ar(s.diagnostics,e.value?bg.open:null,s.selected):e.is(m3)&&(s=new ar(s.diagnostics,s.panel,e.value));return s},provide:s=>[Ow.from(s,t=>t.panel),Et.decorations.from(s,t=>t.diagnostics)]}),aj=kt.mark({class:"cm-lintRange cm-lintRange-active"});function cj(s,t,e){let{diagnostics:i}=s.state.field(Di),n=[],r=2e8,o=0;i.between(t-(e<0?1:0),t+(e>0?1:0),(h,a,{spec:c})=>{t>=h&&t<=a&&(h==a||(t>h||e>0)&&(t<a||e<0))&&(n.push(c.diagnostic),r=Math.min(h,r),o=Math.max(a,o))});let l=s.state.facet(vo).tooltipFilter;return l&&(n=l(n)),n.length?{pos:r,end:o,above:s.state.doc.lineAt(r).to<o,create(){return{dom:fj(s,n)}}}:null}function fj(s,t){return vt("ul",{class:"cm-tooltip-lint"},t.map(e=>w3(s,e,!1)))}const uj=s=>{let t=s.state.field(Di,!1);(!t||!t.panel)&&s.dispatch({effects:p3(s.state,[dx.of(!0)])});let e=rj(s,bg.open);return e&&e.dom.querySelector(".cm-panel-lint ul").focus(),!0},EC=s=>{let t=s.state.field(Di,!1);return!t||!t.panel?!1:(s.dispatch({effects:dx.of(!1)}),!0)},dj=s=>{let t=s.state.field(Di,!1);if(!t)return!1;let e=s.state.selection.main,i=t.diagnostics.iter(e.to+1);return!i.value&&(i=t.diagnostics.iter(0),!i.value||i.from==e.from&&i.to==e.to)?!1:(s.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},gj=[{key:"Mod-Shift-m",run:uj},{key:"F8",run:dj}],pj=Sc.fromClass(class{constructor(s){this.view=s,this.timeout=-1,this.set=!0;let{delay:t}=s.state.facet(vo);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){let s=Date.now();if(s<this.lintTime-10)setTimeout(this.run,this.lintTime-s);else{this.set=!1;let{state:t}=this.view,{sources:e}=t.facet(vo);Promise.all(e.map(i=>Promise.resolve(i(this.view)))).then(i=>{let n=i.reduce((r,o)=>r.concat(o));this.view.state.doc==t.doc&&this.view.dispatch(hj(this.view.state,n))},i=>{Cs(this.view.state,i)})}}update(s){let t=s.state.facet(vo);(s.docChanged||t!=s.startState.facet(vo))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),vo=G.define({combine(s){return Object.assign({sources:s.map(t=>t.source)},RK(s.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:pj});function y3(s){let t=[];if(s)t:for(let{name:e}of s){for(let i=0;i<e.length;i++){let n=e[i];if(/[a-zA-Z]/.test(n)&&!t.some(r=>r.toLowerCase()==n.toLowerCase())){t.push(n);continue t}}t.push("")}return t}function w3(s,t,e){var i;let n=e?y3(t.actions):[];return vt("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},vt("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage():t.message),(i=t.actions)===null||i===void 0?void 0:i.map((r,o)=>{let l=f=>{f.preventDefault();let u=yl(s.state.field(Di).diagnostics,t);u&&r.apply(s,u.from,u.to)},{name:h}=r,a=n[o]?h.indexOf(n[o]):-1,c=a<0?h:[h.slice(0,a),vt("u",h.slice(a,a+1)),h.slice(a+1)];return vt("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${h}${a<0?"":` (access key "${n[o]})"`}.`},c)}),t.source&&vt("div",{class:"cm-diagnosticSource"},t.source))}class mj extends bc{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return vt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class PC{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=w3(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class bg{constructor(t){this.view=t,this.items=[];let e=n=>{if(n.keyCode==27)EC(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:r}=this.items[this.selectedIndex],o=y3(r.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==n.keyCode){let h=yl(this.view.state.field(Di).diagnostics,r);h&&r.actions[l].apply(t,h.from,h.to)}}else return;n.preventDefault()},i=n=>{for(let r=0;r<this.items.length;r++)this.items[r].dom.contains(n.target)&&this.moveSelection(r)};this.list=vt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e,onclick:i}),this.dom=vt("div",{class:"cm-panel-lint"},this.list,vt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>EC(this.view)},"×")),this.update()}get selectedIndex(){let t=this.view.state.field(Di).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(Di),i=0,n=!1,r=null;for(t.between(0,this.view.state.doc.length,(o,l,{spec:h})=>{let a=-1,c;for(let f=i;f<this.items.length;f++)if(this.items[f].diagnostic==h.diagnostic){a=f;break}a<0?(c=new PC(this.view,h.diagnostic),this.items.splice(i,0,c),n=!0):(c=this.items[a],a>i&&(this.items.splice(i,a-i),n=!0)),e&&c.diagnostic==e.diagnostic?c.dom.hasAttribute("aria-selected")||(c.dom.setAttribute("aria-selected","true"),r=c):c.dom.hasAttribute("aria-selected")&&c.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new PC(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),r?(this.list.setAttribute("aria-activedescendant",r.id),this.view.requestMeasure({key:this,read:()=>({sel:r.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:l})=>{o.top<l.top?this.list.scrollTop-=l.top-o.top:o.bottom>l.bottom&&(this.list.scrollTop+=o.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let t=this.list.firstChild;function e(){let i=t;t=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;t!=i.dom;)e();t=i.dom.nextSibling}else this.list.insertBefore(i.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=this.view.state.field(Di),i=yl(e.diagnostics,this.items[t].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:m3.of(i)})}static open(t){return new bg(t)}}function yj(s,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(s)}</svg>')`}function Np(s){return yj(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${s}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const wj=Et.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Np("#d11")},".cm-lintRange-warning":{backgroundImage:Np("orange")},".cm-lintRange-info":{backgroundImage:Np("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),bj=[Z4(),tN(),T4(),IW(),OF(),y4(),k4(),We.allowMultipleSelections.of(!0),dF(),$F(EF,{fallback:!0}),FF(),iK(),dK(),W4(),K4(),L4(),Sz(),QD.of([...oK,...T6,...Nz,...jW,...kF,...IL,...gj])];let Tw=[],b3=[];(()=>{let s="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=0,e=0;t<s.length;t++)(t%2?b3:Tw).push(e=e+s[t])})();function xj(s){if(s<768)return!1;for(let t=0,e=Tw.length;;){let i=t+e>>1;if(s<Tw[i])e=i;else if(s>=b3[i])t=i+1;else return!0;if(t==e)return!1}}function LC(s){return s>=127462&&s<=127487}const VC=8205;function Sj(s,t,e=!0,i=!0){return(e?x3:vj)(s,t,i)}function x3(s,t,e){if(t==s.length)return t;t&&S3(s.charCodeAt(t))&&v3(s.charCodeAt(t-1))&&t--;let i=Hp(s,t);for(t+=IC(i);t<s.length;){let n=Hp(s,t);if(i==VC||n==VC||e&&xj(n))t+=IC(n),i=n;else if(LC(n)){let r=0,o=t-2;for(;o>=0&&LC(Hp(s,o));)r++,o-=2;if(r%2==0)break;t+=2}else break}return t}function vj(s,t,e){for(;t>0;){let i=x3(s,t-2,e);if(i<t)return i;t--}return 0}function Hp(s,t){let e=s.charCodeAt(t);if(!v3(e)||t+1==s.length)return e;let i=s.charCodeAt(t+1);return S3(i)?(e-55296<<10)+(i-56320)+65536:e}function S3(s){return s>=56320&&s<57344}function v3(s){return s>=55296&&s<56320}function IC(s){return s<65536?1:2}class X{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){[t,e]=wl(this,t,e);let n=[];return this.decompose(0,t,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(e,this.length,n,1),Gn.from(n,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){[t,e]=wl(this,t,e);let i=[];return this.decompose(t,e,i,0),Gn.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new ea(this),r=new ea(t);for(let o=e,l=e;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(t=1){return new ea(this,t)}iterRange(t,e=this.length){return new k3(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let n=this.line(t).from;i=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new A3(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?X.empty:t.length<=32?new It(t):Gn.from(It.split(t,[]))}}class It extends X{constructor(t,e=kj(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((e?i:l)>=t)return new Aj(n,l,i,o);n=l+1,i++}}decompose(t,e,i,n){let r=t<=0&&e>=this.length?this:new It(NC(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(n&1){let o=i.pop(),l=zu(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new It(l,o.length+r.length));else{let h=l.length>>1;i.push(new It(l.slice(0,h)),new It(l.slice(h)))}}else i.push(r)}replace(t,e,i){if(!(i instanceof It))return super.replace(t,e,i);[t,e]=wl(this,t,e);let n=zu(this.text,zu(i.text,NC(this.text,0,t)),e),r=this.length+i.length-(e-t);return n.length<=32?new It(n,r):Gn.from(It.split(n,[]),r)}sliceString(t,e=this.length,i=`
`){[t,e]=wl(this,t,e);let n="";for(let r=0,o=0;r<=e&&o<this.text.length;o++){let l=this.text[o],h=r+l.length;r>t&&o&&(n+=i),t<h&&e>r&&(n+=l.slice(Math.max(0,t-r),e-r)),r=h+1}return n}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],n=-1;for(let r of t)i.push(r),n+=r.length+1,i.length==32&&(e.push(new It(i,n)),i=[],n=-1);return n>-1&&e.push(new It(i,n)),e}}class Gn extends X{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,h=i+o.lines-1;if((e?h:l)>=t)return o.lineInner(t,e,i,n);n=l+1,i=h+1}}decompose(t,e,i,n){for(let r=0,o=0;o<=e&&r<this.children.length;r++){let l=this.children[r],h=o+l.length;if(t<=h&&e>=o){let a=n&((o<=t?1:0)|(h>=e?2:0));o>=t&&h<=e&&!a?i.push(l):l.decompose(t-o,e-o,i,a)}o=h+1}}replace(t,e,i){if([t,e]=wl(this,t,e),i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(t>=r&&e<=l){let h=o.replace(t-r,e-r,i),a=this.lines-o.lines+h.lines;if(h.lines<a>>4&&h.lines>a>>6){let c=this.children.slice();return c[n]=h,new Gn(c,this.length-(e-t)+i.length)}return super.replace(r,l,h)}r=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){[t,e]=wl(this,t,e);let n="";for(let r=0,o=0;r<this.children.length&&o<=e;r++){let l=this.children[r],h=o+l.length;o>t&&r&&(n+=i),t<h&&e>o&&(n+=l.sliceString(t-o,e-o,i)),o=h+1}return n}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Gn))return 0;let i=0,[n,r,o,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;n+=e,r+=e){if(n==o||r==l)return i;let h=this.children[n],a=t.children[r];if(h!=a)return i+h.scanIdentical(a,e);i+=h.length+1}}static from(t,e=t.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let d of t)i+=d.lines;if(i<32){let d=[];for(let g of t)g.flatten(d);return new It(d,e)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],h=0,a=-1,c=[];function f(d){let g;if(d.lines>r&&d instanceof Gn)for(let m of d.children)f(m);else d.lines>o&&(h>o||!h)?(u(),l.push(d)):d instanceof It&&h&&(g=c[c.length-1])instanceof It&&d.lines+g.lines<=32?(h+=d.lines,a+=d.length+1,c[c.length-1]=new It(g.text.concat(d.text),g.length+1+d.length)):(h+d.lines>n&&u(),h+=d.lines,a+=d.length+1,c.push(d))}function u(){h!=0&&(l.push(c.length==1?c[0]:Gn.from(c,a)),a=-1,h=c.length=0)}for(let d of t)f(d);return u(),l.length==1?l[0]:new Gn(l,e)}}X.empty=new It([""],0);function kj(s){let t=-1;for(let e of s)t+=e.length+1;return t}function zu(s,t,e=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],h=n+l.length;h>=e&&(h>i&&(l=l.slice(0,i-n)),n<e&&(l=l.slice(e-n)),o?(t[t.length-1]+=l,o=!1):t.push(l)),n=h+1}return t}function NC(s,t,e){return zu(s,[""],t,e)}class ea{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof It?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof It?n.text.length:n.children.length;if(o==(e>0?l:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(n instanceof It){let h=n.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,h.length>Math.max(0,t))return this.value=t==0?h:e>0?h.slice(t):h.slice(0,h.length-t),this;t-=h.length}else{let h=n.children[o+(e<0?-1:0)];t>h.length?(t-=h.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(h),this.offsets.push(e>0?1:(h instanceof It?h.text.length:h.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class k3{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new ea(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:n}=this.cursor.next(t);return this.pos+=(n.length+t)*e,this.value=n.length<=i?n:e<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class A3{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:n}=this.inner.next(t);return e&&this.afterBreak?(this.value="",this.afterBreak=!1):e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(X.prototype[Symbol.iterator]=function(){return this.iter()},ea.prototype[Symbol.iterator]=k3.prototype[Symbol.iterator]=A3.prototype[Symbol.iterator]=function(){return this});class Aj{constructor(t,e,i,n){this.from=t,this.to=e,this.number=i,this.text=n}get length(){return this.to-this.from}}function wl(s,t,e){return t=Math.max(0,Math.min(s.length,t)),[t,Math.max(t,Math.min(s.length,e))]}function Ss(s,t,e=!0,i=!0){return Sj(s,t,e,i)}const $w=/\r\n?|\n/;var ki=(function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s})(ki||(ki={}));class Ms{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,n=0;e<this.sections.length;){let r=this.sections[e++],o=this.sections[e++];o<0?(t(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(t,e=!1){Rw(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];n<0?t.push(i,n):t.push(n,i)}return new Ms(t)}composeDesc(t){return this.empty?t:t.empty?this:C3(this,t)}mapDesc(t,e=!1){return t.empty?this:Bw(this,t,e)}mapPos(t,e=-1,i=ki.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],h=this.sections[o++],a=n+l;if(h<0){if(a>t)return r+(t-n);r+=l}else{if(i!=ki.Simple&&a>=t&&(i==ki.TrackDel&&n<t&&a>t||i==ki.TrackBefore&&n<t||i==ki.TrackAfter&&a>t))return null;if(a>t||a==t&&e<0&&!l)return t==n||e<0?r:r+h;r+=h}n=a}if(t>n)throw new RangeError(`Position ${t} is out of range for changeset of length ${n}`);return r}touchesRange(t,e=t){for(let i=0,n=0;i<this.sections.length&&n<=e;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=e&&l>=t)return n<t&&l>e?"cover":!0;n=l}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+i+(n>=0?":"+n:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Ms(t)}static create(t){return new Ms(t)}}class re extends Ms{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Rw(this,(e,i,n,r,o)=>t=t.replace(n,n+(i-e),o),!1),t}mapDesc(t,e=!1){return Bw(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let n=0,r=0;n<e.length;n+=2){let o=e[n],l=e[n+1];if(l>=0){e[n]=l,e[n+1]=o;let h=n>>1;for(;i.length<h;)i.push(X.empty);i.push(o?t.slice(r,r+o):X.empty)}r+=o}return new re(e,i)}compose(t){return this.empty?t:t.empty?this:C3(this,t,!0)}map(t,e=!1){return t.empty?this:Bw(this,t,e,!0)}iterChanges(t,e=!1){Rw(this,t,e)}get desc(){return Ms.create(this.sections)}filter(t){let e=[],i=[],n=[],r=new Xa(this);t:for(let o=0,l=0;;){let h=o==t.length?1e9:t[o++];for(;l<h||l==h&&r.len==0;){if(r.done)break t;let c=Math.min(r.len,h-l);Se(n,c,-1);let f=r.ins==-1?-1:r.off==0?r.ins:0;Se(e,c,f),f>0&&Zs(i,e,r.text),r.forward(c),l+=c}let a=t[o++];for(;l<a;){if(r.done)break t;let c=Math.min(r.len,a-l);Se(e,c,-1),Se(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new re(e,i),filtered:Ms.create(n)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],n=this.sections[e+1];n<0?t.push(i):n==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let n=[],r=[],o=0,l=null;function h(c=!1){if(!c&&!n.length)return;o<e&&Se(n,e-o,-1);let f=new re(n,r);l=l?l.compose(f.map(l)):f,n=[],r=[],o=0}function a(c){if(Array.isArray(c))for(let f of c)a(f);else if(c instanceof re){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:u=f,insert:d}=c;if(f>u||f<0||u>e)throw new RangeError(`Invalid change range ${f} to ${u} (in doc of length ${e})`);let g=d?typeof d=="string"?X.of(d.split(i||$w)):d:X.empty,m=g.length;if(f==u&&m==0)return;f<o&&h(),f>o&&Se(n,f-o,-1),Se(n,u-f,m),Zs(r,n,g),o=u}}return a(t),h(!l),l}static empty(t){return new re(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="number")e.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)e.push(r[0],0);else{for(;i.length<n;)i.push(X.empty);i[n]=X.of(r.slice(1)),e.push(r[0],i[n].length)}}}return new re(e,i)}static createSet(t,e){return new re(t,e)}}function Se(s,t,e,i=!1){if(t==0&&e<=0)return;let n=s.length-2;n>=0&&e<=0&&e==s[n+1]?s[n]+=t:n>=0&&t==0&&s[n]==0?s[n+1]+=e:i?(s[n]+=t,s[n+1]+=e):s.push(t,e)}function Zs(s,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(e);else{for(;s.length<i;)s.push(X.empty);s.push(e)}}function Rw(s,t,e){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],h=s.sections[o++];if(h<0)n+=l,r+=l;else{let a=n,c=r,f=X.empty;for(;a+=l,c+=h,h&&i&&(f=f.append(i[o-2>>1])),!(e||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],h=s.sections[o++];t(n,a,r,c,f),n=a,r=c}}}function Bw(s,t,e,i=!1){let n=[],r=i?[]:null,o=new Xa(s),l=new Xa(t);for(let h=-1;;){if(o.done&&l.len||l.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&l.ins==-1){let a=Math.min(o.len,l.len);Se(n,a,-1),o.forward(a),l.forward(a)}else if(l.ins>=0&&(o.ins<0||h==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!e))){let a=l.len;for(Se(n,l.ins,-1);a;){let c=Math.min(o.len,a);o.ins>=0&&h<o.i&&o.len<=c&&(Se(n,0,o.ins),r&&Zs(r,n,o.text),h=o.i),o.forward(c),a-=c}l.next()}else if(o.ins>=0){let a=0,c=o.len;for(;c;)if(l.ins==-1){let f=Math.min(c,l.len);a+=f,c-=f,l.forward(f)}else if(l.ins==0&&l.len<c)c-=l.len,l.next();else break;Se(n,a,h<o.i?o.ins:0),r&&h<o.i&&Zs(r,n,o.text),h=o.i,o.forward(o.len-c)}else{if(o.done&&l.done)return r?re.createSet(n,r):Ms.create(n);throw new Error("Mismatched change set lengths")}}}function C3(s,t,e=!1){let i=[],n=e?[]:null,r=new Xa(s),o=new Xa(t);for(let l=!1;;){if(r.done&&o.done)return n?re.createSet(i,n):Ms.create(i);if(r.ins==0)Se(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)Se(i,0,o.ins,l),n&&Zs(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let h=Math.min(r.len2,o.len),a=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Se(i,h,c,l),n&&c&&Zs(n,i,o.text)}else o.ins==-1?(Se(i,r.off?0:r.len,h,l),n&&Zs(n,i,r.textBit(h))):(Se(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&Zs(n,i,o.text));l=(r.ins>h||o.ins>=0&&o.len>h)&&(l||i.length>a),r.forward2(h),o.forward(h)}}}}class Xa{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?X.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?X.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class wr{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let t=this.flags&7;return t==7?null:t}get goalColumn(){let t=this.flags>>6;return t==16777215?void 0:t}map(t,e=-1){let i,n;return this.empty?i=n=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),n=t.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new wr(i,n,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return D.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return D.range(this.anchor,i)}eq(t,e=!1){return this.anchor==t.anchor&&this.head==t.head&&(!e||!this.empty||this.assoc==t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return D.range(t.anchor,t.head)}static create(t,e,i){return new wr(t,e,i)}}class D{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:D.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t,e=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(t.ranges[i],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new D([this.main],0)}addRange(t,e=!0){return D.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,D.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new D(t.ranges.map(e=>wr.fromJSON(e)),t.main)}static single(t,e=t){return new D([D.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<t.length;n++){let r=t[n];if(r.empty?r.from<=i:r.from<i)return D.normalized(t.slice(),e);i=r.to}return new D(t,e)}static cursor(t,e=0,i,n){return wr.create(t,t,(e==0?0:e<0?8:16)|(i==null?7:Math.min(6,i))|(n??16777215)<<6)}static range(t,e,i,n){let r=(i??16777215)<<6|(n==null?7:Math.min(6,n));return e<t?wr.create(e,t,48|r):wr.create(t,e,(e>t?8:0)|r)}static normalized(t,e=0){let i=t[e];t.sort((n,r)=>n.from-r.from),e=t.indexOf(i);for(let n=1;n<t.length;n++){let r=t[n],o=t[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,h=Math.max(r.to,o.to);n<=e&&e--,t.splice(--n,2,r.anchor>r.head?D.range(h,l):D.range(l,h))}}return new D(t,e)}}function M3(s,t){for(let e of s.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let gx=0;class F{constructor(t,e,i,n,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=n,this.id=gx++,this.default=t([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(t={}){return new F(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:px),!!t.static,t.enables)}of(t){return new qu([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new qu(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new qu(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}}function px(s,t){return s==t||s.length==t.length&&s.every((e,i)=>e===t[i])}class qu{constructor(t,e,i,n){this.dependencies=t,this.facet=e,this.type=i,this.value=n,this.id=gx++}dynamicSlot(t){var e;let i=this.value,n=this.facet.compareInput,r=this.id,o=t[r]>>1,l=this.type==2,h=!1,a=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?a=!0:(((e=t[f.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,u){if(h&&u.docChanged||a&&(u.docChanged||u.selection)||Ew(f,c)){let d=i(f);if(l?!HC(d,f.values[o],n):!n(d,f.values[o]))return f.values[o]=d,1}return 0},reconfigure:(f,u)=>{let d,g=u.config.address[r];if(g!=null){let m=Hd(u,g);if(this.dependencies.every(p=>p instanceof F?u.facet(p)===f.facet(p):p instanceof Tl?u.field(p,!1)==f.field(p,!1):!0)||(l?HC(d=i(f),m,n):n(d=i(f),m)))return f.values[o]=m,0}else d=i(f);return f.values[o]=d,1}}}}function HC(s,t,e){if(s.length!=t.length)return!1;for(let i=0;i<s.length;i++)if(!e(s[i],t[i]))return!1;return!0}function Ew(s,t){let e=!1;for(let i of t)ia(s,i)&1&&(e=!0);return e}function Cj(s,t,e){let i=e.map(h=>s[h.id]),n=e.map(h=>h.type),r=i.filter(h=>!(h&1)),o=s[t.id]>>1;function l(h){let a=[];for(let c=0;c<i.length;c++){let f=Hd(h,i[c]);if(n[c]==2)for(let u of f)a.push(u);else a.push(f)}return t.combine(a)}return{create(h){for(let a of i)ia(h,a);return h.values[o]=l(h),1},update(h,a){if(!Ew(h,r))return 0;let c=l(h);return t.compare(c,h.values[o])?0:(h.values[o]=c,1)},reconfigure(h,a){let c=Ew(h,i),f=a.config.facets[t.id],u=a.facet(t);if(f&&!c&&px(e,f))return h.values[o]=u,0;let d=l(h);return t.compare(d,u)?(h.values[o]=u,0):(h.values[o]=d,1)}}}const Af=F.define({static:!0});class Tl{constructor(t,e,i,n,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(t){let e=new Tl(gx++,t.create,t.update,t.compare||((i,n)=>i===n),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Af).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,n)=>{let r=i.values[e],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[e]=o,1)},reconfigure:(i,n)=>{let r=i.facet(Af),o=n.facet(Af),l;return(l=r.find(h=>h.field==this))&&l!=o.find(h=>h.field==this)?(i.values[e]=l.create(i),1):n.config.address[this.id]!=null?(i.values[e]=n.field(this),0):(i.values[e]=this.create(i),1)}}}init(t){return[this,Af.of({field:this,create:t})]}get extension(){return this}}const cr={lowest:4,low:3,default:2,high:1,highest:0};function jl(s){return t=>new D3(t,s)}const Mj={highest:jl(cr.highest),high:jl(cr.high),default:jl(cr.default),low:jl(cr.low),lowest:jl(cr.lowest)};class D3{constructor(t,e){this.inner=t,this.prec=e}}class xg{of(t){return new Pw(this,t)}reconfigure(t){return xg.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class Pw{constructor(t,e){this.compartment=t,this.inner=e}}class Nd{constructor(t,e,i,n,r,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let n=[],r=Object.create(null),o=new Map;for(let u of Dj(t,e,o))u instanceof Tl?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let l=Object.create(null),h=[],a=[];for(let u of n)l[u.id]=a.length<<1,a.push(d=>u.slot(d));let c=i?.config.facets;for(let u in r){let d=r[u],g=d[0].facet,m=c&&c[u]||[];if(d.every(p=>p.type==0))if(l[g.id]=h.length<<1|1,px(m,d))h.push(i.facet(g));else{let p=g.combine(d.map(y=>y.value));h.push(i&&g.compare(p,i.facet(g))?i.facet(g):p)}else{for(let p of d)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=a.length<<1,a.push(y=>p.dynamicSlot(y)));l[g.id]=a.length<<1,a.push(p=>Cj(p,g,d))}}let f=a.map(u=>u(l));return new Nd(t,o,f,l,h,r)}}function Dj(s,t,e){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let h=n.get(o);if(h!=null){if(h<=l)return;let a=i[h].indexOf(o);a>-1&&i[h].splice(a,1),o instanceof Pw&&e.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let a of o)r(a,l);else if(o instanceof Pw){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let a=t.get(o.compartment)||o.inner;e.set(o.compartment,a),r(a,l)}else if(o instanceof D3)r(o.inner,o.prec);else if(o instanceof Tl)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof qu)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,cr.default);else{let a=o.extension;if(!a)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(a,l)}}return r(s,cr.default),i.reduce((o,l)=>o.concat(l))}function ia(s,t){if(t&1)return 2;let e=t>>1,i=s.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[e]=4;let n=s.computeSlot(s,s.config.dynamicSlots[e]);return s.status[e]=2|n}function Hd(s,t){return t&1?s.config.staticValues[t>>1]:s.values[t>>1]}const O3=F.define(),Lw=F.define({combine:s=>s.some(t=>t),static:!0}),T3=F.define({combine:s=>s.length?s[0]:void 0,static:!0}),$3=F.define(),R3=F.define(),B3=F.define(),E3=F.define({combine:s=>s.length?s[0]:!1});class $l{constructor(t,e){this.type=t,this.value=e}static define(){return new Oj}}class Oj{of(t){return new $l(this,t)}}class Tj{constructor(t){this.map=t}of(t){return new oe(this,t)}}class oe{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new oe(this.type,e)}is(t){return this.type==t}static define(t={}){return new Tj(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let n of t){let r=n.map(e);r&&i.push(r)}return i}}oe.reconfigure=oe.define();oe.appendConfig=oe.define();class Te{constructor(t,e,i,n,r,o){this.startState=t,this.changes=e,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&M3(i,e.newLength),r.some(l=>l.type==Te.time)||(this.annotations=r.concat(Te.time.of(Date.now())))}static create(t,e,i,n,r,o){return new Te(t,e,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(Te.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}Te.time=$l.define();Te.userEvent=$l.define();Te.addToHistory=$l.define();Te.remote=$l.define();function $j(s,t){let e=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==t.length||t[n]>=s[i]))r=s[i++],o=s[i++];else if(n<t.length)r=t[n++],o=t[n++];else return e;!e.length||e[e.length-1]<r?e.push(r,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function P3(s,t,e){var i;let n,r,o;return e?(n=t.changes,r=re.empty(t.changes.length),o=s.changes.compose(t.changes)):(n=t.changes.map(s.changes),r=s.changes.mapDesc(t.changes,!0),o=s.changes.compose(n)),{changes:o,selection:t.selection?t.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:oe.mapEffects(s.effects,n).concat(oe.mapEffects(t.effects,r)),annotations:s.annotations.length?s.annotations.concat(t.annotations):t.annotations,scrollIntoView:s.scrollIntoView||t.scrollIntoView}}function Vw(s,t,e){let i=t.selection,n=Xo(t.annotations);return t.userEvent&&(n=n.concat(Te.userEvent.of(t.userEvent))),{changes:t.changes instanceof re?t.changes:re.of(t.changes||[],e,s.facet(T3)),selection:i&&(i instanceof D?i:D.single(i.anchor,i.head)),effects:Xo(t.effects),annotations:n,scrollIntoView:!!t.scrollIntoView}}function L3(s,t,e){let i=Vw(s,t.length?t[0]:{},s.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let r=1;r<t.length;r++){t[r].filter===!1&&(e=!1);let o=!!t[r].sequential;i=P3(i,Vw(s,t[r],o?i.changes.newLength:s.doc.length),o)}let n=Te.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Bj(e?Rj(n):n)}function Rj(s){let t=s.startState,e=!0;for(let n of t.facet($3)){let r=n(s);if(r===!1){e=!1;break}Array.isArray(r)&&(e=e===!0?r:$j(e,r))}if(e!==!0){let n,r;if(e===!1)r=s.changes.invertedDesc,n=re.empty(t.doc.length);else{let o=s.changes.filter(e);n=o.changes,r=o.filtered.mapDesc(o.changes).invertedDesc}s=Te.create(t,n,s.selection&&s.selection.map(r),oe.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=t.facet(R3);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof Te?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof Te?s=r[0]:s=L3(t,Xo(r),!1)}return s}function Bj(s){let t=s.startState,e=t.facet(B3),i=s;for(let n=e.length-1;n>=0;n--){let r=e[n](s);r&&Object.keys(r).length&&(i=P3(i,Vw(t,r,s.changes.newLength),!0))}return i==s?s:Te.create(t,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const Ej=[];function Xo(s){return s==null?Ej:Array.isArray(s)?s:[s]}var vs=(function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s})(vs||(vs={}));const Pj=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Iw;try{Iw=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Lj(s){if(Iw)return Iw.test(s);for(let t=0;t<s.length;t++){let e=s[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Pj.test(e)))return!0}return!1}function Vj(s){return t=>{if(!/\S/.test(t))return vs.Space;if(Lj(t))return vs.Word;for(let e=0;e<s.length;e++)if(t.indexOf(s[e])>-1)return vs.Word;return vs.Other}}class dt{constructor(t,e,i,n,r,o){this.config=t,this.doc=e,this.selection=i,this.values=n,this.status=t.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ia(this,l<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return ia(this,i),Hd(this,i)}update(...t){return L3(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:n}=e;for(let l of t.effects)l.is(xg.reconfigure)?(e&&(n=new Map,e.compartments.forEach((h,a)=>n.set(a,h)),e=null),n.set(l.value.compartment,l.value.extension)):l.is(oe.reconfigure)?(e=null,i=l.value):l.is(oe.appendConfig)&&(e=null,i=Xo(i).concat(l.value));let r;e?r=t.startState.values.slice():(e=Nd.resolve(i,n,this),r=new dt(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(h,a)=>a.reconfigure(h,this),null).values);let o=t.startState.facet(Lw)?t.newSelection:t.newSelection.asSingle();new dt(e,t.newDoc,o,r,(l,h)=>h.update(l,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:D.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),n=this.changes(i.changes),r=[i.range],o=Xo(i.effects);for(let l=1;l<e.ranges.length;l++){let h=t(e.ranges[l]),a=this.changes(h.changes),c=a.map(n);for(let u=0;u<l;u++)r[u]=r[u].map(c);let f=n.mapDesc(a,!0);r.push(h.range.map(f)),n=n.compose(c),o=oe.mapEffects(o,c).concat(oe.mapEffects(Xo(h.effects),f))}return{changes:n,selection:D.create(r,e.mainIndex),effects:o}}changes(t=[]){return t instanceof re?t:re.of(t,this.doc.length,this.facet(dt.lineSeparator))}toText(t){return X.of(t.split(this.facet(dt.lineSeparator)||$w))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(ia(this,e),Hd(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let n=t[i];n instanceof Tl&&this.config.address[n.id]!=null&&(e[i]=n.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i){for(let r in i)if(Object.prototype.hasOwnProperty.call(t,r)){let o=i[r],l=t[r];n.push(o.init(h=>o.spec.fromJSON(l,h)))}}return dt.create({doc:t.doc,selection:D.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){let e=Nd.resolve(t.extensions||[],new Map),i=t.doc instanceof X?t.doc:X.of((t.doc||"").split(e.staticFacet(dt.lineSeparator)||$w)),n=t.selection?t.selection instanceof D?t.selection:D.single(t.selection.anchor,t.selection.head):D.single(0);return M3(n,i.length),e.staticFacet(Lw)||(n=n.asSingle()),new dt(e,i,n,e.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(dt.tabSize)}get lineBreak(){return this.facet(dt.lineSeparator)||`
`}get readOnly(){return this.facet(E3)}phrase(t,...e){for(let i of this.facet(dt.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return!r||r>e.length?i:e[r-1]})),t}languageDataAt(t,e,i=-1){let n=[];for(let r of this.facet(O3))for(let o of r(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&n.push(o[t]);return n}charCategorizer(t){return Vj(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:n}=this.doc.lineAt(t),r=this.charCategorizer(t),o=t-i,l=t-i;for(;o>0;){let h=Ss(e,o,!1);if(r(e.slice(h,o))!=vs.Word)break;o=h}for(;l<n;){let h=Ss(e,l);if(r(e.slice(l,h))!=vs.Word)break;l=h}return o==l?null:D.range(o+i,l+i)}}dt.allowMultipleSelections=Lw;dt.tabSize=F.define({combine:s=>s.length?s[0]:4});dt.lineSeparator=T3;dt.readOnly=E3;dt.phrases=F.define({compare(s,t){let e=Object.keys(s),i=Object.keys(t);return e.length==i.length&&e.every(n=>s[n]==t[n])}});dt.languageData=O3;dt.changeFilter=$3;dt.transactionFilter=R3;dt.transactionExtender=B3;xg.reconfigure=oe.define();class bl{eq(t){return this==t}range(t,e=t){return Za.create(t,e,this)}}bl.prototype.startSide=bl.prototype.endSide=0;bl.prototype.point=!1;bl.prototype.mapMode=ki.TrackDel;class Za{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new Za(t,e,i)}}function Nw(s,t){return s.from-t.from||s.value.startSide-t.value.startSide}class mx{constructor(t,e,i,n){this.from=t,this.to=e,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let h=o+l>>1,a=r[h]-t||(i?this.value[h].endSide:this.value[h].startSide)-e;if(h==o)return a>=0?o:l;a>=0?l=h:o=h+1}}between(t,e,i,n){for(let r=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+t,this.to[r]+t,this.value[r])===!1)return!1}map(t,e){let i=[],n=[],r=[],o=-1,l=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],c=this.from[h]+t,f=this.to[h]+t,u,d;if(c==f){let g=e.mapPos(c,a.startSide,a.mapMode);if(g==null||(u=d=g,a.startSide!=a.endSide&&(d=e.mapPos(c,a.endSide),d<u)))continue}else if(u=e.mapPos(c,a.startSide),d=e.mapPos(f,a.endSide),u>d||u==d&&a.startSide>0&&a.endSide<=0)continue;(d-u||a.endSide-a.startSide)<0||(o<0&&(o=u),a.point&&(l=Math.max(l,d-u)),i.push(a),n.push(u-o),r.push(d-o))}return{mapped:i.length?new mx(n,r,i,l):null,pos:o}}}class gt{constructor(t,e,i,n){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=n}static create(t,e,i,n){return new gt(t,e,i,n)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(Nw)),this.isEmpty)return e.length?gt.of(e):this;let l=new V3(this,null,-1).goto(0),h=0,a=[],c=new Fd;for(;l.value||h<e.length;)if(h<e.length&&(l.from-e[h].from||l.startSide-e[h].value.startSide)>=0){let f=e[h++];c.addInner(f.from,f.to,f.value)||a.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(l.chunkIndex)<e[h].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||a.push(Za.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!a.length?gt.empty:this.nextLayer.update({add:a,filter:o,filterFrom:n,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],h=this.chunk[o],a=t.touchesRange(l,l+h.length);if(a===!1)n=Math.max(n,h.maxPoint),e.push(h),i.push(t.mapPos(l));else if(a===!0){let{mapped:c,pos:f}=h.map(l,t);c&&(n=Math.max(n,c.maxPoint),e.push(c),i.push(f))}}let r=this.nextLayer.map(t);return e.length==0?r:new gt(i,e,r||gt.empty,n)}between(t,e,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(e>=r&&t<=r+o.length&&o.between(r,t-r,e-r,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return Qa.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return Qa.from(t).goto(e)}static compare(t,e,i,n,r=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=r),h=FC(o,l,i),a=new Ul(o,h,r),c=new Ul(l,h,r);i.iterGaps((f,u,d)=>WC(a,f,c,u,d,n)),i.empty&&i.length==0&&WC(a,0,c,0,0,n)}static eq(t,e,i=0,n){n==null&&(n=999999999);let r=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=FC(r,o),h=new Ul(r,l,0).goto(i),a=new Ul(o,l,0).goto(i);for(;;){if(h.to!=a.to||!Hw(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>n)return!0;h.next(),a.next()}}static spans(t,e,i,n,r=-1){let o=new Ul(t,null,r).goto(e),l=e,h=o.openStart;for(;;){let a=Math.min(o.to,i);if(o.point){let c=o.activeForPoint(o.to),f=o.pointFrom<e?c.length+1:o.point.startSide<0?c.length:Math.min(c.length,h);n.point(l,a,o.point,c,f,o.pointRank),h=Math.min(o.openEnd(a),c.length)}else a>l&&(n.span(l,a,o.active,h),h=o.openEnd(a));if(o.to>i)return h+(o.point&&o.to>i?1:0);l=o.to,o.next()}}static of(t,e=!1){let i=new Fd;for(let n of t instanceof Za?[t]:e?Ij(t):t)i.add(n.from,n.to,n.value);return i.finish()}static join(t){if(!t.length)return gt.empty;let e=t[t.length-1];for(let i=t.length-2;i>=0;i--)for(let n=t[i];n!=gt.empty;n=n.nextLayer)e=new gt(n.chunkPos,n.chunk,e,Math.max(n.maxPoint,e.maxPoint));return e}}gt.empty=new gt([],[],null,-1);function Ij(s){if(s.length>1)for(let t=s[0],e=1;e<s.length;e++){let i=s[e];if(Nw(t,i)>0)return s.slice().sort(Nw);t=i}return s}gt.empty.nextLayer=gt.empty;class Fd{finishChunk(t){this.chunks.push(new mx(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new Fd)).add(t,e,i)}addInner(t,e,i){let n=t-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(gt.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=gt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function FC(s,t,e){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of t)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(e?e.mapPos(l):l)==r.chunkPos[o]&&!e?.touchesRange(l,l+r.chunk[o].length)&&n.add(r.chunk[o])}return n}class V3{constructor(t,e,i,n=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class Qa{constructor(t){this.heap=t}static from(t,e=null,i=-1){let n=[];for(let r=0;r<t.length;r++)for(let o=t[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new V3(o,e,i,r));return n.length==1?n[0]:new Qa(n)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)Fp(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)Fp(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Fp(this.heap,0)}}}function Fp(s,t){for(let e=s[t];;){let i=(t<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),e.compare(n)<0)break;s[i]=e,s[t]=n,t=i}}class Ul{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Qa.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Cf(this.active,t),Cf(this.activeTo,t),Cf(this.activeRank,t),this.minActive=zC(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:n,rank:r}=this.cursor;for(;e<this.activeRank.length&&(r-this.activeRank[e]||n-this.activeTo[e])>0;)e++;Mf(this.active,e,i),Mf(this.activeTo,e,n),Mf(this.activeRank,e,r),t&&Mf(t,e,this.cursor.from),this.minActive=zC(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>t){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&Cf(i,n)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let n=i.length-1;n>=0&&i[n]<t;n--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function WC(s,t,e,i,n,r){s.goto(t),e.goto(i);let o=i+n,l=i,h=i-t;for(;;){let a=s.to+h-e.to,c=a||s.endSide-e.endSide,f=c<0?s.to+h:e.to,u=Math.min(f,o);if(s.point||e.point?s.point&&e.point&&(s.point==e.point||s.point.eq(e.point))&&Hw(s.activeForPoint(s.to),e.activeForPoint(e.to))||r.comparePoint(l,u,s.point,e.point):u>l&&!Hw(s.active,e.active)&&r.compareRange(l,u,s.active,e.active),f>o)break;(a||s.openEnd!=e.openEnd)&&r.boundChange&&r.boundChange(f),l=f,c<=0&&s.next(),c>=0&&e.next()}}function Hw(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=t[e]&&!s[e].eq(t[e]))return!1;return!0}function Cf(s,t){for(let e=t,i=s.length-1;e<i;e++)s[e]=s[e+1];s.pop()}function Mf(s,t,e){for(let i=s.length-1;i>=t;i--)s[i+1]=s[i];s[t]=e}function zC(s,t){let e=-1,i=1e9;for(let n=0;n<t.length;n++)(t[n]-i||s[n].endSide-s[e].endSide)<0&&(e=n,i=t[n]);return e}function Nj(s,t,e,i){for(let n=0,r=0;;){if(r>=t)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?e-r%e:1,n=Ss(s,n)}return s.length}let Ai=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Fw=typeof document<"u"?document:{documentElement:{style:{}}};const Ww=/Edge\/(\d+)/.exec(Ai.userAgent),I3=/MSIE \d/.test(Ai.userAgent),zw=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ai.userAgent),Sg=!!(I3||zw||Ww),qC=!Sg&&/gecko\/(\d+)/i.test(Ai.userAgent),Wp=!Sg&&/Chrome\/(\d+)/.exec(Ai.userAgent),Hj="webkitFontSmoothing"in Fw.documentElement.style,qw=!Sg&&/Apple Computer/.test(Ai.vendor),KC=qw&&(/Mobile\/\w+/.test(Ai.userAgent)||Ai.maxTouchPoints>2);var C={mac:KC||/Mac/.test(Ai.platform),ie:Sg,ie_version:I3?Fw.documentMode||6:zw?+zw[1]:Ww?+Ww[1]:0,gecko:qC,gecko_version:qC?+(/Firefox\/(\d+)/.exec(Ai.userAgent)||[0,0])[1]:0,chrome:!!Wp,chrome_version:Wp?+Wp[1]:0,ios:KC,android:/Android\b/.test(Ai.userAgent),webkit_version:Hj?+(/\bAppleWebKit\/(\d+)/.exec(Ai.userAgent)||[0,0])[1]:0,safari:qw,safari_version:qw?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Ai.userAgent)||[0,0])[1]:0,tabSize:Fw.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function _a(s){let t;return s.nodeType==11?t=s.getSelection?s:s.ownerDocument:t=s,t.getSelection()}function Kw(s,t){return t?s==t||s.contains(t.nodeType!=1?t.parentNode:t):!1}function Ku(s,t){if(!t.anchorNode)return!1;try{return Kw(s,t.anchorNode)}catch{return!1}}function tc(s){return s.nodeType==3?Pr(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function na(s,t,e,i){return e?GC(s,t,e,i,-1)||GC(s,t,e,i,1):!1}function Er(s){for(var t=0;;t++)if(s=s.previousSibling,!s)return t}function Wd(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}function GC(s,t,e,i,n){for(;;){if(s==e&&t==i)return!0;if(t==(n<0?0:cs(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;t=Er(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[t+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;t=n<0?cs(s):0}else return!1}}function cs(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function vg(s,t){let e=t?s.left:s.right;return{left:e,right:e,top:s.top,bottom:s.bottom}}function Fj(s){let t=s.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function N3(s,t){let e=t.width/s.offsetWidth,i=t.height/s.offsetHeight;return(e>.995&&e<1.005||!isFinite(e)||Math.abs(t.width-s.offsetWidth)<1)&&(e=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.height-s.offsetHeight)<1)&&(i=1),{scaleX:e,scaleY:i}}function Wj(s,t,e,i,n,r,o,l){let h=s.ownerDocument,a=h.defaultView||window;for(let c=s,f=!1;c&&!f;)if(c.nodeType==1){let u,d=c==h.body,g=1,m=1;if(d)u=Fj(a);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(f=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let w=c.getBoundingClientRect();({scaleX:g,scaleY:m}=N3(c,w)),u={left:w.left,right:w.left+c.clientWidth*g,top:w.top,bottom:w.top+c.clientHeight*m}}let p=0,y=0;if(n=="nearest")t.top<u.top?(y=t.top-(u.top+o),e>0&&t.bottom>u.bottom+y&&(y=t.bottom-u.bottom+o)):t.bottom>u.bottom&&(y=t.bottom-u.bottom+o,e<0&&t.top-y<u.top&&(y=t.top-(u.top+o)));else{let w=t.bottom-t.top,x=u.bottom-u.top;y=(n=="center"&&w<=x?t.top+w/2-x/2:n=="start"||n=="center"&&e<0?t.top-o:t.bottom-x+o)-u.top}if(i=="nearest"?t.left<u.left?(p=t.left-(u.left+r),e>0&&t.right>u.right+p&&(p=t.right-u.right+r)):t.right>u.right&&(p=t.right-u.right+r,e<0&&t.left<u.left+p&&(p=t.left-(u.left+r))):p=(i=="center"?t.left+(t.right-t.left)/2-(u.right-u.left)/2:i=="start"==l?t.left-r:t.right-(u.right-u.left)+r)-u.left,p||y)if(d)a.scrollBy(p,y);else{let w=0,x=0;if(y){let b=c.scrollTop;c.scrollTop+=y/m,x=(c.scrollTop-b)*m}if(p){let b=c.scrollLeft;c.scrollLeft+=p/g,w=(c.scrollLeft-b)*g}t={left:t.left-w,top:t.top-x,right:t.right-w,bottom:t.bottom-x},w&&Math.abs(w-p)<1&&(i="nearest"),x&&Math.abs(x-y)<1&&(n="nearest")}if(d)break;(t.top<u.top||t.bottom>u.bottom||t.left<u.left||t.right>u.right)&&(t={left:Math.max(t.left,u.left),right:Math.min(t.right,u.right),top:Math.max(t.top,u.top),bottom:Math.min(t.bottom,u.bottom)}),c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function zj(s){let t=s.ownerDocument,e,i;for(let n=s.parentNode;n&&!(n==t.body||e&&i);)if(n.nodeType==1)!i&&n.scrollHeight>n.clientHeight&&(i=n),!e&&n.scrollWidth>n.clientWidth&&(e=n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;return{x:e,y:i}}class qj{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){let{anchorNode:e,focusNode:i}=t;this.set(e,Math.min(t.anchorOffset,e?cs(e):0),i,Math.min(t.focusOffset,i?cs(i):0))}set(t,e,i,n){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=n}}let hr=null;C.safari&&C.safari_version>=26&&(hr=!1);function H3(s){if(s.setActive)return s.setActive();if(hr)return s.focus(hr);let t=[];for(let e=s;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(s.focus(hr==null?{get preventScroll(){return hr={preventScroll:!0},!0}}:void 0),!hr){hr=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let jC;function Pr(s,t,e=t){let i=jC||(jC=document.createRange());return i.setEnd(s,e),i.setStart(s,t),i}function Zo(s,t,e,i){let n={key:t,code:t,keyCode:e,which:e,cancelable:!0};i&&({altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey}=i);let r=new KeyboardEvent("keydown",n);r.synthetic=!0,s.dispatchEvent(r);let o=new KeyboardEvent("keyup",n);return o.synthetic=!0,s.dispatchEvent(o),r.defaultPrevented||o.defaultPrevented}function Kj(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function F3(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}function Gj(s,t){let e=t.focusNode,i=t.focusOffset;if(!e||t.anchorNode!=e||t.anchorOffset!=i)return!1;for(i=Math.min(i,cs(e));;)if(i){if(e.nodeType!=1)return!1;let n=e.childNodes[i-1];n.contentEditable=="false"?i--:(e=n,i=cs(e))}else{if(e==s)return!0;i=Er(e),e=e.parentNode}}function W3(s){return s.scrollTop>Math.max(1,s.scrollHeight-s.clientHeight-4)}function z3(s,t){for(let e=s,i=t;;){if(e.nodeType==3&&i>0)return{node:e,offset:i};if(e.nodeType==1&&i>0){if(e.contentEditable=="false")return null;e=e.childNodes[i-1],i=cs(e)}else if(e.parentNode&&!Wd(e))i=Er(e),e=e.parentNode;else return null}}function q3(s,t){for(let e=s,i=t;;){if(e.nodeType==3&&i<e.nodeValue.length)return{node:e,offset:i};if(e.nodeType==1&&i<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[i],i=0}else if(e.parentNode&&!Wd(e))i=Er(e)+1,e=e.parentNode;else return null}}class ke{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new ke(t.parentNode,Er(t),e)}static after(t,e){return new ke(t.parentNode,Er(t)+1,e)}}const yx=[];class tt{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}sync(t,e){if(this.flags&2){let i=this.dom,n=null,r;for(let o of this.children){if(o.flags&7){if(!o.dom&&(r=n?n.nextSibling:i.firstChild)){let l=tt.get(r);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(r)}o.sync(t,e),o.flags&=-8}if(r=n?n.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&r!=o.dom&&(e.written=!0),o.dom.parentNode==i)for(;r&&r!=o.dom;)r=UC(r);else i.insertBefore(o.dom,r);n=o.dom}for(r=n?n.nextSibling:i.firstChild,r&&e&&e.node==i&&(e.written=!0);r;)r=UC(r)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(t,e),i.flags&=-8)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let n=cs(t)==0?0:e==0?-1:1;for(;;){let r=t.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(t==r.firstChild?n=-1:n=1),t=r}n<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!tt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let n=-1,r=-1,o=-1,l=-1;for(let h=0,a=i,c=i;h<this.children.length;h++){let f=this.children[h],u=a+f.length;if(a<t&&u>e)return f.domBoundsAround(t,e,a);if(u>=t&&n==-1&&(n=h,r=a),a>e&&f.dom.parentNode==this.dom){o=h,l=c;break}c=u,a=u+f.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.flags|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.flags|=2),e.flags&1)return;e.flags|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.flags&7&&this.markParentsDirty(!0))}setDOM(t){this.dom!=t&&(this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this)}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=yx){this.markDirty();for(let n=t;n<e;n++){let r=this.children[n];r.parent==this&&i.indexOf(r)<0&&r.destroy()}i.length<250?this.children.splice(t,e-t,...i):this.children=[].concat(this.children.slice(0,t),i,this.children.slice(e));for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new K3(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(t,e,i,n,r,o){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor&&!((this.flags|t.flags)&8)}getSide(){return 0}destroy(){for(let t of this.children)t.parent==this&&t.destroy();this.parent=null}}tt.prototype.breakAfter=0;function UC(s){let t=s.nextSibling;return s.parentNode.removeChild(s),t}class K3{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function G3(s,t,e,i,n,r,o,l,h){let{children:a}=s,c=a.length?a[t]:null,f=r.length?r[r.length-1]:null,u=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!u&&r.length<2&&c.merge(e,n,r.length?f:null,e==0,l,h))){if(i<a.length){let d=a[i];d&&(n<d.length||d.breakAfter&&f?.breakAfter)?(t==i&&(d=d.split(n),n=0),!u&&f&&d.merge(0,n,f,!0,0,h)?r[r.length-1]=d:((n||d.children.length&&!d.children[0].length)&&d.merge(0,n,null,!1,0,h),r.push(d))):d?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&r.length&&c.merge(e,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,l,0),t++));t<i&&r.length;)if(a[i-1].become(r[r.length-1]))i--,r.pop(),h=r.length?0:l;else if(a[t].become(r[0]))t++,r.shift(),l=r.length?0:h;else break;!r.length&&t&&i<a.length&&!a[t-1].breakAfter&&a[i].merge(0,0,a[t-1],!1,l,h)&&t--,(t<i||r.length)&&s.replaceChildren(t,i,r)}}function j3(s,t,e,i,n,r){let o=s.childCursor(),{i:l,off:h}=o.findPos(e,1),{i:a,off:c}=o.findPos(t,-1),f=t-e;for(let u of i)f+=u.length;s.length+=f,G3(s,a,c,l,h,i,0,n,r)}const jj=256;class xn extends tt{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t,e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return this.flags&8||i&&(!(i instanceof xn)||this.length-(e-t)+i.length>jj||i.flags&8)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new xn(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e.flags|=this.flags&8,e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new ke(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return Uj(this.dom,t,e)}}class Os extends tt{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let n of e)n.setParent(this)}setAttrs(t){if(F3(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}canReuseDOM(t){return super.canReuseDOM(t)&&!((this.flags|t.flags)&8)}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.flags|=6)}sync(t,e){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t,e)}merge(t,e,i,n,r,o){return i&&(!(i instanceof Os&&i.mark.eq(this.mark))||t&&r<=0||e<this.length&&o<=0)?!1:(j3(this,t,e,i?i.children.slice():[],r-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,n=-1,r=0;for(let l of this.children){let h=i+l.length;h>t&&e.push(i<t?l.split(t-i):l),n<0&&i>=t&&(n=r),i=h,r++}let o=this.length-t;return this.length=t,n>-1&&(this.children.length=n,this.markDirty()),new Os(this.mark,e,o)}domAtPos(t){return U3(this,t)}coordsAt(t,e){return Y3(this,t,e)}}function Uj(s,t,e){let i=s.nodeValue.length;t>i&&(t=i);let n=t,r=t,o=0;t==0&&e<0||t==i&&e>=0?C.chrome||C.gecko||(t?(n--,o=1):r<i&&(r++,o=-1)):e<0?n--:r<i&&r++;let l=Pr(s,n,r).getClientRects();if(!l.length)return null;let h=l[(o?o<0:e>=0)?0:l.length-1];return C.safari&&!o&&h.width==0&&(h=Array.prototype.find.call(l,a=>a.width)||h),o?vg(h,o<0):h||null}class br extends tt{static create(t,e,i){return new br(t,e,i)}constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}split(t){let e=br.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(t,e,i,n,r,o){return i&&(!(i instanceof br)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t instanceof br&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return X.empty;let t=this;for(;t.parent;)t=t.parent;let{view:e}=t,i=e&&e.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):X.empty}domAtPos(t){return(this.length?t==0:this.side>0)?ke.before(this.dom):ke.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.widget.coordsAt(this.dom,t,e);if(i)return i;let n=this.dom.getClientRects(),r=null;if(!n.length)return null;let o=this.side?this.side<0:t>0;for(let l=o?n.length-1:0;r=n[l],!(t>0?l==0:l==n.length-1||r.top<r.bottom);l+=o?-1:1);return vg(r,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class xl extends tt{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof xl&&t.side==this.side}split(){return new xl(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return this.side>0?ke.before(this.dom):ke.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return X.empty}get isHidden(){return!0}}xn.prototype.children=br.prototype.children=xl.prototype.children=yx;function U3(s,t){let e=s.dom,{children:i}=s,n=0;for(let r=0;n<i.length;n++){let o=i[n],l=r+o.length;if(!(l==r&&o.getSide()<=0)){if(t>r&&t<l&&o.dom.parentNode==e)return o.domAtPos(t-r);if(t<=r)break;r=l}}for(let r=n;r>0;r--){let o=i[r-1];if(o.dom.parentNode==e)return o.domAtPos(o.length)}for(let r=n;r<i.length;r++){let o=i[r];if(o.dom.parentNode==e)return o.domAtPos(0)}return new ke(e,0)}function J3(s,t,e){let i,{children:n}=s;e>0&&t instanceof Os&&n.length&&(i=n[n.length-1])instanceof Os&&i.mark.eq(t.mark)?J3(i,t.children[0],e-1):(n.push(t),t.setParent(s)),s.length+=t.length}function Y3(s,t,e){let i=null,n=-1,r=null,o=-1;function l(a,c){for(let f=0,u=0;f<a.children.length&&u<=c;f++){let d=a.children[f],g=u+d.length;g>=c&&(d.children.length?l(d,c-u):(!r||r.isHidden&&(e>0||Yj(r,d)))&&(g>c||u==g&&d.getSide()>0)?(r=d,o=c-u):(u<c||u==g&&d.getSide()<0&&!d.isHidden)&&(i=d,n=c-u)),u=g}}l(s,t);let h=(e<0?i:r)||i||r;return h?h.coordsAt(Math.max(0,h==i?n:o),e):Jj(s)}function Jj(s){let t=s.dom.lastChild;if(!t)return s.dom.getBoundingClientRect();let e=tc(t);return e[e.length-1]||null}function Yj(s,t){let e=s.coordsAt(0,1),i=t.coordsAt(0,1);return e&&i&&i.top<e.bottom}function Gw(s,t){for(let e in s)e=="class"&&t.class?t.class+=" "+s.class:e=="style"&&t.style?t.style+=";"+s.style:t[e]=s[e];return t}const JC=Object.create(null);function zd(s,t,e){if(s==t)return!0;s||(s=JC),t||(t=JC);let i=Object.keys(s),n=Object.keys(t);if(i.length-(e&&i.indexOf(e)>-1?1:0)!=n.length-(e&&n.indexOf(e)>-1?1:0))return!1;for(let r of i)if(r!=e&&(n.indexOf(r)==-1||s[r]!==t[r]))return!1;return!0}function jw(s,t,e){let i=!1;if(t)for(let n in t)e&&n in e||(i=!0,n=="style"?s.style.cssText="":s.removeAttribute(n));if(e)for(let n in e)t&&t[n]==e[n]||(i=!0,n=="style"?s.style.cssText=e[n]:s.setAttribute(n,e[n]));return i}function Xj(s){let t=Object.create(null);for(let e=0;e<s.attributes.length;e++){let i=s.attributes[e];t[i.name]=i.value}return t}class wx{eq(t){return!1}updateDOM(t,e){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(t){return!0}coordsAt(t,e,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(t){}}var ns=(function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s})(ns||(ns={}));class Oi extends bl{constructor(t,e,i,n){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(t){return new vc(t)}static widget(t){let e=Math.max(-1e4,Math.min(1e4,t.side||0)),i=!!t.block;return e+=i&&!t.inlineOrder?e>0?3e8:-4e8:e>0?1e8:-1e8,new rr(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,n;if(t.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=X3(t,e);i=(r?e?-3e8:-1:5e8)-1,n=(o?e?2e8:1:-6e8)+1}return new rr(t,i,n,e,t.widget||null,!0)}static line(t){return new kc(t)}static set(t,e=!1){return gt.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Oi.none=gt.empty;class vc extends Oi{constructor(t){let{start:e,end:i}=X3(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){var e,i;return this==t||t instanceof vc&&this.tagName==t.tagName&&(this.class||((e=this.attrs)===null||e===void 0?void 0:e.class))==(t.class||((i=t.attrs)===null||i===void 0?void 0:i.class))&&zd(this.attrs,t.attrs,"class")}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}vc.prototype.point=!1;class kc extends Oi{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof kc&&this.spec.class==t.spec.class&&zd(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}kc.prototype.mapMode=ki.TrackBefore;kc.prototype.point=!0;class rr extends Oi{constructor(t,e,i,n,r,o){super(e,i,r,t),this.block=n,this.isReplace=o,this.mapMode=n?e<=0?ki.TrackBefore:ki.TrackAfter:ki.TrackDel}get type(){return this.startSide!=this.endSide?ns.WidgetRange:this.startSide<=0?ns.WidgetBefore:ns.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof rr&&Zj(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}rr.prototype.point=!0;function X3(s,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=s;return e==null&&(e=s.inclusive),i==null&&(i=s.inclusive),{start:e??t,end:i??t}}function Zj(s,t){return s==t||!!(s&&t&&s.compare(t))}function Gu(s,t,e,i=0){let n=e.length-1;n>=0&&e[n]+i>=s?e[n]=Math.max(e[n],t):e.push(s,t)}class zt extends tt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,n,r,o){if(i){if(!(i instanceof zt))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),j3(this,t,e,i?i.children.slice():[],r,o),!0}split(t){let e=new zt;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:n}=this.childPos(t);n&&(e.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)e.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){zd(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){J3(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=Gw(e,this.attrs||{})),i&&(this.attrs=Gw({class:i},this.attrs||{}))}domAtPos(t){return U3(this,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.flags|=6)}sync(t,e){var i;this.dom?this.flags&4&&(F3(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(jw(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t,e);let n=this.dom.lastChild;for(;n&&tt.get(n)instanceof Os;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((i=tt.get(n))===null||i===void 0?void 0:i.isEditable)==!1&&(!C.ios||!this.children.some(r=>r instanceof xn))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0,e;for(let i of this.children){if(!(i instanceof xn)||/[^ -~]/.test(i.text))return null;let n=tc(i.dom);if(n.length!=1)return null;t+=n[0].width,e=n[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(t,e){let i=Y3(this,t,e);if(!this.children.length&&i&&this.parent){let{heightOracle:n}=this.parent.view.viewState,r=i.bottom-i.top;if(Math.abs(r-n.lineHeight)<2&&n.textHeight<r){let o=(r-n.textHeight)/2;return{top:i.top+o,bottom:i.bottom-o,left:i.left,right:i.left}}}return i}become(t){return t instanceof zt&&this.children.length==0&&t.children.length==0&&zd(this.attrs,t.attrs)&&this.breakAfter==t.breakAfter}covers(){return!0}static find(t,e){for(let i=0,n=0;i<t.children.length;i++){let r=t.children[i],o=n+r.length;if(o>=e){if(r instanceof zt)return r;if(o>e)break}n=o+r.breakAfter}return null}}class Ds extends tt{constructor(t,e,i){super(),this.widget=t,this.length=e,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,n,r,o){return i&&(!(i instanceof Ds)||!this.widget.compare(i.widget)||t>0&&r<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?ke.before(this.dom):ke.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Ds(this.widget,e,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return yx}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):X.empty}domBoundsAround(){return null}become(t){return t instanceof Ds&&t.widget.constructor==this.widget.constructor?(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.deco=t.deco,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(t,e){let i=this.widget.coordsAt(this.dom,t,e);return i||(this.widget instanceof Uw?null:vg(this.dom.getBoundingClientRect(),this.length?t==0:e<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(t){let{startSide:e,endSide:i}=this.deco;return e==i?!1:t<0?e<0:i>0}}class Uw extends wx{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return t.className="cm-gap",this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class sa{constructor(t,e,i,n){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Ds&&t.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new zt),this.atCursorPos=!0),this.curLine}flushBuffer(t=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Df(new xl(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer(),this.curLine=null,this.content.push(t)}finish(t){this.pendingBuffer&&t<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(t&&this.content.length&&this.content[this.content.length-1]instanceof Ds)&&this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:l,done:h}=this.cursor.next(this.skip);if(this.skip=0,h)throw new Error("Ran out of text content when drawing inline views");if(l){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,t--;continue}else this.text=o,this.textOff=0}let n=Math.min(this.text.length-this.textOff,t),r=Math.min(n,512);this.flushBuffer(e.slice(e.length-i)),this.getLine().append(Df(new xn(this.text.slice(this.textOff,this.textOff+r)),e),i),this.atCursorPos=!0,this.textOff+=r,t-=r,i=n<=r?0:e.length}}span(t,e,i,n){this.buildText(e-t,i,n),this.pos=e,this.openStart<0&&(this.openStart=n)}point(t,e,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof rr){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=e-t;if(i instanceof rr)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Ds(i.widget||Sl.block,l,i));else{let h=br.create(i.widget||Sl.inline,l,l?0:i.startSide),a=this.atCursorPos&&!h.isEditable&&r<=n.length&&(t<e||i.startSide>0),c=!h.isEditable&&(t<e||r>n.length||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!a&&!h.isEditable&&(this.pendingBuffer=0),this.flushBuffer(n),a&&(f.append(Df(new xl(1),n),r),r=n.length+Math.max(0,r-n.length)),f.append(Df(h,n),r),this.atCursorPos=c,this.pendingBuffer=c?t<e||r>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=r)}static build(t,e,i,n,r){let o=new sa(t,e,i,r);return o.openEnd=gt.spans(n,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Df(s,t){for(let e of t)s=new Os(e,[s],s.length);return s}class Sl extends wx{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Sl.inline=new Sl("span");Sl.block=new Sl("div");var Fe=(function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s})(Fe||(Fe={}));const Lr=Fe.LTR,bx=Fe.RTL;function Z3(s){let t=[];for(let e=0;e<s.length;e++)t.push(1<<+s[e]);return t}const Qj=Z3("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),_j=Z3("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Jw=Object.create(null),$n=[];for(let s of["()","[]","{}"]){let t=s.charCodeAt(0),e=s.charCodeAt(1);Jw[t]=e,Jw[e]=-t}function Q3(s){return s<=247?Qj[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?_j[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8204?256:64336<=s&&s<=65023?4:1}const tU=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Qs{get dir(){return this.level%2?bx:Lr}constructor(t,e,i){this.from=t,this.to=e,this.level=i}side(t,e){return this.dir==e==t?this.to:this.from}forward(t,e){return t==(this.dir==e)}static find(t,e,i,n){let r=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=e&&l.to>=e){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<e:l.to>e:t[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}}function _3(s,t){if(s.length!=t.length)return!1;for(let e=0;e<s.length;e++){let i=s[e],n=t[e];if(i.from!=n.from||i.to!=n.to||i.direction!=n.direction||!_3(i.inner,n.inner))return!1}return!0}const it=[];function eU(s,t,e,i,n){for(let r=0;r<=i.length;r++){let o=r?i[r-1].to:t,l=r<i.length?i[r].from:e,h=r?256:n;for(let a=o,c=h,f=h;a<l;a++){let u=Q3(s.charCodeAt(a));u==512?u=c:u==8&&f==4&&(u=16),it[a]=u==4?2:u,u&7&&(f=u),c=u}for(let a=o,c=h,f=h;a<l;a++){let u=it[a];if(u==128)a<l-1&&c==it[a+1]&&c&24?u=it[a]=c:it[a]=256;else if(u==64){let d=a+1;for(;d<l&&it[d]==64;)d++;let g=a&&c==8||d<e&&it[d]==8?f==1?1:8:256;for(let m=a;m<d;m++)it[m]=g;a=d-1}else u==8&&f==1&&(it[a]=1);c=u,u&7&&(f=u)}}}function iU(s,t,e,i,n){let r=n==1?2:1;for(let o=0,l=0,h=0;o<=i.length;o++){let a=o?i[o-1].to:t,c=o<i.length?i[o].from:e;for(let f=a,u,d,g;f<c;f++)if(d=Jw[u=s.charCodeAt(f)])if(d<0){for(let m=l-3;m>=0;m-=3)if($n[m+1]==-d){let p=$n[m+2],y=p&2?n:p&4?p&1?r:n:0;y&&(it[f]=it[$n[m]]=y),l=m;break}}else{if($n.length==189)break;$n[l++]=f,$n[l++]=u,$n[l++]=h}else if((g=it[f])==2||g==1){let m=g==n;h=m?0:1;for(let p=l-3;p>=0;p-=3){let y=$n[p+2];if(y&2)break;if(m)$n[p+2]|=2;else{if(y&4)break;$n[p+2]|=4}}}}}function nU(s,t,e,i){for(let n=0,r=i;n<=e.length;n++){let o=n?e[n-1].to:s,l=n<e.length?e[n].from:t;for(let h=o;h<l;){let a=it[h];if(a==256){let c=h+1;for(;;)if(c==l){if(n==e.length)break;c=e[n++].to,l=n<e.length?e[n].from:t}else if(it[c]==256)c++;else break;let f=r==1,u=(c<t?it[c]:i)==1,d=f==u?f?1:2:i;for(let g=c,m=n,p=m?e[m-1].to:s;g>h;)g==p&&(g=e[--m].from,p=m?e[m-1].to:s),it[--g]=d;h=c}else r=a,h++}}}function Yw(s,t,e,i,n,r,o){let l=i%2?2:1;if(i%2==n%2)for(let h=t,a=0;h<e;){let c=!0,f=!1;if(a==r.length||h<r[a].from){let m=it[h];m!=l&&(c=!1,f=m==16)}let u=!c&&l==1?[]:null,d=c?i:i+1,g=h;t:for(;;)if(a<r.length&&g==r[a].from){if(f)break t;let m=r[a];if(!c)for(let p=m.to,y=a+1;;){if(p==e)break t;if(y<r.length&&r[y].from==p)p=r[y++].to;else{if(it[p]==l)break t;break}}if(a++,u)u.push(m);else{m.from>h&&o.push(new Qs(h,m.from,d));let p=m.direction==Lr!=!(d%2);Xw(s,p?i+1:i,n,m.inner,m.from,m.to,o),h=m.to}g=m.to}else{if(g==e||(c?it[g]!=l:it[g]==l))break;g++}u?Yw(s,h,g,i+1,n,u,o):h<g&&o.push(new Qs(h,g,d)),h=g}else for(let h=e,a=r.length;h>t;){let c=!0,f=!1;if(!a||h>r[a-1].to){let m=it[h-1];m!=l&&(c=!1,f=m==16)}let u=!c&&l==1?[]:null,d=c?i:i+1,g=h;t:for(;;)if(a&&g==r[a-1].to){if(f)break t;let m=r[--a];if(!c)for(let p=m.from,y=a;;){if(p==t)break t;if(y&&r[y-1].to==p)p=r[--y].from;else{if(it[p-1]==l)break t;break}}if(u)u.push(m);else{m.to<h&&o.push(new Qs(m.to,h,d));let p=m.direction==Lr!=!(d%2);Xw(s,p?i+1:i,n,m.inner,m.from,m.to,o),h=m.from}g=m.from}else{if(g==t||(c?it[g-1]!=l:it[g-1]==l))break;g--}u?Yw(s,g,h,i+1,n,u,o):g<h&&o.push(new Qs(g,h,d)),h=g}}function Xw(s,t,e,i,n,r,o){let l=t%2?2:1;eU(s,n,r,i,l),iU(s,n,r,i,l),nU(n,r,i,l),Yw(s,n,r,t,e,i,o)}function sU(s,t,e){if(!s)return[new Qs(0,0,t==bx?1:0)];if(t==Lr&&!e.length&&!tU.test(s))return tI(s.length);if(e.length)for(;s.length>it.length;)it[it.length]=256;let i=[],n=t==Lr?0:1;return Xw(s,n,n,e,0,s.length,i),i}function tI(s){return[new Qs(0,s,0)]}let eI="";function rU(s,t,e,i,n){var r;let o=i.head-s.from,l=Qs.find(t,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc),h=t[l],a=h.side(n,e);if(o==a){let u=l+=n?1:-1;if(u<0||u>=t.length)return null;h=t[l=u],o=h.side(!n,e),a=h.side(n,e)}let c=Ss(s.text,o,h.forward(n,e));(c<h.from||c>h.to)&&(c=a),eI=s.text.slice(Math.min(o,c),Math.max(o,c));let f=l==(n?t.length-1:0)?null:t[l+(n?1:-1)];return f&&c==a&&f.level+(n?0:1)<h.level?D.cursor(f.side(!n,e)+s.from,f.forward(n,e)?1:-1,f.level):D.cursor(c+s.from,h.forward(n,e)?-1:1,h.level)}function oU(s,t,e){for(let i=t;i<e;i++){let n=Q3(s.charCodeAt(i));if(n==1)return Lr;if(n==2||n==4)return bx}return Lr}const iI=F.define(),nI=F.define(),sI=F.define(),rI=F.define(),Zw=F.define(),oI=F.define(),lI=F.define(),xx=F.define(),Sx=F.define(),hI=F.define({combine:s=>s.some(t=>t)}),lU=F.define({combine:s=>s.some(t=>t)}),aI=F.define();class Qo{constructor(t,e="nearest",i="nearest",n=5,r=5,o=!1){this.range=t,this.y=e,this.x=i,this.yMargin=n,this.xMargin=r,this.isSnapshot=o}map(t){return t.empty?this:new Qo(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new Qo(D.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Of=oe.define({map:(s,t)=>s.map(t)}),cI=oe.define();function ks(s,t,e){let i=s.facet(rI);i.length?i[0](t):window.onerror&&window.onerror(String(t),e,void 0,void 0,t)||(e?console.error(e+":",t):console.error(t))}const gs=F.define({combine:s=>s.length?s[0]:!0});let hU=0;const ko=F.define({combine(s){return s.filter((t,e)=>{for(let i=0;i<e;i++)if(s[i].plugin==t.plugin)return!1;return!0})}});class ec{constructor(t,e,i,n,r){this.id=t,this.create=e,this.domEventHandlers=i,this.domEventObservers=n,this.baseExtensions=r(this),this.extension=this.baseExtensions.concat(ko.of({plugin:this,arg:void 0}))}of(t){return this.baseExtensions.concat(ko.of({plugin:this,arg:t}))}static define(t,e){const{eventHandlers:i,eventObservers:n,provide:r,decorations:o}=e||{};return new ec(hU++,t,i,n,l=>{let h=[];return o&&h.push(ic.of(a=>{let c=a.plugin(l);return c?o(c):Oi.none})),r&&h.push(r(l)),h})}static fromClass(t,e){return ec.define((i,n)=>new t(i,n),e)}}class zp{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(ks(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(t,this.spec.arg)}catch(e){ks(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){ks(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const fI=F.define(),vx=F.define(),ic=F.define(),uI=F.define(),Ac=F.define(),dI=F.define();function YC(s,t){let e=s.state.facet(dI);if(!e.length)return e;let i=e.map(r=>r instanceof Function?r(s):r),n=[];return gt.spans(i,t.from,t.to,{point(){},span(r,o,l,h){let a=r-t.from,c=o-t.from,f=n;for(let u=l.length-1;u>=0;u--,h--){let d=l[u].spec.bidiIsolate,g;if(d==null&&(d=oU(t.text,a,c)),h>0&&f.length&&(g=f[f.length-1]).to==a&&g.direction==d)g.to=c,f=g.inner;else{let m={from:a,to:c,direction:d,inner:[]};f.push(m),f=m.inner}}}}),n}const gI=F.define();function pI(s){let t=0,e=0,i=0,n=0;for(let r of s.state.facet(gI)){let o=r(s);o&&(o.left!=null&&(t=Math.max(t,o.left)),o.right!=null&&(e=Math.max(e,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(n=Math.max(n,o.bottom)))}return{left:t,right:e,top:i,bottom:n}}const Dh=F.define();class Bi{constructor(t,e,i,n){this.fromA=t,this.toA=e,this.fromB=i,this.toB=n}join(t){return new Bi(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let n=t[e-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let h=n==t.length?null:t[n],a=o-l,c=h?h.fromB:1e9;for(;r<e.length&&e[r]<c;){let f=e[r],u=e[r+1],d=Math.max(l,f),g=Math.min(c,u);if(d<=g&&new Bi(d+a,g+a,d,g).addToSet(i),u>c)break;r+=2}if(!h)return i;new Bi(h.fromA,h.toA,h.fromB,h.toB).addToSet(i),o=h.toA,l=h.toB}}}class qd{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=re.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let n=[];this.changes.iterChangedRanges((r,o,l,h)=>n.push(new Bi(r,o,l,h))),this.changedRanges=n}static create(t,e,i){return new qd(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class XC extends tt{get length(){return this.view.state.doc.length}constructor(t){super(),this.view=t,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Oi.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new zt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Bi(0,0,0,t.state.doc.length)],0,null)}update(t){var e;let i=t.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:a,toA:c})=>c<this.minWidthFrom||a>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(t);let n=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((e=this.domChanged)===null||e===void 0)&&e.newSel?n=this.domChanged.newSel.head:!pU(t.changes,this.hasComposition)&&!t.selectionSet&&(n=t.state.selection.main.head));let r=n>-1?cU(this.view,t.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:a,to:c}=this.hasComposition;i=new Bi(a,c,t.changes.mapPos(a,-1),t.changes.mapPos(c,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(C.ie||C.chrome)&&!r&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,l=this.updateDeco(),h=dU(o,l,t.changes);return i=Bi.extendWithRanges(i,h),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,t.startState.doc.length,r),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e,i);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=C.chrome||C.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||n.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Ds&&o.widget instanceof Uw&&r.push(o.dom);n.updateGaps(r)}updateChildren(t,e,i){let n=i?i.range.addToSet(t.slice()):t,r=this.childCursor(e);for(let o=n.length-1;;o--){let l=o>=0?n[o]:null;if(!l)break;let{fromA:h,toA:a,fromB:c,toB:f}=l,u,d,g,m;if(i&&i.range.fromB<f&&i.range.toB>c){let b=sa.build(this.view.state.doc,c,i.range.fromB,this.decorations,this.dynamicDecorationMap),S=sa.build(this.view.state.doc,i.range.toB,f,this.decorations,this.dynamicDecorationMap);d=b.breakAtStart,g=b.openStart,m=S.openEnd;let v=this.compositionView(i);S.breakAtStart?v.breakAfter=1:S.content.length&&v.merge(v.length,v.length,S.content[0],!1,S.openStart,0)&&(v.breakAfter=S.content[0].breakAfter,S.content.shift()),b.content.length&&v.merge(0,0,b.content[b.content.length-1],!0,0,b.openEnd)&&b.content.pop(),u=b.content.concat(v).concat(S.content)}else({content:u,breakAtStart:d,openStart:g,openEnd:m}=sa.build(this.view.state.doc,c,f,this.decorations,this.dynamicDecorationMap));let{i:p,off:y}=r.findPos(a,1),{i:w,off:x}=r.findPos(h,-1);G3(this,w,x,p,y,u,d,g,m)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(t){this.editContextFormatting=this.editContextFormatting.map(t.changes);for(let e of t.transactions)for(let i of e.effects)i.is(cI)&&(this.editContextFormatting=i.value)}compositionView(t){let e=new xn(t.text.nodeValue);e.flags|=8;for(let{deco:n}of t.marks)e=new Os(n,[e],e.length);let i=new zt;return i.append(e,0),i}fixCompositionDOM(t){let e=(r,o)=>{o.flags|=8|(o.children.some(h=>h.flags&7)?1:0),this.markedForComposition.add(o);let l=tt.get(r);l&&l!=o&&(l.dom=null),o.setDOM(r)},i=this.childPos(t.range.fromB,1),n=this.children[i.i];e(t.line,n);for(let r=t.marks.length-1;r>=-1;r--)i=n.childPos(i.off,1),n=n.children[i.i],e(r>=0?t.marks[r].node:t.text,n)}updateSelection(t=!1,e=!1){(t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,n=i==this.dom,r=!n&&!(this.view.state.facet(gs)||this.dom.tabIndex>-1)&&Ku(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(n||e||r))return;let o=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,h=this.moveToLine(this.domAtPos(l.anchor)),a=l.empty?h:this.moveToLine(this.domAtPos(l.head));if(C.gecko&&l.empty&&!this.hasComposition&&aU(h)){let f=document.createTextNode("");this.view.observer.ignore(()=>h.node.insertBefore(f,h.node.childNodes[h.offset]||null)),h=a=new ke(f,0),o=!0}let c=this.view.observer.selectionRange;(o||!c.focusNode||(!na(h.node,h.offset,c.anchorNode,c.anchorOffset)||!na(a.node,a.offset,c.focusNode,c.focusOffset))&&!this.suppressWidgetCursorChange(c,l))&&(this.view.observer.ignore(()=>{C.android&&C.chrome&&this.dom.contains(c.focusNode)&&gU(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let f=_a(this.view.root);if(f)if(l.empty){if(C.gecko){let u=fU(h.node,h.offset);if(u&&u!=3){let d=(u==1?z3:q3)(h.node,h.offset);d&&(h=new ke(d.node,d.offset))}}f.collapse(h.node,h.offset),l.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=l.bidiLevel)}else if(f.extend){f.collapse(h.node,h.offset);try{f.extend(a.node,a.offset)}catch{}}else{let u=document.createRange();l.anchor>l.head&&([h,a]=[a,h]),u.setEnd(a.node,a.offset),u.setStart(h.node,h.offset),f.removeAllRanges(),f.addRange(u)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(h,a)),this.impreciseAnchor=h.precise?null:new ke(c.anchorNode,c.anchorOffset),this.impreciseHead=a.precise?null:new ke(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(t,e){return this.hasComposition&&e.empty&&na(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)&&this.posFromDOM(t.focusNode,t.focusOffset)==e.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:t}=this,e=t.state.selection.main,i=_a(t.root),{anchorNode:n,anchorOffset:r}=t.observer.selectionRange;if(!i||!e.empty||!e.assoc||!i.modify)return;let o=zt.find(this,e.head);if(!o)return;let l=o.posAtStart;if(e.head==l||e.head==l+o.length)return;let h=this.coordsAt(e.head,-1),a=this.coordsAt(e.head,1);if(!h||!a||h.bottom>a.top)return;let c=this.domAtPos(e.head+e.assoc);i.collapse(c.node,c.offset),i.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let f=t.observer.selectionRange;t.docView.posFromDOM(f.anchorNode,f.anchorOffset)!=e.from&&i.collapse(n,r)}moveToLine(t){let e=this.dom,i;if(t.node!=e)return t;for(let n=t.offset;!i&&n<e.childNodes.length;n++){let r=tt.get(e.childNodes[n]);r instanceof zt&&(i=r.domAtPos(0))}for(let n=t.offset-1;!i&&n>=0;n--){let r=tt.get(e.childNodes[n]);r instanceof zt&&(i=r.domAtPos(r.length))}return i?new ke(i.node,i.offset,!0):t}nearest(t){for(let e=t;e;){let i=tt.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let n=this.children[e];if(i<n.length||n instanceof zt)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){let i=null,n=0;for(let r=this.length,o=this.children.length-1;o>=0;o--){let l=this.children[o],h=r-l.breakAfter,a=h-l.length;if(h<t)break;if(a<=t&&(a<t||l.covers(-1))&&(h>t||l.covers(1))&&(!i||l instanceof zt&&!(i instanceof zt&&e>=0)))i=l,n=a;else if(i&&a==t&&h==t&&l instanceof Ds&&Math.abs(e)<2){if(l.deco.startSide<0)break;o&&(i=null)}r=a}return i?i.coordsAt(t-n,e):null}coordsForChar(t){let{i:e,off:i}=this.childPos(t,1),n=this.children[e];if(!(n instanceof zt))return null;for(;n.children.length;){let{i:l,off:h}=n.childPos(i,1);for(;;l++){if(l==n.children.length)return null;if((n=n.children[l]).length)break}i=h}if(!(n instanceof xn))return null;let r=Ss(n.text,i);if(r==i)return null;let o=Pr(n.dom,i,r).getClientRects();for(let l=0;l<o.length;l++){let h=o[l];if(l==o.length-1||h.top<h.bottom&&h.left<h.right)return h}return null}measureVisibleLineHeights(t){let e=[],{from:i,to:n}=t,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==Fe.LTR;for(let a=0,c=0;c<this.children.length;c++){let f=this.children[c],u=a+f.length;if(u>n)break;if(a>=i){let d=f.dom.getBoundingClientRect();if(e.push(d.height),o){let g=f.dom.lastChild,m=g?tc(g):[];if(m.length){let p=m[m.length-1],y=h?p.right-d.left:d.right-p.left;y>l&&(l=y,this.minWidth=r,this.minWidthFrom=a,this.minWidthTo=u)}}}a=u+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?Fe.RTL:Fe.LTR}measureTextSize(){for(let r of this.children)if(r instanceof zt){let o=r.measureTextSize();if(o)return o}let t=document.createElement("div"),e,i,n;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let r=tc(t.firstChild)[0];e=t.getBoundingClientRect().height,i=r?r.width/27:7,n=r?r.height:e,t.remove()}),{lineHeight:e,charWidth:i,textHeight:n}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new K3(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,n=0;;n++){let r=n==e.viewports.length?null:e.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=(e.lineBlockAt(o).bottom-e.lineBlockAt(i).top)/this.view.scaleY;t.push(Oi.replace({widget:new Uw(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return Oi.set(t)}updateDeco(){let t=1,e=this.view.state.facet(ic).map(r=>(this.dynamicDecorationMap[t++]=typeof r=="function")?r(this.view):r),i=!1,n=this.view.state.facet(uI).map((r,o)=>{let l=typeof r=="function";return l&&(i=!0),l?r(this.view):r});for(n.length&&(this.dynamicDecorationMap[t++]=i,e.push(gt.join(n))),this.decorations=[this.editContextFormatting,...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];t<this.decorations.length;)this.dynamicDecorationMap[t++]=!1;return this.decorations}scrollIntoView(t){if(t.isSnapshot){let a=this.view.viewState.lineBlockAt(t.range.head);this.view.scrollDOM.scrollTop=a.top-t.yMargin,this.view.scrollDOM.scrollLeft=t.xMargin;return}for(let a of this.view.state.facet(aI))try{if(a(this.view,t.range,t))return!0}catch(c){ks(this.view.state,c,"scroll handler")}let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!i)return;!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=pI(this.view),o={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:l,offsetHeight:h}=this.view.scrollDOM;Wj(this.view.scrollDOM,o,e.head<e.anchor?-1:1,t.x,t.y,Math.max(Math.min(t.xMargin,l),-l),Math.max(Math.min(t.yMargin,h),-h),this.view.textDirection==Fe.LTR)}}function aU(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}function mI(s,t){let e=s.observer.selectionRange;if(!e.focusNode)return null;let i=z3(e.focusNode,e.focusOffset),n=q3(e.focusNode,e.focusOffset),r=i||n;if(n&&i&&n.node!=i.node){let l=tt.get(n.node);if(!l||l instanceof xn&&l.text!=n.node.nodeValue)r=n;else if(s.docView.lastCompositionAfterCursor){let h=tt.get(i.node);!h||h instanceof xn&&h.text!=i.node.nodeValue||(r=n)}}if(s.docView.lastCompositionAfterCursor=r!=i,!r)return null;let o=t-r.offset;return{from:o,to:o+r.node.nodeValue.length,node:r.node}}function cU(s,t,e){let i=mI(s,e);if(!i)return null;let{node:n,from:r,to:o}=i,l=n.nodeValue;if(/[\n\r]/.test(l)||s.state.doc.sliceString(i.from,i.to)!=l)return null;let h=t.invertedDesc,a=new Bi(h.mapPos(r),h.mapPos(o),r,o),c=[];for(let f=n.parentNode;;f=f.parentNode){let u=tt.get(f);if(u instanceof Os)c.push({node:f,deco:u.mark});else{if(u instanceof zt||f.nodeName=="DIV"&&f.parentNode==s.contentDOM)return{range:a,text:n,marks:c,line:f};if(f!=s.contentDOM)c.push({node:f,deco:new vc({inclusive:!0,attributes:Xj(f),tagName:f.tagName.toLowerCase()})});else return null}}}function fU(s,t){return s.nodeType!=1?0:(t&&s.childNodes[t-1].contentEditable=="false"?1:0)|(t<s.childNodes.length&&s.childNodes[t].contentEditable=="false"?2:0)}let uU=class{constructor(){this.changes=[]}compareRange(t,e){Gu(t,e,this.changes)}comparePoint(t,e){Gu(t,e,this.changes)}boundChange(t){Gu(t,t,this.changes)}};function dU(s,t,e){let i=new uU;return gt.compare(s,t,e,i),i.changes}function gU(s,t){for(let e=s;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function pU(s,t){let e=!1;return t&&s.iterChangedRanges((i,n)=>{i<t.to&&n>t.from&&(e=!0)}),e}function mU(s,t,e=1){let i=s.charCategorizer(t),n=s.doc.lineAt(t),r=t-n.from;if(n.length==0)return D.cursor(t);r==0?e=1:r==n.length&&(e=-1);let o=r,l=r;e<0?o=Ss(n.text,r,!1):l=Ss(n.text,r);let h=i(n.text.slice(o,l));for(;o>0;){let a=Ss(n.text,o,!1);if(i(n.text.slice(a,o))!=h)break;o=a}for(;l<n.length;){let a=Ss(n.text,l);if(i(n.text.slice(l,a))!=h)break;l=a}return D.range(o+n.from,l+n.from)}function yU(s,t){return t.left>s?t.left-s:Math.max(0,s-t.right)}function wU(s,t){return t.top>s?t.top-s:Math.max(0,s-t.bottom)}function qp(s,t){return s.top<t.bottom-1&&s.bottom>t.top+1}function ZC(s,t){return t<s.top?{top:t,left:s.left,right:s.right,bottom:s.bottom}:s}function QC(s,t){return t>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:t}:s}function Qw(s,t,e){let i,n,r,o,l=!1,h,a,c,f;for(let g=s.firstChild;g;g=g.nextSibling){let m=tc(g);for(let p=0;p<m.length;p++){let y=m[p];n&&qp(n,y)&&(y=ZC(QC(y,n.bottom),n.top));let w=yU(t,y),x=wU(e,y);if(w==0&&x==0)return g.nodeType==3?_C(g,t,e):Qw(g,t,e);(!i||o>x||o==x&&r>w)&&(i=g,n=y,r=w,o=x,l=w?t<y.left?p>0:p<m.length-1:!0),w==0?e>y.bottom&&(!c||c.bottom<y.bottom)?(h=g,c=y):e<y.top&&(!f||f.top>y.top)&&(a=g,f=y):c&&qp(c,y)?c=QC(c,y.bottom):f&&qp(f,y)&&(f=ZC(f,y.top))}}if(c&&c.bottom>=e?(i=h,n=c):f&&f.top<=e&&(i=a,n=f),!i)return{node:s,offset:0};let u=Math.max(n.left,Math.min(n.right,t));if(i.nodeType==3)return _C(i,u,e);if(l&&i.contentEditable!="false")return Qw(i,u,e);let d=Array.prototype.indexOf.call(s.childNodes,i)+(t>=(n.left+n.right)/2?1:0);return{node:s,offset:d}}function _C(s,t,e){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let h=Pr(s,l,l+1).getClientRects();for(let a=0;a<h.length;a++){let c=h[a];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<r){let u=t>=(c.left+c.right)/2,d=u;if((C.chrome||C.gecko)&&Pr(s,l).getBoundingClientRect().left==c.right&&(d=!u),f<=0)return{node:s,offset:l+(d?1:0)};n=l+(d?1:0),r=f}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function yI(s,t,e,i=-1){var n,r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,h,{docHeight:a}=s.viewState,{x:c,y:f}=t,u=f-l;if(u<0)return 0;if(u>a)return s.state.doc.length;for(let b=s.viewState.heightOracle.textHeight/2,S=!1;h=s.elementAtHeight(u),h.type!=ns.Text;)for(;u=i>0?h.bottom+b:h.top-b,!(u>=0&&u<=a);){if(S)return e?null:0;S=!0,i=-i}f=l+u;let d=h.from;if(d<s.viewport.from)return s.viewport.from==0?0:e?null:tM(s,o,h,c,f);if(d>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:e?null:tM(s,o,h,c,f);let g=s.dom.ownerDocument,m=s.root.elementFromPoint?s.root:g,p=m.elementFromPoint(c,f);p&&!s.contentDOM.contains(p)&&(p=null),p||(c=Math.max(o.left+1,Math.min(o.right-1,c)),p=m.elementFromPoint(c,f),p&&!s.contentDOM.contains(p)&&(p=null));let y,w=-1;if(p&&((n=s.docView.nearest(p))===null||n===void 0?void 0:n.isEditable)!=!1){if(g.caretPositionFromPoint){let b=g.caretPositionFromPoint(c,f);b&&({offsetNode:y,offset:w}=b)}else if(g.caretRangeFromPoint){let b=g.caretRangeFromPoint(c,f);b&&({startContainer:y,startOffset:w}=b)}y&&(!s.contentDOM.contains(y)||C.safari&&bU(y,w,c)||C.chrome&&xU(y,w,c))&&(y=void 0),y&&(w=Math.min(cs(y),w))}if(!y||!s.docView.dom.contains(y)){let b=zt.find(s.docView,d);if(!b)return u>h.top+h.height/2?h.to:h.from;({node:y,offset:w}=Qw(b.dom,c,f))}let x=s.docView.nearest(y);if(!x)return null;if(x.isWidget&&((r=x.dom)===null||r===void 0?void 0:r.nodeType)==1){let b=x.dom.getBoundingClientRect();return t.y<b.top||t.y<=b.bottom&&t.x<=(b.left+b.right)/2?x.posAtStart:x.posAtEnd}else return x.localPosFromDOM(y,w)+x.posAtStart}function tM(s,t,e,i,n){let r=Math.round((i-t.left)*s.defaultCharacterWidth);if(s.lineWrapping&&e.height>s.defaultLineHeight*1.5){let l=s.viewState.heightOracle.textHeight,h=Math.floor((n-e.top-(s.defaultLineHeight-l)*.5)/l);r+=h*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(e.from,e.to);return e.from+Nj(o,r,s.state.tabSize)}function wI(s,t,e){let i,n=s;if(s.nodeType!=3||t!=(i=s.nodeValue.length))return!1;for(;;){let r=n.nextSibling;if(r){if(r.nodeName=="BR")break;return!1}else{let o=n.parentNode;if(!o||o.nodeName=="DIV")break;n=o}}return Pr(s,i-1,i).getBoundingClientRect().right>e}function bU(s,t,e){return wI(s,t,e)}function xU(s,t,e){if(t!=0)return wI(s,t,e);for(let n=s;;){let r=n.parentNode;if(!r||r.nodeType!=1||r.firstChild!=n)return!1;if(r.classList.contains("cm-line"))break;n=r}let i=s.nodeType==1?s.getBoundingClientRect():Pr(s,0,Math.max(s.nodeValue.length,1)).getBoundingClientRect();return e-i.left>5}function SU(s,t,e){let i=s.lineBlockAt(t);if(Array.isArray(i.type)){let n;for(let r of i.type){if(r.from>t)break;if(!(r.to<t)){if(r.from<t&&r.to>t)return r;(!n||r.type==ns.Text&&(n.type!=r.type||(e<0?r.from<t:r.to>t)))&&(n=r)}}return n||i}return i}function vU(s,t,e,i){let n=SU(s,t.head,t.assoc||-1),r=!i||n.type!=ns.Text||!(s.lineWrapping||n.widgetLineBreaks)?null:s.coordsAtPos(t.assoc<0&&t.head>n.from?t.head-1:t.head);if(r){let o=s.dom.getBoundingClientRect(),l=s.textDirectionAt(n.from),h=s.posAtCoords({x:e==(l==Fe.LTR)?o.right-1:o.left+1,y:(r.top+r.bottom)/2});if(h!=null)return D.cursor(h,e?-1:1)}return D.cursor(e?n.to:n.from,e?-1:1)}function eM(s,t,e,i){let n=s.state.doc.lineAt(t.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=t,h=null;;){let a=rU(n,r,o,l,e),c=eI;if(!a){if(n.number==(e?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(e?1:-1)),r=s.bidiSpans(n),a=s.visualLineSide(n,!e)}if(h){if(!h(c))return l}else{if(!i)return a;h=i(c)}l=a}}function kU(s,t,e){let i=s.state.charCategorizer(t),n=i(e);return r=>{let o=i(r);return n==vs.Space&&(n=o),n==o}}function AU(s,t,e,i){let n=t.head,r=e?1:-1;if(n==(e?s.state.doc.length:0))return D.cursor(n,t.assoc);let o=t.goalColumn,l,h=s.contentDOM.getBoundingClientRect(),a=s.coordsAtPos(n,t.assoc||-1),c=s.documentTop;if(a)o==null&&(o=a.left-h.left),l=r<0?a.top:a.bottom;else{let d=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(h.right-h.left,s.defaultCharacterWidth*(n-d.from))),l=(r<0?d.top:d.bottom)+c}let f=h.left+o,u=i??s.viewState.heightOracle.textHeight>>1;for(let d=0;;d+=10){let g=l+(u+d)*r,m=yI(s,{x:f,y:g},!1,r);if(g<h.top||g>h.bottom||(r<0?m<n:m>n)){let p=s.docView.coordsForChar(m),y=!p||g<p.top?-1:1;return D.cursor(m,y,void 0,o)}}}function ra(s,t,e){for(;;){let i=0;for(let n of s)n.between(t-1,t+1,(r,o,l)=>{if(t>r&&t<o){let h=i||e||(t-r<o-t?-1:1);t=h<0?r:o,i=h}});if(!i)return t}}function bI(s,t){let e=null;for(let i=0;i<t.ranges.length;i++){let n=t.ranges[i],r=null;if(n.empty){let o=ra(s,n.from,0);o!=n.from&&(r=D.cursor(o,-1))}else{let o=ra(s,n.from,-1),l=ra(s,n.to,1);(o!=n.from||l!=n.to)&&(r=D.range(n.from==n.anchor?o:l,n.from==n.head?o:l))}r&&(e||(e=t.ranges.slice()),e[i]=r)}return e?D.create(e,t.mainIndex):t}function Kp(s,t,e){let i=ra(s.state.facet(Ac).map(n=>n(s)),e.from,t.head>e.from?-1:1);return i==e.from?e:D.cursor(i,i<e.from?1:-1)}const Oh="￿";class CU{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(dt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Oh}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let n=t;;){this.findPointBefore(i,n);let r=this.text.length;this.readNode(n);let o=n.nextSibling;if(o==e)break;let l=tt.get(n),h=tt.get(o);(l&&h?l.breakAfter:(l?l.breakAfter:Wd(n))||Wd(o)&&(n.nodeName!="BR"||n.cmIgnore)&&this.text.length>r)&&!DU(o,e)&&this.lineBreak(),n=o}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(e))&&(r=l.index,o=l[0].length),this.append(e.slice(i,r<0?e.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let h of this.points)h.node==t&&h.pos>this.text.length&&(h.pos-=o-1);i=r+o}}readNode(t){if(t.cmIgnore)return;let e=tt.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+(MU(t,i.node,i.offset)?e:0))}}function MU(s,t,e){for(;;){if(!t||e<cs(t))return!1;if(t==s)return!0;e=Er(t)+1,t=t.parentNode}}function DU(s,t){let e;for(;!(s==t||!s);s=s.nextSibling){let i=tt.get(s);if(!(i?.isWidget||s.cmIgnore))return!1;i&&(e||(e=[])).push(i)}if(e)for(let i of e){let n=i.overrideDOMText;if(n?.length)return!1}return!0}class iM{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class OU{constructor(t,e,i,n){this.typeOver=n,this.bounds=null,this.text="",this.domChanged=e>-1;let{impreciseHead:r,impreciseAnchor:o}=t.docView;if(t.state.readOnly&&e>-1)this.newSel=null;else if(e>-1&&(this.bounds=t.docView.domBoundsAround(e,i,0))){let l=r||o?[]:$U(t),h=new CU(l,t.state);h.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=h.text,this.newSel=RU(l,this.bounds.from)}else{let l=t.observer.selectionRange,h=r&&r.node==l.focusNode&&r.offset==l.focusOffset||!Kw(t.contentDOM,l.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(l.focusNode,l.focusOffset),a=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!Kw(t.contentDOM,l.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(l.anchorNode,l.anchorOffset),c=t.viewport;if((C.ios||C.chrome)&&t.state.selection.main.empty&&h!=a&&(c.from>0||c.to<t.state.doc.length)){let f=Math.min(h,a),u=Math.max(h,a),d=c.from-f,g=c.to-u;(d==0||d==1||f==0)&&(g==0||g==-1||u==t.state.doc.length)&&(h=0,a=t.state.doc.length)}this.newSel=D.single(a,h)}}}function xI(s,t){let e,{newSel:i}=t,n=s.state.selection.main,r=s.inputState.lastKeyTime>Date.now()-100?s.inputState.lastKeyCode:-1;if(t.bounds){let{from:o,to:l}=t.bounds,h=n.from,a=null;(r===8||C.android&&t.text.length<l-o)&&(h=n.to,a="end");let c=SI(s.state.doc.sliceString(o,l,Oh),t.text,h-o,a);c&&(C.chrome&&r==13&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==Oh+Oh&&c.toB--,e={from:o+c.from,to:o+c.toA,insert:X.of(t.text.slice(c.from,c.toB).split(Oh))})}else i&&(!s.hasFocus&&s.state.facet(gs)||i.main.eq(n))&&(i=null);if(!e&&!i)return!1;if(!e&&t.typeOver&&!n.empty&&i&&i.main.empty?e={from:n.from,to:n.to,insert:s.state.doc.slice(n.from,n.to)}:(C.mac||C.android)&&e&&e.from==e.to&&e.from==n.head-1&&/^\. ?$/.test(e.insert.toString())&&s.contentDOM.getAttribute("autocorrect")=="off"?(i&&e.insert.length==2&&(i=D.single(i.main.anchor-1,i.main.head-1)),e={from:e.from,to:e.to,insert:X.of([e.insert.toString().replace("."," ")])}):e&&e.from>=n.from&&e.to<=n.to&&(e.from!=n.from||e.to!=n.to)&&n.to-n.from-(e.to-e.from)<=4?e={from:n.from,to:n.to,insert:s.state.doc.slice(n.from,e.from).append(e.insert).append(s.state.doc.slice(e.to,n.to))}:C.chrome&&e&&e.from==e.to&&e.from==n.head&&e.insert.toString()==`
 `&&s.lineWrapping&&(i&&(i=D.single(i.main.anchor-1,i.main.head-1)),e={from:n.from,to:n.to,insert:X.of([" "])}),e)return kx(s,e,i,r);if(i&&!i.main.eq(n)){let o=!1,l="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(o=!0),l=s.inputState.lastSelectionOrigin,l=="select.pointer"&&(i=bI(s.state.facet(Ac).map(h=>h(s)),i))),s.dispatch({selection:i,scrollIntoView:o,userEvent:l}),!0}else return!1}function kx(s,t,e,i=-1){if(C.ios&&s.inputState.flushIOSKey(t))return!0;let n=s.state.selection.main;if(C.android&&(t.to==n.to&&(t.from==n.from||t.from==n.from-1&&s.state.sliceDoc(t.from,n.from)==" ")&&t.insert.length==1&&t.insert.lines==2&&Zo(s.contentDOM,"Enter",13)||(t.from==n.from-1&&t.to==n.to&&t.insert.length==0||i==8&&t.insert.length<t.to-t.from&&t.to>n.head)&&Zo(s.contentDOM,"Backspace",8)||t.from==n.from&&t.to==n.to+1&&t.insert.length==0&&Zo(s.contentDOM,"Delete",46)))return!0;let r=t.insert.toString();s.inputState.composing>=0&&s.inputState.composing++;let o,l=()=>o||(o=TU(s,t,e));return s.state.facet(oI).some(h=>h(s,t.from,t.to,r,l))||s.dispatch(l()),!0}function TU(s,t,e){let i,n=s.state,r=n.selection.main,o=-1;if(t.from==t.to&&t.from<r.from||t.from>r.to){let h=t.from<r.from?-1:1,a=h<0?r.from:r.to,c=ra(n.facet(Ac).map(f=>f(s)),a,h);t.from==c&&(o=c)}if(o>-1)i={changes:t,selection:D.cursor(t.from+t.insert.length,-1)};else if(t.from>=r.from&&t.to<=r.to&&t.to-t.from>=(r.to-r.from)/3&&(!e||e.main.empty&&e.main.from==t.from+t.insert.length)&&s.inputState.composing<0){let h=r.from<t.from?n.sliceDoc(r.from,t.from):"",a=r.to>t.to?n.sliceDoc(t.to,r.to):"";i=n.replaceSelection(s.state.toText(h+t.insert.sliceString(0,void 0,s.state.lineBreak)+a))}else{let h=n.changes(t),a=e&&e.main.to<=h.newLength?e.main:void 0;if(n.selection.ranges.length>1&&s.inputState.composing>=0&&t.to<=r.to&&t.to>=r.to-10){let c=s.state.sliceDoc(t.from,t.to),f,u=e&&mI(s,e.main.head);if(u){let m=t.insert.length-(t.to-t.from);f={from:u.from,to:u.to-m}}else f=s.state.doc.lineAt(r.head);let d=r.to-t.to,g=r.to-r.from;i=n.changeByRange(m=>{if(m.from==r.from&&m.to==r.to)return{changes:h,range:a||m.map(h)};let p=m.to-d,y=p-c.length;if(m.to-m.from!=g||s.state.sliceDoc(y,p)!=c||m.to>=f.from&&m.from<=f.to)return{range:m};let w=n.changes({from:y,to:p,insert:t.insert}),x=m.to-r.to;return{changes:w,range:a?D.range(Math.max(0,a.anchor+x),Math.max(0,a.head+x)):m.map(w)}})}else i={changes:h,selection:a&&n.selection.replaceRange(a)}}let l="input.type";return(s.composing||s.inputState.compositionPendingChange&&s.inputState.compositionEndedAt>Date.now()-50)&&(s.inputState.compositionPendingChange=!1,l+=".compose",s.inputState.compositionFirstChange&&(l+=".start",s.inputState.compositionFirstChange=!1)),n.update(i,{userEvent:l,scrollIntoView:!0})}function SI(s,t,e,i){let n=Math.min(s.length,t.length),r=0;for(;r<n&&s.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==n&&s.length==t.length)return null;let o=s.length,l=t.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(i=="end"){let h=Math.max(0,r-Math.min(o,l));e-=o+h-r}if(o<r&&s.length<t.length){let h=e<=r&&e>=o?r-e:0;r-=h,l=r+(l-o),o=r}else if(l<r){let h=e<=r&&e>=l?r-e:0;r-=h,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function $U(s){let t=[];if(s.root.activeElement!=s.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return e&&(t.push(new iM(e,i)),(n!=e||r!=i)&&t.push(new iM(n,r))),t}function RU(s,t){if(s.length==0)return null;let e=s[0].pos,i=s.length==2?s[1].pos:e;return e>-1&&i>-1?D.single(e+t,i+t):null}class BU{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(t){this.view=t,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=t.hasFocus,C.safari&&t.contentDOM.addEventListener("input",()=>null),C.gecko&&YU(t.contentDOM.ownerDocument)}handleEvent(t){!WU(this.view,t)||this.ignoreDuringComposition(t)||t.type=="keydown"&&this.keydown(t)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(t.type,t)):this.runHandlers(t.type,t))}runHandlers(t,e){let i=this.handlers[t];if(i){for(let n of i.observers)n(this.view,e);for(let n of i.handlers){if(e.defaultPrevented)break;if(n(this.view,e)){e.preventDefault();break}}}}ensureHandlers(t){let e=EU(t),i=this.handlers,n=this.view.contentDOM;for(let r in e)if(r!="scroll"){let o=!e[r].handlers.length,l=i[r];l&&o!=!l.handlers.length&&(n.removeEventListener(r,this.handleEvent),l=null),l||n.addEventListener(r,this.handleEvent,{passive:o})}for(let r in i)r!="scroll"&&!e[r]&&n.removeEventListener(r,this.handleEvent);this.handlers=e}keydown(t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&t.keyCode!=27&&LU.indexOf(t.keyCode)<0&&(this.tabFocusMode=-1),C.android&&C.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return this.view.observer.delayAndroidKey(t.key,t.keyCode),!0;let e;return C.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((e=vI.find(i=>i.keyCode==t.keyCode))&&!t.ctrlKey||PU.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=e||t,setTimeout(()=>this.flushIOSKey(),250),!0):(t.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(t){let e=this.pendingIOSKey;return!e||e.key=="Enter"&&t&&t.from<t.to&&/^\S+$/.test(t.insert.toString())?!1:(this.pendingIOSKey=void 0,Zo(this.view.contentDOM,e.key,e.keyCode,e instanceof KeyboardEvent?e:void 0))}ignoreDuringComposition(t){return!/^key/.test(t.type)||t.synthetic?!1:this.composing>0?!0:C.safari&&!C.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.view.observer.update(t),this.mouseSelection&&this.mouseSelection.update(t),this.draggedContent&&t.docChanged&&(this.draggedContent=this.draggedContent.map(t.changes)),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function nM(s,t){return(e,i)=>{try{return t.call(s,i,e)}catch(n){ks(e.state,n)}}}function EU(s){let t=Object.create(null);function e(i){return t[i]||(t[i]={observers:[],handlers:[]})}for(let i of s){let n=i.spec,r=n&&n.plugin.domEventHandlers,o=n&&n.plugin.domEventObservers;if(r)for(let l in r){let h=r[l];h&&e(l).handlers.push(nM(i.value,h))}if(o)for(let l in o){let h=o[l];h&&e(l).observers.push(nM(i.value,h))}}for(let i in Sn)e(i).handlers.push(Sn[i]);for(let i in Pi)e(i).observers.push(Pi[i]);return t}const vI=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],PU="dthko",LU=[16,17,18,20,91,92,224,225],Tf=6;function $f(s){return Math.max(0,s)*.7+8}function VU(s,t){return Math.max(Math.abs(s.clientX-t.clientX),Math.abs(s.clientY-t.clientY))}class IU{constructor(t,e,i,n){this.view=t,this.startEvent=e,this.style=i,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=e,this.scrollParents=zj(t.contentDOM),this.atoms=t.state.facet(Ac).map(o=>o(t));let r=t.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(dt.allowMultipleSelections)&&NU(t,e),this.dragging=FU(t,e)&&CI(e)==1?null:!1}start(t){this.dragging===!1&&this.select(t)}move(t){if(t.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&VU(this.startEvent,t)<10)return;this.select(this.lastEvent=t);let e=0,i=0,n=0,r=0,o=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:n,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:l}=this.scrollParents.y.getBoundingClientRect());let h=pI(this.view);t.clientX-h.left<=n+Tf?e=-$f(n-t.clientX):t.clientX+h.right>=o-Tf&&(e=$f(t.clientX-o)),t.clientY-h.top<=r+Tf?i=-$f(r-t.clientY):t.clientY+h.bottom>=l-Tf&&(i=$f(t.clientY-l)),this.setScrollSpeed(e,i)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(t,e){this.scrollSpeed={x:t,y:e},t||e?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:t,y:e}=this.scrollSpeed;t&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=t,t=0),e&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=e,e=0),(t||e)&&this.view.win.scrollBy(t,e),this.dragging===!1&&this.select(this.lastEvent)}select(t){let{view:e}=this,i=bI(this.atoms,this.style.get(t,this.extend,this.multiple));(this.mustSelect||!i.eq(e.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function NU(s,t){let e=s.state.facet(iI);return e.length?e[0](t):C.mac?t.metaKey:t.ctrlKey}function HU(s,t){let e=s.state.facet(nI);return e.length?e[0](t):C.mac?!t.altKey:!t.ctrlKey}function FU(s,t){let{main:e}=s.state.selection;if(e.empty)return!1;let i=_a(s.root);if(!i||i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function WU(s,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=s.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=tt.get(e))&&i.ignoreEvent(t))return!1;return!0}const Sn=Object.create(null),Pi=Object.create(null),kI=C.ie&&C.ie_version<15||C.ios&&C.webkit_version<604;function zU(s){let t=s.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{s.focus(),e.remove(),AI(s,e.value)},50)}function kg(s,t,e){for(let i of s.facet(t))e=i(e,s);return e}function AI(s,t){t=kg(s.state,xx,t);let{state:e}=s,i,n=1,r=e.toText(t),o=r.lines==e.selection.ranges.length;if(_w!=null&&e.selection.ranges.every(h=>h.empty)&&_w==r.toString()){let h=-1;i=e.changeByRange(a=>{let c=e.doc.lineAt(a.from);if(c.from==h)return{range:a};h=c.from;let f=e.toText((o?r.line(n++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:D.cursor(a.from+f.length)}})}else o?i=e.changeByRange(h=>{let a=r.line(n++);return{changes:{from:h.from,to:h.to,insert:a.text},range:D.cursor(h.from+a.length)}}):i=e.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Pi.scroll=s=>{s.inputState.lastScrollTop=s.scrollDOM.scrollTop,s.inputState.lastScrollLeft=s.scrollDOM.scrollLeft};Sn.keydown=(s,t)=>(s.inputState.setSelectionOrigin("select"),t.keyCode==27&&s.inputState.tabFocusMode!=0&&(s.inputState.tabFocusMode=Date.now()+2e3),!1);Pi.touchstart=(s,t)=>{s.inputState.lastTouchTime=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};Pi.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};Sn.mousedown=(s,t)=>{if(s.observer.flush(),s.inputState.lastTouchTime>Date.now()-2e3)return!1;let e=null;for(let i of s.state.facet(sI))if(e=i(s,t),e)break;if(!e&&t.button==0&&(e=GU(s,t)),e){let i=!s.hasFocus;s.inputState.startMouseSelection(new IU(s,t,e,i)),i&&s.observer.ignore(()=>{H3(s.contentDOM);let r=s.root.activeElement;r&&!r.contains(s.contentDOM)&&r.blur()});let n=s.inputState.mouseSelection;if(n)return n.start(t),n.dragging===!1}else s.inputState.setSelectionOrigin("select.pointer");return!1};function sM(s,t,e,i){if(i==1)return D.cursor(t,e);if(i==2)return mU(s.state,t,e);{let n=zt.find(s.docView,t),r=s.state.doc.lineAt(n?n.posAtEnd:t),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,D.range(o,l)}}let rM=(s,t,e)=>t>=e.top&&t<=e.bottom&&s>=e.left&&s<=e.right;function qU(s,t,e,i){let n=zt.find(s.docView,t);if(!n)return 1;let r=t-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&rM(e,i,o))return-1;let l=n.coordsAt(r,1);return l&&rM(e,i,l)?1:o&&o.bottom>=i?-1:1}function oM(s,t){let e=s.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:qU(s,e,t.clientX,t.clientY)}}const KU=C.ie&&C.ie_version<=11;let lM=null,hM=0,aM=0;function CI(s){if(!KU)return s.detail;let t=lM,e=aM;return lM=s,aM=Date.now(),hM=!t||e>Date.now()-400&&Math.abs(t.clientX-s.clientX)<2&&Math.abs(t.clientY-s.clientY)<2?(hM+1)%3:1}function GU(s,t){let e=oM(s,t),i=CI(t),n=s.state.selection;return{update(r){r.docChanged&&(e.pos=r.changes.mapPos(e.pos),n=n.map(r.changes))},get(r,o,l){let h=oM(s,r),a,c=sM(s,h.pos,h.bias,i);if(e.pos!=h.pos&&!o){let f=sM(s,e.pos,e.bias,i),u=Math.min(f.from,c.from),d=Math.max(f.to,c.to);c=u<c.from?D.range(u,d):D.range(d,u)}return o?n.replaceRange(n.main.extend(c.from,c.to)):l&&i==1&&n.ranges.length>1&&(a=jU(n,h.pos))?a:l?n.addRange(c):D.create([c])}}}function jU(s,t){for(let e=0;e<s.ranges.length;e++){let{from:i,to:n}=s.ranges[e];if(i<=t&&n>=t)return D.create(s.ranges.slice(0,e).concat(s.ranges.slice(e+1)),s.mainIndex==e?0:s.mainIndex-(s.mainIndex>e?1:0))}return null}Sn.dragstart=(s,t)=>{let{selection:{main:e}}=s.state;if(t.target.draggable){let n=s.docView.nearest(t.target);if(n&&n.isWidget){let r=n.posAtStart,o=r+n.length;(r>=e.to||o<=e.from)&&(e=D.range(r,o))}}let{inputState:i}=s;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=e,t.dataTransfer&&(t.dataTransfer.setData("Text",kg(s.state,Sx,s.state.sliceDoc(e.from,e.to))),t.dataTransfer.effectAllowed="copyMove"),!1};Sn.dragend=s=>(s.inputState.draggedContent=null,!1);function cM(s,t,e,i){if(e=kg(s.state,xx,e),!e)return;let n=s.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:r}=s.inputState,o=i&&r&&HU(s,t)?{from:r.from,to:r.to}:null,l={from:n,insert:e},h=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"}),s.inputState.draggedContent=null}Sn.drop=(s,t)=>{if(!t.dataTransfer)return!1;if(s.state.readOnly)return!0;let e=t.dataTransfer.files;if(e&&e.length){let i=Array(e.length),n=0,r=()=>{++n==e.length&&cM(s,t,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(e[o])}return!0}else{let i=t.dataTransfer.getData("Text");if(i)return cM(s,t,i,!0),!0}return!1};Sn.paste=(s,t)=>{if(s.state.readOnly)return!0;s.observer.flush();let e=kI?null:t.clipboardData;return e?(AI(s,e.getData("text/plain")||e.getData("text/uri-list")),!0):(zU(s),!1)};function UU(s,t){let e=s.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function JU(s){let t=[],e=[],i=!1;for(let n of s.selection.ranges)n.empty||(t.push(s.sliceDoc(n.from,n.to)),e.push(n));if(!t.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(t.push(o.text),e.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:kg(s,Sx,t.join(s.lineBreak)),ranges:e,linewise:i}}let _w=null;Sn.copy=Sn.cut=(s,t)=>{let{text:e,ranges:i,linewise:n}=JU(s.state);if(!e&&!n)return!1;_w=n?e:null,t.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let r=kI?null:t.clipboardData;return r?(r.clearData(),r.setData("text/plain",e),!0):(UU(s,e),!1)};const MI=$l.define();function DI(s,t){let e=[];for(let i of s.facet(lI)){let n=i(s,t);n&&e.push(n)}return e.length?s.update({effects:e,annotations:MI.of(!0)}):null}function OI(s){setTimeout(()=>{let t=s.hasFocus;if(t!=s.inputState.notifiedFocused){let e=DI(s.state,t);e?s.dispatch(e):s.update([])}},10)}Pi.focus=s=>{s.inputState.lastFocusTime=Date.now(),!s.scrollDOM.scrollTop&&(s.inputState.lastScrollTop||s.inputState.lastScrollLeft)&&(s.scrollDOM.scrollTop=s.inputState.lastScrollTop,s.scrollDOM.scrollLeft=s.inputState.lastScrollLeft),OI(s)};Pi.blur=s=>{s.observer.clearSelectionRange(),OI(s)};Pi.compositionstart=Pi.compositionupdate=s=>{s.observer.editContext||(s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0))};Pi.compositionend=s=>{s.observer.editContext||(s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionPendingKey=!0,s.inputState.compositionPendingChange=s.observer.pendingRecords().length>0,s.inputState.compositionFirstChange=null,C.chrome&&C.android?s.observer.flushSoon():s.inputState.compositionPendingChange?Promise.resolve().then(()=>s.observer.flush()):setTimeout(()=>{s.inputState.composing<0&&s.docView.hasComposition&&s.update([])},50))};Pi.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};Sn.beforeinput=(s,t)=>{var e,i;if(t.inputType=="insertReplacementText"&&s.observer.editContext){let r=(e=t.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain"),o=t.getTargetRanges();if(r&&o.length){let l=o[0],h=s.posAtDOM(l.startContainer,l.startOffset),a=s.posAtDOM(l.endContainer,l.endOffset);return kx(s,{from:h,to:a,insert:s.state.toText(r)},null),!0}}let n;if(C.chrome&&C.android&&(n=vI.find(r=>r.inputType==t.inputType))&&(s.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let r=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>r+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}return C.ios&&t.inputType=="deleteContentForward"&&s.observer.flushSoon(),C.safari&&t.inputType=="insertText"&&s.inputState.composing>=0&&setTimeout(()=>Pi.compositionend(s,t),20),!1};const fM=new Set;function YU(s){fM.has(s)||(fM.add(s),s.addEventListener("copy",()=>{}),s.addEventListener("cut",()=>{}))}const uM=["pre-wrap","normal","pre-line","break-spaces"];let vl=!1;function dM(){vl=!1}class XU{constructor(t){this.lineWrapping=t,this.doc=X.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return uM.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let n=t[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(e=!0,this.heightSamples[Math.floor(n*10)]=!0)}return e}refresh(t,e,i,n,r,o){let l=uM.indexOf(t)>-1,h=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=e,this.charWidth=i,this.textHeight=n,this.lineLength=r,h){this.heightSamples={};for(let a=0;a<o.length;a++){let c=o[a];c<0?a++:this.heightSamples[Math.floor(c*10)]=!0}}return h}}class ZU{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class jn{constructor(t,e,i,n,r){this.from=t,this.length=e,this.top=i,this.height=n,this._content=r}get type(){return typeof this._content=="number"?ns.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof rr?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(t){let e=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new jn(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var ut=(function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s})(ut||(ut={}));const ju=.001;class ze{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t){this.height!=t&&(Math.abs(this.height-t)>ju&&(vl=!0),this.height=t)}replace(t,e,i){return ze.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,n){let r=this,o=i.doc;for(let l=n.length-1;l>=0;l--){let{fromA:h,toA:a,fromB:c,toB:f}=n[l],u=r.lineAt(h,ut.ByPosNoHeight,i.setDoc(e),0,0),d=u.to>=a?u:r.lineAt(a,ut.ByPosNoHeight,i,0,0);for(f+=d.to-a,a=d.to;l>0&&u.from<=n[l-1].toA;)h=n[l-1].fromA,c=n[l-1].fromB,l--,h<u.from&&(u=r.lineAt(h,ut.ByPosNoHeight,i,0,0));c+=u.from-h,h=u.from;let g=Ax.build(i.setDoc(o),t,c,f);r=Kd(r,r.replace(h,a,g))}return r.updateHeight(i,0)}static empty(){return new pi(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,n=0,r=0;for(;;)if(e==i)if(n>r*2){let l=t[e-1];l.break?t.splice(--e,1,l.left,null,l.right):t.splice(--e,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=t[i];l.break?t.splice(i,1,l.left,null,l.right):t.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=t[e++];l&&(n+=l.size)}else{let l=t[--i];l&&(r+=l.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new QU(ze.of(t.slice(0,e)),o,ze.of(t.slice(i)))}}function Kd(s,t){return s==t?s:(s.constructor!=t.constructor&&(vl=!0),t)}ze.prototype.size=1;class TI extends ze{constructor(t,e,i){super(t,e),this.deco=i}blockAt(t,e,i,n){return new jn(n,this.length,i,this.height,this.deco||0)}lineAt(t,e,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(t,e,i,n,r,o){t<=r+this.length&&e>=r&&o(this.blockAt(0,i,n,r))}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more&&this.setHeight(n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class pi extends TI{constructor(t,e){super(t,e,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(t,e,i,n){return new jn(n,this.length,i,this.height,this.breaks)}replace(t,e,i){let n=i[0];return i.length==1&&(n instanceof pi||n instanceof ge&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof ge?n=new pi(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):ze.of(i)}updateHeight(t,e=0,i=!1,n){return n&&n.from<=e&&n.more?this.setHeight(n.heights[n.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))+this.breaks*t.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ge extends ze{constructor(t){super(t,0)}heightMetrics(t,e){let i=t.doc.lineAt(e).number,n=t.doc.lineAt(e+this.length).number,r=n-i+1,o,l=0;if(t.lineWrapping){let h=Math.min(this.height,t.lineHeight*r);o=h/r,this.length>r+1&&(l=(this.height-h)/(this.length-r-1))}else o=this.height/r;return{firstLine:i,lastLine:n,perLine:o,perChar:l}}blockAt(t,e,i,n){let{firstLine:r,lastLine:o,perLine:l,perChar:h}=this.heightMetrics(e,n);if(e.lineWrapping){let a=n+(t<e.lineHeight?0:Math.round(Math.max(0,Math.min(1,(t-i)/this.height))*this.length)),c=e.doc.lineAt(a),f=l+c.length*h,u=Math.max(i,t-f/2);return new jn(c.from,c.length,u,f,0)}else{let a=Math.max(0,Math.min(o-r,Math.floor((t-i)/l))),{from:c,length:f}=e.doc.line(r+a);return new jn(c,f,i+l*a,l,0)}}lineAt(t,e,i,n,r){if(e==ut.ByHeight)return this.blockAt(t,i,n,r);if(e==ut.ByPosNoHeight){let{from:d,to:g}=i.doc.lineAt(t);return new jn(d,g-d,0,0,0)}let{firstLine:o,perLine:l,perChar:h}=this.heightMetrics(i,r),a=i.doc.lineAt(t),c=l+a.length*h,f=a.number-o,u=n+l*f+h*(a.from-r-f);return new jn(a.from,a.length,Math.max(n,Math.min(u,n+this.height-c)),c,0)}forEachLine(t,e,i,n,r,o){t=Math.max(t,r),e=Math.min(e,r+this.length);let{firstLine:l,perLine:h,perChar:a}=this.heightMetrics(i,r);for(let c=t,f=n;c<=e;){let u=i.doc.lineAt(c);if(c==t){let g=u.number-l;f+=h*g+a*(t-r-g)}let d=h+a*u.length;o(new jn(u.from,u.length,f,d,0)),f+=d,c=u.to+1}}replace(t,e,i){let n=this.length-e;if(n>0){let r=i[i.length-1];r instanceof ge?i[i.length-1]=new ge(r.length+n):i.push(null,new ge(n-1))}if(t>0){let r=i[0];r instanceof ge?i[0]=new ge(t+r.length):i.unshift(new ge(t-1),null)}return ze.of(i)}decomposeLeft(t,e){e.push(new ge(t-1),null)}decomposeRight(t,e){e.push(null,new ge(this.length-t-1))}updateHeight(t,e=0,i=!1,n){let r=e+this.length;if(n&&n.from<=e+this.length&&n.more){let o=[],l=Math.max(e,n.from),h=-1;for(n.from>e&&o.push(new ge(n.from-e-1).updateHeight(t,e));l<=r&&n.more;){let c=t.doc.lineAt(l).length;o.length&&o.push(null);let f=n.heights[n.index++];h==-1?h=f:Math.abs(f-h)>=ju&&(h=-2);let u=new pi(c,f);u.outdated=!1,o.push(u),l+=c+1}l<=r&&o.push(null,new ge(r-l).updateHeight(t,l));let a=ze.of(o);return(h<0||Math.abs(a.height-this.height)>=ju||Math.abs(h-this.heightMetrics(t,e).perLine)>=ju)&&(vl=!0),Kd(this,a)}else(i||this.outdated)&&(this.setHeight(t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class QU extends ze{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,n){let r=i+this.left.height;return t<r?this.left.blockAt(t,e,i,n):this.right.blockAt(t,e,r,n+this.left.length+this.break)}lineAt(t,e,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,h=e==ut.ByHeight?t<o:t<l,a=h?this.left.lineAt(t,e,i,n,r):this.right.lineAt(t,e,i,o,l);if(this.break||(h?a.to<l:a.from>l))return a;let c=e==ut.ByPosNoHeight?ut.ByPosNoHeight:ut.ByPos;return h?a.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(a)}forEachLine(t,e,i,n,r,o){let l=n+this.left.height,h=r+this.left.length+this.break;if(this.break)t<h&&this.left.forEachLine(t,e,i,n,r,o),e>=h&&this.right.forEachLine(t,e,i,l,h,o);else{let a=this.lineAt(h,ut.ByPos,i,n,r);t<a.from&&this.left.forEachLine(t,a.from-1,i,n,r,o),a.to>=t&&a.from<=e&&o(a),e>a.to&&this.right.forEachLine(a.to+1,e,i,l,h,o)}}replace(t,e,i){let n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,i));let r=[];t>0&&this.decomposeLeft(t,r);let o=r.length;for(let l of i)r.push(l);if(t>0&&gM(r,o-1),e<this.length){let l=r.length;this.decomposeRight(e,r),gM(r,l)}return ze.of(r)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,n=i+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<n&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?ze.of(this.break?[t,null,e]:[t,e]):(this.left=Kd(this.left,t),this.right=Kd(this.right,e),this.setHeight(t.height+e.height),this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,n){let{left:r,right:o}=this,l=e+r.length+this.break,h=null;return n&&n.from<=e+r.length&&n.more?h=r=r.updateHeight(t,e,i,n):r.updateHeight(t,e,i),n&&n.from<=l+o.length&&n.more?h=o=o.updateHeight(t,l,i,n):o.updateHeight(t,l,i),h?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function gM(s,t){let e,i;s[t]==null&&(e=s[t-1])instanceof ge&&(i=s[t+1])instanceof ge&&s.splice(t-1,3,new ge(e.length+1+i.length))}const _U=5;class Ax{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof pi?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new pi(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let o=e-t;i.block?this.addBlock(new TI(o,n,i)):(o||r||n>=_U)&&this.addLineDeco(n,r,o)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new pi(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new ge(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof pi)return t;let e=new pi(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine();let e=t.deco;e&&e.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,e&&e.endSide>0&&(this.covering=t)}addLineDeco(t,e,i){let n=this.ensureLine();n.length+=i,n.collapsed+=i,n.widgetHeight=Math.max(n.widgetHeight,t),n.breaks+=e,this.writtenTo=this.pos=this.pos+i}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof pi)&&!this.isCovered?this.nodes.push(new pi(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let n of this.nodes)n instanceof pi&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(t,e,i,n){let r=new Ax(i,t);return gt.spans(e,i,n,r,0),r.finish(i)}}function tJ(s,t,e){let i=new eJ;return gt.compare(s,t,e,i,0),i.changes}class eJ{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,n){(t<e||i&&i.heightRelevant||n&&n.heightRelevant)&&Gu(t,e,this.changes,5)}}function iJ(s,t){let e=s.getBoundingClientRect(),i=s.ownerDocument,n=i.defaultView||window,r=Math.max(0,e.left),o=Math.min(n.innerWidth,e.right),l=Math.max(0,e.top),h=Math.min(n.innerHeight,e.bottom);for(let a=s.parentNode;a&&a!=i.body;)if(a.nodeType==1){let c=a,f=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&f.overflow!="visible"){let u=c.getBoundingClientRect();r=Math.max(r,u.left),o=Math.min(o,u.right),l=Math.max(l,u.top),h=Math.min(a==s.parentNode?n.innerHeight:h,u.bottom)}a=f.position=="absolute"||f.position=="fixed"?c.offsetParent:c.parentNode}else if(a.nodeType==11)a=a.host;else break;return{left:r-e.left,right:Math.max(r,o)-e.left,top:l-(e.top+t),bottom:Math.max(l,h)-(e.top+t)}}function nJ(s){let t=s.getBoundingClientRect(),e=s.ownerDocument.defaultView||window;return t.left<e.innerWidth&&t.right>0&&t.top<e.innerHeight&&t.bottom>0}function sJ(s,t){let e=s.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}class Gp{constructor(t,e,i,n){this.from=t,this.to=e,this.size=i,this.displaySize=n}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(t,e){return Oi.replace({widget:new rJ(this.displaySize*(e?t.scaleY:t.scaleX),e)}).range(this.from,this.to)}}class rJ extends wx{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class pM{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=mM,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Fe.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let e=t.facet(vx).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new XU(e),this.stateDeco=t.facet(ic).filter(i=>typeof i!="function"),this.heightMap=ze.empty().applyChanges(this.stateDeco,X.empty,this.heightOracle.setDoc(t.doc),[new Bi(0,0,0,t.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Oi.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let n=i?e.head:e.anchor;if(!t.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);t.push(new Rf(r,o))}}return this.viewports=t.sort((i,n)=>i.from-n.from),this.updateScaler()}updateScaler(){let t=this.scaler;return this.scaler=this.heightMap.height<=7e6?mM:new Cx(this.heightOracle,this.heightMap,this.viewports),t.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(Th(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(ic).filter(c=>typeof c!="function");let n=t.changedRanges,r=Bi.extendWithRanges(n,tJ(i,this.stateDeco,t?t.changes:re.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);dM(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),r),(this.heightMap.height!=o||vl)&&(t.flags|=2),l?(this.scrollAnchorPos=t.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let h=r.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<h.from||e.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,e));let a=h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,t.flags|=this.updateForViewport(),(a||!t.changes.empty||t.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(t.changes),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(lU)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?Fe.RTL:Fe.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=e.getBoundingClientRect(),h=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let a=0,c=0;if(l.width&&l.height){let{scaleX:b,scaleY:S}=N3(e,l);(b>.005&&Math.abs(this.scaleX-b)>.005||S>.005&&Math.abs(this.scaleY-S)>.005)&&(this.scaleX=b,this.scaleY=S,a|=16,o=h=!0)}let f=(parseInt(i.paddingTop)||0)*this.scaleY,u=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=f||this.paddingBottom!=u)&&(this.paddingTop=f,this.paddingBottom=u,a|=18),this.editorWidth!=t.scrollDOM.clientWidth&&(n.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,a|=16);let d=t.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=W3(t.scrollDOM);let g=(this.printing?sJ:iJ)(e,this.paddingTop),m=g.top-this.pixelViewport.top,p=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let y=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(y!=this.inView&&(this.inView=y,y&&(h=!0)),!this.inView&&!this.scrollTarget&&!nJ(t.dom))return 0;let w=l.width;if((this.contentDOMWidth!=w||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=t.scrollDOM.clientHeight,a|=16),h){let b=t.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(b)&&(o=!0),o||n.lineWrapping&&Math.abs(w-this.contentDOMWidth)>n.charWidth){let{lineHeight:S,charWidth:v,textHeight:L}=t.docView.measureTextSize();o=S>0&&n.refresh(r,S,v,L,Math.max(5,w/v),b),o&&(t.docView.minWidth=0,a|=16)}m>0&&p>0?c=Math.max(m,p):m<0&&p<0&&(c=Math.min(m,p)),dM();for(let S of this.viewports){let v=S.from==this.viewport.from?b:t.docView.measureVisibleLineHeights(S);this.heightMap=(o?ze.empty().applyChanges(this.stateDeco,X.empty,this.heightOracle,[new Bi(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(n,0,o,new ZU(S.from,v))}vl&&(a|=2)}let x=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return x&&(a&2&&(a|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),a|=this.updateForViewport()),(a&2||x)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,t)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),n=this.heightMap,r=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,h=new Rf(n.lineAt(o-i*1e3,ut.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,ut.ByHeight,r,0,0).to);if(e){let{head:a}=e.range;if(a<h.from||a>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(a,ut.ByPos,r,0,0),u;e.y=="center"?u=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&a<h.from?u=f.top:u=f.bottom-c,h=new Rf(n.lineAt(u-1e3/2,ut.ByHeight,r,0,0).from,n.lineAt(u+c+1e3/2,ut.ByHeight,r,0,0).to)}}return h}mapViewport(t,e){let i=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new Rf(this.heightMap.lineAt(i,ut.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,ut.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(t,ut.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(e,ut.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||n<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let n of t)e.touchesRange(n.from,n.to)||i.push(new Gp(e.mapPos(n.from),e.mapPos(n.to),n.size,n.displaySize));return i}ensureLineGaps(t,e){let i=this.heightOracle.lineWrapping,n=i?1e4:2e3,r=n>>1,o=n<<1;if(this.defaultTextDirection!=Fe.LTR&&!i)return[];let l=[],h=(c,f,u,d)=>{if(f-c<r)return;let g=this.state.selection.main,m=[g.from];g.empty||m.push(g.to);for(let y of m)if(y>c&&y<f){h(c,y-10,u,d),h(y+10,f,u,d);return}let p=lJ(t,y=>y.from>=u.from&&y.to<=u.to&&Math.abs(y.from-c)<r&&Math.abs(y.to-f)<r&&!m.some(w=>y.from<w&&y.to>w));if(!p){if(f<u.to&&e&&i&&e.visibleRanges.some(x=>x.from<=f&&x.to>=f)){let x=e.moveToLineBoundary(D.cursor(f),!1,!0).head;x>c&&(f=x)}let y=this.gapSize(u,c,f,d),w=i||y<2e6?y:2e6;p=new Gp(c,f,y,w)}l.push(p)},a=c=>{if(c.length<o||c.type!=ns.Text)return;let f=oJ(c.from,c.to,this.stateDeco);if(f.total<o)return;let u=this.scrollTarget?this.scrollTarget.range.head:null,d,g;if(i){let m=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,p,y;if(u!=null){let w=Ef(f,u),x=((this.visibleBottom-this.visibleTop)/2+m)/c.height;p=w-x,y=w+x}else p=(this.visibleTop-c.top-m)/c.height,y=(this.visibleBottom-c.top+m)/c.height;d=Bf(f,p),g=Bf(f,y)}else{let m=f.total*this.heightOracle.charWidth,p=n*this.heightOracle.charWidth,y=0;if(m>2e6)for(let v of t)v.from>=c.from&&v.from<c.to&&v.size!=v.displaySize&&v.from*this.heightOracle.charWidth+y<this.pixelViewport.left&&(y=v.size-v.displaySize);let w=this.pixelViewport.left+y,x=this.pixelViewport.right+y,b,S;if(u!=null){let v=Ef(f,u),L=((x-w)/2+p)/m;b=v-L,S=v+L}else b=(w-p)/m,S=(x+p)/m;d=Bf(f,b),g=Bf(f,S)}d>c.from&&h(c.from,d,c,f),g<c.to&&h(g,c.to,c,f)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(a):a(c);return l}gapSize(t,e,i,n){let r=Ef(n,i)-Ef(n,e);return this.heightOracle.lineWrapping?t.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(t){Gp.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Oi.set(t.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(t){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let i=[];gt.spans(e,this.viewport.from,this.viewport.to,{span(r,o){i.push({from:r,to:o})},point(){}},20);let n=0;if(i.length!=this.visibleRanges.length)n=12;else for(let r=0;r<i.length&&!(n&8);r++){let o=this.visibleRanges[r],l=i[r];(o.from!=l.from||o.to!=l.to)&&(n|=4,t&&t.mapPos(o.from,-1)==l.from&&t.mapPos(o.to,1)==l.to||(n|=8))}return this.visibleRanges=i,n}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||Th(this.heightMap.lineAt(t,ut.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return t>=this.viewportLines[0].top&&t<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(e=>e.top<=t&&e.bottom>=t)||Th(this.heightMap.lineAt(this.scaler.fromDOM(t),ut.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(t){let e=this.lineBlockAtHeight(t+8);return e.from>=this.viewport.from||this.viewportLines[0].top-t>200?e:this.viewportLines[0]}elementAtHeight(t){return Th(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Rf{constructor(t,e){this.from=t,this.to=e}}function oJ(s,t,e){let i=[],n=s,r=0;return gt.spans(e,s,t,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<t&&(i.push({from:n,to:t}),r+=t-n),{total:r,ranges:i}}function Bf({total:s,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(s*e);for(let n=0;;n++){let{from:r,to:o}=t[n],l=o-r;if(i<=l)return r+i;i-=l}}function Ef(s,t){let e=0;for(let{from:i,to:n}of s.ranges){if(t<=n){e+=t-i;break}e+=n-i}return e/s.total}function lJ(s,t){for(let e of s)if(t(e))return e}const mM={toDOM(s){return s},fromDOM(s){return s},scale:1,eq(s){return s==this}};class Cx{constructor(t,e,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:h})=>{let a=e.lineAt(l,ut.ByPos,t,0,0).top,c=e.lineAt(h,ut.ByPos,t,0,0).bottom;return n+=c-a,{from:l,to:h,top:a,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(e.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.top)return n+(t-i)*this.scale;if(t<=r.bottom)return r.domTop+(t-r.top);i=r.bottom,n=r.domBottom}}fromDOM(t){for(let e=0,i=0,n=0;;e++){let r=e<this.viewports.length?this.viewports[e]:null;if(!r||t<r.domTop)return i+(t-n)/this.scale;if(t<=r.domBottom)return r.top+(t-r.domTop);i=r.bottom,n=r.domBottom}}eq(t){return t instanceof Cx?this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((e,i)=>e.from==t.viewports[i].from&&e.to==t.viewports[i].to):!1}}function Th(s,t){if(t.scale==1)return s;let e=t.toDOM(s.top),i=t.toDOM(s.bottom);return new jn(s.from,s.length,e,i-e,Array.isArray(s._content)?s._content.map(n=>Th(n,t)):s._content)}const Pf=F.define({combine:s=>s.join(" ")}),tb=F.define({combine:s=>s.indexOf(!0)>-1}),eb=I.newName(),$I=I.newName(),RI=I.newName(),BI={"&light":"."+$I,"&dark":"."+RI};function ib(s,t,e){return new I(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!e||!e[n])throw new RangeError(`Unsupported selector: ${n}`);return e[n]}):s+" "+i}})}const hJ=ib("."+eb,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},BI),aJ={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},jp=C.ie&&C.ie_version<=11;class cJ{constructor(t){this.view=t,this.active=!1,this.editContext=null,this.selectionRange=new qj,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(e=>{for(let i of e)this.queue.push(i);(C.ie&&C.ie_version<=11||C.ios&&t.composing)&&e.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&C.android&&t.constructor.EDIT_CONTEXT!==!1&&!(C.chrome&&C.chrome_version<126)&&(this.editContext=new uJ(t),t.state.facet(gs)&&(t.contentDOM.editContext=this.editContext.editContext)),jp&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var e;((e=this.view.docView)===null||e===void 0?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runHandlers("scroll",t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(t){(t.type=="change"||!t.type)&&!t.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,n=this.selectionRange;if(i.state.facet(gs)?i.root.activeElement!=this.dom:!Ku(this.dom,n))return;let r=n.anchorNode&&i.docView.nearest(n.anchorNode);if(r&&r.ignoreEvent(t)){e||(this.selectionChanged=!1);return}(C.ie&&C.ie_version<=11||C.android&&C.chrome)&&!i.state.selection.main.empty&&n.focusNode&&na(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=_a(t.root);if(!e)return!1;let i=C.safari&&t.root.nodeType==11&&t.root.activeElement==this.dom&&fJ(this.view,e)||e;if(!i||this.selectionRange.eq(i))return!1;let n=Ku(this.dom,i);return n&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&Gj(this.dom,i)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(i),n&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,aJ),jp&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),jp&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var i;if(!this.delayedAndroidKey){let n=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&Zo(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){let t=this.pendingRecords();t.length&&(this.queue=[]);let e=-1,i=-1,n=!1;for(let r of t){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:n}}readChange(){let{from:t,to:e,typeOver:i}=this.processRecords(),n=this.selectionChanged&&Ku(this.dom,this.selectionRange);if(t<0&&!n)return null;t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new OU(this.view,t,e,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let e=this.readChange();if(!e)return this.view.requestMeasure(),!1;let i=this.view.state,n=xI(this.view,e);return this.view.state==i&&(e.domChanged||e.newSel&&!e.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),n}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.flags|=4),t.type=="childList"){let i=yM(e,t.previousSibling||t.target.previousSibling,-1),n=yM(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}update(t){this.editContext&&(this.editContext.update(t),t.startState.facet(gs)!=t.state.facet(gs)&&(t.view.contentDOM.editContext=t.state.facet(gs)?this.editContext.editContext:null))}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function yM(s,t,e){for(;t;){let i=tt.get(t);if(i&&i.parent==s)return i;let n=t.parentNode;t=n!=s.dom?n:e>0?t.nextSibling:t.previousSibling}return null}function wM(s,t){let e=t.startContainer,i=t.startOffset,n=t.endContainer,r=t.endOffset,o=s.docView.domAtPos(s.state.selection.main.anchor);return na(o.node,o.offset,n,r)&&([e,i,n,r]=[n,r,e,i]),{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}}function fJ(s,t){if(t.getComposedRanges){let n=t.getComposedRanges(s.root)[0];if(n)return wM(s,n)}let e=null;function i(n){n.preventDefault(),n.stopImmediatePropagation(),e=n.getTargetRanges()[0]}return s.contentDOM.addEventListener("beforeinput",i,!0),s.dom.ownerDocument.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",i,!0),e?wM(s,e):null}class uJ{constructor(t){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(t.state);let e=this.editContext=new window.EditContext({text:t.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,t.state.selection.main.anchor))),selectionEnd:this.toContextPos(t.state.selection.main.head)});this.handlers.textupdate=i=>{let n=t.state.selection.main,{anchor:r,head:o}=n,l=this.toEditorPos(i.updateRangeStart),h=this.toEditorPos(i.updateRangeEnd);t.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:i.updateRangeStart,editorBase:l,drifted:!1});let a=h-l>i.text.length;l==this.from&&r<this.from?l=r:h==this.to&&r>this.to&&(h=r);let c=SI(t.state.sliceDoc(l,h),i.text,(a?n.from:n.to)-l,a?"end":null);if(!c){let u=D.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd));u.main.eq(n)||t.dispatch({selection:u,userEvent:"select"});return}let f={from:c.from+l,to:c.toA+l,insert:X.of(i.text.slice(c.from,c.toB).split(`
`))};if((C.mac||C.android)&&f.from==o-1&&/^\. ?$/.test(i.text)&&t.contentDOM.getAttribute("autocorrect")=="off"&&(f={from:l,to:h,insert:X.of([i.text.replace("."," ")])}),this.pendingContextChange=f,!t.state.readOnly){let u=this.to-this.from+(f.to-f.from+f.insert.length);kx(t,f,D.single(this.toEditorPos(i.selectionStart,u),this.toEditorPos(i.selectionEnd,u)))}this.pendingContextChange&&(this.revertPending(t.state),this.setSelection(t.state)),f.from<f.to&&!f.insert.length&&t.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(e.text.slice(Math.max(0,i.updateRangeStart-1),Math.min(e.text.length,i.updateRangeStart+1)))&&this.handlers.compositionend(i)},this.handlers.characterboundsupdate=i=>{let n=[],r=null;for(let o=this.toEditorPos(i.rangeStart),l=this.toEditorPos(i.rangeEnd);o<l;o++){let h=t.coordsForChar(o);r=h&&new DOMRect(h.left,h.top,h.right-h.left,h.bottom-h.top)||r||new DOMRect,n.push(r)}e.updateCharacterBounds(i.rangeStart,n)},this.handlers.textformatupdate=i=>{let n=[];for(let r of i.getTextFormats()){let o=r.underlineStyle,l=r.underlineThickness;if(!/none/i.test(o)&&!/none/i.test(l)){let h=this.toEditorPos(r.rangeStart),a=this.toEditorPos(r.rangeEnd);if(h<a){let c=`text-decoration: underline ${/^[a-z]/.test(o)?o+" ":o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${/thin/i.test(l)?1:2}px`;n.push(Oi.mark({attributes:{style:c}}).range(h,a))}}}t.dispatch({effects:cI.of(Oi.set(n))})},this.handlers.compositionstart=()=>{t.inputState.composing<0&&(t.inputState.composing=0,t.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(t.inputState.composing=-1,t.inputState.compositionFirstChange=null,this.composing){let{drifted:i}=this.composing;this.composing=null,i&&this.reset(t.state)}};for(let i in this.handlers)e.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let n=_a(i.root);n&&n.rangeCount&&this.editContext.updateSelectionBounds(n.getRangeAt(0).getBoundingClientRect())}}}applyEdits(t){let e=0,i=!1,n=this.pendingContextChange;return t.changes.iterChanges((r,o,l,h,a)=>{if(i)return;let c=a.length-(o-r);if(n&&o>=n.to)if(n.from==r&&n.to==o&&n.insert.eq(a)){n=this.pendingContextChange=null,e+=c,this.to+=c;return}else n=null,this.revertPending(t.state);if(r+=e,o+=e,o<=this.from)this.from+=c,this.to+=c;else if(r<this.to){if(r<this.from||o>this.to||this.to-this.from+a.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(r),this.toContextPos(o),a.toString()),this.to+=c}e+=c}),n&&!i&&this.revertPending(t.state),!i}update(t){let e=this.pendingContextChange,i=t.startState.selection.main;this.composing&&(this.composing.drifted||!t.changes.touchesRange(i.from,i.to)&&t.transactions.some(n=>!n.isUserEvent("input.type")&&n.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=t.changes.mapPos(this.composing.editorBase)):!this.applyEdits(t)||!this.rangeIsValid(t.state)?(this.pendingContextChange=null,this.reset(t.state)):(t.docChanged||t.selectionSet||e)&&this.setSelection(t.state),(t.geometryChanged||t.docChanged||t.selectionSet)&&t.view.requestMeasure(this.measureReq)}resetRange(t){let{head:e}=t.selection.main;this.from=Math.max(0,e-1e4),this.to=Math.min(t.doc.length,e+1e4)}reset(t){this.resetRange(t),this.editContext.updateText(0,this.editContext.text.length,t.doc.sliceString(this.from,this.to)),this.setSelection(t)}revertPending(t){let e=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(e.from),this.toContextPos(e.from+e.insert.length),t.doc.sliceString(e.from,e.to))}setSelection(t){let{main:e}=t.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,e.anchor))),n=this.toContextPos(e.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=n)&&this.editContext.updateSelection(i,n)}rangeIsValid(t){let{head:e}=t.selection.main;return!(this.from>0&&e-this.from<500||this.to<t.doc.length&&this.to-e<500||this.to-this.from>1e4*3)}toEditorPos(t,e=this.to-this.from){t=Math.min(t,e);let i=this.composing;return i&&i.drifted?i.editorBase+(t-i.contextBase):t+this.from}toContextPos(t){let e=this.composing;return e&&e.drifted?e.contextBase+(t-e.editorBase):t-this.from}destroy(){for(let t in this.handlers)this.editContext.removeEventListener(t,this.handlers[t])}}class _{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){var e;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),t.parent&&t.parent.appendChild(this.dom);let{dispatch:i}=t;this.dispatchTransactions=t.dispatchTransactions||i&&(n=>n.forEach(r=>i(r,this)))||(n=>this.update(n)),this.dispatch=this.dispatch.bind(this),this._root=t.root||Kj(t.parent)||document,this.viewState=new pM(t.state||dt.create(t)),t.scrollTo&&t.scrollTo.is(Of)&&(this.viewState.scrollTarget=t.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(ko).map(n=>new zp(n));for(let n of this.plugins)n.update(this);this.observer=new cJ(this),this.inputState=new BU(this),this.inputState.ensureHandlers(this.plugins),this.docView=new XC(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((e=document.fonts)===null||e===void 0)&&e.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...t){let e=t.length==1&&t[0]instanceof Te?t:t.length==1&&Array.isArray(t[0])?t[0]:[this.state.update(...t)];this.dispatchTransactions(e,this)}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,n,r=this.state;for(let u of t){if(u.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=u.state}if(this.destroyed){this.viewState.state=r;return}let o=this.hasFocus,l=0,h=null;t.some(u=>u.annotation(MI))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,h=DI(r,o),h||(l=1));let a=this.observer.delayedAndroidKey,c=null;if(a?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(c=null)):this.observer.clear(),r.facet(dt.phrases)!=this.state.facet(dt.phrases))return this.setState(r);n=qd.create(this,r,t),n.flags|=l;let f=this.viewState.scrollTarget;try{this.updateState=2;for(let u of t){if(f&&(f=f.map(u.changes)),u.scrollIntoView){let{main:d}=u.state.selection;f=new Qo(d.empty?d:D.cursor(d.head,d.head>d.anchor?-1:1))}for(let d of u.effects)d.is(Of)&&(f=d.value.clip(this.state))}this.viewState.update(n,f),this.bidiCache=Gd.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),e=this.docView.update(n),this.state.facet(Dh)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(u=>u.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Pf)!=n.state.facet(Pf)&&(this.viewState.mustMeasureContent=!0),(e||i||f||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),e&&this.docViewUpdate(),!n.empty)for(let u of this.state.facet(Zw))try{u(n)}catch(d){ks(this.state,d,"update listener")}(h||c)&&Promise.resolve().then(()=>{h&&this.state==h.startState&&this.dispatch(h),c&&!xI(this,c)&&a.force&&Zo(this.contentDOM,a.key,a.keyCode)})}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new pM(t),this.plugins=t.facet(ko).map(i=>new zp(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new XC(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ko),i=t.state.facet(ko);if(e!=i){let n=[];for(let r of i){let o=e.indexOf(r);if(o<0)n.push(new zp(r));else{let l=this.plugins[o];l.mustUpdate=t,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=t&&r.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=t;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);e!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let e=t.value;if(e&&e.docViewUpdate)try{e.docViewUpdate(this)}catch(i){ks(this.state,i,"doc view update listener")}}}measure(t=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,i=this.scrollDOM,n=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:o}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if(W3(i))r=-1,o=this.viewState.heightMap.height;else{let d=this.viewState.scrollAnchorAt(n);r=d.from,o=d.top}this.updateState=1;let h=this.viewState.measure(this);if(!h&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let a=[];h&4||([this.measureRequests,a]=[a,this.measureRequests]);let c=a.map(d=>{try{return d.read(this)}catch(g){return ks(this.state,g),bM}}),f=qd.create(this,this.state,[]),u=!1;f.flags|=h,e?e.flags|=h:e=f,this.updateState=2,f.empty||(this.updatePlugins(f),this.inputState.update(f),this.updateAttrs(),u=this.docView.update(f),u&&this.docViewUpdate());for(let d=0;d<a.length;d++)if(c[d]!=bM)try{let g=a[d];g.write&&g.write(c[d],this)}catch(g){ks(this.state,g)}if(u&&this.docView.updateSelection(!0),!f.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-o;if(g>1||g<-1){n=n+g,i.scrollTop=n/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let l of this.state.facet(Zw))l(e)}get themeClasses(){return eb+" "+(this.state.facet(tb)?RI:$I)+" "+this.state.facet(Pf)}updateAttrs(){let t=xM(this,fI,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(gs)?"true":"false",class:"cm-content",style:`${C.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),xM(this,vx,e);let i=this.observer.ignore(()=>{let n=jw(this.contentDOM,this.contentAttrs,e),r=jw(this.dom,this.editorAttrs,t);return n||r});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let n of i.effects)if(n.is(_.announce)){e&&(this.announceDOM.textContent=""),e=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(Dh);let t=this.state.facet(_.cspNonce);I.mount(this.root,this.styleModules.concat(hJ).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(this.measureRequests.indexOf(t)>-1)return;if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.plugin!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.plugin==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return Kp(this,t,eM(this,t,e,i))}moveByGroup(t,e){return Kp(this,t,eM(this,t,e,i=>kU(this,t.head,i)))}visualLineSide(t,e){let i=this.bidiSpans(t),n=this.textDirectionAt(t.from),r=i[e?i.length-1:0];return D.cursor(r.side(e,n)+t.from,r.forward(!e,n)?1:-1)}moveToLineBoundary(t,e,i=!0){return vU(this,t,e,i)}moveVertically(t,e,i){return Kp(this,t,AU(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),yI(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(t),r=this.bidiSpans(n),o=r[Qs.find(r,t-n.from,-1,e)];return vg(i,o.dir==Fe.LTR==e>0)}coordsForChar(t){return this.readMeasured(),this.docView.coordsForChar(t)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(hI)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>dJ)return tI(t.length);let e=this.textDirectionAt(t.from),i;for(let r of this.bidiCache)if(r.from==t.from&&r.dir==e&&(r.fresh||_3(r.isolates,i=YC(this,t))))return r.order;i||(i=YC(this,t));let n=sU(t.text,e,i);return this.bidiCache.push(new Gd(t.from,t.to,e,i,!0,n)),n}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||C.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{H3(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Of.of(new Qo(typeof t=="number"?D.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}scrollSnapshot(){let{scrollTop:t,scrollLeft:e}=this.scrollDOM,i=this.viewState.scrollAnchorAt(t);return Of.of(new Qo(D.cursor(i.from),"start","start",i.top-t,e,!0))}setTabFocusMode(t){t==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof t=="boolean"?this.inputState.tabFocusMode=t?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+t)}static domEventHandlers(t){return ec.define(()=>({}),{eventHandlers:t})}static domEventObservers(t){return ec.define(()=>({}),{eventObservers:t})}static theme(t,e){let i=I.newName(),n=[Pf.of(i),Dh.of(ib(`.${i}`,t))];return e&&e.dark&&n.push(tb.of(!0)),n}static baseTheme(t){return Mj.lowest(Dh.of(ib("."+eb,t,BI)))}static findFromDOM(t){var e;let i=t.querySelector(".cm-content"),n=i&&tt.get(i)||tt.get(t);return((e=n?.rootView)===null||e===void 0?void 0:e.view)||null}}_.styleModule=Dh;_.inputHandler=oI;_.clipboardInputFilter=xx;_.clipboardOutputFilter=Sx;_.scrollHandler=aI;_.focusChangeEffect=lI;_.perLineTextDirection=hI;_.exceptionSink=rI;_.updateListener=Zw;_.editable=gs;_.mouseSelectionStyle=sI;_.dragMovesSelection=nI;_.clickAddsSelectionRange=iI;_.decorations=ic;_.outerDecorations=uI;_.atomicRanges=Ac;_.bidiIsolatedRanges=dI;_.scrollMargins=gI;_.darkTheme=tb;_.cspNonce=F.define({combine:s=>s.length?s[0]:""});_.contentAttributes=vx;_.editorAttributes=fI;_.lineWrapping=_.contentAttributes.of({class:"cm-lineWrapping"});_.announce=oe.define();const dJ=4096,bM={};class Gd{constructor(t,e,i,n,r,o){this.from=t,this.to=e,this.dir=i,this.isolates=n,this.fresh=r,this.order=o}static update(t,e){if(e.empty&&!t.some(r=>r.fresh))return t;let i=[],n=t.length?t[t.length-1].dir:Fe.LTR;for(let r=Math.max(0,t.length-10);r<t.length;r++){let o=t[r];o.dir==n&&!e.touchesRange(o.from,o.to)&&i.push(new Gd(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function xM(s,t,e){for(let i=s.state.facet(t),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&Gw(o,e)}return e}class kl extends bl{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}kl.prototype.elementClass="";kl.prototype.toDOM=void 0;kl.prototype.mapMode=ki.TrackBefore;kl.prototype.startSide=kl.prototype.endSide=-1;kl.prototype.point=!0;const gJ=({value:s,onChange:t})=>{const e=Wr.useRef(null),i=Wr.useRef(null),n=Wr.useRef(t);return Wr.useEffect(()=>{n.current=t},[t]),Wr.useEffect(()=>{if(!(!e.current||i.current))return i.current=new _({parent:e.current,extensions:[bj]}),()=>i.current?.destroy()},[]),Wr.useEffect(()=>{if(i.current&&s!==void 0){const r=i.current.state.doc.toString();s!==r&&i.current.dispatch({changes:{from:0,to:r.length,insert:s}})}},[s]),Jl.jsx("div",{ref:e,style:{height:"300px",border:"1px solid #ddd"}})};function r_(){return Jl.jsxs("div",{className:"h-full w-full",children:[Jl.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Markdown Editor"}),Jl.jsx("p",{className:"text-sm text-muted-foreground",children:"Overview for App 2."}),Jl.jsx(gJ,{value:"// Type here",onChange:console.log})]})}export{r_ as default};
